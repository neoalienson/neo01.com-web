<!DOCTYPE html><html lang="zh-CN"><head><!-- hexo injector head_begin start --><!-- Google tag (gtag.js) begins-->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3DZR3TQYCY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-3DZR3TQYCY');
    </script>
    <!-- Google tag (gtag.js) ends-->
    <!-- hexo injector head_begin end -->
    <meta charset="utf-8">
    <!-- security headers starts -->
    <!-- meta http-equiv="content-security-policy" content="script-src 'sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=' 'sha256-lJjk3/dvd+wXqRFjV7T5L/nXJXr5NjUjmsKSPEe+ass=';" -->
    <!-- security headers ends -->
    <!-- favicon starts -->    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <!-- favicon ends -->
    

    
    <title>管理您自己的 VPN - 省钱达人指南 | Decoding Digital Anomalies</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="keywords" content="Google,terraform,cloud,Azure">
    
    
    <meta name="description" content="抛弃 VPN 订阅，开始像数字游牧民族一样生活 - 减去 Instagram 上值得拍照的咖啡店氛围。只需使用按需付费的云端 VPN 即可（您的钱包会感谢您）！">
<meta property="og:type" content="article">
<meta property="og:title" content="管理您自己的 VPN - 省钱达人指南">
<meta property="og:url" content="https://neo01.com/zh-CN/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide/index.html">
<meta property="og:site_name" content="Decoding Digital Anomalies">
<meta property="og:description" content="抛弃 VPN 订阅，开始像数字游牧民族一样生活 - 减去 Instagram 上值得拍照的咖啡店氛围。只需使用按需付费的云端 VPN 即可（您的钱包会感谢您）！">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://neo01.com/zh-CN/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide/index_head.jpeg">
<meta property="article:published_time" content="2024-01-11T16:00:00.000Z">
<meta property="article:modified_time" content="2024-05-06T16:00:00.000Z">
<meta property="article:author" content="Neo Alienson">
<meta property="article:tag" content="Google">
<meta property="article:tag" content="terraform">
<meta property="article:tag" content="cloud">
<meta property="article:tag" content="Azure">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://neo01.com/zh-CN/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide/index_head.jpeg">
    
    

    
        <link rel="alternate" href="/atom.xml" title="Decoding Digital Anomalies" type="application/atom+xml">
    

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/libs/titillium-web/styles.css">


    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/css/prism-line-numbers.css">

    
<link rel="stylesheet" href="/css/prism.min.css">


    


    


    
    
        
<link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">

    
    
        
<link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">

    


<!-- hexo injector head_end start --><script type="text/javascript" src="/js/bundle_first.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="stylesheet" type="text/css" href="/cache/cookieconsent.css"><script id="mermaid-scripts" src="/cache/mermaid.min.local.js"></script>
<script>mermaid.initialize({theme: 'default'});</script><style id="github-card-styles">.github-card {
  border-radius: 0.5rem;
  padding: 1.5rem;
  margin: 16px 15px 0 0;
  background: white;
  border: 1px solid #e5e7eb;
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
  display: flex;
  flex-direction: column;
}

.github-card.responsive {
  max-width: 100%;
}

.github-card-header {
  text-align: center;
  margin-bottom: 1rem;
}

.github-card-avatar {
  border-radius: 50%;
  padding-bottom: 1rem;
}

.github-card h3.github-card-name {
  font-size: 1.25rem;
  font-weight: bold;
}

.github-card-name a {
  text-decoration: none;
  color: #1f2937;
}

.github-card p.github-card-username {
  color: #6b7280;
}

.github-card-details {
  text-align: left;
}

.github-card h3.github-card-name,
.github-card p.github-card-username,
.github-card p.github-card-location,
.github-card p.github-card-blog,
.github-card p.github-card-bio {
  margin: 0;
  padding:  0 0 0.5em 0;
  line-height: 1rem;
  color: #6b7280;
}

.github-card-blog a {
  color: #3b82f6;
  text-decoration: none;
}

.github-card-stats {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.75rem;
  margin-bottom: 1rem;
}

.github-card-stat {
  text-align: center;
  padding: 0.5rem;
  background: #f9fafb;
  border-radius: 0.375rem;
}

.github-card-stat-number {
  font-size: 1.5rem;
  font-weight: bold;
  color: #1f2937;
}

.github-card-stat-label {
  font-size: 1rem;
  color: #6b7280;
}

.github-card-languages {
  margin-top: 1rem;
}

.github-card-language-bar {
  display: flex;
  height: 8px;
  border-radius: 4px;
  overflow: hidden;
  background: #f3f4f6;
  margin-bottom: 0.75rem;
}

.github-card-languages-list {
  display: flex;
  flex-wrap: wrap;
  gap: 0 1rem;
  font-size: 0.75rem;
}

.github-card-language-item {
  display: flex;
  align-items: center;
  gap: 0 0.25rem;
  color: #6b7280;
}

.github-card-language-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}

.github-card-language-segment {
  height: 100%;
  transition: width 0.3s ease;
}

.github-card-language-segment:first-child {
  border-top-left-radius: 4px;
  border-bottom-left-radius: 4px;
}

.github-card-language-segment:last-child {
  border-top-right-radius: 4px;
  border-bottom-right-radius: 4px;
}

.github-repo-card {
  display: flex;
  flex-direction: row !important;
  align-items: flex-start;
  gap: 1rem;
  min-height: inherit;
}

.github-repo-icon {
  font-size: 3rem;
  color: #6b7280;
  flex-shrink: 0;
}

.github-repo-info {
  flex: 1;
}

.github-repo-info h3 {
  margin: 0 0 0.5rem 0;
  font-size: 1.25rem;
  font-weight: bold;
}

.github-repo-info h3 a {
  text-decoration: none;
  color: #1f2937;
}

.github-repo-info p {
  margin: 0 0 1rem 0;
  color: #6b7280;
  line-height: 1.4;
}

.github-repo-stats {
  display: flex;
  gap: 1.5rem;
  flex-wrap: wrap;
}

.github-repo-stat {
  color: #6b7280;
  font-size: 0.875rem;
}

.github-repo-octocat {
  flex-shrink: 0;
  align-self: flex-start;
}

.github-repo-octocat svg {
  fill: #6b7280;
}

.github-card-error {
  color: #d73a49;
  padding: 8px;
  border: 1px solid #d73a49;
  border-radius: 4px;
}</style></head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" title="Homepage" class="logo"></a>
                    </h1>
                    
                        <h2 class="subtitle-wrap">
                          
                            <p class="title">解码数字异常</p>
                          
                          <p class="subtitle">有时功能就是数字兔子洞中的错误，反之亦然</p>
                        </h2>
                    
                    <div id="lang-selector">
                        <span class="lang-icon">🌐</span>
                        
                        
                            
                            
                            <a href="/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide/" class="lang-link">English</a>
                        
                            
                            <span class="lang-sep">|</span>
                            <a href="/zh-TW/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide/" class="lang-link">繁體中文</a>
                        
                    </div>
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/zh-CN/">主页</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-CN/categories/AI/">人工智能</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-CN/categories/AI/Art-Gallery/">艺术画廊</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-CN/categories/Architecture/">架构</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-CN/categories/Cybersecurity/">网络安全</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-CN/categories/Development/">开发</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-CN/categories/Misc/">杂项</a></li></ul>
                                    
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/zh-CN/about-me">关于</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" id="search-form-input" placeholder="搜索">
        <button type="submit" title="搜索" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" id="ins-search-input" placeholder="想要查找什么...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script integrity="sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=">
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
        LANG: 'zh-CN',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>




</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Development/">Development</a>
    </h1>
</div>

                        <div class="main-body-content">
                            <article id="post-2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide-zh-CN" class="article article-single article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner responsive-content">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        管理您自己的 VPN - 省钱达人指南
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
      <i class="fa fa-calendar"></i>
        
          Created <time datetime="2024-01-11T16:00:00.000Z" itemprop="datePublished">2024-01-12</time>
          &nbsp;<i class="fa fa-calendar"></i>
          Updated <time datetime="2024-05-06T16:00:00.000Z" itemprop="datePublished">2024-05-07</time>
        
    </div>


                

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/zh-CN/tags/Google/">Google</a> <a class="tag-link" href="/zh-CN/tags/terraform/">terraform</a> <a class="tag-link" href="/zh-CN/tags/cloud/">cloud</a> <a class="tag-link" href="/zh-CN/tags/Azure/">Azure</a>
    </div>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#VPN-%E5%92%8C%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%AE%9A%E4%BB%B7%E6%A8%A1%E5%BC%8F%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">VPN 和代理服务定价模式的问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%89%E9%9C%80%E4%BA%91%E7%AB%AF%E4%BB%A3%E7%90%86"><span class="toc-text">按需云端代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%B7%E6%A0%BC%E6%AF%94%E8%BE%83"><span class="toc-text">价格比较</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-WireGuard-%E7%9A%84-VPN"><span class="toc-text">使用 WireGuard 的 VPN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%8F%8B%E5%A5%BD%E7%9A%84%E5%BC%80%E5%85%B3"><span class="toc-text">用户友好的开关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E6%8F%90%E9%86%92"><span class="toc-text">关闭提醒</span></a></li></ol>
            <p><img src="/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide/index_head.jpeg" alt=""></p>
<p>啊，互联网 - 一个充满知识和猫咪视频的广阔空间。但当您在这个数字海洋中航行时，您可能会发现自己想要更多隐私，或者您只是厌倦了根据您的位置被告知可以和不可以查看什么内容…</p>
<h2 id="VPN-和代理服务定价模式的问题">VPN 和代理服务定价模式的问题</h2>
<p>让我们快速看一下截至 2025 年 10 月的 VPN 服务价格</p>
<table>
<thead>
<tr>
<th>VPN 提供商</th>
<th>每月价格（美元）</th>
<th>订阅每月价格（美元）</th>
</tr>
</thead>
<tbody>
<tr>
<td>Surfshark（入门版）</td>
<td>$15.45</td>
<td>2 年订阅 $1.99</td>
</tr>
<tr>
<td>ExpressVPN（基本版）</td>
<td>$12.99</td>
<td>2 年订阅 $3.49</td>
</tr>
</tbody>
</table>
<p>最好的按需付费选项是按月计费。按使用量付费的模式不存在，我们被迫采用基于订阅的模式。基于订阅的模式就像雇用一个坚持签订一年合约的保镖，而您只需要有人在每月一次的可疑回家路上保护您。像我这样的省钱达人不接受这种订阅优惠。</p>
<h2 id="按需云端代理">按需云端代理</h2>
<p>现在，让我们检视可用于您的 VPN/代理冒险的云端服务。您可以在云端上创建 VPN/代理服务器。为简单起见，让我们从 Google Cloud 上的代理服务器开始。以下是它的工作原理：</p>
<div class="mermaid">flowchart LR
pc["您的电脑\n在国家 A\n\n"]
ssh["SSH 通道\n\n"]
pc--&gt;ssh
proxy["Google Cloud 上的代理\n在国家 B\n\n"]
ssh--&gt;proxy
target["目标网站\n\n"]
proxy--&gt;target</div>
<p>流程图说明了在 Google Cloud 上设置代理服务器。您的电脑（PC）在国家 A，您想访问受限制或因您的位置而被封锁内容的目标网站（target）。您从电脑创建 SSH 通道（ssh）到 Google Cloud 上的代理服务器（proxy），该服务器位于国家 B。这允许您绕过地理限制并访问目标网站，就像您在国家 B 一样。</p>
<h3 id="提供商-1-Google-Cloud">提供商 1. Google Cloud</h3>
<p>以下是在 Google Cloud 上创建带有代理（squid）的计算引擎的 Terraform 脚本。</p>
<pre class="line-numbers language-hcl" data-language="hcl"><div class="caption"><span>main.tf</span></div><code class="language-hcl"><span class="token keyword">resource <span class="token type variable">"google_compute_instance"</span></span> <span class="token string">"default"</span> <span class="token punctuation">{</span>
  <span class="token property">name</span>         <span class="token punctuation">=</span> <span class="token string">"proxy-server"</span>
  <span class="token property">machine_type</span> <span class="token punctuation">=</span> <span class="token string">"e2-micro"</span>
  <span class="token property">zone</span>         <span class="token punctuation">=</span> <span class="token string">"us-west1-a"</span>
  <span class="token property">tags</span>         <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"ssh"</span><span class="token punctuation">]</span>

  <span class="token keyword">scheduling</span> <span class="token punctuation">{</span>
    <span class="token property">provisioning_model</span> <span class="token punctuation">=</span> <span class="token string">"SPOT"</span>
    <span class="token property">automatic_restart</span>  <span class="token punctuation">=</span> <span class="token boolean">false</span>
    <span class="token property">preemptible</span>        <span class="token punctuation">=</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">boot_disk</span> <span class="token punctuation">{</span>
    <span class="token keyword">initialize_params</span> <span class="token punctuation">{</span>
      <span class="token property">image</span> <span class="token punctuation">=</span> <span class="token string">"ubuntu-os-cloud/ubuntu-2004-lts"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">network_interface</span> <span class="token punctuation">{</span>
    <span class="token property">network</span> <span class="token punctuation">=</span> <span class="token string">"default"</span>
    <span class="token keyword">access_config</span> <span class="token punctuation">{</span>
      <span class="token comment">// Ephemeral public IP</span>
      <span class="token property">network_tier</span> <span class="token punctuation">=</span> <span class="token string">"STANDARD"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">service_account</span> <span class="token punctuation">{</span>
    <span class="token property">scopes</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"cloud-platform"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token property">metadata</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
    <span class="token property">ssh-keys</span>       <span class="token punctuation">=</span> format(<span class="token string">"%s:%s"</span>, var.ssh_username, var.ssh_public_key)
    <span class="token property">startup-script</span> <span class="token punctuation">=</span> <span class="token string">"sudo apt-get update;sudo apt-get install -y squid;sudo systemctl start squid"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/google/main.tf">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/google/main.tf</a></p>
<pre class="line-numbers language-hcl" data-language="hcl"><div class="caption"><span>variables.tf</span></div><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> "ssh_username" </span></span><span class="token punctuation">{</span>
  <span class="token property">type</span>        <span class="token punctuation">=</span> string
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"username of SSH to the compute engine"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "ssh_public_key" </span></span><span class="token punctuation">{</span>
  <span class="token property">type</span>        <span class="token punctuation">=</span> string
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"Public key for SSH"</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/google/variables.tf">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/google/variables.tf</a></p>
<pre class="line-numbers language-hcl" data-language="hcl"><div class="caption"><span>output.tf</span></div><code class="language-hcl"><span class="token keyword">output<span class="token type variable"> "ip" </span></span><span class="token punctuation">{</span>
  <span class="token property">value</span> <span class="token punctuation">=</span> google_compute_instance.default.network_interface.<span class="token number">0.</span>access_config.<span class="token number">0.</span>nat_ip
<span class="token punctuation">}</span>

<span class="token keyword">output<span class="token type variable"> "command" </span></span><span class="token punctuation">{</span>
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"Command to setup ssh tunnel to the proxy server"</span>
  <span class="token property">value</span> <span class="token punctuation">=</span> format(<span class="token string">"ssh-keygen -R %s; ssh -L3128:localhost:3128 %s@%s"</span>,
    google_compute_instance.default.network_interface.<span class="token number">0.</span>access_config.<span class="token number">0.</span>nat_ip,
    var.ssh_username,
  google_compute_instance.default.network_interface.<span class="token number">0.</span>access_config.<span class="token number">0.</span>nat_ip)
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/google/output.tf">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/google/output.tf</a></p>
<p>执行 <code>terraform apply</code>：</p>
<pre class="language-shell-session" data-language="shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">terraform apply</span></span>

<span class="token output">var.google_access_credentials
  The json file that contains key of your service account in Google Cloud

  Enter a value: a.josn

var.project
  Google Cloud Project Name

  Enter a value: a

var.ssh_public_key
  Public key for SSH

  Enter a value: ssh-rsa AAAAB...

var.ssh_username
  username of SSH to the compute engine

  Enter a value: neo

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the
following symbols:
  + create

Terraform will perform the following actions:

  # google_compute_instance.default will be created
  + resource "google_compute_instance" "default" {
      ...
      + machine_type         = "e2-micro"
      + metadata             = {
          + "ssh-keys"       = "neo:ssh-rsa AAAAB..."
          + "startup-script" = "sudo apt-get update;sudo apt-get install -y squid;sudo systemctl start squid"
        }
      ...
    }

Plan: 1 to add, 0 to change, 0 to destroy.

Changes to Outputs:
  + command = (known after apply)
  + ip      = (known after apply)

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

google_compute_instance.default: Creating...
google_compute_instance.default: Still creating... [10s elapsed]
google_compute_instance.default: Creation complete after 17s [id=projects/a/zones/us-west1-a/instances/proxy-server]

Apply complete! Resources: 1 added, 0 changed, 0 destroyed.

Outputs:

command = "ssh -L3128:localhost:3128 neo@123.123.123.123"
ip = "123.123.123.123"</span></code></pre>
<p>要设置到代理的 SSH 通道，请使用输出 <code>command</code> 中提供的命令。您可能需要等待片刻，直到代理准备就绪。一旦代理准备就绪，您的浏览器就可以使用 <code>localhost:3128</code> 作为代理。</p>
<p>当云端服务重复使用 IP 地址来创建新的计算实例时，如果您之前曾 SSH 到该 IP 地址，您可能会遇到主机验证错误。这是因为新的计算实例生成了新的主机密钥，该密钥与您在 <code>.ssh/known_hosts</code> 中信任的密钥不符。要解决此问题，您可以使用 <code>ssh-keygen -R</code> 删除受信任的主机密钥，或将私钥从本机发送到新的计算实例。</p>
<p>完成后记得销毁计算引擎：</p>
<pre class="language-shell-session" data-language="shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">terraform destroy</span></span>

<span class="token output">google_compute_instance.default: Refreshing state... [id=projects/f-01man-com/zones/us-west1-a/instances/proxy-server]

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the
following symbols:
  - destroy

Terraform will perform the following actions:

  # google_compute_instance.default will be destroyed
  - resource "google_compute_instance" "default" {
      ...
    }

Plan: 0 to add, 0 to change, 1 to destroy.

Do you really want to destroy all resources?
  Terraform will destroy all your managed infrastructure, as shown above.
  There is no undo. Only 'yes' will be accepted to confirm.

  Enter a value: yes

google_compute_instance.default: Destroying... [id=projects/a/zones/us-west1-a/instances/proxy-server]
google_compute_instance.default: Still destroying... [id=projects/a/zones/us-west1-a/instances/proxy-server, 10s elapsed]
google_compute_instance.default: Destruction complete after 16s

Destroy complete! Resources: 1 destroyed.</span></code></pre>
<p>鉴于我的使用量极低，例如每月 30 分钟，Google 每月向我收取约 0.20 美元。然而，这并不能阻止我探索其他更便宜的替代方案。</p>
<h3 id="提供商-2-Azure">提供商 2. Azure</h3>
<pre class="line-numbers language-hcl" data-language="hcl"><div class="caption"><span>main.tf</span></div><code class="language-hcl"><span class="token keyword">resource <span class="token type variable">"azurerm_resource_group"</span></span> <span class="token string">"rg"</span> <span class="token punctuation">{</span>
  <span class="token property">name</span>     <span class="token punctuation">=</span> <span class="token string">"squid-rg"</span>
  <span class="token property">location</span> <span class="token punctuation">=</span> <span class="token string">"West US"</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"azurerm_virtual_machine"</span></span> <span class="token string">"proxy"</span> <span class="token punctuation">{</span>
  <span class="token property">name</span> <span class="token punctuation">=</span> <span class="token string">"squid-proxy-vm"</span>

  <span class="token comment"># charge you if you dont delete</span>
  <span class="token property">delete_data_disks_on_termination</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
  <span class="token property">delete_os_disk_on_termination</span>    <span class="token punctuation">=</span> <span class="token boolean">true</span>

  <span class="token property">resource_group_name</span>   <span class="token punctuation">=</span> azurerm_resource_group.rg.name
  <span class="token property">location</span>              <span class="token punctuation">=</span> azurerm_resource_group.rg.location
  <span class="token property">network_interface_ids</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>azurerm_network_interface.nic.id<span class="token punctuation">]</span>
  <span class="token property">vm_size</span>               <span class="token punctuation">=</span> <span class="token string">"Standard_B1s"</span>
  <span class="token keyword">storage_os_disk</span> <span class="token punctuation">{</span>
    <span class="token property">name</span>              <span class="token punctuation">=</span> <span class="token string">"os"</span>
    <span class="token property">caching</span>           <span class="token punctuation">=</span> <span class="token string">"ReadWrite"</span>
    <span class="token property">managed_disk_type</span> <span class="token punctuation">=</span> <span class="token string">"Standard_LRS"</span>
    <span class="token property">create_option</span>     <span class="token punctuation">=</span> <span class="token string">"FromImage"</span>
    <span class="token property">os_type</span>           <span class="token punctuation">=</span> <span class="token string">"Linux"</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">storage_image_reference</span> <span class="token punctuation">{</span>
    <span class="token property">publisher</span> <span class="token punctuation">=</span> <span class="token string">"Canonical"</span>
    <span class="token property">offer</span>     <span class="token punctuation">=</span> <span class="token string">"0001-com-ubuntu-server-jammy"</span>
    <span class="token property">sku</span>       <span class="token punctuation">=</span> <span class="token string">"22_04-lts"</span>
    <span class="token property">version</span>   <span class="token punctuation">=</span> <span class="token string">"latest"</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">os_profile</span> <span class="token punctuation">{</span>
    <span class="token property">admin_username</span> <span class="token punctuation">=</span> var.ssh_username
    <span class="token property">computer_name</span>  <span class="token punctuation">=</span> <span class="token string">"proxy"</span>
    <span class="token property">custom_data</span> <span class="token punctuation">=</span> base64encode(<span class="token heredoc string">&lt;&lt;CUSTOM_DATA
#!/bin/bash
sudo apt-get update;sudo apt-get install -y squid;sudo systemctl start squid
    CUSTOM_DATA</span>
    )
  <span class="token punctuation">}</span>

  <span class="token keyword">os_profile_linux_config</span> <span class="token punctuation">{</span>
    <span class="token property">disable_password_authentication</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
    <span class="token keyword">ssh_keys</span> <span class="token punctuation">{</span>
      <span class="token property">path</span> <span class="token punctuation">=</span> <span class="token string">"/home/<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">ssh_username</span><span class="token punctuation">}</span></span>/.ssh/authorized_keys"</span>
      <span class="token property">key_data</span> <span class="token punctuation">=</span> var.ssh_public_key
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"azurerm_network_interface"</span></span> <span class="token string">"nic"</span> <span class="token punctuation">{</span>
  <span class="token property">name</span>                <span class="token punctuation">=</span> <span class="token string">"squid-nic"</span>
  <span class="token property">resource_group_name</span> <span class="token punctuation">=</span> azurerm_resource_group.rg.name
  <span class="token property">location</span>            <span class="token punctuation">=</span> azurerm_resource_group.rg.location

  <span class="token keyword">ip_configuration</span> <span class="token punctuation">{</span>
    <span class="token property">name</span>                          <span class="token punctuation">=</span> <span class="token string">"squid-ipconfig"</span>
    <span class="token property">subnet_id</span>                     <span class="token punctuation">=</span> azurerm_subnet.subnet.id
    <span class="token property">private_ip_address_allocation</span> <span class="token punctuation">=</span> <span class="token string">"Dynamic"</span>
    <span class="token property">public_ip_address_id</span>          <span class="token punctuation">=</span> azurerm_public_ip.proxy.id
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"azurerm_subnet"</span></span> <span class="token string">"subnet"</span> <span class="token punctuation">{</span>
  <span class="token property">name</span>                 <span class="token punctuation">=</span> <span class="token string">"squid-subnet"</span>
  <span class="token property">resource_group_name</span>  <span class="token punctuation">=</span> azurerm_resource_group.rg.name
  <span class="token property">virtual_network_name</span> <span class="token punctuation">=</span> azurerm_virtual_network.vnet.name
  <span class="token property">address_prefixes</span>     <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"10.0.0.0/24"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"azurerm_virtual_network"</span></span> <span class="token string">"vnet"</span> <span class="token punctuation">{</span>
  <span class="token property">name</span>                <span class="token punctuation">=</span> <span class="token string">"squid-vnet"</span>
  <span class="token property">resource_group_name</span> <span class="token punctuation">=</span> azurerm_resource_group.rg.name
  <span class="token property">address_space</span>       <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"10.0.0.0/8"</span><span class="token punctuation">]</span>
  <span class="token property">location</span>            <span class="token punctuation">=</span> <span class="token string">"West US"</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"azurerm_public_ip"</span></span> <span class="token string">"proxy"</span> <span class="token punctuation">{</span>
  <span class="token property">name</span>                <span class="token punctuation">=</span> <span class="token string">"squidPublicIp1"</span>
  <span class="token property">resource_group_name</span> <span class="token punctuation">=</span> azurerm_resource_group.rg.name
  <span class="token property">location</span>            <span class="token punctuation">=</span> azurerm_resource_group.rg.location
  <span class="token property">allocation_method</span>   <span class="token punctuation">=</span> <span class="token string">"Static"</span>

  <span class="token keyword">lifecycle</span> <span class="token punctuation">{</span>
    <span class="token property">create_before_destroy</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/azure/main.tf">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/azure/main.tf</a></p>
<pre class="line-numbers language-hcl" data-language="hcl"><div class="caption"><span>variables.tf</span></div><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> "ssh_username" </span></span><span class="token punctuation">{</span>
    <span class="token property">type</span>        <span class="token punctuation">=</span> string
    <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"username of SSH to the compute engine"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "ssh_public_key" </span></span><span class="token punctuation">{</span>
    <span class="token property">type</span>       <span class="token punctuation">=</span> string
    <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"Public key for SSH"</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/azure/variables.tf">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/azure/variables.tf</a></p>
<pre class="line-numbers language-hcl" data-language="hcl"><div class="caption"><span>output.tf</span></div><code class="language-hcl"><span class="token keyword">output<span class="token type variable"> "ip" </span></span><span class="token punctuation">{</span>
    <span class="token property">value</span> <span class="token punctuation">=</span> azurerm_public_ip.proxy.ip_address
<span class="token punctuation">}</span>

<span class="token keyword">output<span class="token type variable"> "command" </span></span><span class="token punctuation">{</span>
    <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"Command to setup ssh tunnel to the proxy server"</span>
    <span class="token property">value</span>       <span class="token punctuation">=</span> format(<span class="token string">"ssh-keygen -R %s; ssh -L3128:localhost:3128 %s@%s"</span>,
      azurerm_public_ip.proxy.ip_address,
      var.ssh_username,
      azurerm_public_ip.proxy.ip_address)
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/azure/output.tf">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/azure/output.tf</a></p>
<p>创建和销毁需要时间。您可以检查 <code>/var/log/cloud-init.log</code> 并寻找 <code>subp.py</code> 和 <code>part</code> 来进行故障排除，例如：</p>
<pre class="language-none"><code class="language-none">2024-05-07 14:14:02,864 - subp.py[DEBUG]: Running command ['/var/lib/cloud/instance/scripts/part-001'] with allowed return codes [0] (shell=False, capture=False)
2024-05-07 14:14:02,864 - subp.py[DEBUG]: Exec format error. Missing #! in script?
Command: ['/var/lib/cloud/instance/scripts/part-001']
Exit code: -
Reason: [Errno 8] Exec format error: b'/var/lib/cloud/instance/scripts/part-001'</code></pre>
<h3 id="其他云端服务提供商">其他云端服务提供商</h3>
<p>我也尝试过阿里云和华为云。然而，阿里云在使用来自中国以外国家的 IP 地址和资源几次后需要账户验证，要求我上传护照等。此外，最低计算服务是按月计费，而不是像 Google Cloud 那样基于消费。</p>
<p>另一方面，华为云更好；计算服务可以基于消费。然而，带宽费用是按日订阅而不是计量，导致每日费用为 2 美元！因此，我不建议省钱达人使用阿里云和华为云。</p>
<h3 id="云端不可知-Terraform-脚本">云端不可知 Terraform 脚本</h3>
<p>现在我们有 2 个云端提供商选项，Azure 和 Google。我们想创建云端不可知的 Terraform 脚本，因为它允许我们维护一组代码并将其应用于多个云端提供商。这种方法允许我们在需要时轻松切换不同的云端服务提供商。云端不可知架构加上省钱！</p>
<p>让我们将文件夹结构如下：</p>
<pre class="language-none"><code class="language-none">\ - root
    \ - main.tf
      - variables.tf
      - output.tf
      - provider.tf
    \ - modules
        \ - google
            \ - main.tf
              - variables.tf
              - output.tf
        \ - azure
            \ - main.tf
              - variables.tf
              - output.tf</code></pre>
<p><code>root</code> 文件夹作为云端不可知的抽象层，而 <code>modules</code> 下的子文件夹，即 <code>modules/azure</code> 和 <code>modules/google</code>，作为云端特定的实现。您可以期望从执行 <code>root</code> 脚本中通过提供您的用户名和公钥来配置云端服务器，并从输出返回设置 SSH 通道的命令。使用哪个提供商取决于 <code>cloud_service_provider</code> 变量，从示例中可以是 <code>azure</code> 或 <code>google</code>。</p>
<pre class="language-hcl" data-language="hcl"><div class="caption"><span>/variables.tf</span></div><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> "cloud_service_provider" </span></span><span class="token punctuation">{</span>
  <span class="token property">type</span>        <span class="token punctuation">=</span> string
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"Cloud Service Provider: azure or google"</span>

  <span class="token keyword">validation</span> <span class="token punctuation">{</span>
    <span class="token property">condition</span>     <span class="token punctuation">=</span> contains(<span class="token punctuation">[</span><span class="token string">"azure"</span>, <span class="token string">"google"</span><span class="token punctuation">]</span>, var.cloud_service_provider)
    <span class="token property">error_message</span> <span class="token punctuation">=</span> <span class="token string">"Valid values for var: cloud_service_provider are (azure, google)."</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "ssh_username" </span></span><span class="token punctuation">{</span>
  <span class="token property">type</span>        <span class="token punctuation">=</span> string
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"username of SSH to the compute engine"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "ssh_public_key" </span></span><span class="token punctuation">{</span>
  <span class="token property">type</span>        <span class="token punctuation">=</span> string
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"Public key for SSH"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "google_project" </span></span><span class="token punctuation">{</span>
  <span class="token property">type</span>        <span class="token punctuation">=</span> string
  <span class="token property">default</span>     <span class="token punctuation">=</span> <span class="token string">"no project"</span>
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"Google Cloud Project Name."</span>
<span class="token punctuation">}</span>

<span class="token keyword">locals</span> <span class="token punctuation">{</span>
  <span class="token comment"># cross variables validation could be improved in Terraform v1.9.0</span>
  <span class="token comment"># tflint-ignore: terraform_unused_declarations</span>
  <span class="token property">validate_project</span> <span class="token punctuation">=</span> (var.google_project <span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token string">"no project"</span> &amp;&amp; var.cloud_service_provider <span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token string">"google"</span>) ? tobool(
  <span class="token string">"google_project must be provided when the provider is 'google'."</span>) : <span class="token boolean">true</span>
<span class="token punctuation">}</span></code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/variables.tf">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/variables.tf</a></p>
<p><code>/main.tf</code> 非常简单，它根据需求启用模块来实现云端代理并停用其他模块：</p>
<pre class="line-numbers language-hcl" data-language="hcl"><div class="caption"><span>/main.tf</span></div><code class="language-hcl"><span class="token keyword">module<span class="token type variable"> "azure_server" </span></span><span class="token punctuation">{</span>
  <span class="token property">source</span> <span class="token punctuation">=</span> <span class="token string">"./modules/azure"</span>
  <span class="token property">count</span>  <span class="token punctuation">=</span> (var.cloud_service_provider <span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token string">"azure"</span>) ? <span class="token number">1</span> : <span class="token number">0</span>

  <span class="token property">ssh_public_key</span> <span class="token punctuation">=</span> var.ssh_public_key
  <span class="token property">ssh_username</span>   <span class="token punctuation">=</span> var.ssh_username
<span class="token punctuation">}</span>

<span class="token keyword">module<span class="token type variable"> "google_server" </span></span><span class="token punctuation">{</span>
  <span class="token property">source</span>         <span class="token punctuation">=</span> <span class="token string">"./modules/google"</span>
  <span class="token property">count</span>          <span class="token punctuation">=</span> (var.cloud_service_provider <span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token string">"google"</span>) ? <span class="token number">1</span> : <span class="token number">0</span>
  <span class="token property">ssh_public_key</span> <span class="token punctuation">=</span> var.ssh_public_key
  <span class="token property">ssh_username</span>   <span class="token punctuation">=</span> var.ssh_username
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/main.tf">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/main.tf</a></p>
<p><code>/output.tf</code> 与 <code>/main.tf</code> 类似，它也返回 <code>ip</code> 和 <code>command</code>：</p>
<pre class="line-numbers language-hcl" data-language="hcl"><div class="caption"><span>/output.tf</span></div><code class="language-hcl"><span class="token keyword">output<span class="token type variable"> "ip" </span></span><span class="token punctuation">{</span>
  <span class="token property">value</span> <span class="token punctuation">=</span> (var.cloud_service_provider <span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token string">"azure"</span>) ? module.azure_server<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.ip : module.google_server<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.ip
<span class="token punctuation">}</span>

<span class="token keyword">output<span class="token type variable"> "command" </span></span><span class="token punctuation">{</span>
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"Command to setup ssh tunnel to the proxy server"</span>
  <span class="token property">value</span>       <span class="token punctuation">=</span> (var.cloud_service_provider <span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token string">"azure"</span>) ? module.azure_server<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.command : module.google_server<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.command
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/output.tf">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/output.tf</a></p>
<p>Terraform 脚本中的提供商从模块中删除并放在一起到 <code>/provider.tf</code> 中。</p>
<pre class="line-numbers language-hcl" data-language="hcl"><div class="caption"><span>/provider.tf</span></div><code class="language-hcl"><span class="token keyword">terraform</span> <span class="token punctuation">{</span>
  <span class="token keyword">required_providers</span> <span class="token punctuation">{</span>
    <span class="token property">azapi</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
      <span class="token property">source</span> <span class="token punctuation">=</span> <span class="token string">"Azure/azapi"</span>
    <span class="token punctuation">}</span>
    <span class="token property">azurerm</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
      <span class="token property">source</span> <span class="token punctuation">=</span> <span class="token string">"hashicorp/azurerm"</span>
    <span class="token punctuation">}</span>
    <span class="token property">google</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
      <span class="token property">source</span> <span class="token punctuation">=</span> <span class="token string">"hashicorp/google"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">provider<span class="token type variable"> "azapi" </span></span><span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">provider<span class="token type variable"> "azurerm" </span></span><span class="token punctuation">{</span>
  <span class="token keyword">features</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">provider<span class="token type variable"> "google" </span></span><span class="token punctuation">{</span>
  <span class="token property">project</span> <span class="token punctuation">=</span> var.google_project
  <span class="token property">region</span>  <span class="token punctuation">=</span> <span class="token string">"us-central1"</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/provider.tf">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/provider.tf</a></p>
<blockquote>
<p>完整源代码：<a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/</a></p>
</blockquote>
<div class="github-card github-repo-card responsive" style=" min-height: 100px; text-align: left;">
        <div class="github-repo-icon">📖</div>
        <div class="github-repo-info">
          <h3><a href="https://github.com/neoalienson/cloud_vpn_proxy" target="_blank">neoalienson/cloud_vpn_proxy</a></h3>
          <p>Setup your own Cloud Agnostic cloud VPN or proxy</p>
          <div class="github-repo-stats">
            <span class="github-repo-stat">⭐ 0 Stars</span>
            <span class="github-repo-stat">🍴 0 Forks</span>
            <span class="github-repo-stat">Language: HCL</span>
          </div>
        </div>
        <div class="github-repo-octocat"><svg height="32" aria-hidden="true" viewBox="0 0 24 24" version="1.1" width="32" data-view-component="true" class="octicon octicon-mark-github v-align-middle">
    <path d="M12 1C5.923 1 1 5.923 1 12c0 4.867 3.149 8.979 7.521 10.436.55.096.756-.233.756-.522 0-.262-.013-1.128-.013-2.049-2.764.509-3.479-.674-3.699-1.292-.124-.317-.66-1.293-1.127-1.554-.385-.207-.936-.715-.014-.729.866-.014 1.485.797 1.691 1.128.99 1.663 2.571 1.196 3.204.907.096-.715.385-1.196.701-1.471-2.448-.275-5.005-1.224-5.005-5.432 0-1.196.426-2.186 1.128-2.956-.111-.275-.496-1.402.11-2.915 0 0 .921-.288 3.024 1.128a10.193 10.193 0 0 1 2.75-.371c.936 0 1.871.123 2.75.371 2.104-1.43 3.025-1.128 3.025-1.128.605 1.513.221 2.64.111 2.915.701.77 1.127 1.747 1.127 2.956 0 4.222-2.571 5.157-5.019 5.432.399.344.743 1.004.743 2.035 0 1.471-.014 2.654-.014 3.025 0 .289.206.632.756.522C19.851 20.979 23 16.854 23 12c0-6.077-4.922-11-11-11Z"></path>
</svg></div>
      </div>
<h3 id="代理就绪通知">代理就绪通知</h3>
<p><em>即将推出…</em></p>
<h2 id="价格比较">价格比较</h2>
<h3 id="Azure">Azure</h3>
<p>虚拟机<br>
虚拟网络<br>
存储<br>
带宽</p>
<h3 id="Google-Cloud">Google Cloud</h3>
<p>计算引擎<br>
网络</p>
<p><em>即将推出…</em></p>
<h2 id="使用-WireGuard-的-VPN">使用 WireGuard 的 VPN</h2>
<p><em>即将推出…</em></p>
<h2 id="用户友好的开关">用户友好的开关</h2>
<p><em>即将推出…</em></p>
<h2 id="关闭提醒">关闭提醒</h2>
<p><em>即将推出…</em></p>

        </div>
        <footer class="article-footer">
            
    <a data-url="https://neo01.com/zh-CN/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide/" data-id="c293e56" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url').replace("http://","https://"),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
    <!--script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": {
            "@type": "Person",
            "name": "Neo Alienson"
        },
        "headline": "管理您自己的 VPN - 省钱达人指南",
        "image": "https://neo01.comindex_head.jpeg",
        "keywords": "Google terraform cloud Azure",
        "genre": "Development",
        "datePublished": "2024-01-12",
        "dateCreated": "2024-01-12",
        "dateModified": "2024-05-07",
        "url": "https://neo01.com//zh-CN/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide/",
        "description": "抛弃 VPN 订阅，开始像数字游牧民族一样生活 - 减去 Instagram 上值得拍照的咖啡店氛围。只需使用按需付费的云端 VPN 即可（您的钱包会感谢您）！",
        "wordCount": 3360
    }
</script-->

</article>

                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>关注我 :</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="stack-exchange" href="https://stackexchange.com/users/2122053/neo?tab=accounts" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-exchange"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="stack-overflow" href="https://stackoverflow.com/users/1885105/neo" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-overflow"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/neoalienson" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="linkedin" href="https://linkedin.com/in/neo01" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-linkedin"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="rss" href="/atom.xml" target="_blank" rel="noopener">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    <!-- 
        
<nav id="article-nav">
    
        <a href="/zh-CN/2024/02/Free-IT-Exams-and-Certificates-For-Real/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">下一篇</strong>
        <p class="article-nav-title">
        
            真正免费的 IT 考试和证书
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/zh-TW/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">上一篇</strong>
        <p class="article-nav-title">管理您自己的 VPN - 省錢達人指南</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

     -->
    <div class="widgets-container">
        
            
                <div class="widget-wrap widget-list">
    <h3 class="widget-title">链接</h3>
    <div class="widget">
        <ul><li><a href="/zh-CN/ai">AI 游乐场</a></li><li><a href="/zh-CN/tools">工具</a></li><li><a href="/zh-CN/games">游戏</a></li><li><a href="/zh-CN/pages/useful-information">实用信息</a></li><li><a href="/zh-CN/pages/Hexo-Blogging-Cheatsheet">Hexo 博客速查表</a></li></ul>
    </div>
</div>

            
                
    
    
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/zh-CN/2025/10/CISP-Software-Security/" class="thumbnail">
    
    
        
        <span style="background-image:url(/assets/cisp/thumbnail_80.png)" alt="CISP学习指南：软件安全" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-CN/categories/Cybersecurity/">网络安全</a></p>
                            <p class="item-title"><a href="/zh-CN/2025/10/CISP-Software-Security/" class="title">CISP学习指南：软件安全</a></p>
                            <p class="item-date"><time datetime="2025-10-11T16:00:00.000Z" itemprop="datePublished">2025-10-12</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/zh-CN/2025/10/CISP-Access-Control/" class="thumbnail">
    
    
        
        <span style="background-image:url(/assets/cisp/thumbnail_80.png)" alt="CISP学习指南：访问控制" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-CN/categories/Cybersecurity/">网络安全</a></p>
                            <p class="item-title"><a href="/zh-CN/2025/10/CISP-Access-Control/" class="title">CISP学习指南：访问控制</a></p>
                            <p class="item-date"><time datetime="2025-10-10T16:00:00.000Z" itemprop="datePublished">2025-10-11</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/zh-CN/2025/10/CISP-Asset-Management/" class="thumbnail">
    
    
        
        <span style="background-image:url(/assets/cisp/thumbnail_80.png)" alt="CISP学习指南：资产管理" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-CN/categories/Cybersecurity/">网络安全</a></p>
                            <p class="item-title"><a href="/zh-CN/2025/10/CISP-Asset-Management/" class="title">CISP学习指南：资产管理</a></p>
                            <p class="item-date"><time datetime="2025-10-09T16:00:00.000Z" itemprop="datePublished">2025-10-10</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/zh-CN/2025/10/CISP-Security-Incident-Management/" class="thumbnail">
    
    
        
        <span style="background-image:url(/assets/cisp/thumbnail_80.png)" alt="CISP学习指南：信息安全事件管理与业务连续性" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-CN/categories/Cybersecurity/">网络安全</a></p>
                            <p class="item-title"><a href="/zh-CN/2025/10/CISP-Security-Incident-Management/" class="title">CISP学习指南：信息安全事件管理与业务连续性</a></p>
                            <p class="item-date"><time datetime="2025-10-08T16:00:00.000Z" itemprop="datePublished">2025-10-09</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/zh-CN/2025/10/CISP-Physical-Environmental-Security/" class="thumbnail">
    
    
        
        <span style="background-image:url(/assets/cisp/thumbnail_80.png)" alt="CISP学习指南：物理与环境安全" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-CN/categories/Cybersecurity/">网络安全</a></p>
                            <p class="item-title"><a href="/zh-CN/2025/10/CISP-Physical-Environmental-Security/" class="title">CISP学习指南：物理与环境安全</a></p>
                            <p class="item-date"><time datetime="2025-10-07T16:00:00.000Z" itemprop="datePublished">2025-10-08</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    
    
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list">
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2025/">2025</a>
                    <span class="archive-list-count">23</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2024/">2024</a>
                    <span class="archive-list-count">24</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2023/">2023</a>
                    <span class="archive-list-count">12</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2022/">2022</a>
                    <span class="archive-list-count">2</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2020/">2020</a>
                    <span class="archive-list-count">1</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2019/">2019</a>
                    <span class="archive-list-count">12</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2018/">2018</a>
                    <span class="archive-list-count">2</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2017/">2017</a>
                    <span class="archive-list-count">5</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2016/">2016</a>
                    <span class="archive-list-count">4</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2015/">2015</a>
                    <span class="archive-list-count">6</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2014/">2014</a>
                    <span class="archive-list-count">7</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2013/">2013</a>
                    <span class="archive-list-count">2</span>
                </li>
            
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <!-- disable caching cause each page has different footer from qrcode -->
        <!-- common/footer, null, {cache: !config.relative_link})  -->
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="qrcode-share-wrapper">
                <div class="qrcode-text">https://neo01.com/l#74d99980</div>
                <img src="/qr/qr-2b2ded6d5fc8951d9ae98fd5a3ee8561.svg" width="200" height="200" alt="QR Code for https://neo01.com/l#74d99980">
            </div>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" title="Homepage" class="logo"></a>
                </h1>
                
                <p>© 2025 Neo Alienson. 版权所有.
                  <a href="/zh-CN/terms-and-conditions">使用条款</a></p>
                
            </div>
            <div class="footer-plugins">
              


            </div>
        </div>
    </div>
</footer>

        
    
        


        


        


        


        


        


        


        


        


    



<!-- Custom Scripts -->




    </div>
<!-- hexo injector body_end start --><script type="text/javascript" src="/js/bundle_last.js"></script><!-- hexo injector body_end end -->

<script>CookieConsent.run({"palette":{"popup":{"background":"#000"},"button":{"background":"#f1d600"}},"guiOptions":{"consentModal":{"layout":"box","position":"bottom right","equalWeightButtons":true,"flipButtons":false},"preferencesModal":{"layout":"box","position":"right","equalWeightButtons":false,"flipButtons":false}},"categories":{"necessary":{"readOnly":true},"functionality":{},"analytics":{}},"language":{"default":"en","autoDetect":"browser","translations":{"en":{"consentModal":{"title":"Hello traveler, it's cookie time!","description":"🍪 This site uses cookies to serve you the best experience—no crumbs left behind! Want to know what cookies really are? Check out this easy-to-understand cookie explanation. And for the legal nitty-gritty, here’s our website cookie policy to keep you in the loop! 🚀\n","acceptAllBtn":"Accept all","acceptNecessaryBtn":"Reject all","showPreferencesBtn":"Manage preferences","footer":"<a href=\"#link\">Privacy Policy</a>\n<a href=\"/terms-and-conditions/\">Terms and conditions</a>\n"},"preferencesModal":{"title":"Consent Preferences Center","acceptAllBtn":"Accept all","acceptNecessaryBtn":"Reject all","savePreferencesBtn":"Save preferences","closeIconLabel":"Close modal","serviceCounterLabel":"Service|Services","sections":[{"title":"Cookie Usage","description":"We use cookies to make your visit smoother, faster, and tailored just for you. Cookies help us remember your preferences, improve site performance, and deliver personalized content while keeping things secure and user-friendly.\n"},{"title":"Strictly Necessary Cookies <span class=\"pm__badge\">Always Enabled</span>","description":"These cookies are essential for the website to function properly. They enable core features like security, page navigation, and access to secure areas. Without these, the site cannot operate correctly.\n","linkedCategory":"necessary"},{"title":"Functionality Cookies","description":"Functionality cookies remember your choices to provide a more personalized experience. For example, they save your language preference or login details so you don’t have to keep entering them each time.\n","linkedCategory":"functionality"},{"title":"Analytics Cookies","description":"Analytics cookies help us understand how visitors interact with our site by collecting information anonymously. This insight allows us to improve functionality, fix issues, and make the website better for you.\n","linkedCategory":"analytics"},{"title":"More information","description":"Please refer to our <a href='/pages/cookie-policy'>cookie policy</a> for full details on how we use cookies and your options to manage them.\n"}]}}}}})</script></body></html>