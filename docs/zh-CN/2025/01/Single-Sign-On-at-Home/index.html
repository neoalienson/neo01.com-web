<!DOCTYPE html><html lang="zh-CN"><head><!-- hexo injector head_begin start --><!-- Google tag (gtag.js) begins-->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3DZR3TQYCY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-3DZR3TQYCY');
    </script>
    <!-- Google tag (gtag.js) ends-->
    <!-- hexo injector head_begin end -->
    <meta charset="utf-8">
    <!-- security headers starts -->
    <!-- meta http-equiv="content-security-policy" content="script-src 'sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=' 'sha256-lJjk3/dvd+wXqRFjV7T5L/nXJXr5NjUjmsKSPEe+ass=';" -->
    <!-- security headers ends -->
    <!-- favicon starts -->    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <!-- favicon ends -->
    

    
    <title>在家中建立单点登录系统 | Decoding Digital Anomalies</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="keywords" content="Authentication,Cybersecurity,Homelab,SSO">
    
    
    <meta name="description" content="厌倦了管理家庭实验室服务的数十个密码？学习如何建立单点登录系统，只需一次登录即可访问所有服务。">
<meta property="og:type" content="article">
<meta property="og:title" content="在家中建立单点登录系统">
<meta property="og:url" content="https://neo01.com/zh-CN/2025/01/Single-Sign-On-at-Home/index.html">
<meta property="og:site_name" content="Decoding Digital Anomalies">
<meta property="og:description" content="厌倦了管理家庭实验室服务的数十个密码？学习如何建立单点登录系统，只需一次登录即可访问所有服务。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-01-14T16:00:00.000Z">
<meta property="article:modified_time" content="2025-10-12T09:02:08.028Z">
<meta property="article:author" content="Neo Alienson">
<meta property="article:tag" content="Authentication">
<meta property="article:tag" content="Cybersecurity">
<meta property="article:tag" content="Homelab">
<meta property="article:tag" content="SSO">
<meta name="twitter:card" content="summary">
    
            <link rel="alternate" href="/atom.xml" title="Decoding Digital Anomalies" type="application/atom+xml">
    

    

    

    

    

    

    

    
    
        


    
    
        


    

<!-- hexo injector head_end start --><link rel="stylesheet" type="text/css" href="/css/bundle.css"><script type="text/javascript" src="/js/bundle_first.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><style id="admonition-styles">.admonition {
  margin: 1em 0;
  padding: 0rem;
  border-left: 0.3rem solid;
  border-radius: 0.4rem;
  background-color: #f9f9f9;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
  overflow: hidden;
  page-break-inside: avoid;
}

.admonition-title {
  display: flex;
  align-items: center;
  font-weight: 600;
  padding: 0rem 1rem 0.1rem 0.75rem;
  font-size: 1.05em;
  background-color: rgba(0, 0, 0, 0.03);
  border-top-left-radius: 0.4rem;
  border-top-right-radius: 0.4rem;
  margin: 0 !important;
}

.admonition-icon {
  font-size: 1.2em;
  margin-right: 0.6rem;
  opacity: 0.85;
  margin-top: 0.1rem;
}

/* 内容区域 margin */
.admonition > *:not(.admonition-title) {
  margin: 0.6rem 1rem 0.6rem 1rem;
}

/* NOTE 类型 */
.admonition.anote {
  border-color: #448aff;
}
.admonition.anote > .admonition-title {
  background-color: #448aff1a;
  color: #2962ff;
}

/* INFO / TODO 类型 */
.admonition.info,
.admonition.todo {
  border-color: #00b8d4;
}
.admonition.info > .admonition-title,
.admonition.todo > .admonition-title {
  background-color: rgba(0, 184, 212, 0.1);
  color: #007c91;
}

/* 警告类 */
.admonition.warning,
.admonition.attention,
.admonition.caution {
  border-color: #ff9100;
}
.admonition.warning > .admonition-title,
.admonition.attention > .admonition-title,
.admonition.caution > .admonition-title {
  background-color: rgba(255, 145, 0, 0.1);
  color: #c66900;
}

/* 错误类 */
.admonition.failure,
.admonition.missing,
.admonition.fail,
.admonition.error,
.admonition.danger,
.admonition.bug {
  border-color: #ff5252;
}
.admonition.failure > .admonition-title,
.admonition.missing > .admonition-title,
.admonition.fail > .admonition-title,
.admonition.error > .admonition-title,
.admonition.danger > .admonition-title,
.admonition.bug > .admonition-title {
  background-color: rgba(255, 82, 82, 0.1);
  color: #b71c1c;
}

/* TIP 类型 */
.admonition.tip {
  border-color: #00bfa5;
}
.admonition.tip > .admonition-title {
  background-color: #00bfa51a;
  color: #00796b;
}

/* SUCCESS 类型 */
.admonition.success {
  border-color: #00c853;
}
.admonition.success > .admonition-title {
  background-color: #00c8531a;
  color: #2e7d32;
}

/* QUESTION 类型 */
.admonition.question {
  border-color: #64dd17;
}
.admonition.question > .admonition-title {
  background-color: #64dd171a;
  color: #558b2f;
}

/* EXAMPLE 类型 */
.admonition.example {
  border-color: #7c4dff;
}
.admonition.example > .admonition-title {
  background-color: #7c4dff1a;
  color: #512da8;
}

/* QUOTE 类型 */
.admonition.quote {
  border-color: #9e9e9e;
}
.admonition.quote > .admonition-title {
  background-color: #9e9e9e1a;
  color: #424242;
}

/*黑暗模式*/
/* 夜间模式基础样式 */
[data-theme="dark"] .admonition {
  background-color: #1e1e1e;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
}

[data-theme="dark"] .admonition-title {
  background-color: rgba(255, 255, 255, 0.05);
}

/* anote */
[data-theme="dark"] .admonition.anote {
  border-color: #82b1ff;
}
[data-theme="dark"] .admonition.anote > .admonition-title {
  background-color: #82b1ff1a;
  color: #bbdefb;
}

/* tip */
[data-theme="dark"] .admonition.tip {
  border-color: #64ffda;
}
[data-theme="dark"] .admonition.tip > .admonition-title {
  background-color: #64ffda1a;
  color: #1de9b6;
}

/* success */
[data-theme="dark"] .admonition.success {
  border-color: #69f0ae;
}
[data-theme="dark"] .admonition.success > .admonition-title {
  background-color: #69f0ae1a;
  color: #00e676;
}

/* question */
[data-theme="dark"] .admonition.question {
  border-color: #b2ff59;
}
[data-theme="dark"] .admonition.question > .admonition-title {
  background-color: #b2ff591a;
  color: #aeea00;
}

/* example */
[data-theme="dark"] .admonition.example {
  border-color: #b388ff;
}
[data-theme="dark"] .admonition.example > .admonition-title {
  background-color: #b388ff1a;
  color: #b39ddb;
}

/* quote */
[data-theme="dark"] .admonition.quote {
  border-color: #bdbdbd;
}
[data-theme="dark"] .admonition.quote > .admonition-title {
  background-color: #bdbdbd1a;
  color: #eeeeee;
}

/* warning / attention / caution */
[data-theme="dark"] .admonition.warning,
[data-theme="dark"] .admonition.attention,
[data-theme="dark"] .admonition.caution {
  border-color: #ffb300;
}
[data-theme="dark"] .admonition.warning > .admonition-title,
[data-theme="dark"] .admonition.attention > .admonition-title,
[data-theme="dark"] .admonition.caution > .admonition-title {
  background-color: #ffb3001a;
  color: #ffe082;
}

/* error / fail / failure / bug / danger / missing */
[data-theme="dark"] .admonition.error,
[data-theme="dark"] .admonition.fail,
[data-theme="dark"] .admonition.failure,
[data-theme="dark"] .admonition.bug,
[data-theme="dark"] .admonition.missing,
[data-theme="dark"] .admonition.danger {
  border-color: #ef5350;
}
[data-theme="dark"] .admonition.error > .admonition-title,
[data-theme="dark"] .admonition.fail > .admonition-title,
[data-theme="dark"] .admonition.failure > .admonition-title,
[data-theme="dark"] .admonition.bug > .admonition-title,
[data-theme="dark"] .admonition.missing > .admonition-title,
[data-theme="dark"] .admonition.danger > .admonition-title {
  background-color: #ef53501a;
  color: #ff8a80;
}</style><script id="mermaid-scripts" src="/cache/mermaid.min.local.js"></script>
<script>mermaid.initialize({theme: 'default'});</script></head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" title="Homepage" class="logo"></a>
                    </h1>
                        <h2 class="subtitle-wrap">
                            <p class="title">解码数字异常</p>
                          <p class="subtitle">有时功能就是数字兔子洞中的错误，反之亦然</p>
                        </h2>
                    <div id="lang-selector">
                        <span class="lang-icon">🌐</span>
                        
                            <a href="/2025/01/Single-Sign-On-at-Home/" class="lang-link">English</a>
<span class="lang-sep">|</span>                            <a href="/zh-TW/2025/01/Single-Sign-On-at-Home/" class="lang-link">繁體中文</a>
                    </div>
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/zh-CN/">主页</a>
                                </li>
                                                                    <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-CN/categories/AI/">人工智能</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-CN/categories/AI/Art-Gallery/">艺术画廊</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-CN/categories/Architecture/">架构</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-CN/categories/Cybersecurity/">网络安全</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-CN/categories/Development/">开发</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-CN/categories/Misc/">杂项</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-CN/categories/%E5%BC%80%E5%8F%91/">开发</a></li></ul>
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/zh-CN/about-me">关于</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" id="search-form-input" placeholder="搜索">
        <button type="submit" title="搜索" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" id="ins-search-input" placeholder="想要查找什么...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script integrity="sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=">
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
        LANG: 'zh-CN',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>




</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Cybersecurity/">Cybersecurity</a>
    </h1>
</div>

                        <div class="main-body-content">
                            <article id="post-2025/01/Single-Sign-On-at-Home-zh-CN" class="article article-single article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner responsive-content">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        在家中建立单点登录系统
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
      <i class="fa fa-calendar"></i>
        
          Created <time datetime="2025-01-14T16:00:00.000Z" itemprop="datePublished">2025-01-15</time>
          &nbsp;<i class="fa fa-calendar"></i>
          Updated <time datetime="2025-10-12T09:02:08.028Z" itemprop="datePublished">2025-10-12</time>
        
    </div>


                

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/zh-CN/tags/Cybersecurity/">Cybersecurity</a> <a class="tag-link" href="/zh-CN/tags/Homelab/">Homelab</a> <a class="tag-link" href="/zh-CN/tags/Authentication/">Authentication</a> <a class="tag-link" href="/zh-CN/tags/SSO/">SSO</a>
    </div>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%9C%A8%E5%AE%B6%E4%B8%AD%E9%9C%80%E8%A6%81-SSO%EF%BC%9F"><span class="toc-text">为什么在家中需要 SSO？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%90%86%E8%A7%A3-SSO-%E5%9F%BA%E7%A1%80"><span class="toc-text">理解 SSO 基础</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%84%E6%BA%90"><span class="toc-text">资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA"><span class="toc-text">结论</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE-Authelia"><span class="toc-text">设置 Authelia</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%A4%9A%E5%9B%A0%E7%B4%A0%E9%AA%8C%E8%AF%81"><span class="toc-text">添加多因素验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E7%94%A8-SSO-%E5%90%8E%E6%98%AF%E5%90%A6%E5%BA%94%E4%BF%9D%E7%95%99%E6%9C%AC%E5%9C%B0%E8%B4%A6%E6%88%B7%EF%BC%9F"><span class="toc-text">启用 SSO 后是否应保留本地账户？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%84%E6%BA%90-2"><span class="toc-text">资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA-2"><span class="toc-text">结论</span></a></li></ol>
            <p>你已经建立了一个令人印象深刻的家庭实验室——Nextcloud、Jellyfin、Home Assistant、Portainer、Grafana，以及十几个其他服务。每个都很棒。每个也都有自己的登录页面。以及自己的密码。以及自己的会话超时。</p>
<p>听起来很熟悉吗？欢迎来到密码疲劳的世界。</p>
<p>如果你可以登录一次就访问所有内容呢？这就是单点登录（SSO），它不再只是企业专用。</p>
<h2 id="为什么在家中需要-SSO？">为什么在家中需要 SSO？</h2>
<p><strong>问题所在：</strong></p>
<ul>
<li>15+ 个服务 = 15+ 个要记住的密码（或重复使用 😱）</li>
<li>分别登录每个服务浪费时间</li>
<li>没有集中式用户管理</li>
<li>需要时难以撤销访问权限</li>
<li>密码重置是一场噩梦</li>
</ul>
<p><strong>解决方案：</strong></p>
<p>SSO 提供：</p>
<ul>
<li><strong>一次登录</strong>适用于所有服务</li>
<li><strong>集中式身份验证</strong> - 在一个地方管理用户</li>
<li><strong>更好的安全性</strong> - 一次强制执行 MFA，适用于所有地方</li>
<li><strong>更容易的入职</strong> - 一次将家人/朋友加入所有服务</li>
<li><strong>快速撤销</strong> - 停用一个账户，锁定所有地方</li>
</ul>
<h2 id="理解-SSO-基础">理解 SSO 基础</h2>
<h3 id="什么是单点登录？">什么是单点登录？</h3>
<p>SSO 是一种身份验证方案，允许用户登录一次并访问多个应用程序，无需重新验证。</p>
<p><strong>简单示例：</strong></p>
<ul>
<li>没有 SSO：登录 Nextcloud → 登录 Grafana → 登录 Jellyfin（3 次登录）</li>
<li>有 SSO：登录一次 → 访问所有三个服务（1 次登录）</li>
</ul>
<h3 id="关键组件说明">关键组件说明</h3>
<p>将 SSO 想象成一个有多个 VIP 房间的夜店。让我们分解每个组件：</p>
<h4 id="1-身份提供者（IdP）-保安">1. 身份提供者（IdP）- 保安</h4>
<p>**它的作用：**验证你是谁的中央身份验证机构。</p>
<p>**现实世界类比：**就像夜店入口的保安，检查你的身份证并给你一个手环。</p>
<p><strong>在你的家庭实验室中：</strong></p>
<ul>
<li><strong>Authelia、Authentik 或 Keycloak</strong> 充当保安</li>
<li>当你尝试访问任何服务时，你会先被重定向到这里</li>
<li>它检查你的用户名/密码和 MFA</li>
<li>一旦验证，它会给你一个「令牌」（就像手环）</li>
</ul>
<p><strong>示例流程：</strong></p>
<pre class="language-none"><code class="language-none">你 → 尝试访问 Nextcloud
Nextcloud → "我不认识你，去问保安"
你 → 重定向到 Authelia 登录页面
Authelia → "出示你的凭证"
你 → 输入密码 + MFA 代码
Authelia → "已验证！这是你的令牌"</code></pre>
<h4 id="2-服务提供者（SP）-VIP-房间">2. 服务提供者（SP）- VIP 房间</h4>
<p>**它的作用：**信任 IdP 验证用户的实际应用程序。</p>
<p>**现实世界类比：**就像夜店中的 VIP 房间。他们不检查你的身份证——他们只看保安给的手环。</p>
<p><strong>在你的家庭实验室中：</strong></p>
<ul>
<li>**你的应用程序：**Nextcloud、Grafana、Jellyfin、Home Assistant</li>
<li>它们不自己处理密码</li>
<li>它们信任 IdP 的决定</li>
<li>它们只检查：“你有来自 Authelia 的有效令牌吗？”</li>
</ul>
<p><strong>示例：</strong></p>
<pre class="language-none"><code class="language-none">你 → 访问 Grafana（带有来自 Authelia 的令牌）
Grafana → "我看到你有来自 Authelia 的有效令牌"
Grafana → "Authelia 说你是 'alice'，在 'admins' 组中"
Grafana → "欢迎！"</code></pre>
<h4 id="3-用户目录-宾客名单">3. 用户目录 - 宾客名单</h4>
<p>**它的作用：**存储用户信息（用户名、密码、组）。</p>
<p>**现实世界类比：**保安检查的宾客名单。</p>
<p><strong>在你的家庭实验室中：</strong></p>
<ul>
<li>**简单：**包含用户名和哈希密码的 YAML 文件</li>
<li>**高级：**LDAP 服务器（就像用户的数据库）</li>
<li>包含：用户名、密码、电子邮件、组成员资格</li>
</ul>
<p><strong>示例结构：</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml">users:
  alice:
    password: (哈希)
    email: alice@home.local
    groups: [admins, users]
  bob:
    password: (哈希)
    email: bob@home.local
    groups: [users]</code></pre>
<h4 id="4-身份验证-vs-授权">4. 身份验证 vs 授权</h4>
<p>**身份验证：**证明你是谁（“你是 Alice 吗？”）<br>
**授权：**决定你可以做什么（“Alice 可以访问管理面板吗？”）</p>
<p><strong>现实世界类比：</strong></p>
<ul>
<li><strong>身份验证</strong> = 出示身份证证明你已满 21 岁</li>
<li><strong>授权</strong> = 保安决定你是否可以进入 VIP 区</li>
</ul>
<p><strong>在 SSO 中：</strong></p>
<ul>
<li><strong>IdP 处理身份验证：</strong>“是的，这是 Alice，密码正确”</li>
<li><strong>应用程序处理授权：</strong>“Alice 在 ‘admins’ 组中，授予管理员访问权限”</li>
</ul>
<h4 id="5-身份验证协议-语言">5. 身份验证协议 - 语言</h4>
<p>**它们的作用：**IdP 和应用程序通信的标准化方式。</p>
<p>**现实世界类比：**就像保安和 VIP 房间用来沟通的不同语言。</p>
<p><strong>OIDC（OpenID Connect）- 现代且推荐：</strong></p>
<ul>
<li><strong>身份验证：</strong>“你是谁？”</li>
<li><strong>授权：</strong>“你在哪些组中？”</li>
<li>使用 JSON（易于阅读）</li>
<li>建立在 OAuth2 之上</li>
<li>大多数现代应用程序支持</li>
<li><strong>尽可能使用此协议</strong></li>
</ul>
<p><strong>OIDC 令牌示例：</strong></p>
<pre class="language-json" data-language="json"><code class="language-json">{
  "sub": "alice",
  "email": "alice@homelab.local",
  "groups": ["admins", "users"],
  "exp": 1705334400
}</code></pre>
<p><strong>SAML - 企业标准：</strong></p>
<ul>
<li>就像说正式的法律语言</li>
<li>使用 XML（冗长）</li>
<li>较旧的企业应用程序使用它</li>
<li>更复杂但广泛支持</li>
<li>在企业环境中常见</li>
</ul>
<p><strong>Windows 集成身份验证（WIA）- 仅限 Windows：</strong></p>
<ul>
<li>使用 Kerberos/NTLM</li>
<li>Windows 域用户自动登录</li>
<li>在域上无需密码提示</li>
<li>**仅适用于：**Active Directory + Windows 客户端</li>
<li><strong>非联合</strong> - 无法与外部 SaaS 应用程序集成</li>
<li><strong>不适合家庭实验室</strong>，除非你运行 Windows Server 域</li>
</ul>
<h4 id="6-联合-vs-非联合身份验证">6. 联合 vs 非联合身份验证</h4>
<p><strong>什么是联合？</strong></p>
<p>联合允许不同组织/系统相互信任彼此的身份验证。</p>
<p><strong>现实世界类比：</strong></p>
<ul>
<li>**非联合：**你的健身房会员资格只在你的健身房有效</li>
<li>**联合：**你的护照在多个国家有效（它们相互信任）</li>
</ul>
<p><strong>非联合身份验证（WIA、基本验证）：</strong></p>
<pre class="language-none"><code class="language-none">你的家庭实验室 IdP → 仅适用于你的家庭实验室服务
❌ 无法向外部 SaaS（GitHub、AWS 等）进行身份验证</code></pre>
<p><strong>联合身份验证（OIDC、SAML）：</strong></p>
<pre class="language-none"><code class="language-none">你的家庭实验室 IdP ↔ 外部 SaaS（如果它们支持）
✅ 可以向信任你的 IdP 的服务进行身份验证</code></pre>
<p><strong>示例场景：</strong></p>
<p><strong>非联合（WIA）：</strong></p>
<pre class="language-none"><code class="language-none">你 → Windows 域控制器 → 家庭实验室应用程序 ✅
你 → Windows 域控制器 → GitHub ❌（GitHub 不信任你的 DC）</code></pre>
<p><strong>联合（OIDC/SAML）：</strong></p>
<pre class="language-none"><code class="language-none">你 → Authentik → 家庭实验室应用程序 ✅
你 → Authentik → GitHub Enterprise ✅（如果已配置）
你 → Authentik → AWS ✅（如果已配置）</code></pre>
<p><strong>家庭实验室的陷阱：</strong></p>
<p>大多数 SaaS 提供者仅支持<strong>企业订阅</strong>的联合：</p>
<table>
<thead>
<tr>
<th>服务</th>
<th>免费/个人</th>
<th>企业</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>GitHub</strong></td>
<td>无 SSO</td>
<td>使用 SAML 的 SSO</td>
</tr>
<tr>
<td><strong>AWS</strong></td>
<td>无 SSO</td>
<td>使用 SAML 的 SSO</td>
</tr>
<tr>
<td><strong>Google Workspace</strong></td>
<td>无 SSO</td>
<td>使用 SAML 的 SSO</td>
</tr>
<tr>
<td><strong>Microsoft 365</strong></td>
<td>无 SSO</td>
<td>使用 SAML 的 SSO</td>
</tr>
<tr>
<td><strong>Slack</strong></td>
<td>无 SSO</td>
<td>使用 SAML 的 SSO</td>
</tr>
</tbody>
</table>
<p><strong>成本现实：</strong></p>
<ul>
<li>GitHub Enterprise：$21/用户/月</li>
<li>AWS SSO：需要 AWS Organizations</li>
<li>Google Workspace：$12-18/用户/月（SSO）</li>
<li>Microsoft 365：$22/用户/月（SSO）</li>
</ul>
<div class="admonition warning"><p class="admonition-title"><span class="mdi mdi-alert-outline admonition-icon"></span>⚠️ 家庭实验室 SSO 限制</p><div class="admonition-content"><p><strong>你的家庭实验室 SSO 将适用于：</strong></p>
<ul>
<li>✅ 自托管服务（Nextcloud、Grafana、Jellyfin）</li>
<li>✅ 你控制的服务</li>
<li>✅ 支持 OIDC/SAML 且无限制的应用程序</li>
</ul>
<p><strong>你的家庭实验室 SSO 将不适用于：</strong></p>
<ul>
<li>❌ 免费层 SaaS（GitHub、Gmail、Slack）</li>
<li>❌ 需要企业订阅的服务</li>
<li>❌ 不支持自定义 IdP 的服务</li>
</ul>
<p><strong>这将家庭实验室 SSO 限制为仅内部服务</strong>，但对于管理 10-20 个自托管应用程序仍然很有价值！</p>
</div></div>
<p><strong>比较：</strong></p>
<table>
<thead>
<tr>
<th>协议</th>
<th>最适合</th>
<th>复杂度</th>
<th>联合</th>
<th>家庭实验室友好</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>OIDC</strong></td>
<td>现代应用程序</td>
<td>低</td>
<td>✅ 是</td>
<td>✅ 是</td>
</tr>
<tr>
<td><strong>SAML</strong></td>
<td>企业应用程序</td>
<td>高</td>
<td>✅ 是</td>
<td>⚠️ 如果需要</td>
</tr>
<tr>
<td><strong>WIA</strong></td>
<td>Windows 域</td>
<td>中</td>
<td>❌ 否</td>
<td>❌ 过度</td>
</tr>
</tbody>
</table>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>💡 协议选择</p><div class="admonition-content"><p>对于家庭实验室：</p>
<ul>
<li><strong>使用 OIDC</strong> 适用于支持它的应用程序（Grafana、Nextcloud、Portainer）</li>
<li><strong>使用转发验证</strong>（Authelia）适用于不支持 OIDC 的应用程序</li>
<li><strong>跳过 WIA</strong>，除非你已经运行 Active Directory（而且它无法与 SaaS 一起使用）</li>
<li><strong>仅在特定应用程序需要时使用 SAML</strong></li>
<li>**接受限制：**你的 SSO 无法与免费层 SaaS（GitHub、Gmail 等）一起使用</li>
</ul>
</div></div>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>🎯 关键要点</p><div class="admonition-content"><ul>
<li><strong>IdP（Authelia）</strong> = 你登录的唯一地方</li>
<li><strong>服务提供者（你的应用程序）</strong> = 信任 IdP 的决定</li>
<li><strong>用户目录</strong> = 存储用户名/密码的地方</li>
<li><strong>协议（OIDC/SAML）</strong> = 它们如何相互通信</li>
</ul>
<p>你在 IdP 登录一次，你的所有应用程序都信任该登录。</p>
</div></div>
<h2 id="资源">资源</h2>
<ul>
<li>**<a target="_blank" rel="noopener" href="https://www.authelia.com/">Authelia 文档</a>：**完整的 Authelia 指南</li>
<li>**<a target="_blank" rel="noopener" href="https://goauthentik.io/docs/">Authentik 文档</a>：**Authentik 设置和配置</li>
<li>**<a target="_blank" rel="noopener" href="https://www.keycloak.org/documentation">Keycloak 文档</a>：**企业 SSO 指南</li>
<li>**<a target="_blank" rel="noopener" href="https://openid.net/connect/">OIDC 说明</a>：**理解 OpenID Connect</li>
</ul>
<h2 id="结论">结论</h2>
<p>在家中设置 SSO 将你的家庭实验室从一系列独立服务转变为统一平台。初始设置投资立即通过便利性和改进的安全性得到回报。</p>
<p><strong>关键要点：</strong></p>
<ul>
<li>SSO 消除了多个服务的密码疲劳</li>
<li><strong>Authelia 最适合简单设置</strong>，配合反向代理</li>
<li><strong>Authentik 提供完整功能</strong>，配有美观的 UI</li>
<li>转发验证保护任何服务</li>
<li>MFA 添加关键安全层</li>
<li>LDAP 集成可扩展用于更大的部署</li>
<li>定期备份至关重要（SSO 是单点故障）</li>
<li><strong>家庭实验室 SSO 限于自托管服务</strong> - SaaS 集成需要昂贵的企业计划</li>
<li>联合（OIDC/SAML）实现跨系统 SSO，但 WIA 是非联合的</li>
</ul>
<p><strong>快速入门建议：</strong></p>
<p>对于大多数家庭实验室：</p>
<ol>
<li>从 <strong>Authelia</strong> + Traefik 开始（最简单的路径）</li>
<li>最初使用基于文件的身份验证</li>
<li>为管理员账户添加 MFA</li>
<li>逐步将服务迁移到 SSO</li>
<li>如果以后需要 OIDC/SAML，考虑 Authentik</li>
</ol>
<p>从 2-3 个服务开始，熟悉流程，然后扩展。当你不再需要处理数十个密码时，未来的你会感谢你！🔐</p>
<h2 id="设置-Authelia">设置 Authelia</h2>
<h3 id="架构">架构</h3>
<div class="mermaid">flowchart TD
  User["👤 用户"]
  Proxy["🚪 反向代理 (Traefik/nginx)"]
  Authelia["🔐 Authelia"]
  LDAP["📚 用户目录 (YAML/LDAP)"]
  
  subgraph Services[" "]
    App1["📦 Nextcloud"]
    App2["🎬 Jellyfin"]
    App3["📊 Grafana"]
  end
  
  User --&gt; Proxy
  Proxy --&gt; Authelia
  Proxy --&gt; Services
  Authelia -.-&gt; LDAP
  
  style Authelia fill:#e3f2fd
  style Proxy fill:#fff3e0
  style LDAP fill:#f3e5f5
  style Services fill:#e8f5e9</div>
<h3 id="先决条件">先决条件</h3>
<ul>
<li>Docker 和 Docker Compose</li>
<li>反向代理（Traefik 或 nginx）</li>
<li>域名（或本地 DNS）</li>
</ul>
<h3 id="步骤-1：创建目录结构">步骤 1：创建目录结构</h3>
<pre class="language-bash" data-language="bash"><code class="language-bash">mkdir -p authelia/{config,secrets}
cd authelia</code></pre>
<h3 id="步骤-2：生成密钥">步骤 2：生成密钥</h3>
<pre class="language-bash" data-language="bash"><code class="language-bash"># JWT 密钥
tr -cd '[:alnum:]' &lt; /dev/urandom | fold -w "64" | head -n 1 &gt; secrets/jwt_secret

# 会话密钥
tr -cd '[:alnum:]' &lt; /dev/urandom | fold -w "64" | head -n 1 &gt; secrets/session_secret

# 存储加密密钥
tr -cd '[:alnum:]' &lt; /dev/urandom | fold -w "64" | head -n 1 &gt; secrets/storage_encryption_key</code></pre>
<h3 id="步骤-3：创建配置">步骤 3：创建配置</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"># config/configuration.yml
---
theme: dark
default_2fa_method: "totp"

server:
  host: 0.0.0.0
  port: 9091

log:
  level: info

totp:
  issuer: homelab.local
  period: 30
  skew: 1

authentication_backend:
  file:
    path: /config/users_database.yml
    password:
      algorithm: argon2id
      iterations: 1
      salt_length: 16
      parallelism: 8
      memory: 64

access_control:
  default_policy: deny
  rules:
    - domain: "*.homelab.local"
      policy: two_factor

session:
  name: authelia_session
  domain: homelab.local
  expiration: 1h
  inactivity: 5m
  remember_me_duration: 1M

regulation:
  max_retries: 3
  find_time: 2m
  ban_time: 5m

storage:
  encryption_key_secret_file: /secrets/storage_encryption_key
  local:
    path: /config/db.sqlite3

notifier:
  filesystem:
    filename: /config/notification.txt</code></pre>
<h3 id="步骤-4：创建用户">步骤 4：创建用户</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"># config/users_database.yml
users:
  alice:
    displayname: "Alice Smith"
    password: "$argon2id$v=19$m=65536,t=3,p=4$..."
    email: alice@homelab.local
    groups:
      - admins
      - users
  
  bob:
    displayname: "Bob Jones"
    password: "$argon2id$v=19$m=65536,t=3,p=4$..."
    email: bob@homelab.local
    groups:
      - users</code></pre>
<p><strong>生成密码哈希：</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">docker run --rm authelia/authelia:latest authelia crypto hash generate argon2 --password 'yourpassword'</code></pre>
<h3 id="步骤-5：Docker-Compose">步骤 5：Docker Compose</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"># docker-compose.yml
version: '3.8'

services:
  authelia:
    image: authelia/authelia:latest
    container_name: authelia
    volumes:
      - ./config:/config
      - ./secrets:/secrets
    ports:
      - 9091:9091
    environment:
      - TZ=America/New_York
    restart: unless-stopped</code></pre>
<h3 id="步骤-6：与-Traefik-集成">步骤 6：与 Traefik 集成</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"># docker-compose.yml（添加到现有的 Traefik 设置）
services:
  authelia:
    image: authelia/authelia:latest
    container_name: authelia
    volumes:
      - ./authelia/config:/config
      - ./authelia/secrets:/secrets
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.authelia.rule=Host(`auth.homelab.local`)"
      - "traefik.http.routers.authelia.entrypoints=websecure"
      - "traefik.http.routers.authelia.tls=true"
      - "traefik.http.services.authelia.loadbalancer.server.port=9091"
      
      # Authelia 中间件
      - "traefik.http.middlewares.authelia.forwardauth.address=http://authelia:9091/api/verify?rd=https://auth.homelab.local"
      - "traefik.http.middlewares.authelia.forwardauth.trustForwardHeader=true"
      - "traefik.http.middlewares.authelia.forwardauth.authResponseHeaders=Remote-User,Remote-Groups,Remote-Name,Remote-Email"
    restart: unless-stopped

  # 受保护服务示例
  nextcloud:
    image: nextcloud:latest
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.nextcloud.rule=Host(`nextcloud.homelab.local`)"
      - "traefik.http.routers.nextcloud.entrypoints=websecure"
      - "traefik.http.routers.nextcloud.tls=true"
      - "traefik.http.routers.nextcloud.middlewares=authelia@docker"
    restart: unless-stopped</code></pre>
<h3 id="步骤-7：启动服务">步骤 7：启动服务</h3>
<pre class="language-bash" data-language="bash"><code class="language-bash">docker-compose up -d</code></pre>
<p>访问 <code>https://auth.homelab.local</code> 查看登录页面。</p>
<h3 id="理解身份验证流程">理解身份验证流程</h3>
<p>现在你已经设置好 Authelia，让我们看看当你访问受保护的服务时到底发生了什么：</p>
<div class="mermaid">sequenceDiagram
    participant User
    participant App as 应用程序 (Nextcloud)
    participant SSO as SSO 提供者 (Authelia)
    participant LDAP as 用户目录 (YAML/LDAP)
    
    User-&gt;&gt;App: 1. 访问应用程序
    App-&gt;&gt;User: 2. 重定向到 SSO 登录
    User-&gt;&gt;SSO: 3. 输入凭证 + MFA
    SSO-&gt;&gt;LDAP: 4. 验证凭证
    LDAP-&gt;&gt;SSO: 5. 用户已验证
    SSO-&gt;&gt;App: 6. 返回验证令牌
    App-&gt;&gt;User: 7. 授予访问权限
    
    Note over User,App: 用户现在已登录！
    
    User-&gt;&gt;App: 8. 访问另一个应用程序 (Jellyfin)
    App-&gt;&gt;SSO: 9. 检查现有会话
    SSO-&gt;&gt;App: 10. 有效会话存在
    App-&gt;&gt;User: 11. 授予访问权限（无需登录）</div>
<p><strong>幕后发生的事情：</strong></p>
<ol>
<li>**首次访问：**你访问 <code>nextcloud.homelab.local</code></li>
<li>**Traefik 拦截：**向 Authelia 检查 - “这个用户已验证吗？”</li>
<li>**未验证：**Authelia 将你重定向到 <code>auth.homelab.local</code></li>
<li>**你登录：**输入用户名、密码和 MFA 代码</li>
<li>**Authelia 验证：**对照用户数据库检查凭证</li>
<li>**创建会话：**Authelia 创建会话 cookie</li>
<li>**重定向回来：**你被送回 Nextcloud</li>
<li>**授予访问权限：**Traefik 看到有效会话，允许访问</li>
</ol>
<p><strong>第二个服务访问：</strong></p>
<ol>
<li>你访问 <code>grafana.homelab.local</code></li>
<li>Traefik 向 Authelia 检查 - “这个用户已验证吗？”</li>
<li>Authelia 看到现有会话 cookie - “是的，是 Alice！”</li>
<li>立即授予访问权限 - <strong>无需登录</strong></li>
</ol>
<p>这就是 SSO 的魔法 - 一次登录，到处访问！</p>
<h2 id="添加多因素验证">添加多因素验证</h2>
<h3 id="MFA-选项概览">MFA 选项概览</h3>
<table>
<thead>
<tr>
<th>方法</th>
<th>安全性</th>
<th>便利性</th>
<th>成本</th>
<th>防钓鱼</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Passkey (WebAuthn)</strong></td>
<td>最高</td>
<td>高</td>
<td>免费</td>
<td>✅ 是</td>
</tr>
<tr>
<td><strong>硬件密钥</strong></td>
<td>最高</td>
<td>中</td>
<td>$25-50</td>
<td>✅ 是</td>
</tr>
<tr>
<td><strong>TOTP（验证器应用程序）</strong></td>
<td>高</td>
<td>中</td>
<td>免费</td>
<td>❌ 否</td>
</tr>
<tr>
<td><strong>SMS</strong></td>
<td>低</td>
<td>高</td>
<td>需要 SMS 网关</td>
<td>❌ 否</td>
</tr>
</tbody>
</table>
<h3 id="1-Passkey（WebAuthn）-推荐">1. Passkey（WebAuthn）- 推荐</h3>
<p><strong>什么是 Passkey？</strong></p>
<p>Passkey 是使用生物识别验证（指纹、面部、PIN）的密码现代替代品。</p>
<p>**现实世界类比：**就像使用指纹解锁手机，而不是输入密码。</p>
<p><strong>工作方式：</strong></p>
<ul>
<li>你的设备存储加密密钥</li>
<li>你使用生物识别（指纹/面部）或设备 PIN 进行验证</li>
<li>没有密码可以被窃取或钓鱼</li>
<li>通过云同步跨设备工作（iCloud 钥匙串、Google 密码管理器）</li>
</ul>
<p><strong>Authentik 设置：</strong></p>
<ol>
<li>用户菜单 → 设置</li>
<li>MFA 设备 → 注册</li>
<li>选择 <strong>WebAuthn</strong> 或 <strong>Passkey</strong></li>
<li>按照浏览器提示：
<ul>
<li>**移动设备：**使用指纹/Face ID</li>
<li>**笔记本电脑：**使用 Touch ID/Windows Hello</li>
<li>**台式机：**使用手机作为 passkey 或硬件密钥</li>
</ul>
</li>
</ol>
<p><strong>Authelia 设置：</strong></p>
<ol>
<li>登录任何受保护的服务</li>
<li>点击「注册安全密钥」</li>
<li>选择 passkey 选项</li>
<li>使用生物识别进行验证</li>
</ol>
<p><strong>支持的平台：</strong></p>
<ul>
<li>✅ iPhone/iPad（iOS 16+）- Face ID/Touch ID</li>
<li>✅ Android（9+）- 指纹/面部解锁</li>
<li>✅ macOS（Ventura+）- Touch ID</li>
<li>✅ Windows（10+）- Windows Hello</li>
<li>✅ Chrome/Edge/Safari - 内置支持</li>
</ul>
<h3 id="2-硬件安全密钥">2. 硬件安全密钥</h3>
<p><strong>用于验证的物理设备：</strong></p>
<p><strong>Authentik：</strong></p>
<ol>
<li>用户菜单 → 设置</li>
<li>MFA 设备 → 注册</li>
<li>选择 WebAuthn</li>
<li>插入安全密钥（YubiKey 等）</li>
<li>提示时触摸密钥</li>
</ol>
<p><strong>热门硬件密钥：</strong></p>
<ul>
<li><strong>YubiKey 5</strong>（$45-50）- USB-A/C、NFC</li>
<li><strong>YubiKey 5C Nano</strong>（$55）- 留在 USB-C 端口</li>
<li><strong>Google Titan</strong>（$30）- USB-A/C、蓝牙</li>
<li><strong>Feitian</strong>（$20-30）- 预算选项</li>
</ul>
<h3 id="3-TOTP（验证器应用程序）">3. TOTP（验证器应用程序）</h3>
<p><strong>来自应用程序的基于时间的代码：</strong></p>
<p><strong>Authelia（内置）：</strong></p>
<ol>
<li>登录任何受保护的服务</li>
<li>点击「注册设备」</li>
<li>使用验证器应用程序扫描 QR 码</li>
<li>输入 6 位数代码进行验证</li>
</ol>
<p><strong>Authentik：</strong></p>
<ol>
<li>用户菜单 → 设置</li>
<li>MFA 设备 → 注册</li>
<li>选择 TOTP</li>
<li>扫描 QR 码</li>
</ol>
<p><strong>推荐的验证器应用程序：</strong></p>
<ul>
<li><strong>Aegis</strong>（Android）- 开源、加密备份</li>
<li><strong>Raivo OTP</strong>（iOS）- 开源、iCloud 同步</li>
<li><strong>2FAS</strong>（iOS/Android）- 免费、云备份</li>
<li><strong>Authy</strong>（iOS/Android）- 多设备同步</li>
<li><strong>Google Authenticator</strong>（iOS/Android）- 简单、云备份</li>
</ul>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>💡 MFA 最佳实践</p><div class="admonition-content"><p><strong>优先顺序：</strong></p>
<ol>
<li><strong>Passkeys</strong> - 最安全且方便（使用生物识别）</li>
<li><strong>硬件密钥</strong> - 非常安全，需要物理设备</li>
<li><strong>TOTP 应用程序</strong> - 安全，但可能被钓鱼</li>
<li><strong>避免 SMS</strong> - 容易受到 SIM 卡交换攻击</li>
</ol>
<p><strong>建议：</strong></p>
<ul>
<li><strong>管理员始终需要 MFA</strong>（使用 passkeys 或硬件密钥）</li>
<li><strong>家人可选</strong>（减少摩擦，passkeys 很容易）</li>
<li><strong>备份代码</strong> - 生成并安全存储</li>
<li><strong>多种方法</strong> - 注册 passkey + TOTP 作为备份</li>
<li><strong>Passkeys 同步</strong> - 使用 iCloud/Google 从所有设备访问</li>
</ul>
</div></div>
<h2 id="启用-SSO-后是否应保留本地账户？">启用 SSO 后是否应保留本地账户？</h2>
<p><strong>简短答案：是的，始终保留本地账户作为备份。</strong></p>
<h3 id="为什么保留本地账户？">为什么保留本地账户？</h3>
<p>**SSO 是单点故障。**如果你的 SSO 系统故障，你将被锁定在所有内容之外。</p>
<p><strong>SSO 故障的现实世界场景：</strong></p>
<ol>
<li><strong>SSO 容器崩溃</strong> - Docker/Kubernetes 问题</li>
<li><strong>数据库损坏</strong> - Authelia/Authentik 数据库问题</li>
<li><strong>配置错误</strong> - 配置中的错字破坏验证</li>
<li><strong>证书过期</strong> - HTTPS 证书过期，SSO 无法访问</li>
<li><strong>网络问题</strong> - DNS 问题、反向代理故障</li>
<li><strong>意外删除</strong> - 哎呀，删除了错误的容器</li>
</ol>
<p><strong>没有本地账户会发生什么：</strong></p>
<pre class="language-none"><code class="language-none">SSO 故障 → 无法登录任何内容 → 甚至无法访问 SSO 进行修复 → 被锁定</code></pre>
<p><strong>有本地账户作为备份：</strong></p>
<pre class="language-none"><code class="language-none">SSO 故障 → 使用本地管理员账户 → 修复 SSO → 恢复正常</code></pre>
<h3 id="本地账户的最佳实践">本地账户的最佳实践</h3>
<div class="admonition danger"><p class="admonition-title"><span class="mdi mdi-alert-circle-outline admonition-icon"></span>🔒 关键：保护你的本地账户</p><div class="admonition-content"><p>本地账户绕过 SSO，因此必须受到保护：</p>
<ul>
<li><strong>强密码</strong> - 使用密码管理器，20+ 个字符</li>
<li><strong>在本地账户上启用 MFA</strong> - 许多服务支持此功能</li>
<li><strong>限制本地账户</strong> - 仅为管理员/紧急访问创建</li>
<li><strong>不同的密码</strong> - 不要重复使用 SSO 密码</li>
<li><strong>记录凭证</strong> - 安全存储（密码管理器、加密文件）</li>
</ul>
</div></div>
<h3 id="支持本地账户-MFA-的服务">支持本地账户 MFA 的服务</h3>
<p><strong>Proxmox：</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"># 为本地 root 账户启用 TOTP
# 数据中心 → 权限 → 双因素
# 为用户 root@pam 添加 TOTP</code></pre>
<p><strong>Nextcloud：</strong></p>
<ul>
<li>设置 → 安全性 → 双因素验证</li>
<li>即使对本地管理员账户也启用 TOTP</li>
</ul>
<p><strong>Grafana：</strong></p>
<pre class="language-ini" data-language="ini"><code class="language-ini"># grafana.ini
[auth]
login_maximum_inactive_lifetime_duration = 7d
login_maximum_lifetime_duration = 30d

# 本地管理员仍可通过验证器应用程序使用 MFA</code></pre>
<p><strong>Home Assistant：</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"># configuration.yaml
auth_providers:
  - type: homeassistant  # 本地账户
  - type: command_line   # SSO 集成

# 在 UI 中为本地账户启用 MFA：
# 个人资料 → 安全性 → 多因素验证</code></pre>
<h3 id="配置策略">配置策略</h3>
<p><strong>选项 1：双重验证（推荐）</strong></p>
<p>允许 SSO 和本地登录：</p>
<pre class="language-php" data-language="php"><code class="language-php">// Nextcloud - 不隐藏密码表单
'oidc_login_hide_password_form' =&gt; false,  // 保持本地登录可见
'oidc_login_auto_redirect' =&gt; false,       // 不强制 SSO</code></pre>
<p><strong>选项 2：隐藏本地登录</strong></p>
<p>隐藏本地登录但通过直接 URL 保持可访问：</p>
<pre class="language-php" data-language="php"><code class="language-php">// Nextcloud - 隐藏但保持功能
'oidc_login_hide_password_form' =&gt; true,   // 隐藏本地登录
// 访问本地登录：https://nextcloud.local/login?direct=1</code></pre>
<p><strong>选项 3：仅 SSO 加紧急账户</strong></p>
<p>对所有人强制 SSO，除了一个紧急管理员：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"># Authelia - 紧急访问绕过 SSO
access_control:
  rules:
    - domain: "*.homelab.local"
      policy: bypass
      subject:
        - "user:emergency-admin"
      resources:
        - "^/admin/emergency.*$"</code></pre>
<h3 id="紧急访问检查清单">紧急访问检查清单</h3>
<ul>
<li>[ ] <strong>每个关键服务上都存在本地管理员账户</strong></li>
<li>[ ] <strong>所有本地账户都有强唯一密码</strong></li>
<li>[ ] <strong>在支持的本地账户上启用 MFA</strong></li>
<li>[ ] <strong>凭证记录在安全位置</strong>（密码管理器）</li>
<li>[ ] <strong>每月测试本地登录</strong>以确保其工作</li>
<li>[ ] <strong>记录恢复程序</strong> - 如何修复 SSO</li>
<li>[ ] <strong>SSO 配置的备份</strong> - 可以快速恢复</li>
</ul>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>💡 黄金法则</p><div class="admonition-content"><p><strong>始终维护安全的后门：</strong></p>
<ul>
<li>SSO 是你的前门（方便、安全）</li>
<li>本地账户是你的紧急出口（很少使用，始终可用）</li>
<li>两者都应使用 MFA 保护</li>
<li>定期测试两者</li>
</ul>
<p>把它想象成在房子外面藏一把备用钥匙 - 你很少需要它，但当你需要时，你会很高兴它在那里！</p>
</div></div>
<h2 id="资源-2">资源</h2>
<ul>
<li>**<a target="_blank" rel="noopener" href="https://www.authelia.com/">Authelia 文档</a>：**完整的 Authelia 指南</li>
<li>**<a target="_blank" rel="noopener" href="https://goauthentik.io/docs/">Authentik 文档</a>：**Authentik 设置和配置</li>
<li>**<a target="_blank" rel="noopener" href="https://www.keycloak.org/documentation">Keycloak 文档</a>：**企业 SSO 指南</li>
<li>**<a target="_blank" rel="noopener" href="https://openid.net/connect/">OIDC 说明</a>：**理解 OpenID Connect</li>
</ul>
<h2 id="结论-2">结论</h2>
<p>在家中设置 SSO 将你的家庭实验室从一系列独立服务转变为统一平台。初始设置投资立即通过便利性和改进的安全性得到回报。</p>
<p><strong>关键要点：</strong></p>
<ul>
<li>SSO 消除了多个服务的密码疲劳</li>
<li><strong>Authelia 最适合简单设置</strong>，配合反向代理</li>
<li><strong>Authentik 提供完整功能</strong>，配有美观的 UI</li>
<li>转发验证保护任何服务</li>
<li>MFA 添加关键安全层</li>
<li>LDAP 集成可扩展用于更大的部署</li>
<li>定期备份至关重要（SSO 是单点故障）</li>
<li><strong>家庭实验室 SSO 限于自托管服务</strong> - SaaS 集成需要昂贵的企业计划</li>
<li>联合（OIDC/SAML）实现跨系统 SSO，但 WIA 是非联合的</li>
</ul>
<p><strong>快速入门建议：</strong></p>
<p>对于大多数家庭实验室：</p>
<ol>
<li>从 <strong>Authelia</strong> + Traefik 开始（最简单的路径）</li>
<li>最初使用基于文件的身份验证</li>
<li>为管理员账户添加 MFA</li>
<li>逐步将服务迁移到 SSO</li>
<li>如果以后需要 OIDC/SAML，考虑 Authentik</li>
</ol>
<p>从 2-3 个服务开始，熟悉流程，然后扩展。当你不再需要处理数十个密码时，未来的你会感谢你！🔐</p>

        </div>
        <footer class="article-footer">
            
    <a data-url="https://neo01.com/zh-CN/2025/01/Single-Sign-On-at-Home/" data-id="1e977225" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url').replace("http://","https://"),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
    <!--script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": {
            "@type": "Person",
            "name": "Neo Alienson"
        },
        "headline": "在家中建立单点登录系统",
        "image": "https://neo01.com",
        "keywords": "Authentication Cybersecurity Homelab SSO",
        "genre": "Cybersecurity",
        "datePublished": "2025-01-15",
        "dateCreated": "2025-01-15",
        "dateModified": "2025-10-12",
        "url": "https://neo01.com//zh-CN/2025/01/Single-Sign-On-at-Home/",
        "description": "厌倦了管理家庭实验室服务的数十个密码？学习如何建立单点登录系统，只需一次登录即可访问所有服务。",
        "wordCount": 1631
    }
</script-->

</article>

                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>关注我 :</p>
        <ul class="social-links">
                <li>
                    <a class="social-tooltip" title="stack-exchange" href="https://stackexchange.com/users/2122053/neo?tab=accounts" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-exchange"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="stack-overflow" href="https://stackoverflow.com/users/1885105/neo" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-overflow"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/neoalienson" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-github"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="linkedin" href="https://linkedin.com/in/neo01" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-linkedin"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="rss" href="/atom.xml" target="_blank" rel="noopener">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
        </ul>
    </div>
    <div class="widgets-container">
        
            
                <div class="widget-wrap widget-list">
    <h3 class="widget-title">链接</h3>
    <div class="widget">
        <ul><li><a href="/zh-CN/ai">AI 游乐场</a></li><li><a href="/zh-CN/tools">工具</a></li><li><a href="/zh-CN/games">游戏</a></li><li><a href="/zh-CN/pages/useful-information">实用信息</a></li><li><a href="/zh-CN/pages/Hexo-Blogging-Cheatsheet">Hexo 博客速查表</a></li></ul>
    </div>
</div>

            
                
            
                    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-CN/2025/10/CISP-Access-Control-Audit-WAPI/" class="thumbnail">
        <span style="background-image:url(/assets/cisp/thumbnail_80.png)" alt="CISP学习指南：访问控制机制、蜜网、审计系统与WAPI" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-CN/categories/Cybersecurity/">网络安全</a></p>
                            <p class="item-title"><a href="/zh-CN/2025/10/CISP-Access-Control-Audit-WAPI/" class="title">CISP学习指南：访问控制机制、蜜网、审计系统与WAPI</a></p>
                            <p class="item-date"><time datetime="2025-10-21T16:00:00.000Z" itemprop="datePublished">2025-10-22</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-CN/2025/10/CISP-IDS-Law/" class="thumbnail">
        <span style="background-image:url(/assets/cisp/thumbnail_80.png)" alt="CISP学习指南：入侵检测系统与法律基础" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-CN/categories/Cybersecurity/">网络安全</a></p>
                            <p class="item-title"><a href="/zh-CN/2025/10/CISP-IDS-Law/" class="title">CISP学习指南：入侵检测系统与法律基础</a></p>
                            <p class="item-date"><time datetime="2025-10-20T16:00:00.000Z" itemprop="datePublished">2025-10-21</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-CN/2025/10/CISP-Project-Management-Basics/" class="thumbnail">
        <span style="background-image:url(/assets/cisp/thumbnail_80.png)" alt="CISP学习指南：项目管理基础" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-CN/categories/Cybersecurity/">网络安全</a></p>
                            <p class="item-title"><a href="/zh-CN/2025/10/CISP-Project-Management-Basics/" class="title">CISP学习指南：项目管理基础</a></p>
                            <p class="item-date"><time datetime="2025-10-20T16:00:00.000Z" itemprop="datePublished">2025-10-21</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-CN/2025/10/CISP-Authentication-Methods/" class="thumbnail">
        <span style="background-image:url(/assets/cisp/thumbnail_80.png)" alt="CISP学习指南：身份鉴别方法" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-CN/categories/Cybersecurity/">网络安全</a></p>
                            <p class="item-title"><a href="/zh-CN/2025/10/CISP-Authentication-Methods/" class="title">CISP学习指南：身份鉴别方法</a></p>
                            <p class="item-date"><time datetime="2025-10-19T16:00:00.000Z" itemprop="datePublished">2025-10-20</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-CN/2025/10/CISP-Security-Mechanisms-Protocols/" class="thumbnail">
        <span style="background-image:url(/assets/cisp/thumbnail_80.png)" alt="CISP学习指南：安全机制、密码协议与数字签名" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-CN/categories/Cybersecurity/">网络安全</a></p>
                            <p class="item-title"><a href="/zh-CN/2025/10/CISP-Security-Mechanisms-Protocols/" class="title">CISP学习指南：安全机制、密码协议与数字签名</a></p>
                            <p class="item-date"><time datetime="2025-10-19T16:00:00.000Z" itemprop="datePublished">2025-10-20</time></p>
                        </div>
                    </li>
            </ul>
        </div>
    </div>

            
                
    
    
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list">
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2025/">2025</a>
                    <span class="archive-list-count">52</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2024/">2024</a>
                    <span class="archive-list-count">24</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2023/">2023</a>
                    <span class="archive-list-count">15</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2022/">2022</a>
                    <span class="archive-list-count">3</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2020/">2020</a>
                    <span class="archive-list-count">9</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2019/">2019</a>
                    <span class="archive-list-count">12</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2018/">2018</a>
                    <span class="archive-list-count">2</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2017/">2017</a>
                    <span class="archive-list-count">5</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2016/">2016</a>
                    <span class="archive-list-count">4</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2015/">2015</a>
                    <span class="archive-list-count">6</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2014/">2014</a>
                    <span class="archive-list-count">7</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-CN/archives/2013/">2013</a>
                    <span class="archive-list-count">2</span>
                </li>
            
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <!-- disable caching cause each page has different footer from qrcode -->
        <!-- common/footer, null, {cache: !config.relative_link})  -->
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="qrcode-share-wrapper">
                <div class="qrcode-text">https://neo01.com/l#4cfae21d</div>
                <img src="/qr/qr-ed9832fdc81f5c668dfcc12c1bab0b26.svg" width="200" height="200" alt="QR Code for https://neo01.com/l#4cfae21d">
            </div>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" title="Homepage" class="logo"></a>
                </h1>
                
                <p>© 2025 Neo Alienson. 版权所有.
                  <a href="/zh-CN/terms-and-conditions">使用条款</a></p>
                
            </div>
            <div class="footer-plugins">
              


            </div>
        </div>
    </div>
</footer>

        
    
        


        


        


        


        


        


        


        


        


    



<!-- Custom Scripts -->




    </div>
<!-- hexo injector body_end start --><script type="text/javascript" src="/js/bundle_last.js"></script><!-- hexo injector body_end end -->

</body></html>