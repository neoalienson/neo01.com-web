<!DOCTYPE html><html lang="en"><head><!-- hexo injector head_begin start --><!-- Google tag (gtag.js) begins-->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3DZR3TQYCY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-3DZR3TQYCY');
    </script>
    <!-- Google tag (gtag.js) ends-->
    <!-- hexo injector head_begin end -->
    <meta charset="utf-8">
    <!-- security headers starts -->
    <!-- meta http-equiv="content-security-policy" content="script-src 'sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=' 'sha256-lJjk3/dvd+wXqRFjV7T5L/nXJXr5NjUjmsKSPEe+ass=';" -->
    <!-- security headers ends -->
    <!-- favicon starts -->    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <!-- favicon ends -->
    

    
    <title>Manage Your Own VPN - A Penny-Pincher's Guide | Decoding Digital Anomalies</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="keywords" content="Azure,cloud,Google,terraform">
    
    
    <meta name="description" content="Ditch the VPN subscription and start living like a digital nomad - minus the Instagram-worthy coffee shop vibes. Just grab a pay-as-you-go cloud VPN and wing it (your wallet will thank you)!">
<meta property="og:type" content="article">
<meta property="og:title" content="Manage Your Own VPN - A Penny-Pincher's Guide">
<meta property="og:url" content="https://neo01.com/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide/index.html">
<meta property="og:site_name" content="Decoding Digital Anomalies">
<meta property="og:description" content="Ditch the VPN subscription and start living like a digital nomad - minus the Instagram-worthy coffee shop vibes. Just grab a pay-as-you-go cloud VPN and wing it (your wallet will thank you)!">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://neo01.com/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide/index_head.jpeg">
<meta property="article:published_time" content="2024-01-11T16:00:00.000Z">
<meta property="article:modified_time" content="2024-05-06T16:00:00.000Z">
<meta property="article:author" content="Neo Alienson">
<meta property="article:tag" content="Azure">
<meta property="article:tag" content="cloud">
<meta property="article:tag" content="Google">
<meta property="article:tag" content="terraform">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://neo01.com/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide/index_head.jpeg">
    
            <link rel="alternate" href="/atom.xml" title="Decoding Digital Anomalies" type="application/atom+xml">
    

    

    

    

    

    

    

    
    
        


    
    
        


    

<!-- hexo injector head_end start --><link rel="stylesheet" type="text/css" href="/css/bundle.css"><script type="text/javascript" src="/js/bundle_first.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0">  <link rel="canonical" href="https://neo01.com/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide">
  <link rel="alternate" hreflang="en" href="https://neo01.com/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide">
  <link rel="alternate" hreflang="zh-TW" href="https://neo01.com/zh-TW/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide">
  <link rel="alternate" hreflang="zh-CN" href="https://neo01.com/zh-CN/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide">
  <link rel="alternate" hreflang="ja" href="https://neo01.com/ja/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide">
<style id="github-card-styles">.github-card {
  border-radius: 0.5rem;
  padding: 1.5rem;
  margin: 16px 15px 0 0;
  background: white;
  border: 1px solid #e5e7eb;
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
  display: flex;
  flex-direction: column;
}

.github-card.responsive {
  max-width: 100%;
}

.github-card-header {
  text-align: center;
  margin-bottom: 1rem;
}

.github-card-avatar {
  border-radius: 50%;
  padding-bottom: 1rem;
}

.github-card h3.github-card-name {
  font-size: 1.25rem;
  font-weight: bold;
}

.github-card-name a {
  text-decoration: none;
  color: #1f2937;
}

.github-card p.github-card-username {
  color: #6b7280;
}

.github-card-details {
  text-align: left;
}

.github-card h3.github-card-name,
.github-card p.github-card-username,
.github-card p.github-card-location,
.github-card p.github-card-blog,
.github-card p.github-card-bio {
  margin: 0;
  padding:  0 0 0.5em 0;
  line-height: 1rem;
  color: #6b7280;
}

.github-card-blog a {
  color: #3b82f6;
  text-decoration: none;
}

.github-card-stats {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.75rem;
  margin-bottom: 1rem;
}

.github-card-stat {
  text-align: center;
  padding: 0.5rem;
  background: #f9fafb;
  border-radius: 0.375rem;
}

.github-card-stat-number {
  font-size: 1.5rem;
  font-weight: bold;
  color: #1f2937;
}

.github-card-stat-label {
  font-size: 1rem;
  color: #6b7280;
}

.github-card-languages {
  margin-top: 1rem;
}

.github-card-language-bar {
  display: flex;
  height: 8px;
  border-radius: 4px;
  overflow: hidden;
  background: #f3f4f6;
  margin-bottom: 0.75rem;
}

.github-card-languages-list {
  display: flex;
  flex-wrap: wrap;
  gap: 0 1rem;
  font-size: 0.75rem;
}

.github-card-language-item {
  display: flex;
  align-items: center;
  gap: 0 0.25rem;
  color: #6b7280;
}

.github-card-language-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}

.github-card-language-segment {
  height: 100%;
  transition: width 0.3s ease;
}

.github-card-language-segment:first-child {
  border-top-left-radius: 4px;
  border-bottom-left-radius: 4px;
}

.github-card-language-segment:last-child {
  border-top-right-radius: 4px;
  border-bottom-right-radius: 4px;
}

.github-repo-card {
  display: flex;
  flex-direction: row !important;
  align-items: flex-start;
  gap: 1rem;
  min-height: inherit;
}

.github-repo-icon {
  font-size: 3rem;
  color: #6b7280;
  flex-shrink: 0;
}

.github-repo-info {
  flex: 1;
}

.github-repo-info h3 {
  margin: 0 0 0.5rem 0;
  font-size: 1.25rem;
  font-weight: bold;
}

.github-repo-info h3 a {
  text-decoration: none;
  color: #1f2937;
}

.github-repo-info p {
  margin: 0 0 1rem 0;
  color: #6b7280;
  line-height: 1.4;
}

.github-repo-stats {
  display: flex;
  gap: 1.5rem;
  flex-wrap: wrap;
}

.github-repo-stat {
  color: #6b7280;
  font-size: 0.875rem;
}

.github-repo-octocat {
  flex-shrink: 0;
  align-self: flex-start;
}

.github-repo-octocat svg {
  fill: #6b7280;
}

.github-card-error {
  color: #d73a49;
  padding: 8px;
  border: 1px solid #d73a49;
  border-radius: 4px;
}</style><script id="mermaid-scripts" src="/cache/mermaid.min.local.js"></script>
<script>mermaid.initialize({theme: 'default'});</script></head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" title="Homepage" class="logo"></a>
                    </h1>
                        <h2 class="subtitle-wrap">
                            <p class="title">Decoding Digital Anomalies</p>
                          <p class="subtitle">Sometimes the feature is the bug in the digital rabbit hole, and vice versa</p>
                        </h2>
                    <div id="lang-selector">
                        <span class="lang-icon">üåê</span>
                        
                                <a href="/zh-TW/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide/" class="lang-link">ÁπÅÈ´î‰∏≠Êñá</a>
<span class="lang-sep">|</span>                                <a href="/zh-CN/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide/" class="lang-link">ÁÆÄ‰Ωì‰∏≠Êñá</a>
<span class="lang-sep">|</span>                                <a href="/ja/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide/" class="lang-link">Êó•Êú¨Ë™û</a>
                    </div>
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/">Home</a>
                                </li>
                                                                    <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/AI/">AI</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/AI/Art-Gallery/">Art Gallery</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Architecture/">Architecture</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Cybersecurity/">Cybersecurity</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Development/">Development</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Misc/">Misc</a></li></ul>
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/about-me">About</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" id="search-form-input" placeholder="Search">
        <button type="submit" title="Search" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" id="ins-search-input" placeholder="Type something...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script integrity="sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=">
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
        LANG: 'en',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>




</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Development/">Development</a>
    </h1>
</div>

                        <div class="main-body-content">
                            <article id="post-2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide" class="article article-single article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner responsive-content">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        Manage Your Own VPN - A Penny-Pincher's Guide
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
      <i class="fa fa-calendar"></i>
        
          Created <time datetime="2024-01-11T16:00:00.000Z" itemprop="datePublished">2024-01-12</time>
          &nbsp;<i class="fa fa-calendar"></i>
          Updated <time datetime="2024-05-06T16:00:00.000Z" itemprop="datePublished">2024-05-07</time>
        
    </div>


                

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Azure/">Azure</a> <a class="tag-link" href="/tags/cloud/">cloud</a> <a class="tag-link" href="/tags/Google/">Google</a> <a class="tag-link" href="/tags/terraform/">terraform</a>
    </div>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-with-VPN-and-Proxy-Service-Pricing-Model"><span class="toc-text">Problem with VPN and Proxy Service Pricing Model</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#On-Demand-Cloud-Proxy"><span class="toc-text">On Demand Cloud Proxy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Price-comparison"><span class="toc-text">Price comparison</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VPN-with-WireGuard"><span class="toc-text">VPN with WireGuard</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#User-friendly-on-and-off"><span class="toc-text">User friendly on and off</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reminder-to-switch-off"><span class="toc-text">Reminder to switch off</span></a></li></ol>
            <p><img src="index_head.jpeg" alt=""></p>
<p>Ah, the internet ‚Äì a vast expanse of knowledge and cat videos. But as you navigate this digital sea, you might find yourself wanting a bit more privacy, or perhaps you‚Äôre just tired of being told what content you can and cannot view based on your location‚Ä¶</p>
<h2 id="Problem-with-VPN-and-Proxy-Service-Pricing-Model">Problem with VPN and Proxy Service Pricing Model</h2>
<p>Let‚Äôs have a quick look at the VPN service price as of Oct 2025</p>
<table>
<thead>
<tr>
<th>VPN Provider</th>
<th>Price per month (USD)</th>
<th>Price with subscription per month (USD)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Surfshark (Starter)</td>
<td>$15.45</td>
<td>$1.99 for 2 years subscription</td>
</tr>
<tr>
<td>ExpressVPN (Basic)</td>
<td>$12.99</td>
<td>3.49 for 2 years subscription</td>
</tr>
</tbody>
</table>
<p>The best pay-as-you-go option is per month. Per usage pay-as-you-go model does not exist and we are forced to adopt a subscription-based model. A subscription-based model is like hiring a bodyguard who insists on a year-long contract when you only need someone to watch your back during that shady walk home once a month. A Penny Pincher like me does not accept this subscription offer.</p>
<h2 id="On-Demand-Cloud-Proxy">On Demand Cloud Proxy</h2>
<p>Now, let us examine the available cloud services for your VPN/proxy adventures. You can create a VPN/proxy server on Cloud. For simplicity, let‚Äôs start with a proxy server on Google Cloud. Here‚Äôs how it is going to work:</p>
<div class="mermaid">flowchart LR
pc["Your PC\nin Country A\n\n"]
ssh["SSH tunnel\n\n"]
pc--&gt;ssh
proxy["Proxy on Google Cloud\nin Country B\n\n"]
ssh--&gt;proxy
target["Target Website\n\n"]
proxy--&gt;target</div>
<p>The flowchart illustrates the setup of a proxy server on Google Cloud. Your PC (PC) is in Country A, and you want to access a target website (target) that is restricted or has content blocked by your location. You establish an SSH tunnel (ssh) from your PC to the proxy server (proxy) on Google Cloud, which is located in Country B. This allows you to bypass geographical restrictions and access the target website as if you were in Country B.</p>
<h3 id="Provider-1-Google-Cloud">Provider 1. Google Cloud</h3>
<p>Below are the Terraform scripts to create a compute engine with the proxy (squid) on Google Cloud.</p>
<pre class="line-numbers language-hcl" data-language="hcl"><div class="caption"><span>main.tf</span></div><code class="language-hcl"><span class="token keyword">resource <span class="token type variable">"google_compute_instance"</span></span> <span class="token string">"default"</span> <span class="token punctuation">{</span>
  <span class="token property">name</span>         <span class="token punctuation">=</span> <span class="token string">"proxy-server"</span>
  <span class="token property">machine_type</span> <span class="token punctuation">=</span> <span class="token string">"e2-micro"</span>
  <span class="token property">zone</span>         <span class="token punctuation">=</span> <span class="token string">"us-west1-a"</span>
  <span class="token property">tags</span>         <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"ssh"</span><span class="token punctuation">]</span>

  <span class="token keyword">scheduling</span> <span class="token punctuation">{</span>
    <span class="token property">provisioning_model</span> <span class="token punctuation">=</span> <span class="token string">"SPOT"</span>
    <span class="token property">automatic_restart</span>  <span class="token punctuation">=</span> <span class="token boolean">false</span>
    <span class="token property">preemptible</span>        <span class="token punctuation">=</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">boot_disk</span> <span class="token punctuation">{</span>
    <span class="token keyword">initialize_params</span> <span class="token punctuation">{</span>
      <span class="token property">image</span> <span class="token punctuation">=</span> <span class="token string">"ubuntu-os-cloud/ubuntu-2004-lts"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">network_interface</span> <span class="token punctuation">{</span>
    <span class="token property">network</span> <span class="token punctuation">=</span> <span class="token string">"default"</span>
    <span class="token keyword">access_config</span> <span class="token punctuation">{</span>
      <span class="token comment">// Ephemeral public IP</span>
      <span class="token property">network_tier</span> <span class="token punctuation">=</span> <span class="token string">"STANDARD"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">service_account</span> <span class="token punctuation">{</span>
    <span class="token property">scopes</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"cloud-platform"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token property">metadata</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
    <span class="token property">ssh-keys</span>       <span class="token punctuation">=</span> format(<span class="token string">"%s:%s"</span>, var.ssh_username, var.ssh_public_key)
    <span class="token property">startup-script</span> <span class="token punctuation">=</span> <span class="token string">"sudo apt-get update;sudo apt-get install -y squid;sudo systemctl start squid"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/google/main.tf">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/google/main.tf</a></p>
<pre class="line-numbers language-hcl" data-language="hcl"><div class="caption"><span>variables.tf</span></div><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> "ssh_username" </span></span><span class="token punctuation">{</span>
  <span class="token property">type</span>        <span class="token punctuation">=</span> string
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"username of SSH to the compute engine"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "ssh_public_key" </span></span><span class="token punctuation">{</span>
  <span class="token property">type</span>        <span class="token punctuation">=</span> string
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"Public key for SSH"</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/google/variables.tf">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/google/variables.tf</a></p>
<pre class="line-numbers language-hcl" data-language="hcl"><div class="caption"><span>output.tf</span></div><code class="language-hcl"><span class="token keyword">output<span class="token type variable"> "ip" </span></span><span class="token punctuation">{</span>
  <span class="token property">value</span> <span class="token punctuation">=</span> google_compute_instance.default.network_interface.<span class="token number">0.</span>access_config.<span class="token number">0.</span>nat_ip
<span class="token punctuation">}</span>

<span class="token keyword">output<span class="token type variable"> "command" </span></span><span class="token punctuation">{</span>
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"Command to setup ssh tunnel to the proxy server"</span>
  <span class="token property">value</span> <span class="token punctuation">=</span> format(<span class="token string">"ssh-keygen -R %s; ssh -L3128:localhost:3128 %s@%s"</span>,
    google_compute_instance.default.network_interface.<span class="token number">0.</span>access_config.<span class="token number">0.</span>nat_ip,
    var.ssh_username,
  google_compute_instance.default.network_interface.<span class="token number">0.</span>access_config.<span class="token number">0.</span>nat_ip)
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/google/output.tf">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/google/output.tf</a></p>
<p>Run <code>terraform apply</code>:</p>
<pre class="language-shell-session" data-language="shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">terraform apply</span></span>

<span class="token output">var.google_access_credentials
  The json file that contains key of your service account in Google Cloud

  Enter a value: a.josn

var.project
  Google Cloud Project Name

  Enter a value: a

var.ssh_public_key
  Public key for SSH

  Enter a value: ssh-rsa AAAAB...

var.ssh_username
  username of SSH to the compute engine

  Enter a value: neo

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the
following symbols:
  + create

Terraform will perform the following actions:

  # google_compute_instance.default will be created
  + resource "google_compute_instance" "default" {
      ...
      + machine_type         = "e2-micro"
      + metadata             = {
          + "ssh-keys"       = "neo:ssh-rsa AAAAB..."
          + "startup-script" = "sudo apt-get update;sudo apt-get install -y squid;sudo systemctl start squid"
        }
      ...
    }

Plan: 1 to add, 0 to change, 0 to destroy.

Changes to Outputs:
  + command = (known after apply)
  + ip      = (known after apply)

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

google_compute_instance.default: Creating...
google_compute_instance.default: Still creating... [10s elapsed]
google_compute_instance.default: Creation complete after 17s [id=projects/a/zones/us-west1-a/instances/proxy-server]

Apply complete! Resources: 1 added, 0 changed, 0 destroyed.

Outputs:

command = "ssh -L3128:localhost:3128 neo@123.123.123.123"
ip = "123.123.123.123"</span></code></pre>
<p>To set up an SSH tunnel to the proxy, use the command provided in the output <code>command</code>. You may need to wait a few moments until the proxy is ready. Once the proxy is ready, your browser can use <code>localhost:3128</code> as the proxy.</p>
<p>When a cloud service reuses an IP address to create a new compute instance, you may experience a host validation error if you had SSH to the IP address before. This occurs because the new compute instance generates a new host key, which does not match the key you trusted in <code>.ssh/known_hosts</code>. To resolve this issue, you can either remove the trusted host key using <code>ssh-keygen -R</code> or send the private key from your local machine to the new compute instance.</p>
<p>Remember to destroy the compute engine once you have finished with it:</p>
<pre class="language-shell-session" data-language="shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">terraform destroy</span></span>

<span class="token output">google_compute_instance.default: Refreshing state... [id=projects/f-01man-com/zones/us-west1-a/instances/proxy-server]

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the
following symbols:
  - destroy

Terraform will perform the following actions:

  # google_compute_instance.default will be destroyed
  - resource "google_compute_instance" "default" {
      ...
    }

Plan: 0 to add, 0 to change, 1 to destroy.

Do you really want to destroy all resources?
  Terraform will destroy all your managed infrastructure, as shown above.
  There is no undo. Only 'yes' will be accepted to confirm.

  Enter a value: yes

google_compute_instance.default: Destroying... [id=projects/a/zones/us-west1-a/instances/proxy-server]
google_compute_instance.default: Still destroying... [id=projects/a/zones/us-west1-a/instances/proxy-server, 10s elapsed]
google_compute_instance.default: Destruction complete after 16s

Destroy complete! Resources: 1 destroyed.</span></code></pre>
<p>Given my extremely low usage, like 30 minutes a month, Google charges me around USD $0.20 a month. However, that doesn‚Äôt stop me from exploring other cheaper alternatives.</p>
<h3 id="Provider-2-Azure">Provider 2. Azure</h3>
<pre class="line-numbers language-hcl" data-language="hcl"><div class="caption"><span>main.tf</span></div><code class="language-hcl"><span class="token keyword">resource <span class="token type variable">"azurerm_resource_group"</span></span> <span class="token string">"rg"</span> <span class="token punctuation">{</span>
  <span class="token property">name</span>     <span class="token punctuation">=</span> <span class="token string">"squid-rg"</span>
  <span class="token property">location</span> <span class="token punctuation">=</span> <span class="token string">"West US"</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"azurerm_virtual_machine"</span></span> <span class="token string">"proxy"</span> <span class="token punctuation">{</span>
  <span class="token property">name</span> <span class="token punctuation">=</span> <span class="token string">"squid-proxy-vm"</span>

  <span class="token comment"># charge you if you dont delete</span>
  <span class="token property">delete_data_disks_on_termination</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
  <span class="token property">delete_os_disk_on_termination</span>    <span class="token punctuation">=</span> <span class="token boolean">true</span>

  <span class="token property">resource_group_name</span>   <span class="token punctuation">=</span> azurerm_resource_group.rg.name
  <span class="token property">location</span>              <span class="token punctuation">=</span> azurerm_resource_group.rg.location
  <span class="token property">network_interface_ids</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>azurerm_network_interface.nic.id<span class="token punctuation">]</span>
  <span class="token property">vm_size</span>               <span class="token punctuation">=</span> <span class="token string">"Standard_B1s"</span>
  <span class="token keyword">storage_os_disk</span> <span class="token punctuation">{</span>
    <span class="token property">name</span>              <span class="token punctuation">=</span> <span class="token string">"os"</span>
    <span class="token property">caching</span>           <span class="token punctuation">=</span> <span class="token string">"ReadWrite"</span>
    <span class="token property">managed_disk_type</span> <span class="token punctuation">=</span> <span class="token string">"Standard_LRS"</span>
    <span class="token property">create_option</span>     <span class="token punctuation">=</span> <span class="token string">"FromImage"</span>
    <span class="token property">os_type</span>           <span class="token punctuation">=</span> <span class="token string">"Linux"</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">storage_image_reference</span> <span class="token punctuation">{</span>
    <span class="token property">publisher</span> <span class="token punctuation">=</span> <span class="token string">"Canonical"</span>
    <span class="token property">offer</span>     <span class="token punctuation">=</span> <span class="token string">"0001-com-ubuntu-server-jammy"</span>
    <span class="token property">sku</span>       <span class="token punctuation">=</span> <span class="token string">"22_04-lts"</span>
    <span class="token property">version</span>   <span class="token punctuation">=</span> <span class="token string">"latest"</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">os_profile</span> <span class="token punctuation">{</span>
    <span class="token property">admin_username</span> <span class="token punctuation">=</span> var.ssh_username
    <span class="token property">computer_name</span>  <span class="token punctuation">=</span> <span class="token string">"proxy"</span>
    <span class="token property">custom_data</span> <span class="token punctuation">=</span> base64encode(<span class="token heredoc string">&lt;&lt;CUSTOM_DATA
#!/bin/bash
sudo apt-get update;sudo apt-get install -y squid;sudo systemctl start squid
    CUSTOM_DATA</span>
    )
  <span class="token punctuation">}</span>

  <span class="token keyword">os_profile_linux_config</span> <span class="token punctuation">{</span>
    <span class="token property">disable_password_authentication</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
    <span class="token keyword">ssh_keys</span> <span class="token punctuation">{</span>
      <span class="token property">path</span> <span class="token punctuation">=</span> <span class="token string">"/home/<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">ssh_username</span><span class="token punctuation">}</span></span>/.ssh/authorized_keys"</span>
      <span class="token property">key_data</span> <span class="token punctuation">=</span> var.ssh_public_key
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"azurerm_network_interface"</span></span> <span class="token string">"nic"</span> <span class="token punctuation">{</span>
  <span class="token property">name</span>                <span class="token punctuation">=</span> <span class="token string">"squid-nic"</span>
  <span class="token property">resource_group_name</span> <span class="token punctuation">=</span> azurerm_resource_group.rg.name
  <span class="token property">location</span>            <span class="token punctuation">=</span> azurerm_resource_group.rg.location

  <span class="token keyword">ip_configuration</span> <span class="token punctuation">{</span>
    <span class="token property">name</span>                          <span class="token punctuation">=</span> <span class="token string">"squid-ipconfig"</span>
    <span class="token property">subnet_id</span>                     <span class="token punctuation">=</span> azurerm_subnet.subnet.id
    <span class="token property">private_ip_address_allocation</span> <span class="token punctuation">=</span> <span class="token string">"Dynamic"</span>
    <span class="token property">public_ip_address_id</span>          <span class="token punctuation">=</span> azurerm_public_ip.proxy.id
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"azurerm_subnet"</span></span> <span class="token string">"subnet"</span> <span class="token punctuation">{</span>
  <span class="token property">name</span>                 <span class="token punctuation">=</span> <span class="token string">"squid-subnet"</span>
  <span class="token property">resource_group_name</span>  <span class="token punctuation">=</span> azurerm_resource_group.rg.name
  <span class="token property">virtual_network_name</span> <span class="token punctuation">=</span> azurerm_virtual_network.vnet.name
  <span class="token property">address_prefixes</span>     <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"10.0.0.0/24"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"azurerm_virtual_network"</span></span> <span class="token string">"vnet"</span> <span class="token punctuation">{</span>
  <span class="token property">name</span>                <span class="token punctuation">=</span> <span class="token string">"squid-vnet"</span>
  <span class="token property">resource_group_name</span> <span class="token punctuation">=</span> azurerm_resource_group.rg.name
  <span class="token property">address_space</span>       <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"10.0.0.0/8"</span><span class="token punctuation">]</span>
  <span class="token property">location</span>            <span class="token punctuation">=</span> <span class="token string">"West US"</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"azurerm_public_ip"</span></span> <span class="token string">"proxy"</span> <span class="token punctuation">{</span>
  <span class="token property">name</span>                <span class="token punctuation">=</span> <span class="token string">"squidPublicIp1"</span>
  <span class="token property">resource_group_name</span> <span class="token punctuation">=</span> azurerm_resource_group.rg.name
  <span class="token property">location</span>            <span class="token punctuation">=</span> azurerm_resource_group.rg.location
  <span class="token property">allocation_method</span>   <span class="token punctuation">=</span> <span class="token string">"Static"</span>

  <span class="token keyword">lifecycle</span> <span class="token punctuation">{</span>
    <span class="token property">create_before_destroy</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/azure/main.tf">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/azure/main.tf</a></p>
<pre class="line-numbers language-hcl" data-language="hcl"><div class="caption"><span>variables.tf</span></div><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> "ssh_username" </span></span><span class="token punctuation">{</span>
    <span class="token property">type</span>        <span class="token punctuation">=</span> string
    <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"username of SSH to the compute engine"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "ssh_public_key" </span></span><span class="token punctuation">{</span>
    <span class="token property">type</span>       <span class="token punctuation">=</span> string
    <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"Public key for SSH"</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/azure/variables.tf">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/azure/variables.tf</a></p>
<pre class="line-numbers language-hcl" data-language="hcl"><div class="caption"><span>output.tf</span></div><code class="language-hcl"><span class="token keyword">output<span class="token type variable"> "ip" </span></span><span class="token punctuation">{</span>
    <span class="token property">value</span> <span class="token punctuation">=</span> azurerm_public_ip.proxy.ip_address
<span class="token punctuation">}</span>

<span class="token keyword">output<span class="token type variable"> "command" </span></span><span class="token punctuation">{</span>
    <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"Command to setup ssh tunnel to the proxy server"</span>
    <span class="token property">value</span>       <span class="token punctuation">=</span> format(<span class="token string">"ssh-keygen -R %s; ssh -L3128:localhost:3128 %s@%s"</span>,
      azurerm_public_ip.proxy.ip_address,
      var.ssh_username,
      azurerm_public_ip.proxy.ip_address)
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/azure/output.tf">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/modules/azure/output.tf</a></p>
<p>It takes time to create and destroy. You can check <code>/var/log/cloud-init.log</code> and look for <code>subp.py</code> and <code>part</code> to troubleshoot, e.g.:</p>
<pre class="language-none"><code class="language-none">2024-05-07 14:14:02,864 - subp.py[DEBUG]: Running command ['/var/lib/cloud/instance/scripts/part-001'] with allowed return codes [0] (shell=False, capture=False)
2024-05-07 14:14:02,864 - subp.py[DEBUG]: Exec format error. Missing #! in script?
Command: ['/var/lib/cloud/instance/scripts/part-001']
Exit code: -
Reason: [Errno 8] Exec format error: b'/var/lib/cloud/instance/scripts/part-001'</code></pre>
<h3 id="Other-Cloud-Service-Provider">Other Cloud Service Provider</h3>
<p>I have also tried Alibaba Cloud and Huawei Cloud. However, Alibaba Cloud requires account verification after a few uses of IP addresses and resources from a country other than China, which asks me to upload my passport, etc. Also, the minimum compute service is monthly instead of consumption-based like Google Cloud.</p>
<p>On the other hand, Huawei Cloud is better; compute service can be consumption-based. However, bandwidth charges are per day subscription and not metered, resulting in a daily fee of USD 2! Therefore, I do not recommend Alibaba Cloud and Huawei Cloud for those who are Penny Pinchers.</p>
<h3 id="Cloud-Agnostic-Terraform-Script">Cloud Agnostic Terraform Script</h3>
<p>Now we have 2 cloud provider options, Azure and Google. We want to create cloud-agnostic Terraform scripts because it allows us to maintain a single set of code and apply it across multiple cloud providers. This approach allows us to easily switch between different cloud service providers if needed. A cloud-agnostic architecture plus money saving!</p>
<p>Let‚Äôs structure the folder as below:</p>
<pre class="language-none"><code class="language-none">\ - root
    \ - main.tf
      - variables.tf
      - output.tf
      - provider.tf
    \ - modules
        \ - google
            \ - main.tf
              - variables.tf
              - output.tf
        \ - azure
            \ - main.tf
              - variables.tf
              - output.tf</code></pre>
<p>The <code>root</code> folder serves as a cloud-agnostic abstract layer, while subfolders under <code>modules</code>, i.e., <code>modules/azure</code> and <code>modules/google</code>, serve as cloud-specific implementation. What you can expect from running <code>root</code> scripts is to provision a cloud server by providing your username and public key, and the return command to set up an SSH tunnel from the output. Use of which provider depends on the <code>cloud_service_provider</code> variable, either <code>azure</code> or <code>google</code> from the example.</p>
<pre class="language-hcl" data-language="hcl"><div class="caption"><span>/variables.tf</span></div><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> "cloud_service_provider" </span></span><span class="token punctuation">{</span>
  <span class="token property">type</span>        <span class="token punctuation">=</span> string
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"Cloud Service Provider: azure or google"</span>

  <span class="token keyword">validation</span> <span class="token punctuation">{</span>
    <span class="token property">condition</span>     <span class="token punctuation">=</span> contains(<span class="token punctuation">[</span><span class="token string">"azure"</span>, <span class="token string">"google"</span><span class="token punctuation">]</span>, var.cloud_service_provider)
    <span class="token property">error_message</span> <span class="token punctuation">=</span> <span class="token string">"Valid values for var: cloud_service_provider are (azure, google)."</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "ssh_username" </span></span><span class="token punctuation">{</span>
  <span class="token property">type</span>        <span class="token punctuation">=</span> string
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"username of SSH to the compute engine"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "ssh_public_key" </span></span><span class="token punctuation">{</span>
  <span class="token property">type</span>        <span class="token punctuation">=</span> string
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"Public key for SSH"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "google_project" </span></span><span class="token punctuation">{</span>
  <span class="token property">type</span>        <span class="token punctuation">=</span> string
  <span class="token property">default</span>     <span class="token punctuation">=</span> <span class="token string">"no project"</span>
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"Google Cloud Project Name."</span>
<span class="token punctuation">}</span>

<span class="token keyword">locals</span> <span class="token punctuation">{</span>
  <span class="token comment"># cross variables validation could be improved in Terraform v1.9.0</span>
  <span class="token comment"># tflint-ignore: terraform_unused_declarations</span>
  <span class="token property">validate_project</span> <span class="token punctuation">=</span> (var.google_project <span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token string">"no project"</span> &amp;&amp; var.cloud_service_provider <span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token string">"google"</span>) ? tobool(
  <span class="token string">"google_project must be provided when the provider is 'google'."</span>) : <span class="token boolean">true</span>
<span class="token punctuation">}</span></code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/variables.tf">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/variables.tf</a></p>
<p><code>/main.tf</code> is very simple, it enables the module to implement cloud proxy per requirement and disable the other:</p>
<pre class="line-numbers language-hcl" data-language="hcl"><div class="caption"><span>/main.tf</span></div><code class="language-hcl"><span class="token keyword">module<span class="token type variable"> "azure_server" </span></span><span class="token punctuation">{</span>
  <span class="token property">source</span> <span class="token punctuation">=</span> <span class="token string">"./modules/azure"</span>
  <span class="token property">count</span>  <span class="token punctuation">=</span> (var.cloud_service_provider <span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token string">"azure"</span>) ? <span class="token number">1</span> : <span class="token number">0</span>

  <span class="token property">ssh_public_key</span> <span class="token punctuation">=</span> var.ssh_public_key
  <span class="token property">ssh_username</span>   <span class="token punctuation">=</span> var.ssh_username
<span class="token punctuation">}</span>

<span class="token keyword">module<span class="token type variable"> "google_server" </span></span><span class="token punctuation">{</span>
  <span class="token property">source</span>         <span class="token punctuation">=</span> <span class="token string">"./modules/google"</span>
  <span class="token property">count</span>          <span class="token punctuation">=</span> (var.cloud_service_provider <span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token string">"google"</span>) ? <span class="token number">1</span> : <span class="token number">0</span>
  <span class="token property">ssh_public_key</span> <span class="token punctuation">=</span> var.ssh_public_key
  <span class="token property">ssh_username</span>   <span class="token punctuation">=</span> var.ssh_username
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/main.tf">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/main.tf</a></p>
<p><code>/output.tf</code> is similar to <code>/main.tf</code>, which returns <code>ip</code> and <code>command</code> as well:</p>
<pre class="line-numbers language-hcl" data-language="hcl"><div class="caption"><span>/output.tf</span></div><code class="language-hcl"><span class="token keyword">output<span class="token type variable"> "ip" </span></span><span class="token punctuation">{</span>
  <span class="token property">value</span> <span class="token punctuation">=</span> (var.cloud_service_provider <span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token string">"azure"</span>) ? module.azure_server<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.ip : module.google_server<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.ip
<span class="token punctuation">}</span>

<span class="token keyword">output<span class="token type variable"> "command" </span></span><span class="token punctuation">{</span>
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"Command to setup ssh tunnel to the proxy server"</span>
  <span class="token property">value</span>       <span class="token punctuation">=</span> (var.cloud_service_provider <span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token string">"azure"</span>) ? module.azure_server<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.command : module.google_server<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.command
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/output.tf">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/output.tf</a></p>
<p>Providers in Terraform scripts are removed from modules and put together into <code>/provider.tf</code>.</p>
<pre class="line-numbers language-hcl" data-language="hcl"><div class="caption"><span>/provider.tf</span></div><code class="language-hcl"><span class="token keyword">terraform</span> <span class="token punctuation">{</span>
  <span class="token keyword">required_providers</span> <span class="token punctuation">{</span>
    <span class="token property">azapi</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
      <span class="token property">source</span> <span class="token punctuation">=</span> <span class="token string">"Azure/azapi"</span>
    <span class="token punctuation">}</span>
    <span class="token property">azurerm</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
      <span class="token property">source</span> <span class="token punctuation">=</span> <span class="token string">"hashicorp/azurerm"</span>
    <span class="token punctuation">}</span>
    <span class="token property">google</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
      <span class="token property">source</span> <span class="token punctuation">=</span> <span class="token string">"hashicorp/google"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">provider<span class="token type variable"> "azapi" </span></span><span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">provider<span class="token type variable"> "azurerm" </span></span><span class="token punctuation">{</span>
  <span class="token keyword">features</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">provider<span class="token type variable"> "google" </span></span><span class="token punctuation">{</span>
  <span class="token property">project</span> <span class="token punctuation">=</span> var.google_project
  <span class="token property">region</span>  <span class="token punctuation">=</span> <span class="token string">"us-central1"</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/provider.tf">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/provider.tf</a></p>
<blockquote>
<p>Full source code: <a target="_blank" rel="noopener" href="https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/">https://github.com/neoalienson/cloud_vpn_proxy/blob/main/server/</a></p>
</blockquote>
<div class="github-card github-repo-card responsive" style=" min-height: 100px; text-align: left;">
        <div class="github-repo-icon">üìñ</div>
        <div class="github-repo-info">
          <h3><a href="https://github.com/neoalienson/cloud_vpn_proxy" target="_blank">neoalienson/cloud_vpn_proxy</a></h3>
          <p>Setup your own Cloud Agnostic cloud VPN or proxy</p>
          <div class="github-repo-stats">
            <span class="github-repo-stat">‚≠ê 0 Stars</span>
            <span class="github-repo-stat">üç¥ 0 Forks</span>
            <span class="github-repo-stat">Language: HCL</span>
          </div>
        </div>
        <div class="github-repo-octocat"><svg height="32" aria-hidden="true" viewBox="0 0 24 24" version="1.1" width="32" data-view-component="true" class="octicon octicon-mark-github v-align-middle">
    <path d="M12 1C5.923 1 1 5.923 1 12c0 4.867 3.149 8.979 7.521 10.436.55.096.756-.233.756-.522 0-.262-.013-1.128-.013-2.049-2.764.509-3.479-.674-3.699-1.292-.124-.317-.66-1.293-1.127-1.554-.385-.207-.936-.715-.014-.729.866-.014 1.485.797 1.691 1.128.99 1.663 2.571 1.196 3.204.907.096-.715.385-1.196.701-1.471-2.448-.275-5.005-1.224-5.005-5.432 0-1.196.426-2.186 1.128-2.956-.111-.275-.496-1.402.11-2.915 0 0 .921-.288 3.024 1.128a10.193 10.193 0 0 1 2.75-.371c.936 0 1.871.123 2.75.371 2.104-1.43 3.025-1.128 3.025-1.128.605 1.513.221 2.64.111 2.915.701.77 1.127 1.747 1.127 2.956 0 4.222-2.571 5.157-5.019 5.432.399.344.743 1.004.743 2.035 0 1.471-.014 2.654-.014 3.025 0 .289.206.632.756.522C19.851 20.979 23 16.854 23 12c0-6.077-4.922-11-11-11Z"></path>
</svg></div>
      </div>
<h3 id="Notification-on-Proxy-Ready">Notification on Proxy Ready</h3>
<p><em>Coming soon‚Ä¶</em></p>
<h2 id="Price-comparison">Price comparison</h2>
<h3 id="Azure">Azure</h3>
<p>Virtual Machine<br>
Virtual Network<br>
Storage<br>
Bandwidth</p>
<h3 id="Google-Cloud">Google Cloud</h3>
<p>Compute Engine<br>
Networking</p>
<p><em>Coming soon‚Ä¶</em></p>
<h2 id="VPN-with-WireGuard">VPN with WireGuard</h2>
<p><em>Coming soon‚Ä¶</em></p>
<h2 id="User-friendly-on-and-off">User friendly on and off</h2>
<p><em>Coming soon‚Ä¶</em></p>
<h2 id="Reminder-to-switch-off">Reminder to switch off</h2>
<p><em>Coming soon‚Ä¶</em></p>

        </div>
        <footer class="article-footer">
            
    <a data-url="https://neo01.com/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide/" data-id="3a587dca" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url').replace("http://","https://"),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
    <!--script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": {
            "@type": "Person",
            "name": "Neo Alienson"
        },
        "headline": "Manage Your Own VPN - A Penny-Pincher&#39;s Guide",
        "image": "https://neo01.comindex_head.jpeg",
        "keywords": "Azure Google cloud terraform",
        "genre": "Development",
        "datePublished": "2024-01-12",
        "dateCreated": "2024-01-12",
        "dateModified": "2024-05-07",
        "url": "https://neo01.com/2024/01/Manage_Your_Own_VPN_A_Penny-Pinchers_Guide/",
        "description": "Ditch the VPN subscription and start living like a digital nomad - minus the Instagram-worthy coffee shop vibes. Just grab a pay-as-you-go cloud VPN and wing it (your wallet will thank you)!",
        "wordCount": 4016
    }
</script-->

</article>

                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>follow:</p>
        <ul class="social-links">
                <li>
                    <a class="social-tooltip" title="stack-exchange" href="https://stackexchange.com/users/2122053/neo?tab=accounts" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-exchange"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="stack-overflow" href="https://stackoverflow.com/users/1885105/neo" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-overflow"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/neoalienson" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-github"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="linkedin" href="https://linkedin.com/in/neo01" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-linkedin"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="rss" href="/atom.xml" target="_blank" rel="noopener">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
        </ul>
    </div>
    <div class="widgets-container">
        
            
                <div class="widget-wrap widget-list">
    <h3 class="widget-title">links</h3>
    <div class="widget">
        <ul><li><a href="/ai">AI Playground</a></li><li><a href="/tools">Tools</a></li><li><a href="/games">Games</a></li><li><a href="/pages/useful-information">Useful Information</a></li><li><a href="/pages/Hexo-Blogging-Cheatsheet">Hexo Blogging Cheatsheet</a></li></ul>
    </div>
</div>

            
                
            
                    <div class="widget-wrap">
        <h3 class="widget-title">recents</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                    <li>
                        <div class="item-thumbnail">
                            <a href="/2025/10/How-I-Use-AI-to-Learn/" class="thumbnail">
        <span style="background-image:url(/assets/learning/thumbnail_80.png)" alt="How I Use AI to Learn: A Personal Journey Through Iterative Knowledge Building" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/AI/">AI</a></p>
                            <p class="item-title"><a href="/2025/10/How-I-Use-AI-to-Learn/" class="title">How I Use AI to Learn: A Personal Journey Through Iterative Knowledge Building</a></p>
                            <p class="item-date"><time datetime="2025-10-18T16:00:00.000Z" itemprop="datePublished">2025-10-19</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/2025/10/Tools-Games-And-Browser-Built-In-AI/" class="thumbnail">
        <span style="background-image:url(/2025/10/Tools-Games-And-Browser-Built-In-AI/thumbnail.jpeg)" alt="Tools, Games and Browser Built-in AI Playground" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/AI/">AI</a></p>
                            <p class="item-title"><a href="/2025/10/Tools-Games-And-Browser-Built-In-AI/" class="title">Tools, Games and Browser Built-in AI Playground</a></p>
                            <p class="item-date"><time datetime="2025-10-01T16:00:00.000Z" itemprop="datePublished">2025-10-02</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/" class="thumbnail">
        <span style="background-image:url(/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/thumbnail.jpeg)" alt="The Rise of Agentic Coding: AI-Powered Software Engineering" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/AI/">AI</a></p>
                            <p class="item-title"><a href="/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/" class="title">The Rise of Agentic Coding: AI-Powered Software Engineering</a></p>
                            <p class="item-date"><time datetime="2025-09-19T16:00:00.000Z" itemprop="datePublished">2025-09-20</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/2025/08/Understanding_Ephemeral_Ports_Part2/" class="thumbnail">
        <span style="background-image:url(/assets/ports/thumbnail.png)" alt="Understanding Ephemeral Ports Part 2: Why Server Applications Should Avoid Dynamic Ports" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Development/">Development</a></p>
                            <p class="item-title"><a href="/2025/08/Understanding_Ephemeral_Ports_Part2/" class="title">Understanding Ephemeral Ports Part 2: Why Server Applications Should Avoid Dynamic Ports</a></p>
                            <p class="item-date"><time datetime="2025-08-30T16:00:00.000Z" itemprop="datePublished">2025-08-31</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/2025/08/Understanding_Ephemeral_Ports_Part1/" class="thumbnail">
        <span style="background-image:url(/assets/ports/thumbnail.png)" alt="Understanding Ephemeral Ports: The Invisible Workers of Network Communication" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Development/">Development</a></p>
                            <p class="item-title"><a href="/2025/08/Understanding_Ephemeral_Ports_Part1/" class="title">Understanding Ephemeral Ports: The Invisible Workers of Network Communication</a></p>
                            <p class="item-date"><time datetime="2025-08-29T16:00:00.000Z" itemprop="datePublished">2025-08-30</time></p>
                        </div>
                    </li>
            </ul>
        </div>
    </div>

            
                
    
    
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list">
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2025/">2025</a>
                    <span class="archive-list-count">14</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2024/">2024</a>
                    <span class="archive-list-count">25</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2023/">2023</a>
                    <span class="archive-list-count">15</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2022/">2022</a>
                    <span class="archive-list-count">11</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2021/">2021</a>
                    <span class="archive-list-count">14</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2020/">2020</a>
                    <span class="archive-list-count">13</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2019/">2019</a>
                    <span class="archive-list-count">12</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2018/">2018</a>
                    <span class="archive-list-count">2</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2017/">2017</a>
                    <span class="archive-list-count">5</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2016/">2016</a>
                    <span class="archive-list-count">4</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2015/">2015</a>
                    <span class="archive-list-count">6</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2014/">2014</a>
                    <span class="archive-list-count">7</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2013/">2013</a>
                    <span class="archive-list-count">2</span>
                </li>
            
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <!-- disable caching cause each page has different footer from qrcode -->
        <!-- common/footer, null, {cache: !config.relative_link})  -->
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="qrcode-share-wrapper">
                <div class="qrcode-text">https://neo01.com/l#7491eba1</div>
                <img src="/qr/qr-adfb2e743a83314c341c40178ee1c55f.svg" width="200" height="200" alt="QR Code for https://neo01.com/l#7491eba1">
            </div>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" title="Homepage" class="logo"></a>
                </h1>
                
                <p>¬© 2025 Neo Alienson. All rights reserved.
                  <a href="/terms-and-conditions">Terms and Conditions</a></p>
                
            </div>
            <div class="footer-plugins">
              


            </div>
        </div>
    </div>
</footer>

        
    
        


        


        


        


        


        


        


        


        


    



<!-- Custom Scripts -->




    </div>
<!-- hexo injector body_end start --><script type="text/javascript" src="/js/bundle_last.js"></script><!-- hexo injector body_end end -->

</body></html>