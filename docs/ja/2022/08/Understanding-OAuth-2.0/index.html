<!DOCTYPE html><html lang="ja"><head><!-- hexo injector head_begin start --><!-- Google tag (gtag.js) begins-->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3DZR3TQYCY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-3DZR3TQYCY');
    </script>
    <!-- Google tag (gtag.js) ends-->
    <!-- hexo injector head_begin end -->
    <meta charset="utf-8">
    <!-- security headers starts -->
    <!-- meta http-equiv="content-security-policy" content="script-src 'sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=' 'sha256-lJjk3/dvd+wXqRFjV7T5L/nXJXr5NjUjmsKSPEe+ass=';" -->
    <!-- security headers ends -->
    <!-- favicon starts -->    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <!-- favicon ends -->
    

    <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="alternate" href="/atom.xml" title="Decoding Digital Anomalies" type="application/atom+xml">
    

    

    

    

    

    

    

    
    
        


    
    
        


    



    
    <title>OAuth 2.0 を理解する：現代 API を支える認可フレームワーク | Decoding Digital Anomalies</title>
    
    <meta name="keywords" content="API,Authentication,OAuth,Security">
    
    
    <meta name="description" content="OAuth 2.0 はパスワード共有なしで安全な委任アクセスを実現します。認可フローの仕組み、よくある落とし穴、OAuth が認証ではない理由を学びましょう。">
<meta property="og:type" content="article">
<meta property="og:title" content="OAuth 2.0 を理解する：現代 API を支える認可フレームワーク">
<meta property="og:url" content="https://neo01.com/ja/2022/08/Understanding-OAuth-2.0/index.html">
<meta property="og:site_name" content="Decoding Digital Anomalies">
<meta property="og:description" content="OAuth 2.0 はパスワード共有なしで安全な委任アクセスを実現します。認可フローの仕組み、よくある落とし穴、OAuth が認証ではない理由を学びましょう。">
<meta property="og:locale" content="ja_JP">
<meta property="article:published_time" content="2022-08-15T16:00:00.000Z">
<meta property="article:modified_time" content="2025-10-29T08:00:08.650Z">
<meta property="article:author" content="Neo Alienson">
<meta property="article:tag" content="API">
<meta property="article:tag" content="Authentication">
<meta property="article:tag" content="OAuth">
<meta property="article:tag" content="Security">
<meta name="twitter:card" content="summary">
    
    <!-- hexo injector head_end start --><link rel="stylesheet" type="text/css" href="/css/bundle.css"><script type="text/javascript" src="/js/bundle_first.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 8.1.0">  <link rel="canonical" href="https://neo01.com/ja/2022/08/Understanding-OAuth-2.0/">
  <link rel="alternate" hreflang="en" data-canonical="true" href="https://neo01.com/2022/08/Understanding-OAuth-2.0/">
  <link rel="alternate" hreflang="zh-TW" href="https://neo01.com/zh-TW/2022/08/Understanding-OAuth-2.0/">
  <link rel="alternate" hreflang="zh-CN" href="https://neo01.com/zh-CN/2022/08/Understanding-OAuth-2.0/">
  <link rel="alternate" hreflang="ja" href="https://neo01.com/ja/2022/08/Understanding-OAuth-2.0/">
<style id="admonition-styles">.admonition {
  margin: 1em 0;
  padding: 0rem;
  border-left: 0.3rem solid;
  border-radius: 0.4rem;
  background-color: #f9f9f9;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
  overflow: hidden;
  page-break-inside: avoid;
}

.admonition-title {
  display: flex;
  align-items: center;
  font-weight: 600;
  padding: 0rem 1rem 0.1rem 0.75rem;
  font-size: 1.05em;
  background-color: rgba(0, 0, 0, 0.03);
  border-top-left-radius: 0.4rem;
  border-top-right-radius: 0.4rem;
  margin: 0 !important;
}

.admonition-icon {
  font-size: 1.2em;
  margin-right: 0.6rem;
  opacity: 0.85;
  margin-top: 0.1rem;
}

/* 内容区域 margin */
.admonition > *:not(.admonition-title) {
  margin: 0.6rem 1rem 0.6rem 1rem;
}

/* NOTE 类型 */
.admonition.anote {
  border-color: #448aff;
}
.admonition.anote > .admonition-title {
  background-color: #448aff1a;
  color: #2962ff;
}

/* INFO / TODO 类型 */
.admonition.info,
.admonition.todo {
  border-color: #00b8d4;
}
.admonition.info > .admonition-title,
.admonition.todo > .admonition-title {
  background-color: rgba(0, 184, 212, 0.1);
  color: #007c91;
}

/* 警告类 */
.admonition.warning,
.admonition.attention,
.admonition.caution {
  border-color: #ff9100;
}
.admonition.warning > .admonition-title,
.admonition.attention > .admonition-title,
.admonition.caution > .admonition-title {
  background-color: rgba(255, 145, 0, 0.1);
  color: #c66900;
}

/* 错误类 */
.admonition.failure,
.admonition.missing,
.admonition.fail,
.admonition.error,
.admonition.danger,
.admonition.bug {
  border-color: #ff5252;
}
.admonition.failure > .admonition-title,
.admonition.missing > .admonition-title,
.admonition.fail > .admonition-title,
.admonition.error > .admonition-title,
.admonition.danger > .admonition-title,
.admonition.bug > .admonition-title {
  background-color: rgba(255, 82, 82, 0.1);
  color: #b71c1c;
}

/* TIP 类型 */
.admonition.tip {
  border-color: #00bfa5;
}
.admonition.tip > .admonition-title {
  background-color: #00bfa51a;
  color: #00796b;
}

/* SUCCESS 类型 */
.admonition.success {
  border-color: #00c853;
}
.admonition.success > .admonition-title {
  background-color: #00c8531a;
  color: #2e7d32;
}

/* QUESTION 类型 */
.admonition.question {
  border-color: #64dd17;
}
.admonition.question > .admonition-title {
  background-color: #64dd171a;
  color: #558b2f;
}

/* EXAMPLE 类型 */
.admonition.example {
  border-color: #7c4dff;
}
.admonition.example > .admonition-title {
  background-color: #7c4dff1a;
  color: #512da8;
}

/* QUOTE 类型 */
.admonition.quote {
  border-color: #9e9e9e;
}
.admonition.quote > .admonition-title {
  background-color: #9e9e9e1a;
  color: #424242;
}

/*黑暗模式*/
/* 夜间模式基础样式 */
[data-theme="dark"] .admonition {
  background-color: #1e1e1e;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
}

[data-theme="dark"] .admonition-title {
  background-color: rgba(255, 255, 255, 0.05);
}

/* anote */
[data-theme="dark"] .admonition.anote {
  border-color: #82b1ff;
}
[data-theme="dark"] .admonition.anote > .admonition-title {
  background-color: #82b1ff1a;
  color: #bbdefb;
}

/* tip */
[data-theme="dark"] .admonition.tip {
  border-color: #64ffda;
}
[data-theme="dark"] .admonition.tip > .admonition-title {
  background-color: #64ffda1a;
  color: #1de9b6;
}

/* success */
[data-theme="dark"] .admonition.success {
  border-color: #69f0ae;
}
[data-theme="dark"] .admonition.success > .admonition-title {
  background-color: #69f0ae1a;
  color: #00e676;
}

/* question */
[data-theme="dark"] .admonition.question {
  border-color: #b2ff59;
}
[data-theme="dark"] .admonition.question > .admonition-title {
  background-color: #b2ff591a;
  color: #aeea00;
}

/* example */
[data-theme="dark"] .admonition.example {
  border-color: #b388ff;
}
[data-theme="dark"] .admonition.example > .admonition-title {
  background-color: #b388ff1a;
  color: #b39ddb;
}

/* quote */
[data-theme="dark"] .admonition.quote {
  border-color: #bdbdbd;
}
[data-theme="dark"] .admonition.quote > .admonition-title {
  background-color: #bdbdbd1a;
  color: #eeeeee;
}

/* warning / attention / caution */
[data-theme="dark"] .admonition.warning,
[data-theme="dark"] .admonition.attention,
[data-theme="dark"] .admonition.caution {
  border-color: #ffb300;
}
[data-theme="dark"] .admonition.warning > .admonition-title,
[data-theme="dark"] .admonition.attention > .admonition-title,
[data-theme="dark"] .admonition.caution > .admonition-title {
  background-color: #ffb3001a;
  color: #ffe082;
}

/* error / fail / failure / bug / danger / missing */
[data-theme="dark"] .admonition.error,
[data-theme="dark"] .admonition.fail,
[data-theme="dark"] .admonition.failure,
[data-theme="dark"] .admonition.bug,
[data-theme="dark"] .admonition.missing,
[data-theme="dark"] .admonition.danger {
  border-color: #ef5350;
}
[data-theme="dark"] .admonition.error > .admonition-title,
[data-theme="dark"] .admonition.fail > .admonition-title,
[data-theme="dark"] .admonition.failure > .admonition-title,
[data-theme="dark"] .admonition.bug > .admonition-title,
[data-theme="dark"] .admonition.missing > .admonition-title,
[data-theme="dark"] .admonition.danger > .admonition-title {
  background-color: #ef53501a;
  color: #ff8a80;
}</style><script id="mermaid-scripts" src="/cache/mermaid.min.local.js"></script>
<script>mermaid.initialize({theme: 'default'});</script></head>

<body>
    <div id="wrap">
        
        
<header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <div class="logo"></div>
                    </h1>

                        <h2 class="subtitle-wrap">
                            <p class="title">デジタル異常の解読</p>
                          <p class="subtitle">デジタルの迷宮では、時に機能がバグであり、その逆もまた然り</p>
                        </h2>




                    <div id="lang-selector">
                        <span class="lang-icon">🌐</span>
                        
                            <a href="#" class="lang-link" data-lang="en">English</a>
<span class="lang-sep">|</span>                            <a href="#" class="lang-link" data-lang="zh-TW">繁體中文</a>
<span class="lang-sep">|</span>                            <a href="#" class="lang-link" data-lang="zh-CN">简体中文</a>
                        <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            var currentLang = 'ja';
                            var currentPath = window.location.pathname;
                            var basePath;
                            
                            if (currentLang === 'en') {
                                basePath = currentPath;
                            } else {
                                basePath = currentPath.replace(new RegExp('^/' + currentLang + '/'), '/');
                            }
                            
                            document.querySelectorAll('.lang-link').forEach(function(link) {
                                var targetLang = link.getAttribute('data-lang');
                                var targetPath;
                                if (targetLang === 'en') {
                                    targetPath = basePath;
                                } else {
                                    targetPath = '/' + targetLang + basePath;
                                }
                                link.href = targetPath;
                            });
                        });
                        </script>
                    </div>


                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/ja/">ホーム</a>
                                </li>
                                                                    <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/ja/categories/AI/">AI</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/ja/categories/AI/Art-Gallery/">アートギャラリー</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/ja/categories/Architecture/">アーキテクチャ</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/ja/categories/Cybersecurity/">サイバーセキュリティ</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/ja/categories/Development/">開発</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/ja/categories/Misc/">その他</a></li></ul>
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/ja/about-me">このブログについて</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" id="search-form-input" placeholder="検索">
        <button type="submit" title="検索" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" id="ins-search-input" placeholder="入力してください">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script integrity="sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=">
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '記事',
            PAGES: 'ページ',
            CATEGORIES: 'カテゴリー',
            TAGS: 'タグ',
            UNTITLED: '（名称未設定）',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
        LANG: 'ja',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>




</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

        
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Development/">Development</a>
    </h1>
</div>

                        <div class="main-body-content">
                            <article id="post-2022/08/Understanding-OAuth-2.0-ja" class="article article-single article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner responsive-content">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        OAuth 2.0 を理解する：現代 API を支える認可フレームワーク
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
      <i class="fa fa-calendar"></i>
        
          Created <time datetime="2022-08-15T16:00:00.000Z" itemprop="datePublished">2022-08-16</time>
          &nbsp;<i class="fa fa-calendar"></i>
          Updated <time datetime="2025-10-29T08:00:08.650Z" itemprop="datePublished">2025-10-29</time>
        
    </div>


                

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/ja/tags/Security/">Security</a> <a class="tag-link" href="/ja/tags/Authentication/">Authentication</a> <a class="tag-link" href="/ja/tags/OAuth/">OAuth</a> <a class="tag-link" href="/ja/tags/API/">API</a>
    </div>

            </div>
        
        
        
        <div class="article-entry" itemprop="articleBody">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#OAuth-2-0-%E3%81%8C%E5%AE%9F%E9%9A%9B%E3%81%AB%E8%A7%A3%E6%B1%BA%E3%81%99%E3%82%8B%E5%95%8F%E9%A1%8C"><span class="toc-text">OAuth 2.0 が実際に解決する問題</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OAuth-2-0-%E3%81%AE%E5%BD%B9%E5%89%B2%E3%81%A8%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88"><span class="toc-text">OAuth 2.0 の役割とコンポーネント</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AA%8D%E5%8F%AF%E3%82%B3%E3%83%BC%E3%83%89%E3%83%95%E3%83%AD%E3%83%BC%EF%BC%9A%E3%82%B4%E3%83%BC%E3%83%AB%E3%83%89%E3%82%B9%E3%82%BF%E3%83%B3%E3%83%80%E3%83%BC%E3%83%89"><span class="toc-text">認可コードフロー：ゴールドスタンダード</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%82%A4%E3%83%B3%E3%83%97%E3%83%AA%E3%82%B7%E3%83%83%E3%83%88%E3%83%95%E3%83%AD%E3%83%BC%EF%BC%9A%E9%9D%9E%E6%8E%A8%E5%A5%A8%E3%81%A7%E5%8D%B1%E9%99%BA"><span class="toc-text">インプリシットフロー：非推奨で危険</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PKCE%EF%BC%9A%E3%83%91%E3%83%96%E3%83%AA%E3%83%83%E3%82%AF%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%81%AE%E4%BF%9D%E8%AD%B7"><span class="toc-text">PKCE：パブリッククライアントの保護</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E8%AA%8D%E8%A8%BC%E6%83%85%E5%A0%B1%E3%83%95%E3%83%AD%E3%83%BC%EF%BC%9A%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E9%96%93%E9%80%9A%E4%BF%A1"><span class="toc-text">クライアント認証情報フロー：サービス間通信</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B-OAuth-%E3%81%AE%E8%AA%A4%E8%A7%A3"><span class="toc-text">よくある OAuth の誤解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%81%AE%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9"><span class="toc-text">トークンセキュリティのベストプラクティス</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%83%AA%E3%83%95%E3%83%AC%E3%83%83%E3%82%B7%E3%83%A5%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%EF%BC%9A%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%AE%E5%BB%B6%E9%95%B7"><span class="toc-text">リフレッシュトークン：アクセスの延長</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B5%90%E8%AB%96"><span class="toc-text">結論</span></a></li></ol>
            <p>OAuth 2.0 は API 認可の事実上の標準となり、ソーシャルメディアログインから企業 API アクセスまで、あらゆる場面で使用されています。しかし、その普及にもかかわらず、OAuth は広く誤解されています。開発者はしばしば認可と認証を混同し、フローを間違って実装したり、セキュリティを損なう方法でアクセストークンを誤用したりします。</p>
<p>この記事では、コア概念、認可フロー、セキュリティ考慮事項を検証することで OAuth 2.0 の謎を解き明かします。異なる許可タイプでのトークンの旅路を追跡し、様々な当事者の役割を理解し、一般的な実装ミスを特定します。図表と実世界のシナリオを通じて、OAuth がシームレスなユーザー体験を提供しながらリソースを保護する方法について実用的な理解を得られるでしょう。</p>
<h2 id="OAuth-2-0-が実際に解決する問題">OAuth 2.0 が実際に解決する問題</h2>
<p>OAuth 以前、第三者サービス上のユーザーデータにアクセスする必要があるアプリケーションは根本的な問題に直面していました：ユーザーにパスワードを共有してもらう必要があったのです。これは複数のセキュリティと使いやすさの問題を引き起こしました。</p>
<h3 id="OAuth-以前の問題">OAuth 以前の問題</h3>
<p>クラウドストレージプラットフォームに保存されたあなたの写真にアクセスする必要がある写真印刷サービスを考えてみましょう：</p>
<div class="admonition error"><p class="admonition-title"><span class="mdi mdi-alert-circle-outline admonition-icon"></span>🚫 パスワード共有問題</p><div class="admonition-content"><p><strong>従来のアプローチ</strong></p>
<ul>
<li>ユーザーが印刷サービスにクラウドストレージのユーザー名とパスワードを提供</li>
<li>印刷サービスが認証情報を保存（セキュリティリスク）</li>
<li>印刷サービスがすべてのユーザーデータへの完全なアクセス権を持つ</li>
<li>アクセス範囲や期間を制限する方法がない</li>
<li>パスワード変更により統合されたすべてのサービスが中断</li>
<li>どのサービスが何にアクセスしたかの監査証跡がない</li>
</ul>
<p><strong>セキュリティへの影響</strong></p>
<ul>
<li>認証情報が第三者に露出</li>
<li>細かい権限制御がない</li>
<li>パスワード変更なしにアクセスを取り消せない</li>
<li>最小権限の原則に違反</li>
<li>攻撃面が大幅に増加</li>
</ul>
</div></div>
<p>OAuth 2.0 は委任認可を導入することでこれを解決します：ユーザーは認証情報を共有することなく、リソースへの限定的なアクセスを許可できます。</p>
<h3 id="OAuth-のコアイノベーション">OAuth のコアイノベーション</h3>
<p>OAuth は認証（あなたが誰であるかを証明）と認可（リソースへのアクセスを許可）を分離します：</p>
<div class="admonition success"><p class="admonition-title"><span class="mdi mdi-check-circle-outline admonition-icon"></span>✅ OAuth 認可モデル</p><div class="admonition-content"><p><strong>委任アクセス</strong></p>
<ul>
<li>ユーザーがリソース所有者（例：クラウドストレージ）で直接認証</li>
<li>ユーザーが第三者アプリケーションに特定の権限を認可</li>
<li>アプリケーションが時間制限付きアクセストークンを受信</li>
<li>トークンは要求された権限のみを付与</li>
<li>ユーザーはパスワード変更なしにいつでもアクセスを取り消し可能</li>
</ul>
<p><strong>主な利点</strong></p>
<ul>
<li>パスワード共有が不要</li>
<li>細かい権限スコープ</li>
<li>時間制限付きアクセストークン</li>
<li>アプリケーションごとの独立した取り消し</li>
<li>アクセス許可の明確な監査証跡</li>
</ul>
</div></div>
<p>このモデルにより、アプリケーションがセキュリティ境界を維持しながらシームレスに統合できる現代の API エコシステムが実現されます。</p>
<h2 id="OAuth-2-0-の役割とコンポーネント">OAuth 2.0 の役割とコンポーネント</h2>
<p>OAuth は認可フローに参加する 4 つの異なる役割を定義します：</p>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>🎭 OAuth の役割</p><div class="admonition-content"><p><strong>リソース所有者</strong></p>
<ul>
<li>データを所有するユーザー</li>
<li>リソースへのアクセスを認可</li>
<li>例：あなた、印刷サービスに写真へのアクセスを許可</li>
</ul>
<p><strong>クライアント</strong></p>
<ul>
<li>リソースへのアクセスを要求するアプリケーション</li>
<li>認可サーバーに登録されている必要がある</li>
<li>例：写真印刷サービスアプリケーション</li>
</ul>
<p><strong>認可サーバー</strong></p>
<ul>
<li>リソース所有者を認証後、アクセストークンを発行</li>
<li>認可許可を検証</li>
<li>例：クラウドストレージプロバイダーの OAuth サーバー</li>
</ul>
<p><strong>リソースサーバー</strong></p>
<ul>
<li>保護されたリソースをホスト</li>
<li>アクセストークンを検証してリクエストを処理</li>
<li>例：写真ファイルを提供するクラウドストレージ API</li>
</ul>
</div></div>
<p>これらの役割は、異なるアプリケーションタイプとセキュリティ要件に最適化された、明確に定義されたフローシリーズを通じて相互作用します。</p>
<h2 id="認可コードフロー：ゴールドスタンダード">認可コードフロー：ゴールドスタンダード</h2>
<p>認可コードフローは最も安全な OAuth フローで、クライアントシークレットを安全に保存できるアプリケーションに推奨されます。</p>
<h3 id="フロー概要">フロー概要</h3>
<div class="mermaid">sequenceDiagram
    participant User as 👤 リソース所有者
    participant Browser as 🌐 ブラウザ
    participant Client as 📱 クライアントアプリケーション
    participant AuthServer as 🔐 認可サーバー
    participant ResourceServer as 💾 リソースサーバー

    User-&gt;&gt;Browser: 1. 「アカウント接続」をクリック
    Browser-&gt;&gt;AuthServer: 2. 認可リクエスト<br>(client_id, redirect_uri, scope)
    AuthServer-&gt;&gt;User: 3. ログインと同意画面を表示
    User-&gt;&gt;AuthServer: 4. 認証して承認
    AuthServer-&gt;&gt;Browser: 5. 認可コード付きでリダイレクト
    Browser-&gt;&gt;Client: 6. 認可コード
    Client-&gt;&gt;AuthServer: 7. コードをトークンに交換<br>(code, client_id, client_secret)
    AuthServer-&gt;&gt;Client: 8. アクセストークン + リフレッシュトークン
    Client-&gt;&gt;ResourceServer: 9. アクセストークン付き API リクエスト
    ResourceServer-&gt;&gt;Client: 10. 保護されたリソースデータ</div>
<h3 id="ステップバイステップの詳細">ステップバイステップの詳細</h3>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>📋 認可コードフローのステップ</p><div class="admonition-content"><p><strong>1. ユーザーが認可を開始</strong></p>
<ul>
<li>ユーザーがクライアントアプリケーションで「[サービス]で接続」をクリック</li>
<li>クライアントがユーザーを認可サーバーにリダイレクト</li>
</ul>
<p><strong>2. 認可リクエスト</strong>
</p><pre class="language-none"><code class="language-none">GET /authorize?<p></p>
</code></pre></div></div><code class="language-none">

  response_type=code&amp;
  client_id=CLIENT_ID&amp;
  redirect_uri=https://client.app/callback&amp;
  scope=read:photos&amp;
  state=RANDOM_STRING</code>
    - `response_type=code`：認可コードを要求
    - `client_id`：クライアントアプリケーションを識別
    - `redirect_uri`：認可コードを送信する場所
    - `scope`：要求される権限
    - `state`：CSRF 保護トークン
<pre><code>**3. ユーザー認証と同意**
- 認可サーバーがユーザーを認証（ログイン画面）
- 要求された権限を含む同意画面を表示
- ユーザーがアクセスを承認または拒否

**4. 認可コード発行**
<pre class="language-none"><code class="language-none">HTTP/1.1 302 Found
Location: https://client.app/callback?
  code=AUTHORIZATION_CODE&amp;
  state=RANDOM_STRING</code></pre>
- 短期間の認可コード（通常 10 分）
- ブラウザリダイレクトで返される
- 一回限りの使用

**5. トークン交換**
<pre class="language-none"><code class="language-none">POST /token
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&amp;
code=AUTHORIZATION_CODE&amp;
redirect_uri=https://client.app/callback&amp;
client_id=CLIENT_ID&amp;
client_secret=CLIENT_SECRET</code></pre>
- クライアントがコードをトークンに交換
- クライアントシークレットを含む（サーバー間通信）
- 認可コードが消費され無効化

**6. アクセストークンレスポンス**
<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"access_token"</span><span class="token operator">:</span> <span class="token string">"eyJhbGciOiJSUzI1NiIs..."</span><span class="token punctuation">,</span>
  <span class="token property">"token_type"</span><span class="token operator">:</span> <span class="token string">"Bearer"</span><span class="token punctuation">,</span>
  <span class="token property">"expires_in"</span><span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span>
  <span class="token property">"refresh_token"</span><span class="token operator">:</span> <span class="token string">"tGzv3JOkF0XG5Qx2TlKWIA"</span><span class="token punctuation">,</span>
  <span class="token property">"scope"</span><span class="token operator">:</span> <span class="token string">"read:photos"</span>
<span class="token punctuation">}</span></code></pre>
- API リクエスト用のアクセストークン
- 新しいアクセストークン取得用のリフレッシュトークン
- 秒単位の有効期限

**7. API アクセス**
<pre class="language-none"><code class="language-none">GET /api/photos
Authorization: Bearer eyJhbGciOiJSUzI1NiIs...</code></pre>
- クライアントがリクエストにアクセストークンを含める
- リソースサーバーがトークンを検証
- 保護されたリソースを返す
</code></pre>
<h3 id="なぜこのフローが安全なのか">なぜこのフローが安全なのか</h3>
<p>認可コードフローは複数のセキュリティ層を提供します：</p>
<div class="admonition success"><p class="admonition-title"><span class="mdi mdi-check-circle-outline admonition-icon"></span>🔒 セキュリティ機能</p><div class="admonition-content"><p><strong>関心の分離</strong></p>
<ul>
<li>認可コードがブラウザに露出（あまり機密ではない）</li>
<li>アクセストークンがブラウザに露出されない</li>
<li>クライアントシークレットはサーバー間通信でのみ使用</li>
</ul>
<p><strong>短期間の認証情報</strong></p>
<ul>
<li>認可コードが迅速に期限切れ（10 分）</li>
<li>認可コードは一回限りの使用</li>
<li>アクセストークンに時間制限（通常 1 時間）</li>
</ul>
<p><strong>CSRF 保護</strong></p>
<ul>
<li>state パラメータがクロスサイトリクエストフォージェリを防止</li>
<li>クライアントが state が元のリクエストと一致することを検証</li>
</ul>
<p><strong>クライアント認証</strong></p>
<ul>
<li>クライアントシークレットがトークン交換時にクライアント身元を証明</li>
<li>認可コード傍受攻撃を防止</li>
</ul>
</div></div>
<p>このフローは、ウェブアプリケーション、バックエンドサーバーを持つモバイルアプリ、クライアントシークレットを保護できるあらゆるシナリオに適しています。</p>
<h2 id="インプリシットフロー：非推奨で危険">インプリシットフロー：非推奨で危険</h2>
<p>インプリシットフローは、クライアントシークレットを安全に保存できないブラウザベースアプリケーション用に設計されました。しかし、セキュリティ脆弱性により非推奨となっています。</p>
<h3 id="インプリシットフローの仕組み">インプリシットフローの仕組み</h3>
<div class="mermaid">sequenceDiagram
    participant User as 👤 リソース所有者
    participant Browser as 🌐 ブラウザ/SPA
    participant AuthServer as 🔐 認可サーバー
    participant ResourceServer as 💾 リソースサーバー

    User-&gt;&gt;Browser: 1. 「ログイン」をクリック
    Browser-&gt;&gt;AuthServer: 2. 認可リクエスト<br>(response_type=token)
    AuthServer-&gt;&gt;User: 3. 認証して同意
    AuthServer-&gt;&gt;Browser: 4. アクセストークン付きでリダイレクト<br>(URL フラグメント内)
    Browser-&gt;&gt;Browser: 5. URL からトークンを抽出
    Browser-&gt;&gt;ResourceServer: 6. トークン付き API リクエスト
    ResourceServer-&gt;&gt;Browser: 7. 保護されたリソース</div>
<h3 id="なぜインプリシットフローが非推奨なのか">なぜインプリシットフローが非推奨なのか</h3>
<div class="admonition error"><p class="admonition-title"><span class="mdi mdi-alert-circle-outline admonition-icon"></span>🚫 インプリシットフローのセキュリティ問題</p><div class="admonition-content"><p><strong>アクセストークンの露出</strong></p>
<ul>
<li>トークンが URL フラグメントで返される</li>
<li>ブラウザ履歴で見える</li>
<li>サーバーアクセスログに記録される</li>
<li>ブラウザ拡張機能に露出</li>
<li>XSS 攻撃に脆弱</li>
</ul>
<p><strong>クライアント認証なし</strong></p>
<ul>
<li>クライアントシークレット検証なし</li>
<li>クライアント身元を検証できない</li>
<li>クライアントの偽装が容易</li>
</ul>
<p><strong>リフレッシュトークンなし</strong></p>
<ul>
<li>リフレッシュトークンを安全に発行できない</li>
<li>トークン期限切れ時にユーザーが再認証必要</li>
<li>ユーザー体験が悪い</li>
</ul>
<p><strong>トークン漏洩経路</strong></p>
<ul>
<li>Referrer ヘッダーがトークンを漏洩する可能性</li>
<li>ブラウザ履歴がトークンを保存</li>
<li>共有コンピューターがトークンを露出</li>
<li>安全な保存メカニズムがない</li>
</ul>
</div></div>
<p>現代のアプリケーションは PKCE 付き認可コードフローを使用すべきです。</p>
<h2 id="PKCE：パブリッククライアントの保護">PKCE：パブリッククライアントの保護</h2>
<p>Proof Key for Code Exchange（PKCE、「ピクシー」と発音）は、シークレットを保存できないパブリッククライアントを保護するために認可コードフローを拡張します。</p>
<h3 id="パブリッククライアントの問題">パブリッククライアントの問題</h3>
<p>モバイルアプリとシングルページアプリケーションは根本的な課題に直面します：</p>
<div class="admonition warning"><p class="admonition-title"><span class="mdi mdi-alert-outline admonition-icon"></span>⚠️ パブリッククライアントの課題</p><div class="admonition-content"><p><strong>シークレットを安全に保存できない</strong></p>
<ul>
<li>モバイルアプリのコードは逆コンパイル可能</li>
<li>JavaScript ソースコードがブラウザで見える</li>
<li>クライアントシークレットの安全な保存がない</li>
<li>シークレットがすべてのユーザーに露出される</li>
</ul>
<p><strong>認可コード傍受</strong></p>
<ul>
<li>悪意のあるアプリが同じリダイレクト URI を登録可能</li>
<li>認可コードが攻撃者に傍受される</li>
<li>攻撃者がコードをトークンに交換</li>
<li>これを防ぐクライアントシークレットがない</li>
</ul>
</div></div>
<p>PKCE は、事前に抽出できない動的な、リクエストごとのシークレットを追加することでこれを解決します。</p>
<h3 id="PKCE-フロー">PKCE フロー</h3>
<div class="mermaid">sequenceDiagram
    participant User as 👤 リソース所有者
    participant Client as 📱 モバイルアプリ/SPA
    participant AuthServer as 🔐 認可サーバー
    participant ResourceServer as 💾 リソースサーバー

    Client-&gt;&gt;Client: 1. code_verifier を生成<br>(ランダム文字列)
    Client-&gt;&gt;Client: 2. code_challenge を作成<br>(検証器の SHA256 ハッシュ)
    User-&gt;&gt;Client: 3. ログインを開始
    Client-&gt;&gt;AuthServer: 4. 認可リクエスト<br>(code_challenge, method)
    AuthServer-&gt;&gt;User: 5. 認証して同意
    AuthServer-&gt;&gt;Client: 6. 認可コード
    Client-&gt;&gt;AuthServer: 7. トークンリクエスト<br>(code, code_verifier)
    AuthServer-&gt;&gt;AuthServer: 8. code_challenge が<br>code_verifier と一致することを検証
    AuthServer-&gt;&gt;Client: 9. アクセストークン
    Client-&gt;&gt;ResourceServer: 10. API リクエスト
    ResourceServer-&gt;&gt;Client: 11. 保護されたリソース</div>
<h3 id="PKCE-実装詳細">PKCE 実装詳細</h3>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>🔐 PKCE パラメータ</p><div class="admonition-content"><p><strong>コード検証器</strong></p>
<ul>
<li>ランダム文字列：43-128 文字</li>
<li>暗号学的にランダム</li>
<li>認可リクエストごとに新しく生成</li>
<li>例：<code>dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk</code></li>
</ul>
<p><strong>コードチャレンジ</strong></p>
<ul>
<li>コード検証器の SHA256 ハッシュ（推奨）</li>
<li>またはプレーンなコード検証器（非推奨）</li>
<li>認可リクエストで送信</li>
<li>例：<code>E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM</code></li>
</ul>
<p><strong>認可リクエスト</strong>
</p><pre class="language-none"><code class="language-none">GET /authorize?<p></p>
</code></pre></div></div><code class="language-none">

  response_type=code&amp;
  client_id=CLIENT_ID&amp;
  redirect_uri=https://app.example.com/callback&amp;
  scope=read:photos&amp;
  code_challenge=E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM&amp;
  code_challenge_method=S256</code>
<pre><code>**トークンリクエスト**
<pre class="language-none"><code class="language-none">POST /token

grant_type=authorization_code&amp;
code=AUTHORIZATION_CODE&amp;
redirect_uri=https://app.example.com/callback&amp;
client_id=CLIENT_ID&amp;
code_verifier=dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk</code></pre>

**サーバー検証**
<pre class="language-none"><code class="language-none">SHA256(code_verifier) == stored_code_challenge</code></pre>
- 認可サーバーが code_challenge を認可コードと一緒に保存
- トークン交換時に code_verifier が一致することを検証
- 認可コード傍受攻撃を防止
</code></pre>
<h3 id="なぜ-PKCE-が機能するのか">なぜ PKCE が機能するのか</h3>
<div class="admonition success"><p class="admonition-title"><span class="mdi mdi-check-circle-outline admonition-icon"></span>✅ PKCE のセキュリティ利点</p><div class="admonition-content"><p><strong>動的シークレット</strong></p>
<ul>
<li>リクエストごとにコード検証器を生成</li>
<li>アプリケーションから事前抽出不可能</li>
<li>攻撃者が検証器を予測または再利用不可能</li>
</ul>
<p><strong>認可コードバインディング</strong></p>
<ul>
<li>コードチャレンジが認可コードをクライアントインスタンスにバインド</li>
<li>傍受された認可コードはコード検証器なしでは無用</li>
<li>フローを開始したクライアントのみがコードを交換可能</li>
</ul>
<p><strong>シークレット保存不要</strong></p>
<ul>
<li>クライアントシークレット不要</li>
<li>モバイルアプリと SPA に安全</li>
<li>シークレット保存なしでセキュリティを維持</li>
</ul>
<p><strong>後方互換性</strong></p>
<ul>
<li>既存の OAuth サーバーと互換（サポートされている場合）</li>
<li>クライアントシークレットと併用可能</li>
<li>現在すべての OAuth クライアントに推奨</li>
</ul>
</div></div>
<p>PKCE は現在、シークレットを保存できる機密クライアントを含むすべての OAuth クライアントに、追加のセキュリティ層として推奨されています。</p>
<h2 id="クライアント認証情報フロー：サービス間通信">クライアント認証情報フロー：サービス間通信</h2>
<p>クライアント認証情報フローは、ユーザーが関与しないマシン間通信用に設計されています。</p>
<h3 id="クライアント認証情報を使用する場合">クライアント認証情報を使用する場合</h3>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>🤖 クライアント認証情報の使用例</p><div class="admonition-content"><p><strong>バックエンドサービス</strong></p>
<ul>
<li>マイクロサービス間の通信</li>
<li>API にアクセスするスケジュールジョブ</li>
<li>サーバー間統合</li>
<li>ユーザーコンテキスト不要</li>
</ul>
<p><strong>特徴</strong></p>
<ul>
<li>クライアントが自身の代理で行動</li>
<li>リソース所有者が関与しない</li>
<li>クライアント認証情報が認可</li>
<li>通常は長期間またはキャッシュされたトークン</li>
</ul>
</div></div>
<h3 id="クライアント認証情報フロー">クライアント認証情報フロー</h3>
<div class="mermaid">sequenceDiagram
    participant Client as 🖥️ クライアントサービス
    participant AuthServer as 🔐 認可サーバー
    participant ResourceServer as 💾 リソースサーバー

    Client-&gt;&gt;AuthServer: 1. トークンリクエスト<br>(client_id, client_secret, scope)
    AuthServer-&gt;&gt;AuthServer: 2. クライアント認証情報を検証
    AuthServer-&gt;&gt;Client: 3. アクセストークン
    Client-&gt;&gt;ResourceServer: 4. トークン付き API リクエスト
    ResourceServer-&gt;&gt;Client: 5. 保護されたリソース</div>
<h3 id="実装">実装</h3>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>📋 クライアント認証情報リクエスト</p><div class="admonition-content"><p><strong>トークンリクエスト</strong>
</p><pre class="language-none"><code class="language-none">POST /token<p></p>
</code></pre></div></div><code class="language-none">

Content-Type: application/x-www-form-urlencoded

grant_type=client_credentials&amp;
client_id=CLIENT_ID&amp;
client_secret=CLIENT_SECRET&amp;
scope=api:read api:write</code>
<pre><code>**トークンレスポンス**
<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"access_token"</span><span class="token operator">:</span> <span class="token string">"eyJhbGciOiJSUzI1NiIs..."</span><span class="token punctuation">,</span>
  <span class="token property">"token_type"</span><span class="token operator">:</span> <span class="token string">"Bearer"</span><span class="token punctuation">,</span>
  <span class="token property">"expires_in"</span><span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span>
  <span class="token property">"scope"</span><span class="token operator">:</span> <span class="token string">"api:read api:write"</span>
<span class="token punctuation">}</span></code></pre>

**API リクエスト**
<pre class="language-none"><code class="language-none">GET /api/resources
Authorization: Bearer eyJhbGciOiJSUzI1NiIs...</code></pre>
</code></pre>
<p>このフローは単純ですが、クライアント認証情報の安全な保存が必要で、サービス間通信にのみ使用すべきです。</p>
<h2 id="よくある-OAuth-の誤解">よくある OAuth の誤解</h2>
<p>OAuth はしばしば誤解され、セキュリティ脆弱性と実装エラーにつながります。</p>
<h3 id="OAuth-は認証ではない">OAuth は認証ではない</h3>
<p>最も一般的な誤解は、OAuth が認証を提供するというものです。そうではありません。</p>
<div class="admonition error"><p class="admonition-title"><span class="mdi mdi-alert-circle-outline admonition-icon"></span>🚫 OAuth ≠ 認証</p><div class="admonition-content"><p><strong>OAuth が提供するもの</strong></p>
<ul>
<li>認可：リソースへのアクセス許可</li>
<li>API への委任アクセス</li>
<li>スコープ権限</li>
</ul>
<p><strong>OAuth が提供しないもの</strong></p>
<ul>
<li>ユーザー身元確認</li>
<li>ユーザー認証</li>
<li>身元情報</li>
</ul>
<p><strong>問題</strong></p>
<ul>
<li>アクセストークンは認可を証明、身元ではない</li>
<li>トークンは異なるユーザーに発行される可能性</li>
<li>ユーザー情報を取得する標準的な方法がない</li>
<li>トークン置換攻撃に脆弱</li>
</ul>
</div></div>
<h3 id="「OAuth-でログイン」アンチパターン">「OAuth でログイン」アンチパターン</h3>
<p>多くのアプリケーションが OAuth のみを使用して「[サービス]でログイン」を実装します：</p>
<div class="admonition warning"><p class="admonition-title"><span class="mdi mdi-alert-outline admonition-icon"></span>⚠️ 安全でない OAuth ログインパターン</p><div class="admonition-content"><p><strong>欠陥のある実装</strong>
</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 安全でない：これをしてはいけません</span><p></p>
</code></pre></div></div><code class="language-javascript">

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/callback'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> code <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">exchangeCodeForToken</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// トークンが正当なユーザーのものと仮定</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUserFromToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>userId <span class="token operator">=</span> user<span class="token punctuation">.</span>id<span class="token punctuation">;</span> <span class="token comment">// 脆弱</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>
<pre><code>**攻撃シナリオ**
- 攻撃者が自分のアカウントの有効なアクセストークンを取得
- 攻撃者が被害者を騙して攻撃者のトークンを使用させる
- 被害者が攻撃者としてログイン
- 被害者の行動が攻撃者のアカウントに帰属
- データ漏洩とアカウント混乱
</code></pre>
<h3 id="認証には-OpenID-Connect-を使用">認証には OpenID Connect を使用</h3>
<p>OpenID Connect (OIDC) は OAuth 2.0 を拡張して認証を提供します：</p>
<div class="admonition success"><p class="admonition-title"><span class="mdi mdi-check-circle-outline admonition-icon"></span>✅ OpenID Connect ソリューション</p><div class="admonition-content"><p><strong>OIDC が追加するもの</strong></p>
<ul>
<li>ID トークン：ユーザー身元クレームを含む JWT</li>
<li>UserInfo エンドポイント：標準化されたユーザー情報</li>
<li>認証検証</li>
<li>標準化されたクレーム（sub、name、email など）</li>
</ul>
<p><strong>安全な実装</strong>
</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 安全：OpenID Connect を使用</span><p></p>
</code></pre></div></div><code class="language-javascript">

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/callback'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> code <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
  <span class="token keyword">const</span> tokens <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">exchangeCodeForTokens</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ID トークンの署名とクレームを検証</span>
  <span class="token keyword">const</span> idToken <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">verifyIdToken</span><span class="token punctuation">(</span>tokens<span class="token punctuation">.</span>id_token<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ID トークンには検証されたユーザー身元が含まれる</span>
  req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>userId <span class="token operator">=</span> idToken<span class="token punctuation">.</span>sub<span class="token punctuation">;</span>
  req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>email <span class="token operator">=</span> idToken<span class="token punctuation">.</span>email<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>
<pre><code>**ID トークン構造**
<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"iss"</span><span class="token operator">:</span> <span class="token string">"https://auth.example.com"</span><span class="token punctuation">,</span>
  <span class="token property">"sub"</span><span class="token operator">:</span> <span class="token string">"user123"</span><span class="token punctuation">,</span>
  <span class="token property">"aud"</span><span class="token operator">:</span> <span class="token string">"client_id"</span><span class="token punctuation">,</span>
  <span class="token property">"exp"</span><span class="token operator">:</span> <span class="token number">1661529600</span><span class="token punctuation">,</span>
  <span class="token property">"iat"</span><span class="token operator">:</span> <span class="token number">1661526000</span><span class="token punctuation">,</span>
  <span class="token property">"email"</span><span class="token operator">:</span> <span class="token string">"user@example.com"</span><span class="token punctuation">,</span>
  <span class="token property">"email_verified"</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span></code></pre>
</code></pre>
<p>API 認可には OAuth 2.0 を使用。ユーザー認証には OpenID Connect を使用。</p>
<h2 id="トークンセキュリティのベストプラクティス">トークンセキュリティのベストプラクティス</h2>
<p>アクセストークンはベアラートークンです—トークンを所有する誰もがそれを使用できます。適切なトークン処理が重要です。</p>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>🔒 トークンセキュリティガイドライン</p><div class="admonition-content"><p><strong>保存</strong></p>
<ul>
<li>localStorage にトークンを保存しない（XSS 攻撃に脆弱）</li>
<li>ウェブアプリケーションには httpOnly クッキーを使用</li>
<li>モバイルでは安全な保存 API を使用（Keychain、KeyStore）</li>
<li>データベースに保存する場合はトークンを暗号化</li>
</ul>
<p><strong>送信</strong></p>
<ul>
<li>常に HTTPS/TLS を使用</li>
<li>Authorization ヘッダーにトークンを含める、URL には含めない</li>
<li>アプリケーションログにトークンを記録しない</li>
<li>クエリパラメータでトークンを送信しない</li>
</ul>
<p><strong>検証</strong></p>
<ul>
<li>トークン署名を検証（JWT の場合）</li>
<li>トークンの有効期限をチェック</li>
<li>トークンのオーディエンスと発行者を検証</li>
<li>トークンスコープが必要な権限と一致することを検証</li>
</ul>
<p><strong>ライフサイクル管理</strong></p>
<ul>
<li>短期間のアクセストークンを使用（通常 1 時間）</li>
<li>リフレッシュトークンローテーションを実装</li>
<li>ログアウト時にトークンを取り消し</li>
<li>トークン再利用試行を監視</li>
</ul>
<p><strong>スコープ原則</strong></p>
<ul>
<li>最小限必要なスコープを要求</li>
<li>リソースサーバーでスコープを検証</li>
<li>過度な権限を付与しない</li>
<li>スコープベースのアクセス制御を実装</li>
</ul>
</div></div>
<h2 id="リフレッシュトークン：アクセスの延長">リフレッシュトークン：アクセスの延長</h2>
<p>リフレッシュトークンは、ユーザーが頻繁に再認証することなく長期間のアクセスを可能にします。</p>
<h3 id="リフレッシュトークンフロー">リフレッシュトークンフロー</h3>
<div class="mermaid">sequenceDiagram
    participant Client as 📱 クライアントアプリケーション
    participant AuthServer as 🔐 認可サーバー
    participant ResourceServer as 💾 リソースサーバー

    Client-&gt;&gt;ResourceServer: 1. アクセストークン付き API リクエスト
    ResourceServer-&gt;&gt;Client: 2. 401 未認証（トークン期限切れ）
    Client-&gt;&gt;AuthServer: 3. リフレッシュトークンリクエスト<br>(refresh_token, client_id)
    AuthServer-&gt;&gt;AuthServer: 4. リフレッシュトークンを検証
    AuthServer-&gt;&gt;Client: 5. 新しいアクセストークン + 新しいリフレッシュトークン
    Client-&gt;&gt;ResourceServer: 6. 新しいトークン付き API リクエスト
    ResourceServer-&gt;&gt;Client: 7. 保護されたリソース</div>
<h3 id="リフレッシュトークンセキュリティ">リフレッシュトークンセキュリティ</h3>
<div class="admonition warning"><p class="admonition-title"><span class="mdi mdi-alert-outline admonition-icon"></span>⚠️ リフレッシュトークンのリスク</p><div class="admonition-content"><p><strong>高価値ターゲット</strong></p>
<ul>
<li>長期間の認証情報（数日から数ヶ月）</li>
<li>新しいアクセストークンを生成可能</li>
<li>攻撃者にとってアクセストークンより価値が高い</li>
<li>より強い保護が必要</li>
</ul>
<p><strong>セキュリティ対策</strong></p>
<ul>
<li>リフレッシュトークンローテーション：使用のたびに新しいリフレッシュトークンを発行</li>
<li>リフレッシュトークン再利用を検出（盗難を示す）</li>
<li>リフレッシュトークンをクライアントにバインド</li>
<li>疑わしい活動時にトークンファミリーを取り消し</li>
<li>リフレッシュトークンを安全に保存（暗号化）</li>
<li>リフレッシュトークンの有効期限を実装</li>
</ul>
<p><strong>リフレッシュトークンローテーション</strong>
</p><pre class="language-none"><code class="language-none">リクエスト：  refresh_token=OLD_TOKEN<p></p>
</code></pre></div></div><code class="language-none">

レスポンス：   access_token=NEW_ACCESS
            refresh_token=NEW_REFRESH

古いリフレッシュトークンは即座に無効化
古いトークンの再利用はセキュリティアラートをトリガー</code>
<p>リフレッシュトークンローテーションは現在ベストプラクティスと考えられており、トークンリプレイ攻撃を防ぎ、トークン盗難による損害を制限します。</p>
<h2 id="結論">結論</h2>
<p>OAuth 2.0 は、アプリケーションがパスワード共有なしでユーザーリソースにアクセスできる堅牢な委任認可フレームワークを提供します。認可と認証を分離することで、OAuth は現代の API エコシステムを可能にしながら明確なセキュリティ境界を作成します。</p>
<p>PKCE 付き認可コードフローは、ほとんどのアプリケーションの現在のベストプラクティスを表し、機密クライアントとパブリッククライアントの両方に強力なセキュリティを提供します。非推奨のインプリシットフローは完全に避けるべきです。クライアント認証情報フローは、ユーザーが関与しないマシン間シナリオに対応します。各フローは特定のセキュリティ要件とアプリケーションアーキテクチャに対処します。</p>
<p>OAuth が認証ではなく認可を提供することを理解することが重要です。ユーザー認証が必要なアプリケーションは、標準化された身元確認で OAuth を拡張する OpenID Connect を使用すべきです。OAuth アクセストークンを身元の証明として扱うことは、深刻なセキュリティ脆弱性を生み出します。</p>
<p>トークンセキュリティには、保存、送信、検証、ライフサイクル管理への注意深い配慮が必要です。アクセストークンは短期間で、HTTPS で送信し、安全に保存すべきです。リフレッシュトークンは、長期間で強力な認証情報として、ローテーションと再利用検出を含むより強い保護が必要です。</p>
<p>OAuth 2.0 は単一のプロトコルではなく、異なるシナリオに複数のフローを提供するフレームワークです。適切なフローを選択し、正しく実装し、セキュリティベストプラクティスに従うことは、安全でユーザーフレンドリーなアプリケーションを構築するために不可欠です。OAuth の複雑さは、それが解決するセキュリティ問題の複雑さを反映しています—認証情報共有なしの委任アクセスは本質的に困難であり、OAuth はこれらの課題に対する実戦でテストされたソリューションを提供します。</p>
<!-- commentbox plugin begins -->
    <div class="commentbox"></div>
    <script src="https://unpkg.com/commentbox.io/dist/commentBox.min.js"></script>
    <script>commentBox('5765834504929280-proj')</script>
    <!-- commentbox plugin ends -->
    
        </div>
        
        <footer class="article-footer">
            
    <a data-url="https://neo01.com/ja/2022/08/Understanding-OAuth-2.0/" data-id="6382dcf9" class="article-share-link"><i class="fa fa-share"></i>シェア</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url').replace("http://","https://"),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
    <!--script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": {
            "@type": "Person",
            "name": "Neo Alienson"
        },
        "headline": "OAuth 2.0 を理解する：現代 API を支える認可フレームワーク",
        "image": "https://neo01.com",
        "keywords": "API Authentication OAuth Security",
        "genre": "Development",
        "datePublished": "2022-08-16",
        "dateCreated": "2022-08-16",
        "dateModified": "2025-10-29",
        "url": "https://neo01.com//ja/2022/08/Understanding-OAuth-2.0/",
        "description": "OAuth 2.0 はパスワード共有なしで安全な委任アクセスを実現します。認可フローの仕組み、よくある落とし穴、OAuth が認証ではない理由を学びましょう。",
        "wordCount": 1373
    }
</script-->

</article>

                        </div>
                    </section>
                    
<aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>フォロー:</p>
        <ul class="social-links">
                <li>
                    <a class="social-tooltip" title="stack-exchange" href="https://stackexchange.com/users/2122053/neo?tab=accounts" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-exchange"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="stack-overflow" href="https://stackoverflow.com/users/1885105/neo" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-overflow"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/neoalienson" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-github"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="linkedin" href="https://linkedin.com/in/neo01" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-linkedin"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="rss" href="/atom.xml" target="_blank" rel="noopener">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
        </ul>
    </div>
    <div class="widgets-container">

        
            
                
                <div class="widget-wrap widget-list">
    <h3 class="widget-title">リンク</h3>
    <div class="widget">
        <ul><li><a href="/ja/ai">AI プレイグラウンド</a></li><li><a href="/ja/tools">ツール</a></li><li><a href="/ja/games">ゲーム</a></li><li><a href="/ja/pages/useful-information">役立つ情報</a></li><li><a href="/ja/pages/Hexo-Blogging-Cheatsheet">Hexo ブログチートシート</a></li></ul>
    </div>
</div>

                
            
                
                
                
            
                
                    <div class="widget-wrap">
        <h3 class="widget-title">最新</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                    <li>
                        <div class="item-thumbnail">
                            <a href="/ja/2025/10/How-I-Use-AI-to-Learn/" class="thumbnail">
        <span style="background-image:url(/assets/learning/thumbnail_80.png)" alt="AIを使った学習法：反復的知識構築による個人的な旅" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/ja/categories/AI/">AI</a></p>
                            <p class="item-title"><a href="/ja/2025/10/How-I-Use-AI-to-Learn/" class="title">AIを使った学習法：反復的知識構築による個人的な旅</a></p>
                            <p class="item-date"><time datetime="2025-10-18T16:00:00.000Z" itemprop="datePublished">2025-10-19</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/ja/2025/10/Tools-Games-And-Browser-Built-In-AI/" class="thumbnail">
        <span style="background-image:url(/2025/10/Tools-Games-And-Browser-Built-In-AI/thumbnail.jpeg)" alt="ツール、ゲーム、そしてブラウザ内蔵AIプレイグラウンド" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/ja/categories/AI/">AI</a></p>
                            <p class="item-title"><a href="/ja/2025/10/Tools-Games-And-Browser-Built-In-AI/" class="title">ツール、ゲーム、そしてブラウザ内蔵AIプレイグラウンド</a></p>
                            <p class="item-date"><time datetime="2025-10-01T16:00:00.000Z" itemprop="datePublished">2025-10-02</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/ja/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/" class="thumbnail">
        <span style="background-image:url(/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/thumbnail.jpeg)" alt="エージェントコーディングの台頭：AI駆動のソフトウェアエンジニアリング" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/ja/categories/AI/">AI</a></p>
                            <p class="item-title"><a href="/ja/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/" class="title">エージェントコーディングの台頭：AI駆動のソフトウェアエンジニアリング</a></p>
                            <p class="item-date"><time datetime="2025-09-19T16:00:00.000Z" itemprop="datePublished">2025-09-20</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/ja/2025/08/Understanding_Ephemeral_Ports_Part2/" class="thumbnail">
        <span style="background-image:url(/assets/ports/thumbnail.png)" alt="エフェメラルポートを理解する パート2：サーバーアプリケーションが動的ポートを避けるべき理由" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/ja/categories/Development/">開発</a></p>
                            <p class="item-title"><a href="/ja/2025/08/Understanding_Ephemeral_Ports_Part2/" class="title">エフェメラルポートを理解する パート2：サーバーアプリケーションが動的ポートを避けるべき理由</a></p>
                            <p class="item-date"><time datetime="2025-08-30T16:00:00.000Z" itemprop="datePublished">2025-08-31</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/ja/2025/08/Understanding_Ephemeral_Ports_Part1/" class="thumbnail">
        <span style="background-image:url(/assets/ports/thumbnail.png)" alt="エフェメラルポートを理解する：ネットワーク通信の見えない働き手" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/ja/categories/Development/">開発</a></p>
                            <p class="item-title"><a href="/ja/2025/08/Understanding_Ephemeral_Ports_Part1/" class="title">エフェメラルポートを理解する：ネットワーク通信の見えない働き手</a></p>
                            <p class="item-date"><time datetime="2025-08-29T16:00:00.000Z" itemprop="datePublished">2025-08-30</time></p>
                        </div>
                    </li>
            </ul>
        </div>
    </div>

                
            
                
                
    
    
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">アーカイブ</h3>
        <div class="widget">
            <ul class="archive-list">
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2025/">2025</a>
                    <span class="archive-list-count">72</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2024/">2024</a>
                    <span class="archive-list-count">25</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2023/">2023</a>
                    <span class="archive-list-count">15</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2022/">2022</a>
                    <span class="archive-list-count">18</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2021/">2021</a>
                    <span class="archive-list-count">14</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2020/">2020</a>
                    <span class="archive-list-count">13</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2019/">2019</a>
                    <span class="archive-list-count">12</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2018/">2018</a>
                    <span class="archive-list-count">2</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2017/">2017</a>
                    <span class="archive-list-count">5</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2016/">2016</a>
                    <span class="archive-list-count">4</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2015/">2015</a>
                    <span class="archive-list-count">6</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2014/">2014</a>
                    <span class="archive-list-count">7</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2013/">2013</a>
                    <span class="archive-list-count">2</span>
                </li>
            
            </ul>
        </div>
    </div>


                
            
        

    </div>
</aside>


                </div>
            </div>
        </div>
        
<footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>

            <div class="qrcode-share-wrapper">
                <div class="qrcode-text">https://neo01.com/l#7d956e6f</div>
                <img src="/qr/qr-6807895fd9fdaca9d899337bf4ad73fb.svg" width="200" height="200" alt="QR Code for https://neo01.com/l#7d956e6f">
            </div>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" title="Homepage" class="logo"></a>
                </h1>
                
                <p>© 2025 Neo Alienson. 全著作権所有.
                  <a href="/ja/terms-and-conditions">利用規約</a></p>
                
            </div>
            <div class="footer-plugins">
              


            </div>
        </div>
    </div>
</footer>

        
        
    
        


        


        


        


        


        


        


        


        


    



<!-- Custom Scripts -->




        
    </div>
<!-- hexo injector body_end start --><script type="text/javascript" src="/js/bundle_last.js"></script><!-- hexo injector body_end end -->

<script>CookieConsent.run({"palette":{"popup":{"background":"#000"},"button":{"background":"#f1d600"}},"guiOptions":{"consentModal":{"layout":"box","position":"bottom right","equalWeightButtons":true,"flipButtons":false},"preferencesModal":{"layout":"box","position":"right","equalWeightButtons":false,"flipButtons":false}},"categories":{"necessary":{"readOnly":true},"functionality":{},"analytics":{}},"language":{"default":"en","autoDetect":"browser","translations":{"en":{"consentModal":{"title":"Hello traveler, it's cookie time!","description":"🍪 This site uses cookies to serve you the best experience—no crumbs left behind! Want to know what cookies really are? Check out this easy-to-understand cookie explanation. And for the legal nitty-gritty, here’s our website cookie policy to keep you in the loop! 🚀\n","acceptAllBtn":"Accept all","acceptNecessaryBtn":"Reject all","showPreferencesBtn":"Manage preferences","footer":"<a href=\"#link\">Privacy Policy</a>\n<a href=\"/terms-and-conditions/\">Terms and conditions</a>\n"},"preferencesModal":{"title":"Consent Preferences Center","acceptAllBtn":"Accept all","acceptNecessaryBtn":"Reject all","savePreferencesBtn":"Save preferences","closeIconLabel":"Close modal","serviceCounterLabel":"Service|Services","sections":[{"title":"Cookie Usage","description":"We use cookies to make your visit smoother, faster, and tailored just for you. Cookies help us remember your preferences, improve site performance, and deliver personalized content while keeping things secure and user-friendly.\n"},{"title":"Strictly Necessary Cookies <span class=\"pm__badge\">Always Enabled</span>","description":"These cookies are essential for the website to function properly. They enable core features like security, page navigation, and access to secure areas. Without these, the site cannot operate correctly.\n","linkedCategory":"necessary"},{"title":"Functionality Cookies","description":"Functionality cookies remember your choices to provide a more personalized experience. For example, they save your language preference or login details so you don’t have to keep entering them each time.\n","linkedCategory":"functionality"},{"title":"Analytics Cookies","description":"Analytics cookies help us understand how visitors interact with our site by collecting information anonymously. This insight allows us to improve functionality, fix issues, and make the website better for you.\n","linkedCategory":"analytics"},{"title":"More information","description":"Please refer to our <a href='/pages/cookie-policy'>cookie policy</a> for full details on how we use cookies and your options to manage them.\n"}]}}}}})</script></body></html>