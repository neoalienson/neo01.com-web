<!DOCTYPE html><html lang="ja"><head><!-- hexo injector head_begin start --><!-- Google tag (gtag.js) begins-->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3DZR3TQYCY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-3DZR3TQYCY');
    </script>
    <!-- Google tag (gtag.js) ends-->
    <!-- hexo injector head_begin end -->
    <meta charset="utf-8">
    <!-- security headers starts -->
    <!-- meta http-equiv="content-security-policy" content="script-src 'sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=' 'sha256-lJjk3/dvd+wXqRFjV7T5L/nXJXr5NjUjmsKSPEe+ass=';" -->
    <!-- security headers ends -->
    <!-- favicon starts -->    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <!-- favicon ends -->
    

    <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="alternate" href="/atom.xml" title="Decoding Digital Anomalies" type="application/atom+xml">
    

    

    

    

    

    

    

    
    
        


    
    
        


    



    
    <title>ホームでのシングルサインオンの設定 | Decoding Digital Anomalies</title>
    
    <meta name="keywords" content="Authentication,Cybersecurity,Homelab">
    
    
    <meta name="description" content="ホームラボサービスの数十のパスワード管理に疲れていませんか？シングルサインオンを設定して、1回のログインですべてのサービスにアクセスする方法を学びましょう。">
<meta property="og:type" content="article">
<meta property="og:title" content="ホームでのシングルサインオンの設定">
<meta property="og:url" content="https://neo01.com/ja/2025/01/Single-Sign-On-at-Home/index.html">
<meta property="og:site_name" content="Decoding Digital Anomalies">
<meta property="og:description" content="ホームラボサービスの数十のパスワード管理に疲れていませんか？シングルサインオンを設定して、1回のログインですべてのサービスにアクセスする方法を学びましょう。">
<meta property="og:locale" content="ja_JP">
<meta property="article:published_time" content="2025-01-14T16:00:00.000Z">
<meta property="article:modified_time" content="2025-10-23T14:57:12.778Z">
<meta property="article:author" content="Neo Alienson">
<meta property="article:tag" content="Authentication">
<meta property="article:tag" content="Cybersecurity">
<meta property="article:tag" content="Homelab">
<meta name="twitter:card" content="summary">
    
    <!-- hexo injector head_end start --><link rel="stylesheet" type="text/css" href="/css/bundle.css"><script type="text/javascript" src="/js/bundle_first.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 8.1.0">  <link rel="canonical" href="https://neo01.com/ja/2025/01/Single-Sign-On-at-Home/">
  <link rel="alternate" hreflang="en" data-canonical="true" href="https://neo01.com/2025/01/Single-Sign-On-at-Home/">
  <link rel="alternate" hreflang="zh-TW" href="https://neo01.com/zh-TW/2025/01/Single-Sign-On-at-Home/">
  <link rel="alternate" hreflang="zh-CN" href="https://neo01.com/zh-CN/2025/01/Single-Sign-On-at-Home/">
  <link rel="alternate" hreflang="ja" href="https://neo01.com/ja/2025/01/Single-Sign-On-at-Home/">
<style id="admonition-styles">.admonition {
  margin: 1em 0;
  padding: 0rem;
  border-left: 0.3rem solid;
  border-radius: 0.4rem;
  background-color: #f9f9f9;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
  overflow: hidden;
  page-break-inside: avoid;
}

.admonition-title {
  display: flex;
  align-items: center;
  font-weight: 600;
  padding: 0rem 1rem 0.1rem 0.75rem;
  font-size: 1.05em;
  background-color: rgba(0, 0, 0, 0.03);
  border-top-left-radius: 0.4rem;
  border-top-right-radius: 0.4rem;
  margin: 0 !important;
}

.admonition-icon {
  font-size: 1.2em;
  margin-right: 0.6rem;
  opacity: 0.85;
  margin-top: 0.1rem;
}

/* 内容区域 margin */
.admonition > *:not(.admonition-title) {
  margin: 0.6rem 1rem 0.6rem 1rem;
}

/* NOTE 类型 */
.admonition.anote {
  border-color: #448aff;
}
.admonition.anote > .admonition-title {
  background-color: #448aff1a;
  color: #2962ff;
}

/* INFO / TODO 类型 */
.admonition.info,
.admonition.todo {
  border-color: #00b8d4;
}
.admonition.info > .admonition-title,
.admonition.todo > .admonition-title {
  background-color: rgba(0, 184, 212, 0.1);
  color: #007c91;
}

/* 警告类 */
.admonition.warning,
.admonition.attention,
.admonition.caution {
  border-color: #ff9100;
}
.admonition.warning > .admonition-title,
.admonition.attention > .admonition-title,
.admonition.caution > .admonition-title {
  background-color: rgba(255, 145, 0, 0.1);
  color: #c66900;
}

/* 错误类 */
.admonition.failure,
.admonition.missing,
.admonition.fail,
.admonition.error,
.admonition.danger,
.admonition.bug {
  border-color: #ff5252;
}
.admonition.failure > .admonition-title,
.admonition.missing > .admonition-title,
.admonition.fail > .admonition-title,
.admonition.error > .admonition-title,
.admonition.danger > .admonition-title,
.admonition.bug > .admonition-title {
  background-color: rgba(255, 82, 82, 0.1);
  color: #b71c1c;
}

/* TIP 类型 */
.admonition.tip {
  border-color: #00bfa5;
}
.admonition.tip > .admonition-title {
  background-color: #00bfa51a;
  color: #00796b;
}

/* SUCCESS 类型 */
.admonition.success {
  border-color: #00c853;
}
.admonition.success > .admonition-title {
  background-color: #00c8531a;
  color: #2e7d32;
}

/* QUESTION 类型 */
.admonition.question {
  border-color: #64dd17;
}
.admonition.question > .admonition-title {
  background-color: #64dd171a;
  color: #558b2f;
}

/* EXAMPLE 类型 */
.admonition.example {
  border-color: #7c4dff;
}
.admonition.example > .admonition-title {
  background-color: #7c4dff1a;
  color: #512da8;
}

/* QUOTE 类型 */
.admonition.quote {
  border-color: #9e9e9e;
}
.admonition.quote > .admonition-title {
  background-color: #9e9e9e1a;
  color: #424242;
}

/*黑暗模式*/
/* 夜间模式基础样式 */
[data-theme="dark"] .admonition {
  background-color: #1e1e1e;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
}

[data-theme="dark"] .admonition-title {
  background-color: rgba(255, 255, 255, 0.05);
}

/* anote */
[data-theme="dark"] .admonition.anote {
  border-color: #82b1ff;
}
[data-theme="dark"] .admonition.anote > .admonition-title {
  background-color: #82b1ff1a;
  color: #bbdefb;
}

/* tip */
[data-theme="dark"] .admonition.tip {
  border-color: #64ffda;
}
[data-theme="dark"] .admonition.tip > .admonition-title {
  background-color: #64ffda1a;
  color: #1de9b6;
}

/* success */
[data-theme="dark"] .admonition.success {
  border-color: #69f0ae;
}
[data-theme="dark"] .admonition.success > .admonition-title {
  background-color: #69f0ae1a;
  color: #00e676;
}

/* question */
[data-theme="dark"] .admonition.question {
  border-color: #b2ff59;
}
[data-theme="dark"] .admonition.question > .admonition-title {
  background-color: #b2ff591a;
  color: #aeea00;
}

/* example */
[data-theme="dark"] .admonition.example {
  border-color: #b388ff;
}
[data-theme="dark"] .admonition.example > .admonition-title {
  background-color: #b388ff1a;
  color: #b39ddb;
}

/* quote */
[data-theme="dark"] .admonition.quote {
  border-color: #bdbdbd;
}
[data-theme="dark"] .admonition.quote > .admonition-title {
  background-color: #bdbdbd1a;
  color: #eeeeee;
}

/* warning / attention / caution */
[data-theme="dark"] .admonition.warning,
[data-theme="dark"] .admonition.attention,
[data-theme="dark"] .admonition.caution {
  border-color: #ffb300;
}
[data-theme="dark"] .admonition.warning > .admonition-title,
[data-theme="dark"] .admonition.attention > .admonition-title,
[data-theme="dark"] .admonition.caution > .admonition-title {
  background-color: #ffb3001a;
  color: #ffe082;
}

/* error / fail / failure / bug / danger / missing */
[data-theme="dark"] .admonition.error,
[data-theme="dark"] .admonition.fail,
[data-theme="dark"] .admonition.failure,
[data-theme="dark"] .admonition.bug,
[data-theme="dark"] .admonition.missing,
[data-theme="dark"] .admonition.danger {
  border-color: #ef5350;
}
[data-theme="dark"] .admonition.error > .admonition-title,
[data-theme="dark"] .admonition.fail > .admonition-title,
[data-theme="dark"] .admonition.failure > .admonition-title,
[data-theme="dark"] .admonition.bug > .admonition-title,
[data-theme="dark"] .admonition.missing > .admonition-title,
[data-theme="dark"] .admonition.danger > .admonition-title {
  background-color: #ef53501a;
  color: #ff8a80;
}</style><script id="mermaid-scripts" src="/cache/mermaid.min.local.js"></script>
<script>mermaid.initialize({theme: 'default'});</script></head>

<body>
    <div id="wrap">
        
        
<header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <div class="logo"></div>
                    </h1>

                        <h2 class="subtitle-wrap">
                            <p class="title">デジタル異常の解読</p>
                          <p class="subtitle">デジタルの迷宮では、時に機能がバグであり、その逆もまた然り</p>
                        </h2>




                    <div id="lang-selector">
                        <span class="lang-icon">🌐</span>
                        
                            <a href="#" class="lang-link" data-lang="en">English</a>
<span class="lang-sep">|</span>                            <a href="#" class="lang-link" data-lang="zh-TW">繁體中文</a>
<span class="lang-sep">|</span>                            <a href="#" class="lang-link" data-lang="zh-CN">简体中文</a>
                        <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            var currentLang = 'ja';
                            var currentPath = window.location.pathname;
                            var basePath;
                            
                            if (currentLang === 'en') {
                                basePath = currentPath;
                            } else {
                                basePath = currentPath.replace(new RegExp('^/' + currentLang + '/'), '/');
                            }
                            
                            document.querySelectorAll('.lang-link').forEach(function(link) {
                                var targetLang = link.getAttribute('data-lang');
                                var targetPath;
                                if (targetLang === 'en') {
                                    targetPath = basePath;
                                } else {
                                    targetPath = '/' + targetLang + basePath;
                                }
                                link.href = targetPath;
                            });
                        });
                        </script>
                    </div>


                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/ja/">ホーム</a>
                                </li>
                                                                    <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/ja/categories/AI/">AI</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/ja/categories/AI/Art-Gallery/">アートギャラリー</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/ja/categories/Architecture/">アーキテクチャ</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/ja/categories/Cybersecurity/">サイバーセキュリティ</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/ja/categories/Development/">開発</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/ja/categories/Misc/">その他</a></li></ul>
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/ja/about-me">このブログについて</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" id="search-form-input" placeholder="検索">
        <button type="submit" title="検索" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" id="ins-search-input" placeholder="入力してください">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script integrity="sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=">
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '記事',
            PAGES: 'ページ',
            CATEGORIES: 'カテゴリー',
            TAGS: 'タグ',
            UNTITLED: '（名称未設定）',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
        LANG: 'ja',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>




</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

        
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Cybersecurity/">Cybersecurity</a>
    </h1>
</div>

                        <div class="main-body-content">
                            <article id="post-2025/01/Single-Sign-On-at-Home-ja" class="article article-single article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner responsive-content">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        ホームでのシングルサインオンの設定
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
      <i class="fa fa-calendar"></i>
        
          Created <time datetime="2025-01-14T16:00:00.000Z" itemprop="datePublished">2025-01-15</time>
          &nbsp;<i class="fa fa-calendar"></i>
          Updated <time datetime="2025-10-23T14:57:12.778Z" itemprop="datePublished">2025-10-23</time>
        
    </div>


                

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/ja/tags/Authentication/">Authentication</a> <a class="tag-link" href="/ja/tags/Cybersecurity/">Cybersecurity</a> <a class="tag-link" href="/ja/tags/Homelab/">Homelab</a>
    </div>

            </div>
        
        
        
        <div class="article-entry" itemprop="articleBody">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%81%AA%E3%81%9C%E3%83%9B%E3%83%BC%E3%83%A0%E3%81%A7-SSO-%E3%82%92%E4%BD%BF%E3%81%86%E3%81%AE%E3%81%8B%EF%BC%9F"><span class="toc-text">なぜホームで SSO を使うのか？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSO-%E3%81%AE%E5%9F%BA%E7%A4%8E%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B"><span class="toc-text">SSO の基礎を理解する</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%82%BB%E3%83%AB%E3%83%95%E3%83%9B%E3%82%B9%E3%83%88-vs-%E5%A4%96%E9%83%A8%E3%82%A2%E3%82%A4%E3%83%87%E3%83%B3%E3%83%86%E3%82%A3%E3%83%86%E3%82%A3%E3%83%97%E3%83%AD%E3%83%90%E3%82%A4%E3%83%80%E3%83%BC"><span class="toc-text">セルフホスト vs 外部アイデンティティプロバイダー</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSO-%E3%82%BD%E3%83%AA%E3%83%A5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E9%81%B8%E6%8A%9E"><span class="toc-text">SSO ソリューションの選択</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Authelia-%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><span class="toc-text">Authelia のセットアップ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E8%A6%81%E7%B4%A0%E8%AA%8D%E8%A8%BC%E3%81%AE%E8%BF%BD%E5%8A%A0"><span class="toc-text">多要素認証の追加</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSO-%E6%9C%89%E5%8A%B9%E5%8C%96%E5%BE%8C%E3%82%82%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%82%92%E4%BF%9D%E6%8C%81%E3%81%99%E3%81%B9%E3%81%8D%E3%81%8B%EF%BC%9F"><span class="toc-text">SSO 有効化後もローカルアカウントを保持すべきか？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B5%90%E8%AB%96"><span class="toc-text">結論</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Authentik-%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><span class="toc-text">Authentik のセットアップ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E7%B5%B1%E5%90%88"><span class="toc-text">アプリケーションの統合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E7%AE%A1%E7%90%86"><span class="toc-text">ユーザー管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E5%BA%A6%EF%BC%9ALDAP-%E7%B5%B1%E5%90%88"><span class="toc-text">高度：LDAP 統合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%81%AE%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9"><span class="toc-text">セキュリティのベストプラクティス</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0"><span class="toc-text">トラブルシューティング</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%A3%E8%A6%96%E3%81%A8%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9"><span class="toc-text">監視とメンテナンス</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AF%94%E8%BC%83%EF%BC%9ASSO-%E3%82%BD%E3%83%AA%E3%83%A5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3"><span class="toc-text">比較：SSO ソリューション</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9"><span class="toc-text">リソース</span></a></li></ol>
            <p>あなたは印象的なホームラボを構築しました——Nextcloud、Jellyfin、Home Assistant、Portainer、Grafana、そして他の十数個のサービス。それぞれが素晴らしいです。しかし、それぞれに独自のログインページがあります。そして独自のパスワード。そして独自のセッションタイムアウト。</p>
<p>聞き覚えがありますか？パスワード疲労の世界へようこそ。</p>
<p>一度ログインするだけですべてにアクセスできたらどうでしょうか？それがシングルサインオン（SSO）であり、もはや企業専用ではありません。</p>
<h2 id="なぜホームで-SSO-を使うのか？">なぜホームで SSO を使うのか？</h2>
<p><strong>問題：</strong></p>
<ul>
<li>15+ のサービス = 15+ の覚えるべきパスワード（または再利用 😱）</li>
<li>各サービスに個別にログインすると時間の無駄</li>
<li>集中型ユーザー管理がない</li>
<li>必要なときにアクセスを取り消すのが困難</li>
<li>パスワードリセットは悪夢</li>
</ul>
<p><strong>解決策：</strong></p>
<p>SSO が提供するもの：</p>
<ul>
<li><strong>1回のログイン</strong>ですべてのサービスにアクセス</li>
<li><strong>集中型認証</strong> - 1か所でユーザーを管理</li>
<li><strong>より良いセキュリティ</strong> - MFA を一度強制すれば、どこでも適用される</li>
<li><strong>簡単なオンボーディング</strong> - 家族/友人を一度にすべてのサービスに追加</li>
<li><strong>迅速な取り消し</strong> - 1つのアカウントを無効にすれば、どこでもロックアウト</li>
</ul>
<h2 id="SSO-の基礎を理解する">SSO の基礎を理解する</h2>
<h3 id="シングルサインオンとは？">シングルサインオンとは？</h3>
<p>SSO は、ユーザーが一度ログインして、再認証なしで複数のアプリケーションにアクセスできる認証スキームです。</p>
<p><strong>簡単な例：</strong></p>
<ul>
<li>SSO なし：Nextcloud にログイン → Grafana にログイン → Jellyfin にログイン（3回のログイン）</li>
<li>SSO あり：一度ログイン → 3つのサービスすべてにアクセス（1回のログイン）</li>
</ul>
<h3 id="主要コンポーネントの説明">主要コンポーネントの説明</h3>
<p>SSO を複数の VIP ルームがあるナイトクラブのように考えてください。各コンポーネントを分解してみましょう：</p>
<h4 id="1-アイデンティティプロバイダー（IdP）-用心棒">1. アイデンティティプロバイダー（IdP）- 用心棒</h4>
<p>**役割：**あなたが誰であるかを検証する中央認証機関。</p>
<p>**現実世界のアナロジー：**ナイトクラブの入口で ID をチェックし、リストバンドを渡す用心棒のようなもの。</p>
<p><strong>あなたのホームラボでは：</strong></p>
<ul>
<li><strong>Authelia、Authentik、または Keycloak</strong> が用心棒として機能</li>
<li>任意のサービスにアクセスしようとすると、まずここにリダイレクトされます</li>
<li>ユーザー名/パスワードと MFA をチェック</li>
<li>検証されると、「トークン」（リストバンドのようなもの）が与えられます</li>
</ul>
<p><strong>フロー例：</strong></p>
<pre class="language-none"><code class="language-none">あなた → Nextcloud にアクセスしようとする
Nextcloud → 「あなたを知りません、用心棒に聞いてください」
あなた → Authelia ログインページにリダイレクト
Authelia → 「認証情報を見せてください」
あなた → パスワード + MFA コードを入力
Authelia → 「検証済み！これがあなたのトークンです」</code></pre>
<h4 id="2-サービスプロバイダー（SP）-VIP-ルーム">2. サービスプロバイダー（SP）- VIP ルーム</h4>
<p>**役割：**IdP を信頼してユーザーを認証する実際のアプリケーション。</p>
<p>**現実世界のアナロジー：**ナイトクラブの VIP ルームのようなもの。ID はチェックせず、用心棒からのリストバンドだけを見ます。</p>
<p><strong>あなたのホームラボでは：</strong></p>
<ul>
<li>**あなたのアプリ：**Nextcloud、Grafana、Jellyfin、Home Assistant</li>
<li>パスワードを自分で処理しない</li>
<li>IdP の決定を信頼</li>
<li>「Authelia からの有効なトークンを持っていますか？」とだけチェック</li>
</ul>
<p><strong>例：</strong></p>
<pre class="language-none"><code class="language-none">あなた → Grafana にアクセス（Authelia からのトークン付き）
Grafana → 「Authelia からの有効なトークンを持っていますね」
Grafana → 「Authelia によると、あなたは 'admins' グループの 'alice' です」
Grafana → 「ようこそ！」</code></pre>
<h4 id="3-ユーザーディレクトリ-ゲストリスト">3. ユーザーディレクトリ - ゲストリスト</h4>
<p>**役割：**ユーザー情報（ユーザー名、パスワード、グループ）を保存。</p>
<p>**現実世界のアナロジー：**用心棒がチェックするゲストリスト。</p>
<p><strong>あなたのホームラボでは：</strong></p>
<ul>
<li>**シンプル：**ユーザー名とハッシュ化されたパスワードを含む YAML ファイル</li>
<li>**高度：**LDAP サーバー（ユーザーのデータベースのようなもの）</li>
<li>含まれるもの：ユーザー名、パスワード、メール、グループメンバーシップ</li>
</ul>
<p><strong>構造例：</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">users</span><span class="token punctuation">:</span>
  <span class="token key atrule">alice</span><span class="token punctuation">:</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> (hashed)
    <span class="token key atrule">email</span><span class="token punctuation">:</span> alice@home.local
    <span class="token key atrule">groups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>admins<span class="token punctuation">,</span> users<span class="token punctuation">]</span>
  <span class="token key atrule">bob</span><span class="token punctuation">:</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> (hashed)
    <span class="token key atrule">email</span><span class="token punctuation">:</span> bob@home.local
    <span class="token key atrule">groups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>users<span class="token punctuation">]</span></code></pre>
<h4 id="4-認証-vs-認可">4. 認証 vs 認可</h4>
<p>**認証：**あなたが誰であるかを証明する（「あなたは Alice ですか？」）<br>
**認可：**あなたが何ができるかを決定する（「Alice は管理パネルにアクセスできますか？」）</p>
<p><strong>現実世界のアナロジー：</strong></p>
<ul>
<li><strong>認証</strong> = 21歳以上であることを証明するために ID を提示する</li>
<li><strong>認可</strong> = 用心棒が VIP セクションに入れるかどうかを決定する</li>
</ul>
<p><strong>SSO では：</strong></p>
<ul>
<li><strong>IdP が認証を処理：</strong>「はい、これは正しいパスワードを持つ Alice です」</li>
<li><strong>アプリが認可を処理：</strong>「Alice は ‘admins’ グループにいるので、管理者アクセスを許可します」</li>
</ul>
<h4 id="5-認証プロトコル-言語">5. 認証プロトコル - 言語</h4>
<p>**役割：**IdP とアプリが通信するための標準化された方法。</p>
<p>**現実世界のアナロジー：**用心棒と VIP ルームが通信するために使用する異なる言語のようなもの。</p>
<p><strong>OIDC（OpenID Connect）- モダンで推奨：</strong></p>
<ul>
<li><strong>認証：</strong>「あなたは誰ですか？」</li>
<li><strong>認可：</strong>「どのグループに所属していますか？」</li>
<li>JSON を使用（読みやすい）</li>
<li>OAuth2 上に構築</li>
<li>ほとんどのモダンなアプリがサポート</li>
<li><strong>可能な限りこれを使用</strong></li>
</ul>
<p><strong>OIDC トークンの例：</strong></p>
<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"sub"</span><span class="token operator">:</span> <span class="token string">"alice"</span><span class="token punctuation">,</span>
  <span class="token property">"email"</span><span class="token operator">:</span> <span class="token string">"alice@homelab.local"</span><span class="token punctuation">,</span>
  <span class="token property">"groups"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"admins"</span><span class="token punctuation">,</span> <span class="token string">"users"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"exp"</span><span class="token operator">:</span> <span class="token number">1705334400</span>
<span class="token punctuation">}</span></code></pre>
<p><strong>SAML - エンタープライズ標準：</strong></p>
<ul>
<li>正式な法律用語を話すようなもの</li>
<li>XML を使用（冗長）</li>
<li>古いエンタープライズアプリが使用</li>
<li>より複雑だが広くサポートされている</li>
<li>企業環境で一般的</li>
</ul>
<p><strong>Windows 統合認証（WIA）- Windows のみ：</strong></p>
<ul>
<li>Kerberos/NTLM を使用</li>
<li>Windows ドメインユーザーの自動ログイン</li>
<li>ドメイン上であればパスワードプロンプトなし</li>
<li>**以下でのみ動作：**Active Directory + Windows クライアント</li>
<li><strong>フェデレーションではない</strong> - 外部 SaaS アプリと統合できない</li>
<li><strong>ホームラボには不適切</strong>、Windows Server ドメインを実行している場合を除く</li>
</ul>
<h4 id="6-フェデレーション-vs-非フェデレーション認証">6. フェデレーション vs 非フェデレーション認証</h4>
<p><strong>フェデレーションとは？</strong></p>
<p>フェデレーションは、異なる組織/システムが互いの認証を信頼できるようにします。</p>
<p><strong>現実世界のアナロジー：</strong></p>
<ul>
<li>**非フェデレーション：**ジムの会員資格は自分のジムでのみ有効</li>
<li>**フェデレーション：**パスポートは複数の国で有効（互いに信頼している）</li>
</ul>
<p><strong>非フェデレーション認証（WIA、基本認証）：</strong></p>
<pre class="language-none"><code class="language-none">あなたのホームラボ IdP → ホームラボサービスでのみ動作
❌ 外部 SaaS（GitHub、AWS など）に認証できない</code></pre>
<p><strong>フェデレーション認証（OIDC、SAML）：</strong></p>
<pre class="language-none"><code class="language-none">あなたのホームラボ IdP ↔ 外部 SaaS（サポートしている場合）
✅ あなたの IdP を信頼するサービスに認証できる</code></pre>
<p><strong>シナリオ例：</strong></p>
<p><strong>非フェデレーション（WIA）：</strong></p>
<pre class="language-none"><code class="language-none">あなた → Windows ドメインコントローラー → ホームラボアプリ ✅
あなた → Windows ドメインコントローラー → GitHub ❌（GitHub はあなたの DC を信頼しない）</code></pre>
<p><strong>フェデレーション（OIDC/SAML）：</strong></p>
<pre class="language-none"><code class="language-none">あなた → Authentik → ホームラボアプリ ✅
あなた → Authentik → GitHub Enterprise ✅（設定されている場合）
あなた → Authentik → AWS ✅（設定されている場合）</code></pre>
<p><strong>ホームラボの落とし穴：</strong></p>
<p>ほとんどの SaaS プロバイダーは<strong>エンタープライズサブスクリプション</strong>でのみフェデレーションをサポート：</p>
<table>
<thead>
<tr>
<th>サービス</th>
<th>無料/個人</th>
<th>エンタープライズ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>GitHub</strong></td>
<td>SSO なし</td>
<td>SAML による SSO</td>
</tr>
<tr>
<td><strong>AWS</strong></td>
<td>SSO なし</td>
<td>SAML による SSO</td>
</tr>
<tr>
<td><strong>Google Workspace</strong></td>
<td>SSO なし</td>
<td>SAML による SSO</td>
</tr>
<tr>
<td><strong>Microsoft 365</strong></td>
<td>SSO なし</td>
<td>SAML による SSO</td>
</tr>
<tr>
<td><strong>Slack</strong></td>
<td>SSO なし</td>
<td>SAML による SSO</td>
</tr>
</tbody>
</table>
<p><strong>コストの現実：</strong></p>
<ul>
<li>GitHub Enterprise：$21/ユーザー/月</li>
<li>AWS SSO：AWS Organizations が必要</li>
<li>Google Workspace：$12-18/ユーザー/月（SSO 用）</li>
<li>Microsoft 365：$22/ユーザー/月（SSO 用）</li>
</ul>
<div class="admonition warning"><p class="admonition-title"><span class="mdi mdi-alert-outline admonition-icon"></span>⚠️ ホームラボ SSO の制限</p><div class="admonition-content"><p><strong>あなたのホームラボ SSO が動作するもの：</strong></p>
<ul>
<li>✅ セルフホストサービス（Nextcloud、Grafana、Jellyfin）</li>
<li>✅ あなたが管理するサービス</li>
<li>✅ 制限なしで OIDC/SAML をサポートするアプリ</li>
</ul>
<p><strong>あなたのホームラボ SSO が動作しないもの：</strong></p>
<ul>
<li>❌ 無料ティア SaaS（GitHub、Gmail、Slack）</li>
<li>❌ エンタープライズサブスクリプションが必要なサービス</li>
<li>❌ カスタム IdP をサポートしないサービス</li>
</ul>
<p><strong>これによりホームラボ SSO は内部サービスのみに制限されます</strong>が、10-20 のセルフホストアプリを管理するには依然として価値があります！</p>
</div></div>
<p><strong>比較：</strong></p>
<table>
<thead>
<tr>
<th>プロトコル</th>
<th>最適な用途</th>
<th>複雑さ</th>
<th>フェデレーション</th>
<th>ホームラボフレンドリー</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>OIDC</strong></td>
<td>モダンアプリ</td>
<td>低</td>
<td>✅ はい</td>
<td>✅ はい</td>
</tr>
<tr>
<td><strong>SAML</strong></td>
<td>エンタープライズアプリ</td>
<td>高</td>
<td>✅ はい</td>
<td>⚠️ 必要な場合</td>
</tr>
<tr>
<td><strong>WIA</strong></td>
<td>Windows ドメイン</td>
<td>中</td>
<td>❌ いいえ</td>
<td>❌ 過剰</td>
</tr>
</tbody>
</table>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>💡 プロトコルの選択</p><div class="admonition-content"><p>ホームラボの場合：</p>
<ul>
<li><strong>OIDC を使用</strong> サポートするアプリ用（Grafana、Nextcloud、Portainer）</li>
<li><strong>フォワード認証を使用</strong>（Authelia）OIDC サポートのないアプリ用</li>
<li><strong>WIA をスキップ</strong> すでに Active Directory を実行している場合を除く（そして SaaS では動作しない）</li>
<li><strong>SAML を使用</strong> 特定のアプリが必要とする場合のみ</li>
<li>**制限を受け入れる：**あなたの SSO は無料ティア SaaS（GitHub、Gmail など）では動作しない</li>
</ul>
</div></div>
<p><strong>視覚的比較：</strong></p>
<div class="mermaid">flowchart LR
    A["👤 ユーザー"] --&gt;|"1. ログインリクエスト"| B["🔐 IdP<br>(Authelia)"]
    B --&gt;|"2. 認証情報をチェック"| C["📚 ユーザーディレクトリ<br>(YAML/LDAP)"]
    C --&gt;|"3. 有効なユーザー"| B
    B --&gt;|"4. トークン発行<br>(OIDC/SAML)"| A
    A --&gt;|"5. トークン提示"| D["📦 サービスプロバイダー<br>(Nextcloud)"]
    D --&gt;|"6. トークン検証"| B
    B --&gt;|"7. トークン有効"| D
    D --&gt;|"8. アクセス許可"| A
    
    style B fill:#e3f2fd
    style C fill:#f3e5f5
    style D fill:#e8f5e9</div>
<h4 id="すべてをまとめる">すべてをまとめる</h4>
<p><strong>SSO なし（現在の状態）：</strong></p>
<pre class="language-none"><code class="language-none">あなた → Nextcloud → Nextcloud のパスワードを入力
あなた → Grafana → Grafana のパスワードを入力
あなた → Jellyfin → Jellyfin のパスワードを入力
（15 のサービス = 15 のパスワード！）</code></pre>
<p><strong>SSO あり（設定後）：</strong></p>
<pre class="language-none"><code class="language-none">あなた → Nextcloud → Authelia にリダイレクト → 一度ログイン
あなた → Grafana → すでにログイン済み（トークンが存在）
あなた → Jellyfin → すでにログイン済み（トークンが存在）
（1回のログイン = すべてにアクセス！）</code></pre>
<p>**魔法：**Authelia にログインすると、セッションが作成されます。すべてのアプリが Authelia に確認します：「このユーザーはログインしていますか？」Authelia が「はい！」と答え、アクセスを許可します。</p>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>🎯 重要なポイント</p><div class="admonition-content"><ul>
<li><strong>IdP（Authelia）</strong> = ログインする唯一の場所</li>
<li><strong>サービスプロバイダー（あなたのアプリ）</strong> = IdP の決定を信頼</li>
<li><strong>ユーザーディレクトリ</strong> = ユーザー名/パスワードが保存される場所</li>
<li><strong>プロトコル（OIDC/SAML）</strong> = 互いに通信する方法</li>
</ul>
<p>IdP で一度ログインすれば、すべてのアプリがそのログインを信頼します。</p>
</div></div>
<h2 id="セルフホスト-vs-外部アイデンティティプロバイダー">セルフホスト vs 外部アイデンティティプロバイダー</h2>
<p>セルフホストソリューションに飛び込む前に、「なぜ Google、Microsoft、または GitHub を IdP として使わないのか？」と疑問に思うかもしれません。</p>
<h3 id="外部-IdP（Google、Microsoft、GitHub、Auth0）">外部 IdP（Google、Microsoft、GitHub、Auth0）</h3>
<p><strong>長所：</strong></p>
<ul>
<li>メンテナンス不要</li>
<li>すでにアカウントを持っている</li>
<li>エンタープライズグレードのセキュリティ</li>
<li>個人使用は無料</li>
<li>組み込み MFA</li>
<li><strong>SaaS とフェデレーション可能</strong>（エンタープライズサブスクリプションがある場合）</li>
</ul>
<p><strong>短所：</strong></p>
<ul>
<li><strong>プライバシーの懸念</strong> - 外部プロバイダーがホームラボへのすべてのログインを見る</li>
<li><strong>インターネット依存</strong> - インターネットがダウンすると認証できない</li>
<li><strong>サービス停止</strong> - サービスがダウンするとホームラボが壊れる</li>
<li><strong>アカウントリンク</strong> - 外部アカウントなしでユーザーを追加できない</li>
<li><strong>利用規約</strong> - 彼らのルールと変更に従う</li>
<li><strong>データ主権</strong> - 認証データがネットワークを離れる</li>
<li><strong>エコシステムに制限</strong> - Google SSO を Microsoft サービスに使用できない</li>
</ul>
<h3 id="セルフホスト-IdP（Authelia、Authentik、Keycloak）">セルフホスト IdP（Authelia、Authentik、Keycloak）</h3>
<p><strong>長所：</strong></p>
<ul>
<li><strong>完全なプライバシー</strong> - 外部追跡なし</li>
<li><strong>オフラインで動作</strong> - インターネット停止がローカルサービスに影響しない</li>
<li><strong>完全な制御</strong> - あなたのルール、あなたのユーザー</li>
<li><strong>カスタムユーザー</strong> - Google アカウントを必要とせずに家族/友人を追加</li>
<li><strong>ベンダーロックインなし</strong> - 認証インフラストラクチャを所有</li>
<li><strong>学習機会</strong> - SSO の仕組みを理解</li>
<li><strong>フェデレーションプロトコル</strong> - OIDC/SAML を使用（標準プロトコル）</li>
</ul>
<p><strong>短所：</strong></p>
<ul>
<li>セットアップとメンテナンスが必要</li>
<li>セキュリティに責任を持つ</li>
<li>バックアップを管理する必要がある</li>
<li>「Google でログイン」ボタンより複雑</li>
<li><strong>SaaS 統合が制限される</strong> - ほとんどの SaaS は高価なエンタープライズプランが必要</li>
</ul>
<h3 id="ハイブリッドアプローチ">ハイブリッドアプローチ</h3>
<p>両方の長所を活かす：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Authentik は外部 IdP をソースとして使用可能</span>
<span class="token comment"># ユーザーは選択できる：ローカルアカウント OR Google OR GitHub</span></code></pre>
<p><strong>ユースケース：</strong></p>
<ul>
<li><strong>セルフホストをプライマリ</strong> + 外部をバックアップ</li>
<li><strong>家族用のローカルアカウント</strong> + ゲスト用の外部</li>
<li><strong>機密サービス用のセルフホスト</strong> + 低リスクアプリ用の外部</li>
</ul>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>💡 外部 IdP を使用するタイミング</p><div class="admonition-content"><p>外部 IdP を使用する場合：</p>
<ul>
<li>Google/Microsoft にログインアクティビティを見られても構わない</li>
<li>ホームラボが常にインターネットに接続されている</li>
<li>自分だけの認証が必要</li>
<li>メンテナンス不要を望む</li>
<li>エンタープライズサブスクリプションがあり、SaaS と統合したい</li>
</ul>
<p>セルフホストを使用する場合：</p>
<ul>
<li>プライバシーが重要（外部追跡なし）</li>
<li>オフライン機能が必要</li>
<li>複数のユーザー（家族/友人）を管理する必要がある</li>
<li>インフラストラクチャを学び、制御したい</li>
<li>外部プロバイダーに公開すべきでないサービスがある</li>
<li><strong>セルフホストサービスのみに SSO が必要</strong>（一般的なホームラボのケース）</li>
</ul>
</div></div>
<p><strong>実世界の例：</strong></p>
<p><strong>シナリオ 1 - ISP 停止：</strong><br>
外部 IdP では、ローカルの Home Assistant にログインしてセキュリティカメラをチェックできません。セルフホスト SSO では、ローカルネットワーク上ですべてが動作します。</p>
<p><strong>シナリオ 2 - SaaS 統合：</strong><br>
ホームラボ SSO を GitHub に使用したい。GitHub はカスタム SAML IdP を受け入れるために Enterprise（$21/ユーザー/月）が必要です。ホームラボには高すぎるため、代わりに GitHub 自身の認証を使用します。</p>
<h2 id="SSO-ソリューションの選択">SSO ソリューションの選択</h2>
<h3 id="オプション-1：Authelia（軽量、プロキシベース）">オプション 1：Authelia（軽量、プロキシベース）</h3>
<p>**最適な用途：**シンプルなセットアップ、リバースプロキシユーザー</p>
<p><strong>長所：</strong></p>
<ul>
<li>軽量（単一バイナリ）</li>
<li>任意のリバースプロキシで動作（Traefik、nginx）</li>
<li>シンプルな YAML 設定</li>
<li>組み込み LDAP/ファイルベース認証</li>
<li>優れたドキュメント</li>
</ul>
<p><strong>短所：</strong></p>
<ul>
<li>限定的な OIDC サポート（基本）</li>
<li>管理 UI なし（設定ファイルのみ）</li>
<li>Authentik より統合が少ない</li>
</ul>
<h3 id="オプション-2：Authentik（フル機能、モダン）">オプション 2：Authentik（フル機能、モダン）</h3>
<p>**最適な用途：**複雑なセットアップ、複数のプロトコルが必要</p>
<p><strong>長所：</strong></p>
<ul>
<li>美しい管理 UI</li>
<li>完全な OIDC および SAML サポート</li>
<li>組み込みユーザー管理</li>
<li>カスタマイズ可能なログインフロー</li>
<li>活発な開発</li>
</ul>
<p><strong>短所：</strong></p>
<ul>
<li>より重いリソース使用</li>
<li>より複雑なセットアップ</li>
<li>PostgreSQL/Redis が必要</li>
</ul>
<h3 id="オプション-3：Keycloak（エンタープライズグレード）">オプション 3：Keycloak（エンタープライズグレード）</h3>
<p>**最適な用途：**大規模ホームラボ、エンタープライズ機能</p>
<p><strong>長所：</strong></p>
<ul>
<li>業界標準</li>
<li>包括的な機能</li>
<li>優れた SAML/OIDC サポート</li>
<li>ユーザーフェデレーション</li>
</ul>
<p><strong>短所：</strong></p>
<ul>
<li>重いリソース使用（Java ベース）</li>
<li>複雑な設定</li>
<li>小規模ホームラボには過剰</li>
</ul>
<h3 id="比較表">比較表</h3>
<table>
<thead>
<tr>
<th>機能</th>
<th>Authelia</th>
<th>Authentik</th>
<th>Keycloak</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>リソース使用</strong></td>
<td>低</td>
<td>中</td>
<td>高</td>
</tr>
<tr>
<td><strong>セットアップの複雑さ</strong></td>
<td>低</td>
<td>中</td>
<td>高</td>
</tr>
<tr>
<td><strong>OIDC サポート</strong></td>
<td>基本</td>
<td>完全</td>
<td>完全</td>
</tr>
<tr>
<td><strong>SAML サポート</strong></td>
<td>❌ なし</td>
<td>✅ あり</td>
<td>✅ あり</td>
</tr>
<tr>
<td><strong>管理 UI</strong></td>
<td>❌ なし</td>
<td>✅ あり</td>
<td>✅ あり</td>
</tr>
<tr>
<td><strong>MFA</strong></td>
<td>✅ TOTP、WebAuthn</td>
<td>✅ TOTP、WebAuthn、Passkey</td>
<td>✅ すべてのタイプ</td>
</tr>
<tr>
<td><strong>最適な用途</strong></td>
<td>小規模ラボ</td>
<td>中規模ラボ</td>
<td>エンタープライズ</td>
</tr>
</tbody>
</table>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>💡 推奨</p><div class="admonition-content"><ul>
<li>Traefik/nginx を使用していてシンプルさを求めるなら <strong>Authelia から始める</strong></li>
<li>OIDC/SAML と UI が必要なら <strong>Authentik を選択</strong></li>
<li>エンタープライズ機能が必要か、すでに知っている場合のみ <strong>Keycloak を使用</strong></li>
</ul>
</div></div>
<h2 id="Authelia-のセットアップ">Authelia のセットアップ</h2>
<h3 id="アーキテクチャ">アーキテクチャ</h3>
<div class="mermaid">flowchart TD
  User["👤 ユーザー"]
  Proxy["🚪 リバースプロキシ (Traefik/nginx)"]
  Authelia["🔐 Authelia"]
  LDAP["📚 ユーザーディレクトリ (YAML/LDAP)"]
  
  subgraph Services[" "]
    App1["📦 Nextcloud"]
    App2["🎬 Jellyfin"]
    App3["📊 Grafana"]
  end
  
  User --&gt; Proxy
  Proxy --&gt; Authelia
  Proxy --&gt; Services
  Authelia -.-&gt; LDAP
  
  style Authelia fill:#e3f2fd
  style Proxy fill:#fff3e0
  style LDAP fill:#f3e5f5
  style Services fill:#e8f5e9</div>
<h3 id="前提条件">前提条件</h3>
<ul>
<li>Docker と Docker Compose</li>
<li>リバースプロキシ（Traefik または nginx）</li>
<li>ドメイン名（またはローカル DNS）</li>
</ul>
<h3 id="ステップ-1：ディレクトリ構造の作成">ステップ 1：ディレクトリ構造の作成</h3>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> authelia/<span class="token punctuation">{</span>config,secrets<span class="token punctuation">}</span>
<span class="token builtin class-name">cd</span> authelia</code></pre>
<h3 id="ステップ-2：シークレットの生成">ステップ 2：シークレットの生成</h3>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># JWT シークレット</span>
<span class="token function">tr</span> <span class="token parameter variable">-cd</span> <span class="token string">'[:alnum:]'</span> <span class="token operator">&lt;</span> /dev/urandom <span class="token operator">|</span> <span class="token function">fold</span> <span class="token parameter variable">-w</span> <span class="token string">"64"</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token operator">&gt;</span> secrets/jwt_secret

<span class="token comment"># セッションシークレット</span>
<span class="token function">tr</span> <span class="token parameter variable">-cd</span> <span class="token string">'[:alnum:]'</span> <span class="token operator">&lt;</span> /dev/urandom <span class="token operator">|</span> <span class="token function">fold</span> <span class="token parameter variable">-w</span> <span class="token string">"64"</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token operator">&gt;</span> secrets/session_secret

<span class="token comment"># ストレージ暗号化キー</span>
<span class="token function">tr</span> <span class="token parameter variable">-cd</span> <span class="token string">'[:alnum:]'</span> <span class="token operator">&lt;</span> /dev/urandom <span class="token operator">|</span> <span class="token function">fold</span> <span class="token parameter variable">-w</span> <span class="token string">"64"</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token operator">&gt;</span> secrets/storage_encryption_key</code></pre>
<h3 id="ステップ-3：設定の作成">ステップ 3：設定の作成</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># config/configuration.yml</span>
<span class="token punctuation">---</span>
<span class="token key atrule">theme</span><span class="token punctuation">:</span> dark
<span class="token key atrule">default_2fa_method</span><span class="token punctuation">:</span> <span class="token string">"totp"</span>

<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">host</span><span class="token punctuation">:</span> 0.0.0.0
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9091</span>

<span class="token key atrule">log</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span> info

<span class="token key atrule">totp</span><span class="token punctuation">:</span>
  <span class="token key atrule">issuer</span><span class="token punctuation">:</span> homelab.local
  <span class="token key atrule">period</span><span class="token punctuation">:</span> <span class="token number">30</span>
  <span class="token key atrule">skew</span><span class="token punctuation">:</span> <span class="token number">1</span>

<span class="token key atrule">authentication_backend</span><span class="token punctuation">:</span>
  <span class="token key atrule">file</span><span class="token punctuation">:</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /config/users_database.yml
    <span class="token key atrule">password</span><span class="token punctuation">:</span>
      <span class="token key atrule">algorithm</span><span class="token punctuation">:</span> argon2id
      <span class="token key atrule">iterations</span><span class="token punctuation">:</span> <span class="token number">1</span>
      <span class="token key atrule">salt_length</span><span class="token punctuation">:</span> <span class="token number">16</span>
      <span class="token key atrule">parallelism</span><span class="token punctuation">:</span> <span class="token number">8</span>
      <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token number">64</span>

<span class="token key atrule">access_control</span><span class="token punctuation">:</span>
  <span class="token key atrule">default_policy</span><span class="token punctuation">:</span> deny
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">domain</span><span class="token punctuation">:</span> <span class="token string">"*.homelab.local"</span>
      <span class="token key atrule">policy</span><span class="token punctuation">:</span> two_factor

<span class="token key atrule">session</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> authelia_session
  <span class="token key atrule">domain</span><span class="token punctuation">:</span> homelab.local
  <span class="token key atrule">expiration</span><span class="token punctuation">:</span> 1h
  <span class="token key atrule">inactivity</span><span class="token punctuation">:</span> 5m
  <span class="token key atrule">remember_me_duration</span><span class="token punctuation">:</span> 1M

<span class="token key atrule">regulation</span><span class="token punctuation">:</span>
  <span class="token key atrule">max_retries</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">find_time</span><span class="token punctuation">:</span> 2m
  <span class="token key atrule">ban_time</span><span class="token punctuation">:</span> 5m

<span class="token key atrule">storage</span><span class="token punctuation">:</span>
  <span class="token key atrule">encryption_key_secret_file</span><span class="token punctuation">:</span> /secrets/storage_encryption_key
  <span class="token key atrule">local</span><span class="token punctuation">:</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /config/db.sqlite3

<span class="token key atrule">notifier</span><span class="token punctuation">:</span>
  <span class="token key atrule">filesystem</span><span class="token punctuation">:</span>
    <span class="token key atrule">filename</span><span class="token punctuation">:</span> /config/notification.txt</code></pre>
<h3 id="ステップ-4：ユーザーの作成">ステップ 4：ユーザーの作成</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># config/users_database.yml</span>
<span class="token key atrule">users</span><span class="token punctuation">:</span>
  <span class="token key atrule">alice</span><span class="token punctuation">:</span>
    <span class="token key atrule">displayname</span><span class="token punctuation">:</span> <span class="token string">"Alice Smith"</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"$argon2id$v=19$m=65536,t=3,p=4$..."</span> <span class="token comment"># 生成：authelia crypto hash generate argon2 --password 'yourpassword'</span>
    <span class="token key atrule">email</span><span class="token punctuation">:</span> alice@homelab.local
    <span class="token key atrule">groups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> admins
      <span class="token punctuation">-</span> users
  
  <span class="token key atrule">bob</span><span class="token punctuation">:</span>
    <span class="token key atrule">displayname</span><span class="token punctuation">:</span> <span class="token string">"Bob Jones"</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"$argon2id$v=19$m=65536,t=3,p=4$..."</span>
    <span class="token key atrule">email</span><span class="token punctuation">:</span> bob@homelab.local
    <span class="token key atrule">groups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> users</code></pre>
<p><strong>パスワードハッシュの生成：</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">--rm</span> authelia/authelia:latest authelia crypto <span class="token builtin class-name">hash</span> generate argon2 <span class="token parameter variable">--password</span> <span class="token string">'yourpassword'</span></code></pre>
<h3 id="ステップ-5：Docker-Compose">ステップ 5：Docker Compose</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># docker-compose.yml</span>
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.8'</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">authelia</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> authelia/authelia<span class="token punctuation">:</span>latest
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> authelia
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./config<span class="token punctuation">:</span>/config
      <span class="token punctuation">-</span> ./secrets<span class="token punctuation">:</span>/secrets
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 9091<span class="token punctuation">:</span><span class="token number">9091</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> TZ=America/New_York
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</code></pre>
<h3 id="ステップ-6：Traefik-との統合">ステップ 6：Traefik との統合</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># docker-compose.yml（既存の Traefik セットアップに追加）</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">authelia</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> authelia/authelia<span class="token punctuation">:</span>latest
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> authelia
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./authelia/config<span class="token punctuation">:</span>/config
      <span class="token punctuation">-</span> ./authelia/secrets<span class="token punctuation">:</span>/secrets
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.enable=true"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.authelia.rule=Host(`auth.homelab.local`)"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.authelia.entrypoints=websecure"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.authelia.tls=true"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.services.authelia.loadbalancer.server.port=9091"</span>
      
      <span class="token comment"># Authelia ミドルウェア</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.middlewares.authelia.forwardauth.address=http://authelia:9091/api/verify?rd=https://auth.homelab.local"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.middlewares.authelia.forwardauth.trustForwardHeader=true"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.middlewares.authelia.forwardauth.authResponseHeaders=Remote-User,Remote-Groups,Remote-Name,Remote-Email"</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped

  <span class="token comment"># 保護されたサービスの例</span>
  <span class="token key atrule">nextcloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nextcloud<span class="token punctuation">:</span>latest
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.enable=true"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.nextcloud.rule=Host(`nextcloud.homelab.local`)"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.nextcloud.entrypoints=websecure"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.nextcloud.tls=true"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.nextcloud.middlewares=authelia@docker"</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</code></pre>
<h3 id="ステップ-7：サービスの起動">ステップ 7：サービスの起動</h3>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span></code></pre>
<p><code>https://auth.homelab.local</code> にアクセスしてログインページを確認します。</p>
<h3 id="認証フローの理解">認証フローの理解</h3>
<p>Authelia をセットアップしたので、保護されたサービスにアクセスしたときに何が起こるかを正確に見てみましょう：</p>
<div class="mermaid">sequenceDiagram
    participant User as ユーザー
    participant App as アプリケーション (Nextcloud)
    participant SSO as SSO プロバイダー (Authelia)
    participant LDAP as ユーザーディレクトリ (YAML/LDAP)
    
    User-&gt;&gt;App: 1. アプリケーションにアクセス
    App-&gt;&gt;User: 2. SSO ログインにリダイレクト
    User-&gt;&gt;SSO: 3. 認証情報 + MFA を入力
    SSO-&gt;&gt;LDAP: 4. 認証情報を検証
    LDAP-&gt;&gt;SSO: 5. ユーザー認証済み
    SSO-&gt;&gt;App: 6. 認証トークンを返す
    App-&gt;&gt;User: 7. アクセスを許可
    
    Note over User,App: ユーザーがログイン済み！
    
    User-&gt;&gt;App: 8. 別のアプリにアクセス (Jellyfin)
    App-&gt;&gt;SSO: 9. 既存のセッションをチェック
    SSO-&gt;&gt;App: 10. 有効なセッションが存在
    App-&gt;&gt;User: 11. アクセスを許可（ログイン不要）</div>
<p><strong>舞台裏で何が起こるか：</strong></p>
<ol>
<li><strong>最初のアクセス：</strong><code>nextcloud.homelab.local</code> にアクセス</li>
<li>**Traefik が傍受：**Authelia に確認 - 「このユーザーは認証済みですか？」</li>
<li>**未認証：**Authelia が <code>auth.homelab.local</code> にリダイレクト</li>
<li>**ログイン：**ユーザー名、パスワード、MFA コードを入力</li>
<li>**Authelia が検証：**ユーザーデータベースに対して認証情報をチェック</li>
<li>**セッション作成：**Authelia がセッション Cookie を作成</li>
<li>**リダイレクトバック：**Nextcloud に戻される</li>
<li>**アクセス許可：**Traefik が有効なセッションを確認し、アクセスを許可</li>
</ol>
<p><strong>2番目のサービスアクセス：</strong></p>
<ol>
<li><code>grafana.homelab.local</code> にアクセス</li>
<li>Traefik が Authelia に確認 - 「このユーザーは認証済みですか？」</li>
<li>Authelia が既存のセッション Cookie を確認 - 「はい、Alice です！」</li>
<li>すぐにアクセス許可 - <strong>ログイン不要</strong></li>
</ol>
<p>これが SSO の魔法です - 一度のログインで、どこでもアクセス！</p>
<h2 id="多要素認証の追加">多要素認証の追加</h2>
<h3 id="MFA-オプションの概要">MFA オプションの概要</h3>
<table>
<thead>
<tr>
<th>方法</th>
<th>セキュリティ</th>
<th>利便性</th>
<th>コスト</th>
<th>フィッシング耐性</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Passkey (WebAuthn)</strong></td>
<td>最高</td>
<td>高</td>
<td>無料</td>
<td>✅ はい</td>
</tr>
<tr>
<td><strong>ハードウェアキー</strong></td>
<td>最高</td>
<td>中</td>
<td>$25-50</td>
<td>✅ はい</td>
</tr>
<tr>
<td><strong>TOTP (認証アプリ)</strong></td>
<td>高</td>
<td>中</td>
<td>無料</td>
<td>❌ いいえ</td>
</tr>
<tr>
<td><strong>SMS</strong></td>
<td>低</td>
<td>高</td>
<td>SMS ゲートウェイが必要</td>
<td>❌ いいえ</td>
</tr>
</tbody>
</table>
<h3 id="1-Passkey-WebAuthn-推奨">1. Passkey (WebAuthn) - 推奨</h3>
<p><strong>Passkey とは？</strong></p>
<p>Passkey は、生体認証（指紋、顔、PIN）を使用したパスワードの現代的な代替品です。</p>
<p>**現実世界のアナロジー：**パスワードを入力する代わりに、指紋でスマートフォンのロックを解除するようなもの。</p>
<p><strong>仕組み：</strong></p>
<ul>
<li>デバイスが暗号化キーを保存</li>
<li>生体認証（指紋/顔）またはデバイス PIN で認証</li>
<li>盗まれたりフィッシングされたりするパスワードがない</li>
<li>クラウド同期でデバイス間で動作（iCloud キーチェーン、Google パスワードマネージャー）</li>
</ul>
<p><strong>Authentik セットアップ：</strong></p>
<ol>
<li>ユーザーメニュー → 設定</li>
<li>MFA デバイス → 登録</li>
<li><strong>WebAuthn</strong> または <strong>Passkey</strong> を選択</li>
<li>ブラウザのプロンプトに従う：
<ul>
<li>**モバイル：**指紋/Face ID を使用</li>
<li>**ラップトップ：**Touch ID/Windows Hello を使用</li>
<li>**デスクトップ：**スマートフォンを Passkey として使用、またはハードウェアキー</li>
</ul>
</li>
</ol>
<p><strong>Authelia セットアップ：</strong></p>
<ol>
<li>保護されたサービスにログイン</li>
<li>「セキュリティキーを登録」をクリック</li>
<li>Passkey オプションを選択</li>
<li>生体認証で認証</li>
</ol>
<p><strong>サポートされているプラットフォーム：</strong></p>
<ul>
<li>✅ iPhone/iPad (iOS 16+) - Face ID/Touch ID</li>
<li>✅ Android (9+) - 指紋/顔認証</li>
<li>✅ macOS (Ventura+) - Touch ID</li>
<li>✅ Windows (10+) - Windows Hello</li>
<li>✅ Chrome/Edge/Safari - 組み込みサポート</li>
</ul>
<h3 id="2-ハードウェアセキュリティキー">2. ハードウェアセキュリティキー</h3>
<p><strong>認証用の物理デバイス：</strong></p>
<p><strong>Authentik：</strong></p>
<ol>
<li>ユーザーメニュー → 設定</li>
<li>MFA デバイス → 登録</li>
<li>WebAuthn を選択</li>
<li>セキュリティキー（YubiKey など）を挿入</li>
<li>プロンプトが表示されたらキーにタッチ</li>
</ol>
<p><strong>人気のハードウェアキー：</strong></p>
<ul>
<li><strong>YubiKey 5</strong> ($45-50) - USB-A/C、NFC</li>
<li><strong>YubiKey 5C Nano</strong> ($55) - USB-C ポートに常駐</li>
<li><strong>Google Titan</strong> ($30) - USB-A/C、Bluetooth</li>
<li><strong>Feitian</strong> ($20-30) - 予算オプション</li>
</ul>
<h3 id="3-TOTP（認証アプリ）">3. TOTP（認証アプリ）</h3>
<p><strong>アプリからの時間ベースのコード：</strong></p>
<p><strong>Authelia（組み込み）：</strong></p>
<ol>
<li>保護されたサービスにログイン</li>
<li>「デバイスを登録」をクリック</li>
<li>認証アプリで QR コードをスキャン</li>
<li>6桁のコードを入力して確認</li>
</ol>
<p><strong>Authentik：</strong></p>
<ol>
<li>ユーザーメニュー → 設定</li>
<li>MFA デバイス → 登録</li>
<li>TOTP を選択</li>
<li>QR コードをスキャン</li>
</ol>
<p><strong>推奨される認証アプリ：</strong></p>
<ul>
<li><strong>Aegis</strong> (Android) - オープンソース、暗号化バックアップ</li>
<li><strong>Raivo OTP</strong> (iOS) - オープンソース、iCloud 同期</li>
<li><strong>2FAS</strong> (iOS/Android) - 無料、クラウドバックアップ</li>
<li><strong>Authy</strong> (iOS/Android) - マルチデバイス同期</li>
<li><strong>Google Authenticator</strong> (iOS/Android) - シンプル、クラウドバックアップ</li>
</ul>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>💡 MFA ベストプラクティス</p><div class="admonition-content"><p><strong>優先順位：</strong></p>
<ol>
<li><strong>Passkey</strong> - 最も安全で便利（生体認証を使用）</li>
<li><strong>ハードウェアキー</strong> - 非常に安全、物理デバイスが必要</li>
<li><strong>TOTP アプリ</strong> - 安全だが、フィッシングされる可能性あり</li>
<li><strong>SMS を避ける</strong> - SIM スワッピングに脆弱</li>
</ol>
<p><strong>推奨事項：</strong></p>
<ul>
<li><strong>管理者には MFA を必須に</strong>（Passkey またはハードウェアキーを使用）</li>
<li><strong>家族にはオプション</strong>（摩擦を減らす、Passkey は簡単）</li>
<li><strong>バックアップコード</strong> - 生成して安全に保存</li>
<li><strong>複数の方法</strong> - Passkey + TOTP をバックアップとして登録</li>
<li><strong>Passkey 同期</strong> - iCloud/Google を使用してすべてのデバイスからアクセス</li>
</ul>
</div></div>
<h2 id="SSO-有効化後もローカルアカウントを保持すべきか？">SSO 有効化後もローカルアカウントを保持すべきか？</h2>
<p><strong>短い答え：はい、常にバックアップとしてローカルアカウントを保持してください。</strong></p>
<h3 id="なぜローカルアカウントを保持するのか？">なぜローカルアカウントを保持するのか？</h3>
<p>**SSO は単一障害点です。**SSO システムがダウンすると、すべてからロックアウトされます。</p>
<p><strong>SSO が失敗する実世界のシナリオ：</strong></p>
<ol>
<li><strong>SSO コンテナがクラッシュ</strong> - Docker/Kubernetes の問題</li>
<li><strong>データベースの破損</strong> - Authelia/Authentik データベースの問題</li>
<li><strong>設定エラー</strong> - 設定のタイプミスが認証を壊す</li>
<li><strong>証明書の期限切れ</strong> - HTTPS 証明書が期限切れ、SSO に到達不可</li>
<li><strong>ネットワークの問題</strong> - DNS の問題、リバースプロキシがダウン</li>
<li><strong>誤削除</strong> - 間違ったコンテナを削除</li>
</ol>
<p><strong>ローカルアカウントなしの場合：</strong></p>
<pre class="language-none"><code class="language-none">SSO ダウン → 何にもログインできない → SSO にアクセスして修正できない → ロックアウト</code></pre>
<p><strong>バックアップとしてローカルアカウントがある場合：</strong></p>
<pre class="language-none"><code class="language-none">SSO ダウン → ローカル管理者アカウントを使用 → SSO を修正 → 通常に戻る</code></pre>
<h3 id="ローカルアカウントのベストプラクティス">ローカルアカウントのベストプラクティス</h3>
<div class="admonition danger"><p class="admonition-title"><span class="mdi mdi-alert-circle-outline admonition-icon"></span>🔒 重要：ローカルアカウントを保護する</p><div class="admonition-content"><p>ローカルアカウントは SSO をバイパスするため、保護する必要があります：</p>
<ul>
<li><strong>強力なパスワード</strong> - パスワードマネージャーを使用、20文字以上</li>
<li><strong>ローカルアカウントで MFA を有効化</strong> - 多くのサービスがサポート</li>
<li><strong>ローカルアカウントを制限</strong> - 管理者/緊急アクセス用のみ作成</li>
<li><strong>異なるパスワード</strong> - SSO パスワードを再利用しない</li>
<li><strong>認証情報を文書化</strong> - 安全に保存（パスワードマネージャー、暗号化ファイル）</li>
</ul>
</div></div>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>💡 ゴールデンルール</p><div class="admonition-content"><p><strong>常に安全なバックドアを維持：</strong></p>
<ul>
<li>SSO は正面玄関（便利、安全）</li>
<li>ローカルアカウントは非常口（めったに使わないが、常に利用可能）</li>
<li>両方とも MFA で保護すべき</li>
<li>両方を定期的にテスト</li>
</ul>
<p>家の外に隠しておいた予備の鍵のようなものと考えてください - めったに必要ありませんが、必要なときにそこにあることを喜ぶでしょう！</p>
</div></div>
<h2 id="結論">結論</h2>
<p>ホームで SSO をセットアップすると、ホームラボが個別のサービスのコレクションから統一されたプラットフォームに変わります。初期セットアップの投資は、利便性とセキュリティの向上ですぐに報われます。</p>
<p><strong>重要なポイント：</strong></p>
<ul>
<li>SSO は複数のサービスにわたるパスワード疲労を解消</li>
<li><strong>Authelia はシンプルなセットアップに最適</strong> リバースプロキシと共に</li>
<li><strong>Authentik は完全な機能を提供</strong> 美しい UI と共に</li>
<li>フォワード認証は任意のサービスを保護</li>
<li>MFA は重要なセキュリティレイヤーを追加</li>
<li>LDAP 統合は大規模デプロイメントに対応</li>
<li>定期的なバックアップが不可欠（SSO は単一障害点）</li>
<li><strong>ホームラボ SSO はセルフホストサービスに制限される</strong> - SaaS 統合には高価なエンタープライズプランが必要</li>
<li>フェデレーション（OIDC/SAML）はシステム間で SSO を可能にするが、WIA は非フェデレーション</li>
</ul>
<p><strong>クイックスタート推奨：</strong></p>
<p>ほとんどのホームラボの場合：</p>
<ol>
<li><strong>Authelia</strong> + Traefik から始める（最もシンプルな道）</li>
<li>最初はファイルベース認証を使用</li>
<li>管理者アカウントに MFA を追加</li>
<li>徐々にサービスを SSO に移行</li>
<li>後で OIDC/SAML が必要な場合は Authentik を検討</li>
</ol>
<p>2-3 のサービスから始めて、フローに慣れてから拡張してください。もう何十ものパスワードをやりくりしなくて済むようになったとき、未来の自分が感謝するでしょう！🔐</p>
<h2 id="Authentik-のセットアップ">Authentik のセットアップ</h2>
<h3 id="ステップ-1：Docker-Compose-でインストール">ステップ 1：Docker Compose でインストール</h3>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 公式 compose ファイルをダウンロード</span>
<span class="token function">wget</span> https://goauthentik.io/docker-compose.yml
<span class="token function">wget</span> https://goauthentik.io/.env

<span class="token comment"># シークレットを生成</span>
<span class="token builtin class-name">echo</span> <span class="token string">"PG_PASS=<span class="token variable"><span class="token variable">$(</span>openssl rand <span class="token parameter variable">-base64</span> <span class="token number">36</span><span class="token variable">)</span></span>"</span> <span class="token operator">&gt;&gt;</span> .env
<span class="token builtin class-name">echo</span> <span class="token string">"AUTHENTIK_SECRET_KEY=<span class="token variable"><span class="token variable">$(</span>openssl rand <span class="token parameter variable">-base64</span> <span class="token number">60</span><span class="token variable">)</span></span>"</span> <span class="token operator">&gt;&gt;</span> .env

<span class="token comment"># サービスを起動</span>
<span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span></code></pre>
<h3 id="ステップ-2：初期セットアップ">ステップ 2：初期セットアップ</h3>
<ol>
<li><code>http://localhost:9000/if/flow/initial-setup/</code> にアクセス</li>
<li>管理者アカウントを作成</li>
<li>セットアップウィザードを完了</li>
</ol>
<h3 id="ステップ-3：アプリケーションの作成">ステップ 3：アプリケーションの作成</h3>
<ol>
<li>
<p><strong>Applications → Create</strong></p>
<ul>
<li>Name: Nextcloud</li>
<li>Slug: nextcloud</li>
<li>Provider: 新しい OIDC プロバイダーを作成</li>
</ul>
</li>
<li>
<p><strong>OIDC プロバイダーの設定</strong></p>
<ul>
<li>Client Type: Confidential</li>
<li>Redirect URIs: <code>https://nextcloud.homelab.local/apps/oidc_login/oidc</code></li>
<li>Signing Key: 自動生成</li>
</ul>
</li>
<li>
<p><strong>認証情報をメモ：</strong></p>
<ul>
<li>Client ID: (自動生成)</li>
<li>Client Secret: (自動生成)</li>
</ul>
</li>
</ol>
<h3 id="ステップ-4：アプリケーションの設定（Nextcloud-の例）">ステップ 4：アプリケーションの設定（Nextcloud の例）</h3>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">// nextcloud/config/config.php</span>
<span class="token string single-quoted-string">'oidc_login_provider_url'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'https://auth.homelab.local/application/o/nextcloud/'</span><span class="token punctuation">,</span>
<span class="token string single-quoted-string">'oidc_login_client_id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'your-client-id'</span><span class="token punctuation">,</span>
<span class="token string single-quoted-string">'oidc_login_client_secret'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'your-client-secret'</span><span class="token punctuation">,</span>
<span class="token string single-quoted-string">'oidc_login_auto_redirect'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
<span class="token string single-quoted-string">'oidc_login_button_text'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Log in with SSO'</span><span class="token punctuation">,</span>
<span class="token string single-quoted-string">'oidc_login_hide_password_form'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
<span class="token string single-quoted-string">'oidc_login_attributes'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'sub'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'mail'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'email'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'groups'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'groups'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span></code></pre>
<h2 id="アプリケーションの統合">アプリケーションの統合</h2>
<h3 id="ネイティブ-OIDC-サポートを持つアプリケーション">ネイティブ OIDC サポートを持つアプリケーション</h3>
<p><strong>Grafana：</strong></p>
<pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># grafana.ini</span>
<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">auth.generic_oauth</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">name</span> <span class="token punctuation">=</span> <span class="token value attr-value">SSO</span>
<span class="token key attr-name">client_id</span> <span class="token punctuation">=</span> <span class="token value attr-value">grafana-client-id</span>
<span class="token key attr-name">client_secret</span> <span class="token punctuation">=</span> <span class="token value attr-value">grafana-client-secret</span>
<span class="token key attr-name">scopes</span> <span class="token punctuation">=</span> <span class="token value attr-value">openid profile email</span>
<span class="token key attr-name">auth_url</span> <span class="token punctuation">=</span> <span class="token value attr-value">https://auth.homelab.local/application/o/authorize/</span>
<span class="token key attr-name">token_url</span> <span class="token punctuation">=</span> <span class="token value attr-value">https://auth.homelab.local/application/o/token/</span>
<span class="token key attr-name">api_url</span> <span class="token punctuation">=</span> <span class="token value attr-value">https://auth.homelab.local/application/o/userinfo/</span></code></pre>
<p><strong>Portainer：</strong></p>
<ol>
<li>Settings → Authentication</li>
<li>OAuth → Enable</li>
<li>Authentik からエンドポイントを設定</li>
</ol>
<p><strong>Home Assistant：</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># configuration.yaml</span>
<span class="token key atrule">auth_providers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> homeassistant
  <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> command_line
    <span class="token key atrule">command</span><span class="token punctuation">:</span> /config/auth_script.sh
    <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"--username"</span><span class="token punctuation">]</span>
    <span class="token key atrule">meta</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code></pre>
<h3 id="OIDC-サポートのないアプリケーション">OIDC サポートのないアプリケーション</h3>
<p>Authelia/Traefik で<strong>フォワード認証</strong>を使用：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 任意のサービスを保護</span>
<span class="token key atrule">labels</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.myapp.middlewares=authelia@docker"</span></code></pre>
<h3 id="アプリケーションサポートマトリックス">アプリケーションサポートマトリックス</h3>
<table>
<thead>
<tr>
<th>アプリケーション</th>
<th>OIDC</th>
<th>SAML</th>
<th>フォワード認証</th>
<th>難易度</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Nextcloud</strong></td>
<td>✅ はい</td>
<td>✅ はい</td>
<td>✅ はい</td>
<td>簡単</td>
</tr>
<tr>
<td><strong>Grafana</strong></td>
<td>✅ はい</td>
<td>❌ いいえ</td>
<td>✅ はい</td>
<td>簡単</td>
</tr>
<tr>
<td><strong>Portainer</strong></td>
<td>✅ はい</td>
<td>❌ いいえ</td>
<td>✅ はい</td>
<td>簡単</td>
</tr>
<tr>
<td><strong>Jellyfin</strong></td>
<td>⚠️ プラグイン</td>
<td>❌ いいえ</td>
<td>✅ はい</td>
<td>中</td>
</tr>
<tr>
<td><strong>Home Assistant</strong></td>
<td>⚠️ カスタム</td>
<td>❌ いいえ</td>
<td>✅ はい</td>
<td>中</td>
</tr>
<tr>
<td><strong>Proxmox</strong></td>
<td>✅ はい</td>
<td>❌ いいえ</td>
<td>❌ いいえ</td>
<td>中</td>
</tr>
<tr>
<td><strong>TrueNAS</strong></td>
<td>❌ いいえ</td>
<td>✅ はい</td>
<td>✅ はい</td>
<td>難</td>
</tr>
</tbody>
</table>
<h2 id="ユーザー管理">ユーザー管理</h2>
<h3 id="ユーザーの追加（Authelia）">ユーザーの追加（Authelia）</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># config/users_database.yml</span>
<span class="token key atrule">users</span><span class="token punctuation">:</span>
  <span class="token key atrule">newuser</span><span class="token punctuation">:</span>
    <span class="token key atrule">displayname</span><span class="token punctuation">:</span> <span class="token string">"New User"</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"$argon2id$v=19$m=65536,t=3,p=4$..."</span>
    <span class="token key atrule">email</span><span class="token punctuation">:</span> newuser@homelab.local
    <span class="token key atrule">groups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> users</code></pre>
<p>変更後に Authelia を再起動します。</p>
<h3 id="ユーザーの追加（Authentik）">ユーザーの追加（Authentik）</h3>
<ol>
<li><strong>Directory → Users → Create</strong></li>
<li>詳細を入力</li>
<li>グループに割り当て</li>
<li>パスワードを設定（または招待を送信）</li>
</ol>
<h3 id="グループベースのアクセス制御">グループベースのアクセス制御</h3>
<p><strong>Authelia：</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># config/configuration.yml</span>
<span class="token key atrule">access_control</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">domain</span><span class="token punctuation">:</span> <span class="token string">"admin.homelab.local"</span>
      <span class="token key atrule">policy</span><span class="token punctuation">:</span> two_factor
      <span class="token key atrule">subject</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">"group:admins"</span>
    
    <span class="token punctuation">-</span> <span class="token key atrule">domain</span><span class="token punctuation">:</span> <span class="token string">"*.homelab.local"</span>
      <span class="token key atrule">policy</span><span class="token punctuation">:</span> two_factor
      <span class="token key atrule">subject</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">"group:users"</span></code></pre>
<p><strong>Authentik：</strong></p>
<ol>
<li>グループを作成：admins、users、family</li>
<li>ユーザーをグループに割り当て</li>
<li>アプリケーションポリシーでグループメンバーシップをチェック</li>
</ol>
<h2 id="高度：LDAP-統合">高度：LDAP 統合</h2>
<p>大規模なセットアップの場合、LDAP を中央ユーザーディレクトリとして使用します。</p>
<h3 id="OpenLDAP-のインストール">OpenLDAP のインストール</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># docker-compose.yml</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">openldap</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> osixia/openldap<span class="token punctuation">:</span>latest
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> LDAP_ORGANISATION=Homelab
      <span class="token punctuation">-</span> LDAP_DOMAIN=homelab.local
      <span class="token punctuation">-</span> LDAP_ADMIN_PASSWORD=admin_password
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ldap_data<span class="token punctuation">:</span>/var/lib/ldap
      <span class="token punctuation">-</span> ldap_config<span class="token punctuation">:</span>/etc/ldap/slapd.d
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"389:389"</span>
      <span class="token punctuation">-</span> <span class="token string">"636:636"</span>

  <span class="token key atrule">ldap-admin</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> osixia/phpldapadmin<span class="token punctuation">:</span>latest
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> PHPLDAPADMIN_LDAP_HOSTS=openldap
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"8080:80"</span>
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> openldap

<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token key atrule">ldap_data</span><span class="token punctuation">:</span>
  ldap_config<span class="token punctuation">:</span></code></pre>
<h3 id="Authelia-を-LDAP-で設定">Authelia を LDAP で設定</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># config/configuration.yml</span>
<span class="token key atrule">authentication_backend</span><span class="token punctuation">:</span>
  <span class="token key atrule">ldap</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> ldap<span class="token punctuation">:</span>//openldap<span class="token punctuation">:</span><span class="token number">389</span>
    <span class="token key atrule">base_dn</span><span class="token punctuation">:</span> dc=homelab<span class="token punctuation">,</span>dc=local
    <span class="token key atrule">username_attribute</span><span class="token punctuation">:</span> uid
    <span class="token key atrule">additional_users_dn</span><span class="token punctuation">:</span> ou=users
    <span class="token key atrule">users_filter</span><span class="token punctuation">:</span> (<span class="token important">&amp;(</span><span class="token punctuation">{</span>username_attribute<span class="token punctuation">}</span>=<span class="token punctuation">{</span>input<span class="token punctuation">}</span>)(objectClass=person))
    <span class="token key atrule">additional_groups_dn</span><span class="token punctuation">:</span> ou=groups
    <span class="token key atrule">groups_filter</span><span class="token punctuation">:</span> (<span class="token important">&amp;(member=</span><span class="token punctuation">{</span>dn<span class="token punctuation">}</span>)(objectClass=groupOfNames))
    <span class="token key atrule">user</span><span class="token punctuation">:</span> cn=admin<span class="token punctuation">,</span>dc=homelab<span class="token punctuation">,</span>dc=local
    <span class="token key atrule">password</span><span class="token punctuation">:</span> admin_password</code></pre>
<h3 id="Authentik-を-LDAP-で設定">Authentik を LDAP で設定</h3>
<ol>
<li><strong>Directory → Federation &amp; Social → LDAP Sources</strong></li>
<li>新しい LDAP ソースを作成</li>
<li>接続の詳細を設定</li>
<li>属性をマッピング</li>
</ol>
<h2 id="セキュリティのベストプラクティス">セキュリティのベストプラクティス</h2>
<div class="admonition danger"><p class="admonition-title"><span class="mdi mdi-alert-circle-outline admonition-icon"></span>⚠️ 重要なセキュリティ対策</p><div class="admonition-content"><p><strong>SSO システムを保護：</strong></p>
<ul>
<li>SSO は単一障害点 - しっかり保護する</li>
<li>強力な管理者パスワードを使用</li>
<li>すべての管理者アカウントで MFA を有効化</li>
<li>ソフトウェアを最新に保つ</li>
<li>認証ログを監視</li>
<li>設定を定期的にバックアップ</li>
</ul>
</div></div>
<p><strong>セキュリティチェックリスト：</strong></p>
<ul>
<li>[ ] すべてのアカウントに強力なパスワード</li>
<li>[ ] 管理者に MFA を有効化</li>
<li>[ ] すべての場所で HTTPS（プライベート CA を使用）</li>
<li>[ ] レート制限を有効化</li>
<li>[ ] ログイン失敗の通知</li>
<li>[ ] 定期的なセキュリティ監査</li>
<li>[ ] 認証データベースのバックアップ</li>
<li>[ ] 復旧手順を文書化</li>
<li>[ ] アカウント復旧フローをテスト</li>
<li>[ ] 不審なアクティビティを監視</li>
</ul>
<p><strong>ネットワークセキュリティ：</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Authelia レート制限</span>
<span class="token key atrule">regulation</span><span class="token punctuation">:</span>
  <span class="token key atrule">max_retries</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">find_time</span><span class="token punctuation">:</span> 2m
  <span class="token key atrule">ban_time</span><span class="token punctuation">:</span> 5m</code></pre>
<p><strong>セッションセキュリティ：</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 短いセッションタイムアウト</span>
<span class="token key atrule">session</span><span class="token punctuation">:</span>
  <span class="token key atrule">expiration</span><span class="token punctuation">:</span> 1h
  <span class="token key atrule">inactivity</span><span class="token punctuation">:</span> 15m</code></pre>
<h2 id="トラブルシューティング">トラブルシューティング</h2>
<h3 id="問題：リダイレクトループ">問題：リダイレクトループ</h3>
<p>**原因：**フォワード認証またはセッション Cookie の設定ミス</p>
<p><strong>解決策：</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># セッションドメインが一致することを確認</span>
<span class="token key atrule">session</span><span class="token punctuation">:</span>
  <span class="token key atrule">domain</span><span class="token punctuation">:</span> homelab.local  <span class="token comment"># ドメインと一致する必要がある</span></code></pre>
<h3 id="問題：「Invalid-Redirect-URI」">問題：「Invalid Redirect URI」</h3>
<p>**原因：**アプリケーションのリダイレクト URI が OIDC 設定と一致しない</p>
<p><strong>解決策：</strong><br>
アプリケーションログで実際のリダイレクト URI を確認し、IdP で更新します。</p>
<h3 id="問題：ログイン後にユーザーがアクセスできない">問題：ログイン後にユーザーがアクセスできない</h3>
<p>**原因：**認可ヘッダーが欠落</p>
<p><strong>解決策：</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Traefik - ヘッダーが転送されることを確認</span>
<span class="token punctuation">-</span> <span class="token string">"traefik.http.middlewares.authelia.forwardauth.authResponseHeaders=Remote-User,Remote-Groups"</span></code></pre>
<h3 id="問題：セッションの有効期限が早すぎる">問題：セッションの有効期限が早すぎる</h3>
<p><strong>解決策：</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># セッション期間を延長</span>
<span class="token key atrule">session</span><span class="token punctuation">:</span>
  <span class="token key atrule">expiration</span><span class="token punctuation">:</span> 12h
  <span class="token key atrule">inactivity</span><span class="token punctuation">:</span> 2h
  <span class="token key atrule">remember_me_duration</span><span class="token punctuation">:</span> 1M</code></pre>
<h2 id="監視とメンテナンス">監視とメンテナンス</h2>
<h3 id="ログ監視">ログ監視</h3>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Authelia ログ</span>
<span class="token function">docker</span> logs <span class="token parameter variable">-f</span> authelia

<span class="token comment"># ログイン失敗を監視</span>
<span class="token function">docker</span> logs authelia <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"authentication failed"</span></code></pre>
<h3 id="バックアップ戦略">バックアップ戦略</h3>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># backup-sso.sh</span>

<span class="token assign-left variable">BACKUP_DIR</span><span class="token operator">=</span><span class="token string">"/backups/sso/<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d<span class="token variable">)</span></span>"</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$BACKUP_DIR</span>

<span class="token comment"># Authelia をバックアップ</span>
<span class="token function">cp</span> <span class="token parameter variable">-r</span> /path/to/authelia/config <span class="token variable">$BACKUP_DIR</span>/
<span class="token function">cp</span> <span class="token parameter variable">-r</span> /path/to/authelia/secrets <span class="token variable">$BACKUP_DIR</span>/

<span class="token comment"># Authentik データベースをバックアップ</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> authentik-postgres pg_dump <span class="token parameter variable">-U</span> authentik <span class="token operator">&gt;</span> <span class="token variable">$BACKUP_DIR</span>/authentik.sql

<span class="token builtin class-name">echo</span> <span class="token string">"バックアップ完了: <span class="token variable">$BACKUP_DIR</span>"</span></code></pre>
<h3 id="ヘルスチェック">ヘルスチェック</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># docker-compose.yml</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">authelia</span><span class="token punctuation">:</span>
    <span class="token key atrule">healthcheck</span><span class="token punctuation">:</span>
      <span class="token key atrule">test</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"CMD"</span><span class="token punctuation">,</span> <span class="token string">"wget"</span><span class="token punctuation">,</span> <span class="token string">"--no-verbose"</span><span class="token punctuation">,</span> <span class="token string">"--tries=1"</span><span class="token punctuation">,</span> <span class="token string">"--spider"</span><span class="token punctuation">,</span> <span class="token string">"http://localhost:9091/api/health"</span><span class="token punctuation">]</span>
      <span class="token key atrule">interval</span><span class="token punctuation">:</span> 30s
      <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 3s
      <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">3</span></code></pre>
<h2 id="比較：SSO-ソリューション">比較：SSO ソリューション</h2>
<table>
<thead>
<tr>
<th>側面</th>
<th>Authelia</th>
<th>Authentik</th>
<th>Keycloak</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>RAM 使用量</strong></td>
<td>~50MB</td>
<td>~500MB</td>
<td>~1GB</td>
</tr>
<tr>
<td><strong>セットアップ時間</strong></td>
<td>30分</td>
<td>1時間</td>
<td>2時間以上</td>
</tr>
<tr>
<td><strong>設定方法</strong></td>
<td>YAML</td>
<td>Web UI</td>
<td>Web UI</td>
</tr>
<tr>
<td><strong>ユーザーストレージ</strong></td>
<td>ファイル/LDAP</td>
<td>データベース</td>
<td>データベース/LDAP</td>
</tr>
<tr>
<td><strong>OIDC</strong></td>
<td>基本</td>
<td>完全</td>
<td>完全</td>
</tr>
<tr>
<td><strong>SAML</strong></td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td><strong>学習曲線</strong></td>
<td>低</td>
<td>中</td>
<td>高</td>
</tr>
<tr>
<td><strong>コミュニティ</strong></td>
<td>活発</td>
<td>非常に活発</td>
<td>巨大</td>
</tr>
</tbody>
</table>
<h2 id="リソース">リソース</h2>
<ul>
<li>**<a target="_blank" rel="noopener" href="https://www.authelia.com/">Authelia ドキュメント</a>：**完全な Authelia ガイド</li>
<li>**<a target="_blank" rel="noopener" href="https://goauthentik.io/docs/">Authentik ドキュメント</a>：**Authentik のセットアップと設定</li>
<li>**<a target="_blank" rel="noopener" href="https://www.keycloak.org/documentation">Keycloak ドキュメント</a>：**エンタープライズ SSO ガイド</li>
<li>**<a target="_blank" rel="noopener" href="https://openid.net/connect/">OIDC 説明</a>：**OpenID Connect の理解</li>
</ul>

        </div>
        
        <footer class="article-footer">
            
    <a data-url="https://neo01.com/ja/2025/01/Single-Sign-On-at-Home/" data-id="1d4e5330" class="article-share-link"><i class="fa fa-share"></i>シェア</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url').replace("http://","https://"),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
    <!--script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": {
            "@type": "Person",
            "name": "Neo Alienson"
        },
        "headline": "ホームでのシングルサインオンの設定",
        "image": "https://neo01.com",
        "keywords": "Authentication Cybersecurity Homelab",
        "genre": "Cybersecurity",
        "datePublished": "2025-01-15",
        "dateCreated": "2025-01-15",
        "dateModified": "2025-10-23",
        "url": "https://neo01.com//ja/2025/01/Single-Sign-On-at-Home/",
        "description": "ホームラボサービスの数十のパスワード管理に疲れていませんか？シングルサインオンを設定して、1回のログインですべてのサービスにアクセスする方法を学びましょう。",
        "wordCount": 3973
    }
</script-->

</article>

                        </div>
                    </section>
                    
<aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>フォロー:</p>
        <ul class="social-links">
                <li>
                    <a class="social-tooltip" title="stack-exchange" href="https://stackexchange.com/users/2122053/neo?tab=accounts" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-exchange"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="stack-overflow" href="https://stackoverflow.com/users/1885105/neo" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-overflow"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/neoalienson" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-github"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="linkedin" href="https://linkedin.com/in/neo01" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-linkedin"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="rss" href="/atom.xml" target="_blank" rel="noopener">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
        </ul>
    </div>
    <div class="widgets-container">

        
            
                
                <div class="widget-wrap widget-list">
    <h3 class="widget-title">リンク</h3>
    <div class="widget">
        <ul><li><a href="/ja/ai">AI プレイグラウンド</a></li><li><a href="/ja/tools">ツール</a></li><li><a href="/ja/games">ゲーム</a></li><li><a href="/ja/pages/useful-information">役立つ情報</a></li><li><a href="/ja/pages/Hexo-Blogging-Cheatsheet">Hexo ブログチートシート</a></li></ul>
    </div>
</div>

                
            
                
                
                
            
                
                    <div class="widget-wrap">
        <h3 class="widget-title">最新</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                    <li>
                        <div class="item-thumbnail">
                            <a href="/ja/2025/10/How-I-Use-AI-to-Learn/" class="thumbnail">
        <span style="background-image:url(/assets/learning/thumbnail_80.png)" alt="AIを使った学習法：反復的知識構築による個人的な旅" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/ja/categories/AI/">AI</a></p>
                            <p class="item-title"><a href="/ja/2025/10/How-I-Use-AI-to-Learn/" class="title">AIを使った学習法：反復的知識構築による個人的な旅</a></p>
                            <p class="item-date"><time datetime="2025-10-18T16:00:00.000Z" itemprop="datePublished">2025-10-19</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/ja/2025/10/Tools-Games-And-Browser-Built-In-AI/" class="thumbnail">
        <span style="background-image:url(/2025/10/Tools-Games-And-Browser-Built-In-AI/thumbnail.jpeg)" alt="ツール、ゲーム、そしてブラウザ内蔵AIプレイグラウンド" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/ja/categories/AI/">AI</a></p>
                            <p class="item-title"><a href="/ja/2025/10/Tools-Games-And-Browser-Built-In-AI/" class="title">ツール、ゲーム、そしてブラウザ内蔵AIプレイグラウンド</a></p>
                            <p class="item-date"><time datetime="2025-10-01T16:00:00.000Z" itemprop="datePublished">2025-10-02</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/ja/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/" class="thumbnail">
        <span style="background-image:url(/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/thumbnail.jpeg)" alt="エージェントコーディングの台頭：AI駆動のソフトウェアエンジニアリング" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/ja/categories/AI/">AI</a></p>
                            <p class="item-title"><a href="/ja/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/" class="title">エージェントコーディングの台頭：AI駆動のソフトウェアエンジニアリング</a></p>
                            <p class="item-date"><time datetime="2025-09-19T16:00:00.000Z" itemprop="datePublished">2025-09-20</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/ja/2025/08/Understanding_Ephemeral_Ports_Part2/" class="thumbnail">
        <span style="background-image:url(/assets/ports/thumbnail.png)" alt="エフェメラルポートを理解する パート2：サーバーアプリケーションが動的ポートを避けるべき理由" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/ja/categories/Development/">開発</a></p>
                            <p class="item-title"><a href="/ja/2025/08/Understanding_Ephemeral_Ports_Part2/" class="title">エフェメラルポートを理解する パート2：サーバーアプリケーションが動的ポートを避けるべき理由</a></p>
                            <p class="item-date"><time datetime="2025-08-30T16:00:00.000Z" itemprop="datePublished">2025-08-31</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/ja/2025/08/Understanding_Ephemeral_Ports_Part1/" class="thumbnail">
        <span style="background-image:url(/assets/ports/thumbnail.png)" alt="エフェメラルポートを理解する：ネットワーク通信の見えない働き手" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/ja/categories/Development/">開発</a></p>
                            <p class="item-title"><a href="/ja/2025/08/Understanding_Ephemeral_Ports_Part1/" class="title">エフェメラルポートを理解する：ネットワーク通信の見えない働き手</a></p>
                            <p class="item-date"><time datetime="2025-08-29T16:00:00.000Z" itemprop="datePublished">2025-08-30</time></p>
                        </div>
                    </li>
            </ul>
        </div>
    </div>

                
            
                
                
    
    
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">アーカイブ</h3>
        <div class="widget">
            <ul class="archive-list">
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2025/">2025</a>
                    <span class="archive-list-count">72</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2024/">2024</a>
                    <span class="archive-list-count">25</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2023/">2023</a>
                    <span class="archive-list-count">15</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2022/">2022</a>
                    <span class="archive-list-count">18</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2021/">2021</a>
                    <span class="archive-list-count">14</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2020/">2020</a>
                    <span class="archive-list-count">13</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2019/">2019</a>
                    <span class="archive-list-count">12</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2018/">2018</a>
                    <span class="archive-list-count">2</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2017/">2017</a>
                    <span class="archive-list-count">5</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2016/">2016</a>
                    <span class="archive-list-count">4</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2015/">2015</a>
                    <span class="archive-list-count">6</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2014/">2014</a>
                    <span class="archive-list-count">7</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/ja/archives/2013/">2013</a>
                    <span class="archive-list-count">2</span>
                </li>
            
            </ul>
        </div>
    </div>


                
            
        

    </div>
</aside>


                </div>
            </div>
        </div>
        
<footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>

            <div class="qrcode-share-wrapper">
                <div class="qrcode-text">https://neo01.com/l#f54fda09</div>
                <img src="/qr/qr-4bd3c573a592b39682bde4efe033f0c7.svg" width="200" height="200" alt="QR Code for https://neo01.com/l#f54fda09">
            </div>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" title="Homepage" class="logo"></a>
                </h1>
                
                <p>© 2025 Neo Alienson. 全著作権所有.
                  <a href="/ja/terms-and-conditions">利用規約</a></p>
                
            </div>
            <div class="footer-plugins">
              


            </div>
        </div>
    </div>
</footer>

        
        
    
        


        


        


        


        


        


        


        


        


    



<!-- Custom Scripts -->




        
    </div>
<!-- hexo injector body_end start --><script type="text/javascript" src="/js/bundle_last.js"></script><!-- hexo injector body_end end -->

<script>CookieConsent.run({"palette":{"popup":{"background":"#000"},"button":{"background":"#f1d600"}},"guiOptions":{"consentModal":{"layout":"box","position":"bottom right","equalWeightButtons":true,"flipButtons":false},"preferencesModal":{"layout":"box","position":"right","equalWeightButtons":false,"flipButtons":false}},"categories":{"necessary":{"readOnly":true},"functionality":{},"analytics":{}},"language":{"default":"en","autoDetect":"browser","translations":{"en":{"consentModal":{"title":"Hello traveler, it's cookie time!","description":"🍪 This site uses cookies to serve you the best experience—no crumbs left behind! Want to know what cookies really are? Check out this easy-to-understand cookie explanation. And for the legal nitty-gritty, here’s our website cookie policy to keep you in the loop! 🚀\n","acceptAllBtn":"Accept all","acceptNecessaryBtn":"Reject all","showPreferencesBtn":"Manage preferences","footer":"<a href=\"#link\">Privacy Policy</a>\n<a href=\"/terms-and-conditions/\">Terms and conditions</a>\n"},"preferencesModal":{"title":"Consent Preferences Center","acceptAllBtn":"Accept all","acceptNecessaryBtn":"Reject all","savePreferencesBtn":"Save preferences","closeIconLabel":"Close modal","serviceCounterLabel":"Service|Services","sections":[{"title":"Cookie Usage","description":"We use cookies to make your visit smoother, faster, and tailored just for you. Cookies help us remember your preferences, improve site performance, and deliver personalized content while keeping things secure and user-friendly.\n"},{"title":"Strictly Necessary Cookies <span class=\"pm__badge\">Always Enabled</span>","description":"These cookies are essential for the website to function properly. They enable core features like security, page navigation, and access to secure areas. Without these, the site cannot operate correctly.\n","linkedCategory":"necessary"},{"title":"Functionality Cookies","description":"Functionality cookies remember your choices to provide a more personalized experience. For example, they save your language preference or login details so you don’t have to keep entering them each time.\n","linkedCategory":"functionality"},{"title":"Analytics Cookies","description":"Analytics cookies help us understand how visitors interact with our site by collecting information anonymously. This insight allows us to improve functionality, fix issues, and make the website better for you.\n","linkedCategory":"analytics"},{"title":"More information","description":"Please refer to our <a href='/pages/cookie-policy'>cookie policy</a> for full details on how we use cookies and your options to manage them.\n"}]}}}}})</script></body></html>