<!DOCTYPE html><html lang="zh-TW"><head><!-- hexo injector head_begin start --><!-- Google tag (gtag.js) begins-->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3DZR3TQYCY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-3DZR3TQYCY');
    </script>
    <!-- Google tag (gtag.js) ends-->
    <!-- hexo injector head_begin end -->
    <meta charset="utf-8">
    <!-- security headers starts -->
    <!-- meta http-equiv="content-security-policy" content="script-src 'sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=' 'sha256-lJjk3/dvd+wXqRFjV7T5L/nXJXr5NjUjmsKSPEe+ass=';" -->
    <!-- security headers ends -->
    <!-- favicon starts -->    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <!-- favicon ends -->
    

    <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="alternate" href="/atom.xml" title="Decoding Digital Anomalies" type="application/atom+xml">
    

    

    

    

    

    

    

    
    
        


    
    
        


    



    
    <title>理解 OAuth 2.0：驅動現代 API 的授權框架 | Decoding Digital Anomalies</title>
    
    <meta name="keywords" content="API,Authentication,OAuth,Security">
    
    
    <meta name="description" content="OAuth 2.0 實現安全的委託存取而無需共享密碼。了解授權流程如何運作、常見陷阱，以及為什麼 OAuth 不是身份驗證。">
<meta property="og:type" content="article">
<meta property="og:title" content="理解 OAuth 2.0：驅動現代 API 的授權框架">
<meta property="og:url" content="https://neo01.com/zh-TW/2022/08/Understanding-OAuth-2.0/index.html">
<meta property="og:site_name" content="Decoding Digital Anomalies">
<meta property="og:description" content="OAuth 2.0 實現安全的委託存取而無需共享密碼。了解授權流程如何運作、常見陷阱，以及為什麼 OAuth 不是身份驗證。">
<meta property="og:locale" content="zh_TW">
<meta property="article:published_time" content="2022-08-15T16:00:00.000Z">
<meta property="article:modified_time" content="2025-10-29T07:55:12.357Z">
<meta property="article:author" content="Neo Alienson">
<meta property="article:tag" content="API">
<meta property="article:tag" content="Authentication">
<meta property="article:tag" content="OAuth">
<meta property="article:tag" content="Security">
<meta name="twitter:card" content="summary">
    
    <!-- hexo injector head_end start --><link rel="stylesheet" type="text/css" href="/css/bundle.css"><script type="text/javascript" src="/js/bundle_first.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 8.1.0">  <link rel="canonical" href="https://neo01.com/zh-TW/2022/08/Understanding-OAuth-2.0/">
  <link rel="alternate" hreflang="en" data-canonical="true" href="https://neo01.com/2022/08/Understanding-OAuth-2.0/">
  <link rel="alternate" hreflang="zh-TW" href="https://neo01.com/zh-TW/2022/08/Understanding-OAuth-2.0/">
  <link rel="alternate" hreflang="zh-CN" href="https://neo01.com/zh-CN/2022/08/Understanding-OAuth-2.0/">
  <link rel="alternate" hreflang="ja" href="https://neo01.com/ja/2022/08/Understanding-OAuth-2.0/">
<style id="admonition-styles">.admonition {
  margin: 1em 0;
  padding: 0rem;
  border-left: 0.3rem solid;
  border-radius: 0.4rem;
  background-color: #f9f9f9;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
  overflow: hidden;
  page-break-inside: avoid;
}

.admonition-title {
  display: flex;
  align-items: center;
  font-weight: 600;
  padding: 0rem 1rem 0.1rem 0.75rem;
  font-size: 1.05em;
  background-color: rgba(0, 0, 0, 0.03);
  border-top-left-radius: 0.4rem;
  border-top-right-radius: 0.4rem;
  margin: 0 !important;
}

.admonition-icon {
  font-size: 1.2em;
  margin-right: 0.6rem;
  opacity: 0.85;
  margin-top: 0.1rem;
}

/* 内容区域 margin */
.admonition > *:not(.admonition-title) {
  margin: 0.6rem 1rem 0.6rem 1rem;
}

/* NOTE 类型 */
.admonition.anote {
  border-color: #448aff;
}
.admonition.anote > .admonition-title {
  background-color: #448aff1a;
  color: #2962ff;
}

/* INFO / TODO 类型 */
.admonition.info,
.admonition.todo {
  border-color: #00b8d4;
}
.admonition.info > .admonition-title,
.admonition.todo > .admonition-title {
  background-color: rgba(0, 184, 212, 0.1);
  color: #007c91;
}

/* 警告类 */
.admonition.warning,
.admonition.attention,
.admonition.caution {
  border-color: #ff9100;
}
.admonition.warning > .admonition-title,
.admonition.attention > .admonition-title,
.admonition.caution > .admonition-title {
  background-color: rgba(255, 145, 0, 0.1);
  color: #c66900;
}

/* 错误类 */
.admonition.failure,
.admonition.missing,
.admonition.fail,
.admonition.error,
.admonition.danger,
.admonition.bug {
  border-color: #ff5252;
}
.admonition.failure > .admonition-title,
.admonition.missing > .admonition-title,
.admonition.fail > .admonition-title,
.admonition.error > .admonition-title,
.admonition.danger > .admonition-title,
.admonition.bug > .admonition-title {
  background-color: rgba(255, 82, 82, 0.1);
  color: #b71c1c;
}

/* TIP 类型 */
.admonition.tip {
  border-color: #00bfa5;
}
.admonition.tip > .admonition-title {
  background-color: #00bfa51a;
  color: #00796b;
}

/* SUCCESS 类型 */
.admonition.success {
  border-color: #00c853;
}
.admonition.success > .admonition-title {
  background-color: #00c8531a;
  color: #2e7d32;
}

/* QUESTION 类型 */
.admonition.question {
  border-color: #64dd17;
}
.admonition.question > .admonition-title {
  background-color: #64dd171a;
  color: #558b2f;
}

/* EXAMPLE 类型 */
.admonition.example {
  border-color: #7c4dff;
}
.admonition.example > .admonition-title {
  background-color: #7c4dff1a;
  color: #512da8;
}

/* QUOTE 类型 */
.admonition.quote {
  border-color: #9e9e9e;
}
.admonition.quote > .admonition-title {
  background-color: #9e9e9e1a;
  color: #424242;
}

/*黑暗模式*/
/* 夜间模式基础样式 */
[data-theme="dark"] .admonition {
  background-color: #1e1e1e;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
}

[data-theme="dark"] .admonition-title {
  background-color: rgba(255, 255, 255, 0.05);
}

/* anote */
[data-theme="dark"] .admonition.anote {
  border-color: #82b1ff;
}
[data-theme="dark"] .admonition.anote > .admonition-title {
  background-color: #82b1ff1a;
  color: #bbdefb;
}

/* tip */
[data-theme="dark"] .admonition.tip {
  border-color: #64ffda;
}
[data-theme="dark"] .admonition.tip > .admonition-title {
  background-color: #64ffda1a;
  color: #1de9b6;
}

/* success */
[data-theme="dark"] .admonition.success {
  border-color: #69f0ae;
}
[data-theme="dark"] .admonition.success > .admonition-title {
  background-color: #69f0ae1a;
  color: #00e676;
}

/* question */
[data-theme="dark"] .admonition.question {
  border-color: #b2ff59;
}
[data-theme="dark"] .admonition.question > .admonition-title {
  background-color: #b2ff591a;
  color: #aeea00;
}

/* example */
[data-theme="dark"] .admonition.example {
  border-color: #b388ff;
}
[data-theme="dark"] .admonition.example > .admonition-title {
  background-color: #b388ff1a;
  color: #b39ddb;
}

/* quote */
[data-theme="dark"] .admonition.quote {
  border-color: #bdbdbd;
}
[data-theme="dark"] .admonition.quote > .admonition-title {
  background-color: #bdbdbd1a;
  color: #eeeeee;
}

/* warning / attention / caution */
[data-theme="dark"] .admonition.warning,
[data-theme="dark"] .admonition.attention,
[data-theme="dark"] .admonition.caution {
  border-color: #ffb300;
}
[data-theme="dark"] .admonition.warning > .admonition-title,
[data-theme="dark"] .admonition.attention > .admonition-title,
[data-theme="dark"] .admonition.caution > .admonition-title {
  background-color: #ffb3001a;
  color: #ffe082;
}

/* error / fail / failure / bug / danger / missing */
[data-theme="dark"] .admonition.error,
[data-theme="dark"] .admonition.fail,
[data-theme="dark"] .admonition.failure,
[data-theme="dark"] .admonition.bug,
[data-theme="dark"] .admonition.missing,
[data-theme="dark"] .admonition.danger {
  border-color: #ef5350;
}
[data-theme="dark"] .admonition.error > .admonition-title,
[data-theme="dark"] .admonition.fail > .admonition-title,
[data-theme="dark"] .admonition.failure > .admonition-title,
[data-theme="dark"] .admonition.bug > .admonition-title,
[data-theme="dark"] .admonition.missing > .admonition-title,
[data-theme="dark"] .admonition.danger > .admonition-title {
  background-color: #ef53501a;
  color: #ff8a80;
}</style><script id="mermaid-scripts" src="/cache/mermaid.min.local.js"></script>
<script>mermaid.initialize({theme: 'default'});</script></head>

<body>
    <div id="wrap">
        
        
<header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <div class="logo"></div>
                    </h1>

                        <h2 class="subtitle-wrap">
                            <p class="title">解碼數位異象</p>
                          <p class="subtitle">有時功能就是數位兔子洞中的錯誤，反之亦然</p>
                        </h2>




                    <div id="lang-selector">
                        <span class="lang-icon">🌐</span>
                        
                            <a href="#" class="lang-link" data-lang="en">English</a>
<span class="lang-sep">|</span>                            <a href="#" class="lang-link" data-lang="zh-CN">简体中文</a>
<span class="lang-sep">|</span>                            <a href="#" class="lang-link" data-lang="ja">日本語</a>
                        <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            var currentLang = 'zh-TW';
                            var currentPath = window.location.pathname;
                            var basePath;
                            
                            if (currentLang === 'en') {
                                basePath = currentPath;
                            } else {
                                basePath = currentPath.replace(new RegExp('^/' + currentLang + '/'), '/');
                            }
                            
                            document.querySelectorAll('.lang-link').forEach(function(link) {
                                var targetLang = link.getAttribute('data-lang');
                                var targetPath;
                                if (targetLang === 'en') {
                                    targetPath = basePath;
                                } else {
                                    targetPath = '/' + targetLang + basePath;
                                }
                                link.href = targetPath;
                            });
                        });
                        </script>
                    </div>


                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/zh-TW/">首頁</a>
                                </li>
                                                                    <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/AI/">人工智慧</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/AI/Art-Gallery/">藝術畫廊</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Architecture/">架構</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Cybersecurity/">資訊安全</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Development/">開發</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Misc/">雜項</a></li></ul>
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/zh-TW/about-me">關於</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" id="search-form-input" placeholder="搜尋">
        <button type="submit" title="搜尋" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" id="ins-search-input" placeholder="輸入關鍵字...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script integrity="sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=">
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '頁面',
            CATEGORIES: '分類',
            TAGS: '標籤',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
        LANG: 'zh-TW',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>




</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

        
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Development/">Development</a>
    </h1>
</div>

                        <div class="main-body-content">
                            <article id="post-2022/08/Understanding-OAuth-2.0-zh-TW" class="article article-single article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner responsive-content">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        理解 OAuth 2.0：驅動現代 API 的授權框架
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
      <i class="fa fa-calendar"></i>
        
          Created <time datetime="2022-08-15T16:00:00.000Z" itemprop="datePublished">2022-08-16</time>
          &nbsp;<i class="fa fa-calendar"></i>
          Updated <time datetime="2025-10-29T07:55:12.357Z" itemprop="datePublished">2025-10-29</time>
        
    </div>


                

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/zh-TW/tags/Security/">Security</a> <a class="tag-link" href="/zh-TW/tags/Authentication/">Authentication</a> <a class="tag-link" href="/zh-TW/tags/OAuth/">OAuth</a> <a class="tag-link" href="/zh-TW/tags/API/">API</a>
    </div>

            </div>
        
        
        
        <div class="article-entry" itemprop="articleBody">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#OAuth-2-0-%E5%AF%A6%E9%9A%9B%E8%A7%A3%E6%B1%BA%E7%9A%84%E5%95%8F%E9%A1%8C"><span class="toc-text">OAuth 2.0 實際解決的問題</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OAuth-2-0-%E8%A7%92%E8%89%B2%E5%92%8C%E7%B5%84%E4%BB%B6"><span class="toc-text">OAuth 2.0 角色和組件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%88%E6%AC%8A%E7%A2%BC%E6%B5%81%E7%A8%8B%EF%BC%9A%E9%BB%83%E9%87%91%E6%A8%99%E6%BA%96"><span class="toc-text">授權碼流程：黃金標準</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9A%B1%E5%BC%8F%E6%B5%81%E7%A8%8B%EF%BC%9A%E5%B7%B2%E6%A3%84%E7%94%A8%E4%B8%94%E5%8D%B1%E9%9A%AA"><span class="toc-text">隱式流程：已棄用且危險</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PKCE%EF%BC%9A%E4%BF%9D%E8%AD%B7%E5%85%AC%E9%96%8B%E5%AE%A2%E6%88%B6%E7%AB%AF"><span class="toc-text">PKCE：保護公開客戶端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A2%E6%88%B6%E7%AB%AF%E6%86%91%E8%AD%89%E6%B5%81%E7%A8%8B%EF%BC%9A%E6%9C%8D%E5%8B%99%E5%B0%8D%E6%9C%8D%E5%8B%99"><span class="toc-text">客戶端憑證流程：服務對服務</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A6%8B%E7%9A%84-OAuth-%E8%AA%A4%E8%A7%A3"><span class="toc-text">常見的 OAuth 誤解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AC%8A%E6%9D%96%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AF%A6%E5%8B%99"><span class="toc-text">權杖安全最佳實務</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E6%96%B0%E6%95%B4%E7%90%86%E6%AC%8A%E6%9D%96%EF%BC%9A%E5%BB%B6%E9%95%B7%E5%AD%98%E5%8F%96"><span class="toc-text">重新整理權杖：延長存取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B5%90%E8%AB%96"><span class="toc-text">結論</span></a></li></ol>
            <p>OAuth 2.0 已成為 API 授權的事實標準，從社群媒體登入到企業 API 存取無所不在。然而儘管如此普及，OAuth 仍被廣泛誤解。開發者經常混淆授權與身份驗證、錯誤實作流程，或以危害安全的方式誤用存取權杖。</p>
<p>本文透過檢視核心概念、授權流程和安全考量來揭開 OAuth 2.0 的神秘面紗。我們將追蹤權杖在不同授權類型中的旅程，理解各方角色，並識別常見的實作錯誤。透過圖表和真實場景，您將獲得對 OAuth 如何在提供無縫使用者體驗的同時保護資源的實用理解。</p>
<h2 id="OAuth-2-0-實際解決的問題">OAuth 2.0 實際解決的問題</h2>
<p>在 OAuth 之前，需要存取第三方服務上使用者資料的應用程式面臨一個根本問題：它們需要使用者分享密碼。這造成了多重安全性和可用性問題。</p>
<h3 id="OAuth-之前的問題">OAuth 之前的問題</h3>
<p>考慮一個需要存取您儲存在雲端儲存平台上照片的照片列印服務：</p>
<div class="admonition error"><p class="admonition-title"><span class="mdi mdi-alert-circle-outline admonition-icon"></span>🚫 密碼分享問題</p><div class="admonition-content"><p><strong>傳統方法</strong></p>
<ul>
<li>使用者向列印服務提供雲端儲存的使用者名稱和密碼</li>
<li>列印服務儲存憑證（安全風險）</li>
<li>列印服務擁有對所有使用者資料的完整存取權</li>
<li>無法限制存取範圍或持續時間</li>
<li>密碼變更會中斷所有整合服務</li>
<li>無法稽核哪個服務存取了什麼</li>
</ul>
<p><strong>安全影響</strong></p>
<ul>
<li>憑證暴露給第三方</li>
<li>無細粒度權限控制</li>
<li>無法在不變更密碼的情況下撤銷存取權</li>
<li>違反最小權限原則</li>
<li>顯著增加攻擊面</li>
</ul>
</div></div>
<p>OAuth 2.0 透過引入委託授權來解決這個問題：使用者可以在不分享憑證的情況下授予對其資源的有限存取權。</p>
<h3 id="OAuth-的核心創新">OAuth 的核心創新</h3>
<p>OAuth 將身份驗證（證明您是誰）與授權（授予資源存取權）分離：</p>
<div class="admonition success"><p class="admonition-title"><span class="mdi mdi-check-circle-outline admonition-icon"></span>✅ OAuth 授權模型</p><div class="admonition-content"><p><strong>委託存取</strong></p>
<ul>
<li>使用者直接向資源擁有者進行身份驗證（例如雲端儲存）</li>
<li>使用者為第三方應用程式授權特定權限</li>
<li>應用程式接收有時限的存取權杖</li>
<li>權杖僅授予請求的權限</li>
<li>使用者可隨時撤銷存取權而無需變更密碼</li>
</ul>
<p><strong>主要優勢</strong></p>
<ul>
<li>無需密碼分享</li>
<li>細粒度權限範圍</li>
<li>有時限的存取權杖</li>
<li>每個應用程式獨立撤銷</li>
<li>清楚的存取授權稽核軌跡</li>
</ul>
</div></div>
<p>這個模型實現了現代 API 生態系統，讓應用程式能夠無縫整合同時維持安全邊界。</p>
<h2 id="OAuth-2-0-角色和組件">OAuth 2.0 角色和組件</h2>
<p>OAuth 定義了四個參與授權流程的不同角色：</p>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>🎭 OAuth 角色</p><div class="admonition-content"><p><strong>資源擁有者</strong></p>
<ul>
<li>擁有資料的使用者</li>
<li>授權存取其資源</li>
<li>範例：您，授權列印服務存取您的照片</li>
</ul>
<p><strong>客戶端</strong></p>
<ul>
<li>請求存取資源的應用程式</li>
<li>必須向授權伺服器註冊</li>
<li>範例：照片列印服務應用程式</li>
</ul>
<p><strong>授權伺服器</strong></p>
<ul>
<li>在驗證資源擁有者身份後發行存取權杖</li>
<li>驗證授權許可</li>
<li>範例：雲端儲存提供商的 OAuth 伺服器</li>
</ul>
<p><strong>資源伺服器</strong></p>
<ul>
<li>託管受保護的資源</li>
<li>驗證存取權杖並提供請求服務</li>
<li>範例：提供照片檔案的雲端儲存 API</li>
</ul>
</div></div>
<p>這些角色透過一系列明確定義的流程互動，每個流程都針對不同的應用程式類型和安全需求進行最佳化。</p>
<h2 id="授權碼流程：黃金標準">授權碼流程：黃金標準</h2>
<p>授權碼流程是最安全的 OAuth 流程，建議用於能夠安全儲存客戶端密鑰的應用程式。</p>
<h3 id="流程概覽">流程概覽</h3>
<div class="mermaid">sequenceDiagram
    participant User as 👤 資源擁有者
    participant Browser as 🌐 瀏覽器
    participant Client as 📱 客戶端應用程式
    participant AuthServer as 🔐 授權伺服器
    participant ResourceServer as 💾 資源伺服器

    User-&gt;&gt;Browser: 1. 點擊「連接帳戶」
    Browser-&gt;&gt;AuthServer: 2. 授權請求<br>(client_id, redirect_uri, scope)
    AuthServer-&gt;&gt;User: 3. 顯示登入和同意畫面
    User-&gt;&gt;AuthServer: 4. 驗證身份並核准
    AuthServer-&gt;&gt;Browser: 5. 重新導向並附帶授權碼
    Browser-&gt;&gt;Client: 6. 授權碼
    Client-&gt;&gt;AuthServer: 7. 交換授權碼取得權杖<br>(code, client_id, client_secret)
    AuthServer-&gt;&gt;Client: 8. 存取權杖 + 重新整理權杖
    Client-&gt;&gt;ResourceServer: 9. 使用存取權杖的 API 請求
    ResourceServer-&gt;&gt;Client: 10. 受保護的資源資料</div>
<h3 id="逐步分解">逐步分解</h3>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>📋 授權碼流程步驟</p><div class="admonition-content"><p><strong>1. 使用者啟動授權</strong></p>
<ul>
<li>使用者在客戶端應用程式中點擊「使用 [服務] 連接」</li>
<li>客戶端將使用者重新導向至授權伺服器</li>
</ul>
<p><strong>2. 授權請求</strong>
</p><pre class="language-none"><code class="language-none">GET /authorize?<p></p>
</code></pre></div></div><code class="language-none">

  response_type=code&amp;
  client_id=CLIENT_ID&amp;
  redirect_uri=https://client.app/callback&amp;
  scope=read:photos&amp;
  state=RANDOM_STRING</code>
    - `response_type=code`：請求授權碼
    - `client_id`：識別客戶端應用程式
    - `redirect_uri`：發送授權碼的位置
    - `scope`：請求的權限
    - `state`：CSRF 保護權杖
<pre><code>**3. 使用者身份驗證和同意**
- 授權伺服器驗證使用者身份（登入畫面）
- 顯示包含請求權限的同意畫面
- 使用者核准或拒絕存取

**4. 發行授權碼**
<pre class="language-none"><code class="language-none">HTTP/1.1 302 Found
Location: https://client.app/callback?
  code=AUTHORIZATION_CODE&amp;
  state=RANDOM_STRING</code></pre>
- 短期授權碼（通常 10 分鐘）
- 透過瀏覽器重新導向回傳
- 僅限單次使用

**5. 權杖交換**
<pre class="language-none"><code class="language-none">POST /token
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&amp;
code=AUTHORIZATION_CODE&amp;
redirect_uri=https://client.app/callback&amp;
client_id=CLIENT_ID&amp;
client_secret=CLIENT_SECRET</code></pre>
- 客戶端交換授權碼取得權杖
- 包含客戶端密鑰（伺服器對伺服器）
- 授權碼被消耗並失效

**6. 存取權杖回應**
<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"access_token"</span><span class="token operator">:</span> <span class="token string">"eyJhbGciOiJSUzI1NiIs..."</span><span class="token punctuation">,</span>
  <span class="token property">"token_type"</span><span class="token operator">:</span> <span class="token string">"Bearer"</span><span class="token punctuation">,</span>
  <span class="token property">"expires_in"</span><span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span>
  <span class="token property">"refresh_token"</span><span class="token operator">:</span> <span class="token string">"tGzv3JOkF0XG5Qx2TlKWIA"</span><span class="token punctuation">,</span>
  <span class="token property">"scope"</span><span class="token operator">:</span> <span class="token string">"read:photos"</span>
<span class="token punctuation">}</span></code></pre>
- 用於 API 請求的存取權杖
- 用於取得新存取權杖的重新整理權杖
- 以秒為單位的過期時間

**7. API 存取**
<pre class="language-none"><code class="language-none">GET /api/photos
Authorization: Bearer eyJhbGciOiJSUzI1NiIs...</code></pre>
- 客戶端在請求中包含存取權杖
- 資源伺服器驗證權杖
- 回傳受保護的資源
</code></pre>
<h3 id="為什麼這個流程是安全的">為什麼這個流程是安全的</h3>
<p>授權碼流程提供多層安全保護：</p>
<div class="admonition success"><p class="admonition-title"><span class="mdi mdi-check-circle-outline admonition-icon"></span>🔒 安全功能</p><div class="admonition-content"><p><strong>關注點分離</strong></p>
<ul>
<li>授權碼暴露給瀏覽器（較不敏感）</li>
<li>存取權杖從不暴露給瀏覽器</li>
<li>客戶端密鑰僅用於伺服器對伺服器通訊</li>
</ul>
<p><strong>短期憑證</strong></p>
<ul>
<li>授權碼快速過期（10 分鐘）</li>
<li>授權碼僅限單次使用</li>
<li>存取權杖有時限（通常 1 小時）</li>
</ul>
<p><strong>CSRF 保護</strong></p>
<ul>
<li>state 參數防止跨站請求偽造</li>
<li>客戶端驗證 state 符合原始請求</li>
</ul>
<p><strong>客戶端身份驗證</strong></p>
<ul>
<li>客戶端密鑰在權杖交換期間證明客戶端身份</li>
<li>防止授權碼攔截攻擊</li>
</ul>
</div></div>
<p>這個流程適用於網路應用程式、具有後端伺服器的行動應用程式，以及任何能夠保護客戶端密鑰的場景。</p>
<h2 id="隱式流程：已棄用且危險">隱式流程：已棄用且危險</h2>
<p>隱式流程是為無法安全儲存客戶端密鑰的瀏覽器應用程式設計的。然而，由於安全漏洞，它已被棄用。</p>
<h3 id="隱式流程如何運作">隱式流程如何運作</h3>
<div class="mermaid">sequenceDiagram
    participant User as 👤 資源擁有者
    participant Browser as 🌐 瀏覽器/SPA
    participant AuthServer as 🔐 授權伺服器
    participant ResourceServer as 💾 資源伺服器

    User-&gt;&gt;Browser: 1. 點擊「登入」
    Browser-&gt;&gt;AuthServer: 2. 授權請求<br>(response_type=token)
    AuthServer-&gt;&gt;User: 3. 驗證身份並同意
    AuthServer-&gt;&gt;Browser: 4. 重新導向並附帶存取權杖<br>(在 URL 片段中)
    Browser-&gt;&gt;Browser: 5. 從 URL 提取權杖
    Browser-&gt;&gt;ResourceServer: 6. 使用權杖的 API 請求
    ResourceServer-&gt;&gt;Browser: 7. 受保護的資源</div>
<h3 id="為什麼隱式流程被棄用">為什麼隱式流程被棄用</h3>
<div class="admonition error"><p class="admonition-title"><span class="mdi mdi-alert-circle-outline admonition-icon"></span>🚫 隱式流程安全問題</p><div class="admonition-content"><p><strong>存取權杖暴露</strong></p>
<ul>
<li>權杖在 URL 片段中回傳</li>
<li>在瀏覽器歷史記錄中可見</li>
<li>記錄在伺服器存取日誌中</li>
<li>暴露給瀏覽器擴充功能</li>
<li>容易受到 XSS 攻擊</li>
</ul>
<p><strong>無客戶端身份驗證</strong></p>
<ul>
<li>無客戶端密鑰驗證</li>
<li>無法驗證客戶端身份</li>
<li>更容易偽裝客戶端</li>
</ul>
<p><strong>無重新整理權杖</strong></p>
<ul>
<li>無法安全發行重新整理權杖</li>
<li>權杖過期時使用者必須重新驗證</li>
<li>使用者體驗不佳</li>
</ul>
<p><strong>權杖洩漏途徑</strong></p>
<ul>
<li>Referrer 標頭可能洩漏權杖</li>
<li>瀏覽器歷史記錄儲存權杖</li>
<li>共用電腦暴露權杖</li>
<li>無安全儲存機制</li>
</ul>
</div></div>
<p>現代應用程式應該使用帶有 PKCE 的授權碼流程。</p>
<h2 id="PKCE：保護公開客戶端">PKCE：保護公開客戶端</h2>
<p>代碼交換證明金鑰（PKCE，發音為「pixie」）擴展了授權碼流程，以保護無法儲存密鑰的公開客戶端。</p>
<h3 id="公開客戶端問題">公開客戶端問題</h3>
<p>行動應用程式和單頁應用程式面臨根本挑戰：</p>
<div class="admonition warning"><p class="admonition-title"><span class="mdi mdi-alert-outline admonition-icon"></span>⚠️ 公開客戶端挑戰</p><div class="admonition-content"><p><strong>無法安全儲存密鑰</strong></p>
<ul>
<li>行動應用程式代碼可以被反編譯</li>
<li>JavaScript 原始碼在瀏覽器中可見</li>
<li>無客戶端密鑰的安全儲存</li>
<li>密鑰會暴露給所有使用者</li>
</ul>
<p><strong>授權碼攔截</strong></p>
<ul>
<li>惡意應用程式可以註冊相同的重新導向 URI</li>
<li>授權碼被攻擊者攔截</li>
<li>攻擊者交換授權碼取得權杖</li>
<li>無客戶端密鑰來防止這種情況</li>
</ul>
</div></div>
<p>PKCE 透過添加無法預先提取的動態、每次請求密鑰來解決這個問題。</p>
<h3 id="PKCE-流程">PKCE 流程</h3>
<div class="mermaid">sequenceDiagram
    participant User as 👤 資源擁有者
    participant Client as 📱 行動應用程式/SPA
    participant AuthServer as 🔐 授權伺服器
    participant ResourceServer as 💾 資源伺服器

    Client-&gt;&gt;Client: 1. 產生 code_verifier<br>(隨機字串)
    Client-&gt;&gt;Client: 2. 建立 code_challenge<br>(驗證器的 SHA256 雜湊)
    User-&gt;&gt;Client: 3. 啟動登入
    Client-&gt;&gt;AuthServer: 4. 授權請求<br>(code_challenge, method)
    AuthServer-&gt;&gt;User: 5. 驗證身份並同意
    AuthServer-&gt;&gt;Client: 6. 授權碼
    Client-&gt;&gt;AuthServer: 7. 權杖請求<br>(code, code_verifier)
    AuthServer-&gt;&gt;AuthServer: 8. 驗證 code_challenge<br>符合 code_verifier
    AuthServer-&gt;&gt;Client: 9. 存取權杖
    Client-&gt;&gt;ResourceServer: 10. API 請求
    ResourceServer-&gt;&gt;Client: 11. 受保護的資源</div>
<h3 id="PKCE-實作細節">PKCE 實作細節</h3>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>🔐 PKCE 參數</p><div class="admonition-content"><p><strong>代碼驗證器</strong></p>
<ul>
<li>隨機字串：43-128 個字元</li>
<li>密碼學隨機</li>
<li>每次授權請求都重新產生</li>
<li>範例：<code>dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk</code></li>
</ul>
<p><strong>代碼挑戰</strong></p>
<ul>
<li>代碼驗證器的 SHA256 雜湊（建議）</li>
<li>或純文字代碼驗證器（不建議）</li>
<li>在授權請求中發送</li>
<li>範例：<code>E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM</code></li>
</ul>
<p><strong>授權請求</strong>
</p><pre class="language-none"><code class="language-none">GET /authorize?<p></p>
</code></pre></div></div><code class="language-none">

  response_type=code&amp;
  client_id=CLIENT_ID&amp;
  redirect_uri=https://app.example.com/callback&amp;
  scope=read:photos&amp;
  code_challenge=E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM&amp;
  code_challenge_method=S256</code>
<pre><code>**權杖請求**
<pre class="language-none"><code class="language-none">POST /token

grant_type=authorization_code&amp;
code=AUTHORIZATION_CODE&amp;
redirect_uri=https://app.example.com/callback&amp;
client_id=CLIENT_ID&amp;
code_verifier=dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk</code></pre>

**伺服器驗證**
<pre class="language-none"><code class="language-none">SHA256(code_verifier) == stored_code_challenge</code></pre>
- 授權伺服器將 code_challenge 與授權碼一起儲存
- 在權杖交換期間驗證 code_verifier 符合
- 防止授權碼攔截攻擊
</code></pre>
<h3 id="為什麼-PKCE-有效">為什麼 PKCE 有效</h3>
<div class="admonition success"><p class="admonition-title"><span class="mdi mdi-check-circle-outline admonition-icon"></span>✅ PKCE 安全優勢</p><div class="admonition-content"><p><strong>動態密鑰</strong></p>
<ul>
<li>每次請求產生代碼驗證器</li>
<li>無法從應用程式預先提取</li>
<li>攻擊者無法預測或重複使用驗證器</li>
</ul>
<p><strong>授權碼綁定</strong></p>
<ul>
<li>代碼挑戰將授權碼綁定到客戶端實例</li>
<li>被攔截的授權碼在沒有代碼驗證器的情況下無用</li>
<li>只有啟動流程的客戶端才能交換授權碼</li>
</ul>
<p><strong>無需儲存密鑰</strong></p>
<ul>
<li>不需要客戶端密鑰</li>
<li>對行動應用程式和 SPA 安全</li>
<li>在不儲存密鑰的情況下維持安全性</li>
</ul>
<p><strong>向後相容</strong></p>
<ul>
<li>與現有 OAuth 伺服器相容（如果支援）</li>
<li>可與客戶端密鑰一起使用</li>
<li>現在建議所有 OAuth 客戶端使用</li>
</ul>
</div></div>
<p>PKCE 現在建議所有 OAuth 客戶端使用，包括能夠儲存密鑰的機密客戶端，作為額外的安全層。</p>
<h2 id="客戶端憑證流程：服務對服務">客戶端憑證流程：服務對服務</h2>
<p>客戶端憑證流程是為不涉及使用者的機器對機器通訊設計的。</p>
<h3 id="何時使用客戶端憑證">何時使用客戶端憑證</h3>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>🤖 客戶端憑證使用案例</p><div class="admonition-content"><p><strong>後端服務</strong></p>
<ul>
<li>微服務之間的通訊</li>
<li>存取 API 的排程作業</li>
<li>伺服器對伺服器整合</li>
<li>不需要使用者上下文</li>
</ul>
<p><strong>特徵</strong></p>
<ul>
<li>客戶端代表自己行動</li>
<li>不涉及資源擁有者</li>
<li>客戶端憑證就是授權</li>
<li>通常是長期或快取的權杖</li>
</ul>
</div></div>
<h3 id="客戶端憑證流程">客戶端憑證流程</h3>
<div class="mermaid">sequenceDiagram
    participant Client as 🖥️ 客戶端服務
    participant AuthServer as 🔐 授權伺服器
    participant ResourceServer as 💾 資源伺服器

    Client-&gt;&gt;AuthServer: 1. 權杖請求<br>(client_id, client_secret, scope)
    AuthServer-&gt;&gt;AuthServer: 2. 驗證客戶端憑證
    AuthServer-&gt;&gt;Client: 3. 存取權杖
    Client-&gt;&gt;ResourceServer: 4. 使用權杖的 API 請求
    ResourceServer-&gt;&gt;Client: 5. 受保護的資源</div>
<h3 id="實作">實作</h3>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>📋 客戶端憑證請求</p><div class="admonition-content"><p><strong>權杖請求</strong>
</p><pre class="language-none"><code class="language-none">POST /token<p></p>
</code></pre></div></div><code class="language-none">

Content-Type: application/x-www-form-urlencoded

grant_type=client_credentials&amp;
client_id=CLIENT_ID&amp;
client_secret=CLIENT_SECRET&amp;
scope=api:read api:write</code>
<pre><code>**權杖回應**
<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"access_token"</span><span class="token operator">:</span> <span class="token string">"eyJhbGciOiJSUzI1NiIs..."</span><span class="token punctuation">,</span>
  <span class="token property">"token_type"</span><span class="token operator">:</span> <span class="token string">"Bearer"</span><span class="token punctuation">,</span>
  <span class="token property">"expires_in"</span><span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span>
  <span class="token property">"scope"</span><span class="token operator">:</span> <span class="token string">"api:read api:write"</span>
<span class="token punctuation">}</span></code></pre>

**API 請求**
<pre class="language-none"><code class="language-none">GET /api/resources
Authorization: Bearer eyJhbGciOiJSUzI1NiIs...</code></pre>
</code></pre>
<p>這個流程很直接，但需要安全儲存客戶端憑證，且應該只用於服務對服務通訊。</p>
<h2 id="常見的-OAuth-誤解">常見的 OAuth 誤解</h2>
<p>OAuth 經常被誤解，導致安全漏洞和實作錯誤。</p>
<h3 id="OAuth-不是身份驗證">OAuth 不是身份驗證</h3>
<p>最常見的誤解是 OAuth 提供身份驗證。它並不提供。</p>
<div class="admonition error"><p class="admonition-title"><span class="mdi mdi-alert-circle-outline admonition-icon"></span>🚫 OAuth ≠ 身份驗證</p><div class="admonition-content"><p><strong>OAuth 提供什麼</strong></p>
<ul>
<li>授權：存取資源的權限</li>
<li>委託的 API 存取</li>
<li>範圍權限</li>
</ul>
<p><strong>OAuth 不提供什麼</strong></p>
<ul>
<li>使用者身份驗證</li>
<li>使用者身份驗證</li>
<li>身份資訊</li>
</ul>
<p><strong>問題</strong></p>
<ul>
<li>存取權杖證明授權，不是身份</li>
<li>權杖可能發行給不同使用者</li>
<li>沒有標準方式取得使用者資訊</li>
<li>容易受到權杖替換攻擊</li>
</ul>
</div></div>
<h3 id="「使用-OAuth-登入」反模式">「使用 OAuth 登入」反模式</h3>
<p>許多應用程式僅使用 OAuth 實作「使用 [服務] 登入」：</p>
<div class="admonition warning"><p class="admonition-title"><span class="mdi mdi-alert-outline admonition-icon"></span>⚠️ 不安全的 OAuth 登入模式</p><div class="admonition-content"><p><strong>有缺陷的實作</strong>
</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 不安全：不要這樣做</span><p></p>
</code></pre></div></div><code class="language-javascript">

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/callback'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> code <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">exchangeCodeForToken</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 假設權杖屬於合法使用者</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUserFromToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>userId <span class="token operator">=</span> user<span class="token punctuation">.</span>id<span class="token punctuation">;</span> <span class="token comment">// 有漏洞</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>
<pre><code>**攻擊場景**
- 攻擊者取得其帳戶的有效存取權杖
- 攻擊者誘騙受害者使用攻擊者的權杖
- 受害者以攻擊者身份登入
- 受害者的行動歸因於攻擊者的帳戶
- 資料洩漏和帳戶混淆
</code></pre>
<h3 id="使用-OpenID-Connect-進行身份驗證">使用 OpenID Connect 進行身份驗證</h3>
<p>OpenID Connect (OIDC) 擴展 OAuth 2.0 以提供身份驗證：</p>
<div class="admonition success"><p class="admonition-title"><span class="mdi mdi-check-circle-outline admonition-icon"></span>✅ OpenID Connect 解決方案</p><div class="admonition-content"><p><strong>OIDC 添加什麼</strong></p>
<ul>
<li>ID 權杖：包含使用者身份聲明的 JWT</li>
<li>UserInfo 端點：標準化的使用者資訊</li>
<li>身份驗證驗證</li>
<li>標準化聲明（sub、name、email 等）</li>
</ul>
<p><strong>安全實作</strong>
</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 安全：使用 OpenID Connect</span><p></p>
</code></pre></div></div><code class="language-javascript">

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/callback'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> code <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
  <span class="token keyword">const</span> tokens <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">exchangeCodeForTokens</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 驗證 ID 權杖簽名和聲明</span>
  <span class="token keyword">const</span> idToken <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">verifyIdToken</span><span class="token punctuation">(</span>tokens<span class="token punctuation">.</span>id_token<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ID 權杖包含已驗證的使用者身份</span>
  req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>userId <span class="token operator">=</span> idToken<span class="token punctuation">.</span>sub<span class="token punctuation">;</span>
  req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>email <span class="token operator">=</span> idToken<span class="token punctuation">.</span>email<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>
<pre><code>**ID 權杖結構**
<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"iss"</span><span class="token operator">:</span> <span class="token string">"https://auth.example.com"</span><span class="token punctuation">,</span>
  <span class="token property">"sub"</span><span class="token operator">:</span> <span class="token string">"user123"</span><span class="token punctuation">,</span>
  <span class="token property">"aud"</span><span class="token operator">:</span> <span class="token string">"client_id"</span><span class="token punctuation">,</span>
  <span class="token property">"exp"</span><span class="token operator">:</span> <span class="token number">1661529600</span><span class="token punctuation">,</span>
  <span class="token property">"iat"</span><span class="token operator">:</span> <span class="token number">1661526000</span><span class="token punctuation">,</span>
  <span class="token property">"email"</span><span class="token operator">:</span> <span class="token string">"user@example.com"</span><span class="token punctuation">,</span>
  <span class="token property">"email_verified"</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span></code></pre>
</code></pre>
<p>使用 OAuth 2.0 進行 API 授權。使用 OpenID Connect 進行使用者身份驗證。</p>
<h2 id="權杖安全最佳實務">權杖安全最佳實務</h2>
<p>存取權杖是持有者權杖——任何擁有權杖的人都可以使用它。適當的權杖處理至關重要。</p>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>🔒 權杖安全指南</p><div class="admonition-content"><p><strong>儲存</strong></p>
<ul>
<li>永遠不要將權杖儲存在 localStorage（容易受到 XSS 攻擊）</li>
<li>對網路應用程式使用 httpOnly cookies</li>
<li>在行動裝置上使用安全儲存 API（Keychain、KeyStore）</li>
<li>如果儲存在資料庫中，請加密權杖</li>
</ul>
<p><strong>傳輸</strong></p>
<ul>
<li>始終使用 HTTPS/TLS</li>
<li>在 Authorization 標頭中包含權杖，不要在 URL 中</li>
<li>永遠不要在應用程式日誌中記錄權杖</li>
<li>避免在查詢參數中發送權杖</li>
</ul>
<p><strong>驗證</strong></p>
<ul>
<li>驗證權杖簽名（對於 JWT）</li>
<li>檢查權杖過期</li>
<li>驗證權杖受眾和發行者</li>
<li>驗證權杖範圍符合所需權限</li>
</ul>
<p><strong>生命週期管理</strong></p>
<ul>
<li>使用短期存取權杖（通常 1 小時）</li>
<li>實作重新整理權杖輪換</li>
<li>登出時撤銷權杖</li>
<li>監控權杖重複使用嘗試</li>
</ul>
<p><strong>範圍原則</strong></p>
<ul>
<li>請求最少必要的範圍</li>
<li>在資源伺服器上驗證範圍</li>
<li>不要授予過多權限</li>
<li>實作基於範圍的存取控制</li>
</ul>
</div></div>
<h2 id="重新整理權杖：延長存取">重新整理權杖：延長存取</h2>
<p>重新整理權杖實現長期存取，而無需使用者頻繁重新驗證。</p>
<h3 id="重新整理權杖流程">重新整理權杖流程</h3>
<div class="mermaid">sequenceDiagram
    participant Client as 📱 客戶端應用程式
    participant AuthServer as 🔐 授權伺服器
    participant ResourceServer as 💾 資源伺服器

    Client-&gt;&gt;ResourceServer: 1. 使用存取權杖的 API 請求
    ResourceServer-&gt;&gt;Client: 2. 401 未授權（權杖過期）
    Client-&gt;&gt;AuthServer: 3. 重新整理權杖請求<br>(refresh_token, client_id)
    AuthServer-&gt;&gt;AuthServer: 4. 驗證重新整理權杖
    AuthServer-&gt;&gt;Client: 5. 新存取權杖 + 新重新整理權杖
    Client-&gt;&gt;ResourceServer: 6. 使用新權杖的 API 請求
    ResourceServer-&gt;&gt;Client: 7. 受保護的資源</div>
<h3 id="重新整理權杖安全">重新整理權杖安全</h3>
<div class="admonition warning"><p class="admonition-title"><span class="mdi mdi-alert-outline admonition-icon"></span>⚠️ 重新整理權杖風險</p><div class="admonition-content"><p><strong>高價值目標</strong></p>
<ul>
<li>長期憑證（數天到數月）</li>
<li>可以產生新的存取權杖</li>
<li>對攻擊者比存取權杖更有價值</li>
<li>需要更強的保護</li>
</ul>
<p><strong>安全措施</strong></p>
<ul>
<li>重新整理權杖輪換：每次使用時發行新的重新整理權杖</li>
<li>偵測重新整理權杖重複使用（表示被盜）</li>
<li>將重新整理權杖綁定到客戶端</li>
<li>在可疑活動時撤銷權杖系列</li>
<li>安全儲存重新整理權杖（加密）</li>
<li>實作重新整理權杖過期</li>
</ul>
<p><strong>重新整理權杖輪換</strong>
</p><pre class="language-none"><code class="language-none">請求：  refresh_token=OLD_TOKEN<p></p>
</code></pre></div></div><code class="language-none">

回應：   access_token=NEW_ACCESS
        refresh_token=NEW_REFRESH

舊重新整理權杖立即失效
重複使用舊權杖觸發安全警報</code>
<p>重新整理權杖輪換現在被認為是最佳實務，防止權杖重放攻擊並限制權杖被盜的損害。</p>
<h2 id="結論">結論</h2>
<p>OAuth 2.0 提供了一個強大的委託授權框架，使應用程式能夠在不分享密碼的情況下存取使用者資源。透過將授權與身份驗證分離，OAuth 創建了清楚的安全邊界，同時實現了現代 API 生態系統。</p>
<p>帶有 PKCE 的授權碼流程代表了大多數應用程式的當前最佳實務，為機密和公開客戶端提供強大的安全性。已棄用的隱式流程應該完全避免。客戶端憑證流程服務於不涉及使用者的機器對機器場景。每個流程都解決特定的安全需求和應用程式架構。</p>
<p>理解 OAuth 提供授權而非身份驗證是至關重要的。需要使用者身份驗證的應用程式應該使用 OpenID Connect，它以標準化身份驗證擴展 OAuth。將 OAuth 存取權杖視為身份證明會造成嚴重的安全漏洞。</p>
<p>權杖安全需要仔細注意儲存、傳輸、驗證和生命週期管理。存取權杖應該是短期的，透過 HTTPS 傳輸，並安全儲存。重新整理權杖作為長期且強大的憑證，需要更強的保護，包括輪換和重複使用偵測。</p>
<p>OAuth 2.0 不是單一協定，而是為不同場景提供多種流程的框架。選擇適當的流程、正確實作，並遵循安全最佳實務，對於建構安全、使用者友善的應用程式至關重要。OAuth 的複雜性反映了它所解決的安全問題的複雜性——在不分享憑證的情況下進行委託存取本質上是具有挑戰性的，而 OAuth 為這些挑戰提供了經過實戰考驗的解決方案。</p>
<!-- commentbox plugin begins -->
    <div class="commentbox"></div>
    <script src="https://unpkg.com/commentbox.io/dist/commentBox.min.js"></script>
    <script>commentBox('5765834504929280-proj')</script>
    <!-- commentbox plugin ends -->
    
        </div>
        
        <footer class="article-footer">
            
    <a data-url="https://neo01.com/zh-TW/2022/08/Understanding-OAuth-2.0/" data-id="7a1fc274" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url').replace("http://","https://"),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
    <!--script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": {
            "@type": "Person",
            "name": "Neo Alienson"
        },
        "headline": "理解 OAuth 2.0：驅動現代 API 的授權框架",
        "image": "https://neo01.com",
        "keywords": "API Authentication OAuth Security",
        "genre": "Development",
        "datePublished": "2022-08-16",
        "dateCreated": "2022-08-16",
        "dateModified": "2025-10-29",
        "url": "https://neo01.com//zh-TW/2022/08/Understanding-OAuth-2.0/",
        "description": "OAuth 2.0 實現安全的委託存取而無需共享密碼。了解授權流程如何運作、常見陷阱，以及為什麼 OAuth 不是身份驗證。",
        "wordCount": 1382
    }
</script-->

</article>

                        </div>
                    </section>
                    
<aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>追蹤 :</p>
        <ul class="social-links">
                <li>
                    <a class="social-tooltip" title="stack-exchange" href="https://stackexchange.com/users/2122053/neo?tab=accounts" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-exchange"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="stack-overflow" href="https://stackoverflow.com/users/1885105/neo" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-overflow"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/neoalienson" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-github"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="linkedin" href="https://linkedin.com/in/neo01" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-linkedin"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="rss" href="/atom.xml" target="_blank" rel="noopener">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
        </ul>
    </div>
    <div class="widgets-container">

        
            
                
                <div class="widget-wrap widget-list">
    <h3 class="widget-title">連結</h3>
    <div class="widget">
        <ul><li><a href="/zh-TW/ai">AI 遊樂場</a></li><li><a href="/zh-TW/tools">工具</a></li><li><a href="/zh-TW/games">遊戲</a></li><li><a href="/zh-TW/pages/useful-information">實用資訊</a></li><li><a href="/zh-TW/pages/Hexo-Blogging-Cheatsheet">Hexo 部落格速查表</a></li></ul>
    </div>
</div>

                
            
                
                
                
            
                
                    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/10/How-I-Use-AI-to-Learn/" class="thumbnail">
        <span style="background-image:url(/assets/learning/thumbnail_80.png)" alt="我如何使用 AI 學習：透過迭代知識建構的個人旅程" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/AI/">人工智慧</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/10/How-I-Use-AI-to-Learn/" class="title">我如何使用 AI 學習：透過迭代知識建構的個人旅程</a></p>
                            <p class="item-date"><time datetime="2025-10-18T16:00:00.000Z" itemprop="datePublished">2025-10-19</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/10/Tools-Games-And-Browser-Built-In-AI/" class="thumbnail">
        <span style="background-image:url(/2025/10/Tools-Games-And-Browser-Built-In-AI/thumbnail.jpeg)" alt="工具、遊戲與瀏覽器內建 AI 遊樂場" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/AI/">人工智慧</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/10/Tools-Games-And-Browser-Built-In-AI/" class="title">工具、遊戲與瀏覽器內建 AI 遊樂場</a></p>
                            <p class="item-date"><time datetime="2025-10-01T16:00:00.000Z" itemprop="datePublished">2025-10-02</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/" class="thumbnail">
        <span style="background-image:url(/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/thumbnail.jpeg)" alt="代理式編碼的崛起：AI 驅動的軟體工程" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/AI/">人工智慧</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/" class="title">代理式編碼的崛起：AI 驅動的軟體工程</a></p>
                            <p class="item-date"><time datetime="2025-09-19T16:00:00.000Z" itemprop="datePublished">2025-09-20</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports_Part2/" class="thumbnail">
        <span style="background-image:url(/assets/ports/thumbnail.png)" alt="理解臨時埠 Part 2：為什麼伺服器應用程式應避免使用動態埠" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/Development/">開發</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports_Part2/" class="title">理解臨時埠 Part 2：為什麼伺服器應用程式應避免使用動態埠</a></p>
                            <p class="item-date"><time datetime="2025-08-30T16:00:00.000Z" itemprop="datePublished">2025-08-31</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports_Part1/" class="thumbnail">
        <span style="background-image:url(/assets/ports/thumbnail.png)" alt="理解臨時埠：網路通訊的隱形工作者" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/Development/">開發</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports_Part1/" class="title">理解臨時埠：網路通訊的隱形工作者</a></p>
                            <p class="item-date"><time datetime="2025-08-29T16:00:00.000Z" itemprop="datePublished">2025-08-30</time></p>
                        </div>
                    </li>
            </ul>
        </div>
    </div>

                
            
                
                
    
    
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">所有文章</h3>
        <div class="widget">
            <ul class="archive-list">
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2025/">2025</a>
                    <span class="archive-list-count">72</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2024/">2024</a>
                    <span class="archive-list-count">25</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2023/">2023</a>
                    <span class="archive-list-count">15</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2022/">2022</a>
                    <span class="archive-list-count">18</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2021/">2021</a>
                    <span class="archive-list-count">14</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2020/">2020</a>
                    <span class="archive-list-count">13</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2019/">2019</a>
                    <span class="archive-list-count">12</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2018/">2018</a>
                    <span class="archive-list-count">2</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2017/">2017</a>
                    <span class="archive-list-count">5</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2016/">2016</a>
                    <span class="archive-list-count">4</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2015/">2015</a>
                    <span class="archive-list-count">6</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2014/">2014</a>
                    <span class="archive-list-count">7</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2013/">2013</a>
                    <span class="archive-list-count">2</span>
                </li>
            
            </ul>
        </div>
    </div>


                
            
        

    </div>
</aside>


                </div>
            </div>
        </div>
        
<footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>

            <div class="qrcode-share-wrapper">
                <div class="qrcode-text">https://neo01.com/l#b3cc4d0f</div>
                <img src="/qr/qr-0c5bfef30c8f31fb1d5be4f6c4307ac6.svg" width="200" height="200" alt="QR Code for https://neo01.com/l#b3cc4d0f">
            </div>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" title="Homepage" class="logo"></a>
                </h1>
                
                <p>© 2025 Neo Alienson. 版權所有.
                  <a href="/zh-TW/terms-and-conditions">使用條款</a></p>
                
            </div>
            <div class="footer-plugins">
              


            </div>
        </div>
    </div>
</footer>

        
        
    
        


        


        


        


        


        


        


        


        


    



<!-- Custom Scripts -->




        
    </div>
<!-- hexo injector body_end start --><script type="text/javascript" src="/js/bundle_last.js"></script><!-- hexo injector body_end end -->

<script>CookieConsent.run({"palette":{"popup":{"background":"#000"},"button":{"background":"#f1d600"}},"guiOptions":{"consentModal":{"layout":"box","position":"bottom right","equalWeightButtons":true,"flipButtons":false},"preferencesModal":{"layout":"box","position":"right","equalWeightButtons":false,"flipButtons":false}},"categories":{"necessary":{"readOnly":true},"functionality":{},"analytics":{}},"language":{"default":"en","autoDetect":"browser","translations":{"en":{"consentModal":{"title":"Hello traveler, it's cookie time!","description":"🍪 This site uses cookies to serve you the best experience—no crumbs left behind! Want to know what cookies really are? Check out this easy-to-understand cookie explanation. And for the legal nitty-gritty, here’s our website cookie policy to keep you in the loop! 🚀\n","acceptAllBtn":"Accept all","acceptNecessaryBtn":"Reject all","showPreferencesBtn":"Manage preferences","footer":"<a href=\"#link\">Privacy Policy</a>\n<a href=\"/terms-and-conditions/\">Terms and conditions</a>\n"},"preferencesModal":{"title":"Consent Preferences Center","acceptAllBtn":"Accept all","acceptNecessaryBtn":"Reject all","savePreferencesBtn":"Save preferences","closeIconLabel":"Close modal","serviceCounterLabel":"Service|Services","sections":[{"title":"Cookie Usage","description":"We use cookies to make your visit smoother, faster, and tailored just for you. Cookies help us remember your preferences, improve site performance, and deliver personalized content while keeping things secure and user-friendly.\n"},{"title":"Strictly Necessary Cookies <span class=\"pm__badge\">Always Enabled</span>","description":"These cookies are essential for the website to function properly. They enable core features like security, page navigation, and access to secure areas. Without these, the site cannot operate correctly.\n","linkedCategory":"necessary"},{"title":"Functionality Cookies","description":"Functionality cookies remember your choices to provide a more personalized experience. For example, they save your language preference or login details so you don’t have to keep entering them each time.\n","linkedCategory":"functionality"},{"title":"Analytics Cookies","description":"Analytics cookies help us understand how visitors interact with our site by collecting information anonymously. This insight allows us to improve functionality, fix issues, and make the website better for you.\n","linkedCategory":"analytics"},{"title":"More information","description":"Please refer to our <a href='/pages/cookie-policy'>cookie policy</a> for full details on how we use cookies and your options to manage them.\n"}]}}}}})</script></body></html>