<!DOCTYPE html><html lang="zh-TW"><head><!-- hexo injector head_begin start --><!-- Google tag (gtag.js) begins-->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3DZR3TQYCY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-3DZR3TQYCY');
    </script>
    <!-- Google tag (gtag.js) ends-->
    <!-- hexo injector head_begin end -->
    <meta charset="utf-8">
    <!-- security headers starts -->
    <!-- meta http-equiv="content-security-policy" content="script-src 'sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=' 'sha256-lJjk3/dvd+wXqRFjV7T5L/nXJXr5NjUjmsKSPEe+ass=';" -->
    <!-- security headers ends -->
    <!-- favicon starts -->    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <!-- favicon ends -->
    

    
    <title>在 Git 中防止憑證：分層防禦策略 | Decoding Digital Anomalies</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="keywords" content="Credentials,DevOps,Git,Security">
    
    
    <meta name="description" content="預防勝於補救。遵循 OWASP DevSecOps 原則，透過預提交鉤子、密鑰掃描、程式碼檢查和自動偵測建構多層防禦。">
<meta property="og:type" content="article">
<meta property="og:title" content="在 Git 中防止憑證：分層防禦策略">
<meta property="og:url" content="https://neo01.com/zh-TW/2022/03/Preventing-Credentials-in-Git/index.html">
<meta property="og:site_name" content="Decoding Digital Anomalies">
<meta property="og:description" content="預防勝於補救。遵循 OWASP DevSecOps 原則，透過預提交鉤子、密鑰掃描、程式碼檢查和自動偵測建構多層防禦。">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://neo01.com/assets/git/thumbnail.png">
<meta property="article:published_time" content="2022-03-20T16:00:00.000Z">
<meta property="article:modified_time" content="2025-10-25T14:15:01.244Z">
<meta property="article:author" content="Neo Alienson">
<meta property="article:tag" content="Credentials">
<meta property="article:tag" content="DevOps">
<meta property="article:tag" content="Git">
<meta property="article:tag" content="Security">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://neo01.com/assets/git/thumbnail.png">
    
            <link rel="alternate" href="/atom.xml" title="Decoding Digital Anomalies" type="application/atom+xml">
    

    

    

    

    

    

    

    
    
        


    
    
        


    

<!-- hexo injector head_end start --><link rel="stylesheet" type="text/css" href="/css/bundle.css"><script type="text/javascript" src="/js/bundle_first.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><style id="admonition-styles">.admonition {
  margin: 1em 0;
  padding: 0rem;
  border-left: 0.3rem solid;
  border-radius: 0.4rem;
  background-color: #f9f9f9;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
  overflow: hidden;
  page-break-inside: avoid;
}

.admonition-title {
  display: flex;
  align-items: center;
  font-weight: 600;
  padding: 0rem 1rem 0.1rem 0.75rem;
  font-size: 1.05em;
  background-color: rgba(0, 0, 0, 0.03);
  border-top-left-radius: 0.4rem;
  border-top-right-radius: 0.4rem;
  margin: 0 !important;
}

.admonition-icon {
  font-size: 1.2em;
  margin-right: 0.6rem;
  opacity: 0.85;
  margin-top: 0.1rem;
}

/* 内容区域 margin */
.admonition > *:not(.admonition-title) {
  margin: 0.6rem 1rem 0.6rem 1rem;
}

/* NOTE 类型 */
.admonition.anote {
  border-color: #448aff;
}
.admonition.anote > .admonition-title {
  background-color: #448aff1a;
  color: #2962ff;
}

/* INFO / TODO 类型 */
.admonition.info,
.admonition.todo {
  border-color: #00b8d4;
}
.admonition.info > .admonition-title,
.admonition.todo > .admonition-title {
  background-color: rgba(0, 184, 212, 0.1);
  color: #007c91;
}

/* 警告类 */
.admonition.warning,
.admonition.attention,
.admonition.caution {
  border-color: #ff9100;
}
.admonition.warning > .admonition-title,
.admonition.attention > .admonition-title,
.admonition.caution > .admonition-title {
  background-color: rgba(255, 145, 0, 0.1);
  color: #c66900;
}

/* 错误类 */
.admonition.failure,
.admonition.missing,
.admonition.fail,
.admonition.error,
.admonition.danger,
.admonition.bug {
  border-color: #ff5252;
}
.admonition.failure > .admonition-title,
.admonition.missing > .admonition-title,
.admonition.fail > .admonition-title,
.admonition.error > .admonition-title,
.admonition.danger > .admonition-title,
.admonition.bug > .admonition-title {
  background-color: rgba(255, 82, 82, 0.1);
  color: #b71c1c;
}

/* TIP 类型 */
.admonition.tip {
  border-color: #00bfa5;
}
.admonition.tip > .admonition-title {
  background-color: #00bfa51a;
  color: #00796b;
}

/* SUCCESS 类型 */
.admonition.success {
  border-color: #00c853;
}
.admonition.success > .admonition-title {
  background-color: #00c8531a;
  color: #2e7d32;
}

/* QUESTION 类型 */
.admonition.question {
  border-color: #64dd17;
}
.admonition.question > .admonition-title {
  background-color: #64dd171a;
  color: #558b2f;
}

/* EXAMPLE 类型 */
.admonition.example {
  border-color: #7c4dff;
}
.admonition.example > .admonition-title {
  background-color: #7c4dff1a;
  color: #512da8;
}

/* QUOTE 类型 */
.admonition.quote {
  border-color: #9e9e9e;
}
.admonition.quote > .admonition-title {
  background-color: #9e9e9e1a;
  color: #424242;
}

/*黑暗模式*/
/* 夜间模式基础样式 */
[data-theme="dark"] .admonition {
  background-color: #1e1e1e;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
}

[data-theme="dark"] .admonition-title {
  background-color: rgba(255, 255, 255, 0.05);
}

/* anote */
[data-theme="dark"] .admonition.anote {
  border-color: #82b1ff;
}
[data-theme="dark"] .admonition.anote > .admonition-title {
  background-color: #82b1ff1a;
  color: #bbdefb;
}

/* tip */
[data-theme="dark"] .admonition.tip {
  border-color: #64ffda;
}
[data-theme="dark"] .admonition.tip > .admonition-title {
  background-color: #64ffda1a;
  color: #1de9b6;
}

/* success */
[data-theme="dark"] .admonition.success {
  border-color: #69f0ae;
}
[data-theme="dark"] .admonition.success > .admonition-title {
  background-color: #69f0ae1a;
  color: #00e676;
}

/* question */
[data-theme="dark"] .admonition.question {
  border-color: #b2ff59;
}
[data-theme="dark"] .admonition.question > .admonition-title {
  background-color: #b2ff591a;
  color: #aeea00;
}

/* example */
[data-theme="dark"] .admonition.example {
  border-color: #b388ff;
}
[data-theme="dark"] .admonition.example > .admonition-title {
  background-color: #b388ff1a;
  color: #b39ddb;
}

/* quote */
[data-theme="dark"] .admonition.quote {
  border-color: #bdbdbd;
}
[data-theme="dark"] .admonition.quote > .admonition-title {
  background-color: #bdbdbd1a;
  color: #eeeeee;
}

/* warning / attention / caution */
[data-theme="dark"] .admonition.warning,
[data-theme="dark"] .admonition.attention,
[data-theme="dark"] .admonition.caution {
  border-color: #ffb300;
}
[data-theme="dark"] .admonition.warning > .admonition-title,
[data-theme="dark"] .admonition.attention > .admonition-title,
[data-theme="dark"] .admonition.caution > .admonition-title {
  background-color: #ffb3001a;
  color: #ffe082;
}

/* error / fail / failure / bug / danger / missing */
[data-theme="dark"] .admonition.error,
[data-theme="dark"] .admonition.fail,
[data-theme="dark"] .admonition.failure,
[data-theme="dark"] .admonition.bug,
[data-theme="dark"] .admonition.missing,
[data-theme="dark"] .admonition.danger {
  border-color: #ef5350;
}
[data-theme="dark"] .admonition.error > .admonition-title,
[data-theme="dark"] .admonition.fail > .admonition-title,
[data-theme="dark"] .admonition.failure > .admonition-title,
[data-theme="dark"] .admonition.bug > .admonition-title,
[data-theme="dark"] .admonition.missing > .admonition-title,
[data-theme="dark"] .admonition.danger > .admonition-title {
  background-color: #ef53501a;
  color: #ff8a80;
}</style></head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" title="Homepage" class="logo"></a>
                    </h1>
                        <h2 class="subtitle-wrap">
                            <p class="title">解碼數位異象</p>
                          <p class="subtitle">有時功能就是數位兔子洞中的錯誤，反之亦然</p>
                        </h2>
                    <div id="lang-selector">
                        <span class="lang-icon">🌐</span>
                        
                            <a href="/2022/03/Preventing-Credentials-in-Git/" class="lang-link">English</a>
<span class="lang-sep">|</span>                            <a href="/zh-CN/2022/03/Preventing-Credentials-in-Git/" class="lang-link">简体中文</a>
<span class="lang-sep">|</span>                            <a href="/ja/2022/03/Preventing-Credentials-in-Git/" class="lang-link">日本語</a>
                    </div>
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/zh-TW/">首頁</a>
                                </li>
                                                                    <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/AI/">人工智慧</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/AI/Art-Gallery/">藝術畫廊</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Architecture/">架構</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Cybersecurity/">資訊安全</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Development/">開發</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Misc/">雜項</a></li></ul>
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/zh-TW/about-me">關於</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" id="search-form-input" placeholder="搜尋">
        <button type="submit" title="搜尋" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" id="ins-search-input" placeholder="輸入關鍵字...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script integrity="sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=">
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '頁面',
            CATEGORIES: '分類',
            TAGS: '標籤',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
        LANG: 'zh-TW',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>




</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Development/">Development</a>
    </h1>
</div>

                        <div class="main-body-content">
                            <article id="post-2022/03/Preventing-Credentials-in-Git-zh-TW" class="article article-single article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner responsive-content">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        在 Git 中防止憑證：分層防禦策略
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
      <i class="fa fa-calendar"></i>
        
          Created <time datetime="2022-03-20T16:00:00.000Z" itemprop="datePublished">2022-03-21</time>
          &nbsp;<i class="fa fa-calendar"></i>
          Updated <time datetime="2025-10-25T14:15:01.244Z" itemprop="datePublished">2025-10-25</time>
        
    </div>


                

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/zh-TW/tags/DevOps/">DevOps</a> <a class="tag-link" href="/zh-TW/tags/Security/">Security</a> <a class="tag-link" href="/zh-TW/tags/Git/">Git</a> <a class="tag-link" href="/zh-TW/tags/Credentials/">Credentials</a>
    </div>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B2%E7%A6%A6%E5%B1%A4%E6%AC%A1"><span class="toc-text">防禦層次</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC-1-%E5%B1%A4%EF%BC%9AGitignore-%E8%A8%AD%E5%AE%9A"><span class="toc-text">第 1 層：Gitignore 設定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC-2-%E5%B1%A4%EF%BC%9A%E7%92%B0%E5%A2%83%E8%AE%8A%E6%95%B8%E5%92%8C%E8%A8%AD%E5%AE%9A"><span class="toc-text">第 2 層：環境變數和設定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC-3-%E5%B1%A4%EF%BC%9A%E9%A0%90%E6%8F%90%E4%BA%A4%E9%89%A4%E5%AD%90"><span class="toc-text">第 3 層：預提交鉤子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC-4-%E5%B1%A4%EF%BC%9ACI-CD-%E7%AE%A1%E7%B7%9A%E6%8E%83%E6%8F%8F"><span class="toc-text">第 4 層：CI/CD 管線掃描</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC-5-%E5%B1%A4%EF%BC%9A%E5%AF%86%E9%91%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%B5%B1"><span class="toc-text">第 5 層：密鑰管理系統</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC-6-%E5%B1%A4%EF%BC%9A%E4%BD%BF%E7%94%A8-GitProxy-%E7%9A%84%E6%8E%A8%E9%80%81%E4%BF%9D%E8%AD%B7"><span class="toc-text">第 6 層：使用 GitProxy 的推送保護</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC-7-%E5%B1%A4%EF%BC%9A%E5%B9%B3%E5%8F%B0%E6%8E%83%E6%8F%8F%E5%92%8C%E7%9B%A3%E6%8E%A7"><span class="toc-text">第 7 層：平台掃描和監控</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%A6%E6%96%BD%E7%AD%96%E7%95%A5"><span class="toc-text">實施策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%95%E7%90%86%E8%AA%A4%E5%A0%B1"><span class="toc-text">處理誤報</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B5%90%E8%AB%96"><span class="toc-text">結論</span></a></li></ol>
            <p>在探討<a href="/zh-TW/2022/02/Managing-Credentials-Committed-to-Git/">如何從憑證洩露中復原</a>之後,顯而易見的問題出現了：我們如何一開始就防止憑證進入 Git？答案不是單一工具或技術——而是在多個階段捕捉錯誤的分層防禦策略,在它們成為事件之前。</p>
<p>預防比補救有效得多。從 Git 歷史中刪除憑證需要重寫提交、與團隊成員協調,並接受分支和鏡像可能永久保留洩露。相比之下,防止初始提交只需幾秒鐘,並消除所有下游複雜性。本文探討形成全面憑證保護策略的實用工具和技術。</p>
<h2 id="防禦層次">防禦層次</h2>
<p>有效的憑證保護需要多個重疊的防禦：</p>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>🛡️ 深度防禦</p><div class="admonition-content"><p><strong>第 1 層：設定</strong></p>
<ul>
<li><code>.gitignore</code> 防止追蹤憑證檔案</li>
<li>全域模式捕捉常見錯誤</li>
<li>範本檔案指導正確結構</li>
</ul>
<p><strong>第 2 層：程式碼實踐</strong></p>
<ul>
<li>環境變數將設定與程式碼分離</li>
<li>設定函式庫強制執行模式</li>
<li>程式碼審查捕捉硬編碼密鑰</li>
</ul>
<p><strong>第 3 層：自動掃描</strong></p>
<ul>
<li>預提交鉤子阻止包含憑證的提交</li>
<li>CI/CD 管線掃描捕捉繞過的鉤子</li>
<li>儲存庫掃描偵測歷史洩露</li>
</ul>
<p><strong>第 4 層：密鑰管理</strong></p>
<ul>
<li>集中式憑證儲存</li>
<li>執行時密鑰注入</li>
<li>自動輪換功能</li>
</ul>
<p><strong>第 5 層：監控</strong></p>
<ul>
<li>平台提供的掃描（GitHub、GitLab）</li>
<li>自訂模式偵測</li>
<li>快速回應的警報系統</li>
</ul>
</div></div>
<p>每一層捕捉不同類型的錯誤,並在其他層失敗時提供冗餘。</p>
<h2 id="第-1-層：Gitignore-設定">第 1 層：Gitignore 設定</h2>
<p>第一道防線防止 Git 追蹤憑證檔案。</p>
<h3 id="必要的-Gitignore-模式">必要的 Gitignore 模式</h3>
<p>設定 <code>.gitignore</code> 以排除常見的憑證位置：</p>
<pre class="language-ignore" data-language="ignore"><code class="language-ignore"><span class="token comment"># 環境檔案</span>
<span class="token entry string">.env</span>
<span class="token entry string">.env.local</span>
<span class="token entry string">.env.<span class="token operator">*</span>.local</span>
<span class="token entry string">.env.development</span>
<span class="token entry string">.env.production</span>

<span class="token comment"># 設定檔案</span>
<span class="token entry string">config<span class="token punctuation">/</span>secrets.yml</span>
<span class="token entry string">config<span class="token punctuation">/</span>database.yml</span>
<span class="token entry string">config<span class="token punctuation">/</span>credentials.yml</span>
<span class="token entry string">secrets.json</span>
<span class="token entry string">secrets.yaml</span>

<span class="token comment"># 金鑰檔案</span>
<span class="token entry string"><span class="token operator">*</span>.key</span>
<span class="token entry string"><span class="token operator">*</span>.pem</span>
<span class="token entry string"><span class="token operator">*</span>.p12</span>
<span class="token entry string"><span class="token operator">*</span>.pfx</span>
<span class="token entry string"><span class="token operator">*</span>.cer</span>
<span class="token entry string"><span class="token operator">*</span>.crt</span>
<span class="token entry string">id_rsa</span>
<span class="token entry string">id_dsa</span>

<span class="token comment"># 雲端供應商憑證</span>
<span class="token entry string">.aws<span class="token punctuation">/</span>credentials</span>
<span class="token entry string">.azure<span class="token punctuation">/</span>credentials</span>
<span class="token entry string">gcloud-service-key.json</span>

<span class="token comment"># 可能包含憑證的 IDE 檔案</span>
<span class="token entry string">.vscode<span class="token punctuation">/</span>settings.json</span>
<span class="token entry string">.idea<span class="token punctuation">/</span>workspace.xml</span>
<span class="token entry string">.idea<span class="token punctuation">/</span>dataSources.xml</span></code></pre>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>📝 Gitignore 最佳實踐</p><div class="admonition-content"><p><strong>儲存庫層級模式</strong></p>
<ul>
<li>在第一次提交前新增模式</li>
<li>包含專案特定的憑證檔案</li>
<li>記錄為什麼檔案被忽略</li>
<li>將 <code>.gitignore</code> 提交到儲存庫</li>
</ul>
<p><strong>全域 Gitignore</strong></p>
<ul>
<li>全域設定個人模式</li>
<li>涵蓋 IDE 特定檔案</li>
<li>套用到所有儲存庫</li>
</ul>
<p></p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 設定全域 gitignore</span><p></p>
</code></pre></div></div><code class="language-bash">

<span class="token function">git</span> config <span class="token parameter variable">--global</span> core.excludesfile ~/.gitignore_global

<span class="token comment"># 新增常見模式</span>
<span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> ~/.gitignore_global <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
.env
*.key
*.pem
.DS_Store
EOF</span></code>
<h3 id="指導用的範本檔案">指導用的範本檔案</h3>
<p>提供 <code>.env.example</code> 檔案顯示所需結構,但不包含實際憑證：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># .env.example</span>
<span class="token assign-left variable">DATABASE_URL</span><span class="token operator">=</span>postgresql://user:password@localhost:5432/dbname
<span class="token assign-left variable">API_KEY</span><span class="token operator">=</span>your_api_key_here
<span class="token assign-left variable">AWS_ACCESS_KEY_ID</span><span class="token operator">=</span>your_access_key
<span class="token assign-left variable">AWS_SECRET_ACCESS_KEY</span><span class="token operator">=</span>your_secret_key
<span class="token assign-left variable">STRIPE_SECRET_KEY</span><span class="token operator">=</span>sk_test_your_key_here</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># .gitignore</span>
.env
.env.local

<span class="token comment"># README.md 說明</span>
<span class="token comment"># 複製 .env.example 到 .env 並填入實際值</span></code></pre>
<p>範本檔案引導開發者採用正確的憑證管理方式,而不暴露實際密鑰。</p>
<h2 id="第-2-層：環境變數和設定">第 2 層：環境變數和設定</h2>
<p>透過環境變數和設定管理將憑證與程式碼分離。</p>
<h3 id="環境變數模式">環境變數模式</h3>
<p>將憑證儲存在環境變數中,絕不在程式碼中：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># config.py - 不良：硬編碼憑證</span>
DATABASE_URL <span class="token operator">=</span> <span class="token string">"postgresql://user:pass123@localhost/db"</span>
API_KEY <span class="token operator">=</span> <span class="token string">"sk_live_abc123xyz789"</span>

<span class="token comment"># config.py - 良好：環境變數</span>
<span class="token keyword">import</span> os

DATABASE_URL <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"DATABASE_URL"</span><span class="token punctuation">]</span>
API_KEY <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"API_KEY"</span><span class="token punctuation">]</span>

<span class="token comment"># config.py - 更好：帶驗證和預設值</span>
<span class="token keyword">import</span> os

<span class="token keyword">def</span> <span class="token function">get_required_env</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    value <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> value<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Required environment variable </span><span class="token interpolation"><span class="token punctuation">{</span>key<span class="token punctuation">}</span></span><span class="token string"> is not set"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> value

DATABASE_URL <span class="token operator">=</span> get_required_env<span class="token punctuation">(</span><span class="token string">"DATABASE_URL"</span><span class="token punctuation">)</span>
API_KEY <span class="token operator">=</span> get_required_env<span class="token punctuation">(</span><span class="token string">"API_KEY"</span><span class="token punctuation">)</span>
DEBUG <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"DEBUG"</span><span class="token punctuation">,</span> <span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span></code></pre>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// config.js - 不良：硬編碼憑證</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">apiKey</span><span class="token operator">:</span> <span class="token string">"sk_live_abc123xyz789"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">dbPassword</span><span class="token operator">:</span> <span class="token string">"password123"</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// config.js - 良好：環境變數</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">apiKey</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">API_KEY</span><span class="token punctuation">,</span>
  <span class="token literal-property property">dbPassword</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_PASSWORD</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// config.js - 更好：帶驗證</span>
<span class="token keyword">function</span> <span class="token function">requireEnv</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> value <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Required environment variable </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is not set</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">apiKey</span><span class="token operator">:</span> <span class="token function">requireEnv</span><span class="token punctuation">(</span><span class="token string">"API_KEY"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">dbPassword</span><span class="token operator">:</span> <span class="token function">requireEnv</span><span class="token punctuation">(</span><span class="token string">"DB_PASSWORD"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">debug</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DEBUG</span> <span class="token operator">===</span> <span class="token string">"true"</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<div class="admonition success"><p class="admonition-title"><span class="mdi mdi-check-circle-outline admonition-icon"></span>✅ 環境變數的優勢</p><div class="admonition-content"><p><strong>優點</strong></p>
<ul>
<li>憑證永遠不在原始碼中</li>
<li>每個環境不同的值</li>
<li>無需變更程式碼即可輕鬆輪換</li>
<li>跨語言和平台的標準</li>
<li>部署系統支援</li>
</ul>
<p><strong>實施指南</strong></p>
<ul>
<li>在啟動時驗證必要變數</li>
<li>如果憑證缺失則快速失敗</li>
<li>記錄所有必要變數</li>
<li>為非密鑰提供合理預設值</li>
<li>使用一致的命名慣例</li>
</ul>
</div></div>
<h3 id="設定函式庫">設定函式庫</h3>
<p>使用強制執行環境變數模式的設定函式庫：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># 使用 python-decouple</span>
<span class="token keyword">from</span> decouple <span class="token keyword">import</span> config

DATABASE_URL <span class="token operator">=</span> config<span class="token punctuation">(</span><span class="token string">"DATABASE_URL"</span><span class="token punctuation">)</span>
API_KEY <span class="token operator">=</span> config<span class="token punctuation">(</span><span class="token string">"API_KEY"</span><span class="token punctuation">)</span>
DEBUG <span class="token operator">=</span> config<span class="token punctuation">(</span><span class="token string">"DEBUG"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> cast<span class="token operator">=</span><span class="token builtin">bool</span><span class="token punctuation">)</span></code></pre>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用 dotenv</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dotenv'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">apiKey</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">API_KEY</span><span class="token punctuation">,</span>
  <span class="token literal-property property">dbPassword</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_PASSWORD</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>設定函式庫提供一致的模式並減少樣板程式碼。</p>
<h2 id="第-3-層：預提交鉤子">第 3 層：預提交鉤子</h2>
<p>自動掃描在憑證進入 Git 歷史之前捕捉它們。根據 <a target="_blank" rel="noopener" href="https://owasp.org/www-project-devsecops-guideline/latest/01-Pre-commit">OWASP DevSecOps 指南</a>,預提交階段至關重要,因為它在安全問題到達中央儲存庫之前就予以防止。此階段專注於兩個關鍵領域：密鑰管理和程式碼檢查,透過早期偵測確保更高品質的程式碼。</p>
<h3 id="為什麼預提交很重要">為什麼預提交很重要</h3>
<p>預提交階段作為第一道防線：</p>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>🎯 預提交的優勢</p><div class="admonition-content"><p><strong>早期偵測</strong></p>
<ul>
<li>在問題進入儲存庫之前捕捉</li>
<li>防止密鑰到達中央 Git 伺服器</li>
<li>在開發者工作站立即阻止提交</li>
<li>大幅降低補救成本</li>
</ul>
<p><strong>品質強制執行</strong></p>
<ul>
<li>透過檢查工具強制執行編碼標準</li>
<li>驗證程式碼格式一致性</li>
<li>檢查安全漏洞</li>
<li>確保符合團隊指南</li>
</ul>
<p><strong>開發者回饋</strong></p>
<ul>
<li>即時回饋循環</li>
<li>教育開發者安全實踐</li>
<li>防止尷尬的公開洩露</li>
<li>建立安全意識</li>
</ul>
</div></div>
<h3 id="基本預提交鉤子">基本預提交鉤子</h3>
<p>建立簡單的鉤子來偵測常見的憑證模式：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># .git/hooks/pre-commit</span>

<span class="token comment"># 取得暫存的變更</span>
<span class="token assign-left variable">STAGED_DIFF</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> <span class="token function">diff</span> <span class="token parameter variable">--cached</span><span class="token variable">)</span></span>

<span class="token comment"># 檢查常見的憑證模式</span>
<span class="token keyword">if</span> <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$STAGED_DIFF</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-qE</span> <span class="token string">"(password|api_key|secret|token)\s*=\s*['<span class="token entity" title="\&quot;">\"</span>][^'<span class="token entity" title="\&quot;">\"</span>]+['<span class="token entity" title="\&quot;">\"</span>]"</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"❌ 錯誤：在提交中偵測到潛在憑證"</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"請移除憑證並使用環境變數"</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token comment"># 檢查 AWS 存取金鑰</span>
<span class="token keyword">if</span> <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$STAGED_DIFF</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-qE</span> <span class="token string">"AKIA[0-9A-Z]{16}"</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"❌ 錯誤：偵測到 AWS 存取金鑰"</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token comment"># 檢查私鑰</span>
<span class="token keyword">if</span> <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$STAGED_DIFF</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-qE</span> <span class="token string">"BEGIN.*PRIVATE KEY"</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"❌ 錯誤：偵測到私鑰"</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token comment"># 檢查高熵字串（潛在密鑰）</span>
<span class="token keyword">if</span> <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$STAGED_DIFF</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-qE</span> <span class="token string">"['<span class="token entity" title="\&quot;">\"</span>][a-zA-Z0-9]{32,}['<span class="token entity" title="\&quot;">\"</span>]"</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"⚠️  警告：偵測到高熵字串（可能是密鑰）"</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"提交前請仔細審查"</span>
<span class="token keyword">fi</span>

<span class="token builtin class-name">exit</span> <span class="token number">0</span></code></pre>
<h3 id="使用-git-secrets">使用 git-secrets</h3>
<p>AWS 的 git-secrets 提供全面的憑證偵測：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安裝 git-secrets</span>
brew <span class="token function">install</span> git-secrets  <span class="token comment"># macOS</span>
<span class="token comment"># 或</span>
<span class="token function">git</span> clone https://github.com/awslabs/git-secrets.git
<span class="token builtin class-name">cd</span> git-secrets
<span class="token function">make</span> <span class="token function">install</span>

<span class="token comment"># 在儲存庫中安裝鉤子</span>
<span class="token builtin class-name">cd</span> /path/to/your/repo
<span class="token function">git</span> secrets <span class="token parameter variable">--install</span>

<span class="token comment"># 註冊 AWS 模式</span>
<span class="token function">git</span> secrets --register-aws

<span class="token comment"># 新增自訂模式</span>
<span class="token function">git</span> secrets <span class="token parameter variable">--add</span> <span class="token string">'password\s*=\s*["\'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>^<span class="token string">"\']+["</span><span class="token punctuation">\</span>'<span class="token punctuation">]</span><span class="token string">'
git secrets --add '</span>api<span class="token punctuation">[</span>_-<span class="token punctuation">]</span>?key<span class="token punctuation">\</span>s*<span class="token operator">=</span><span class="token punctuation">\</span>s*<span class="token punctuation">[</span><span class="token string">"\'][^"</span><span class="token punctuation">\</span>'<span class="token punctuation">]</span>+<span class="token punctuation">[</span><span class="token string">"\']'
git secrets --add '["</span><span class="token punctuation">\</span>'<span class="token punctuation">]</span><span class="token punctuation">[</span>a-zA-Z0-9<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">32</span>,<span class="token punctuation">}</span><span class="token punctuation">[</span>"<span class="token punctuation">\</span>'<span class="token punctuation">]</span>'

<span class="token comment"># 掃描儲存庫歷史</span>
<span class="token function">git</span> secrets --scan-history</code></pre>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>🔧 git-secrets 設定</p><div class="admonition-content"><p><strong>全域安裝</strong>
</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 在所有儲存庫中安裝鉤子</span><p></p>
</code></pre></div></div><code class="language-bash">

<span class="token function">git</span> secrets <span class="token parameter variable">--install</span> ~/.git-templates/git-secrets
<span class="token function">git</span> config <span class="token parameter variable">--global</span> init.templateDir ~/.git-templates/git-secrets</code>
<pre><code>**自訂模式**
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 新增組織特定模式</span>
<span class="token function">git</span> secrets <span class="token parameter variable">--add</span> <span class="token string">'MYCOMPANY_[A-Z_]+\s*=\s*["\'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>^<span class="token string">"\']+["</span><span class="token punctuation">\</span>'<span class="token punctuation">]</span><span class="token string">'
git secrets --add '</span>internal<span class="token punctuation">[</span>_-<span class="token punctuation">]</span>token<span class="token punctuation">\</span>s*:<span class="token punctuation">\</span>s*<span class="token punctuation">[</span><span class="token string">"\'][^"</span><span class="token punctuation">\</span>'<span class="token punctuation">]</span>+<span class="token punctuation">[</span>"<span class="token punctuation">\</span>'<span class="token punctuation">]</span>'</code></pre>

**允許的模式**
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 將誤報加入白名單</span>
<span class="token function">git</span> secrets <span class="token parameter variable">--add</span> <span class="token parameter variable">--allowed</span> <span class="token string">'example_password'</span>
<span class="token function">git</span> secrets <span class="token parameter variable">--add</span> <span class="token parameter variable">--allowed</span> <span class="token string">'test_api_key'</span></code></pre>
</code></pre>
<h3 id="使用-detect-secrets">使用 detect-secrets</h3>
<p>Yelp 的 detect-secrets 提供進階的基於熵的偵測：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安裝 detect-secrets</span>
pip <span class="token function">install</span> detect-secrets

<span class="token comment"># 建立基準線</span>
detect-secrets scan <span class="token operator">&gt;</span> .secrets.baseline

<span class="token comment"># 提交基準線</span>
<span class="token function">git</span> <span class="token function">add</span> .secrets.baseline
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"Add secrets baseline"</span>

<span class="token comment"># 安裝預提交鉤子</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> .git/hooks/pre-commit <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'
#!/bin/bash
detect-secrets-hook --baseline .secrets.baseline $(git diff --cached --name-only)
EOF</span>
<span class="token function">chmod</span> +x .git/hooks/pre-commit</code></pre>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># .pre-commit-config.yaml</span>
<span class="token key atrule">repos</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">repo</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/Yelp/detect<span class="token punctuation">-</span>secrets
    <span class="token key atrule">rev</span><span class="token punctuation">:</span> v1.4.0
    <span class="token key atrule">hooks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> detect<span class="token punctuation">-</span>secrets
        <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'--baseline'</span><span class="token punctuation">,</span> <span class="token string">'.secrets.baseline'</span><span class="token punctuation">]</span></code></pre>
<div class="admonition success"><p class="admonition-title"><span class="mdi mdi-check-circle-outline admonition-icon"></span>✅ detect-secrets 功能</p><div class="admonition-content"><p><strong>進階偵測</strong></p>
<ul>
<li>基於熵的密鑰偵測</li>
<li>自訂偵測器的外掛系統</li>
<li>管理誤報的基準線</li>
<li>支援多種密鑰類型</li>
</ul>
<p><strong>管理誤報</strong>
</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 稽核基準線</span><p></p>
</code></pre></div></div><code class="language-bash">

detect-secrets audit .secrets.baseline

<span class="token comment"># 更新基準線</span>
detect-secrets scan <span class="token parameter variable">--baseline</span> .secrets.baseline</code>
<h3 id="使用-pre-commit-框架">使用 pre-commit 框架</h3>
<p>pre-commit 框架管理多個鉤子：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># .pre-commit-config.yaml</span>
<span class="token key atrule">repos</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">repo</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/pre<span class="token punctuation">-</span>commit/pre<span class="token punctuation">-</span>commit<span class="token punctuation">-</span>hooks
    <span class="token key atrule">rev</span><span class="token punctuation">:</span> v4.4.0
    <span class="token key atrule">hooks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> detect<span class="token punctuation">-</span>private<span class="token punctuation">-</span>key
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> check<span class="token punctuation">-</span>added<span class="token punctuation">-</span>large<span class="token punctuation">-</span>files
      
  <span class="token punctuation">-</span> <span class="token key atrule">repo</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/Yelp/detect<span class="token punctuation">-</span>secrets
    <span class="token key atrule">rev</span><span class="token punctuation">:</span> v1.4.0
    <span class="token key atrule">hooks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> detect<span class="token punctuation">-</span>secrets
        <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'--baseline'</span><span class="token punctuation">,</span> <span class="token string">'.secrets.baseline'</span><span class="token punctuation">]</span>
        
  <span class="token punctuation">-</span> <span class="token key atrule">repo</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/gitleaks/gitleaks
    <span class="token key atrule">rev</span><span class="token punctuation">:</span> v8.16.1
    <span class="token key atrule">hooks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> gitleaks</code></pre>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安裝 pre-commit</span>
pip <span class="token function">install</span> pre-commit

<span class="token comment"># 安裝鉤子</span>
pre-commit <span class="token function">install</span>

<span class="token comment"># 手動執行</span>
pre-commit run --all-files</code></pre>
<p>pre-commit 框架在專案間提供一致的鉤子管理。</p>
<h3 id="程式碼檢查整合">程式碼檢查整合</h3>
<p>除了密鑰偵測,預提交鉤子應強制執行程式碼品質：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># .pre-commit-config.yaml - 全面設定</span>
<span class="token key atrule">repos</span><span class="token punctuation">:</span>
  <span class="token comment"># 安全：密鑰偵測</span>
  <span class="token punctuation">-</span> <span class="token key atrule">repo</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/Yelp/detect<span class="token punctuation">-</span>secrets
    <span class="token key atrule">rev</span><span class="token punctuation">:</span> v1.4.0
    <span class="token key atrule">hooks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> detect<span class="token punctuation">-</span>secrets
        <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'--baseline'</span><span class="token punctuation">,</span> <span class="token string">'.secrets.baseline'</span><span class="token punctuation">]</span>
  
  <span class="token punctuation">-</span> <span class="token key atrule">repo</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/pre<span class="token punctuation">-</span>commit/pre<span class="token punctuation">-</span>commit<span class="token punctuation">-</span>hooks
    <span class="token key atrule">rev</span><span class="token punctuation">:</span> v4.4.0
    <span class="token key atrule">hooks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> detect<span class="token punctuation">-</span>private<span class="token punctuation">-</span>key
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> check<span class="token punctuation">-</span>added<span class="token punctuation">-</span>large<span class="token punctuation">-</span>files
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> check<span class="token punctuation">-</span>merge<span class="token punctuation">-</span>conflict
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> trailing<span class="token punctuation">-</span>whitespace
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> end<span class="token punctuation">-</span>of<span class="token punctuation">-</span>file<span class="token punctuation">-</span>fixer
  
  <span class="token comment"># 程式碼品質：檢查</span>
  <span class="token punctuation">-</span> <span class="token key atrule">repo</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/psf/black
    <span class="token key atrule">rev</span><span class="token punctuation">:</span> 23.3.0
    <span class="token key atrule">hooks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> black
        <span class="token key atrule">language_version</span><span class="token punctuation">:</span> python3
  
  <span class="token punctuation">-</span> <span class="token key atrule">repo</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/pycqa/flake8
    <span class="token key atrule">rev</span><span class="token punctuation">:</span> 6.0.0
    <span class="token key atrule">hooks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> flake8
        <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'--max-line-length=88'</span><span class="token punctuation">]</span>
  
  <span class="token punctuation">-</span> <span class="token key atrule">repo</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/pre<span class="token punctuation">-</span>commit/mirrors<span class="token punctuation">-</span>eslint
    <span class="token key atrule">rev</span><span class="token punctuation">:</span> v8.40.0
    <span class="token key atrule">hooks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> eslint
        <span class="token key atrule">files</span><span class="token punctuation">:</span> \.<span class="token punctuation">[</span>jt<span class="token punctuation">]</span>sx<span class="token punctuation">?</span>$
        <span class="token key atrule">types</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>file<span class="token punctuation">]</span></code></pre>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>🔧 檢查最佳實踐</p><div class="admonition-content"><p><strong>Python 專案</strong></p>
<ul>
<li><strong>Black</strong>：程式碼格式化</li>
<li><strong>Flake8</strong>：風格指南強制執行</li>
<li><strong>Pylint</strong>：程式碼分析</li>
<li><strong>mypy</strong>：型別檢查</li>
</ul>
<p><strong>JavaScript/TypeScript 專案</strong></p>
<ul>
<li><strong>ESLint</strong>：程式碼品質和風格</li>
<li><strong>Prettier</strong>：程式碼格式化</li>
<li><strong>TSLint</strong>：TypeScript 特定規則</li>
</ul>
<p><strong>檢查的優勢</strong></p>
<ul>
<li>團隊間一致的程式碼風格</li>
<li>早期捕捉常見錯誤</li>
<li>強制執行安全最佳實踐</li>
<li>減少程式碼審查摩擦</li>
<li>提高程式碼可維護性</li>
</ul>
</div></div>
<p>結合密鑰偵測與程式碼檢查建立了全面的預提交防禦,同時解決安全和品質問題。</p>
<h2 id="第-4-層：CI-CD-管線掃描">第 4 層：CI/CD 管線掃描</h2>
<p>透過 CI/CD 掃描捕捉繞過預提交鉤子的憑證。</p>
<h3 id="GitHub-Actions-整合">GitHub Actions 整合</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># .github/workflows/security.yml</span>
<span class="token key atrule">name</span><span class="token punctuation">:</span> Security Scan

<span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>push<span class="token punctuation">,</span> pull_request<span class="token punctuation">]</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">gitleaks</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">fetch-depth</span><span class="token punctuation">:</span> <span class="token number">0</span>
          
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run Gitleaks
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> gitleaks/gitleaks<span class="token punctuation">-</span>action@v2
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
          <span class="token key atrule">GITHUB_TOKEN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.GITHUB_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>
<h3 id="GitLab-CI-整合">GitLab CI 整合</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># .gitlab-ci.yml</span>
<span class="token key atrule">secret-detection</span><span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
  <span class="token key atrule">image</span><span class="token punctuation">:</span> python<span class="token punctuation">:</span><span class="token number">3.9</span>
  <span class="token key atrule">before_script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> pip install detect<span class="token punctuation">-</span>secrets
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> detect<span class="token punctuation">-</span>secrets scan <span class="token punctuation">-</span><span class="token punctuation">-</span>baseline .secrets.baseline
  <span class="token key atrule">only</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> merge_requests
    <span class="token punctuation">-</span> main</code></pre>
<h3 id="自訂掃描腳本">自訂掃描腳本</h3>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># scripts/scan_secrets.py</span>
<span class="token keyword">import</span> re
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> subprocess

PATTERNS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token string">r'AKIA[0-9A-Z]{16}'</span><span class="token punctuation">,</span> <span class="token string">'AWS Access Key'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">r'password\s*=\s*["\'][^"\']+["\']'</span><span class="token punctuation">,</span> <span class="token string">'Password'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">r'api[_-]?key\s*=\s*["\'][^"\']+["\']'</span><span class="token punctuation">,</span> <span class="token string">'API Key'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">r'BEGIN.*PRIVATE KEY'</span><span class="token punctuation">,</span> <span class="token string">'Private Key'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">scan_commit</span><span class="token punctuation">(</span>commit_hash<span class="token punctuation">)</span><span class="token punctuation">:</span>
    diff <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span>
        <span class="token punctuation">[</span><span class="token string">'git'</span><span class="token punctuation">,</span> <span class="token string">'show'</span><span class="token punctuation">,</span> commit_hash<span class="token punctuation">]</span><span class="token punctuation">,</span>
        text<span class="token operator">=</span><span class="token boolean">True</span>
    <span class="token punctuation">)</span>
    
    findings <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> pattern<span class="token punctuation">,</span> name <span class="token keyword">in</span> PATTERNS<span class="token punctuation">:</span>
        matches <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> diff<span class="token punctuation">,</span> re<span class="token punctuation">.</span>IGNORECASE<span class="token punctuation">)</span>
        <span class="token keyword">if</span> matches<span class="token punctuation">:</span>
            findings<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span> name<span class="token punctuation">,</span>
                <span class="token string">'pattern'</span><span class="token punctuation">:</span> pattern<span class="token punctuation">,</span>
                <span class="token string">'count'</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>matches<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> findings

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    commit <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span>
        <span class="token punctuation">[</span><span class="token string">'git'</span><span class="token punctuation">,</span> <span class="token string">'rev-parse'</span><span class="token punctuation">,</span> <span class="token string">'HEAD'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        text<span class="token operator">=</span><span class="token boolean">True</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    findings <span class="token operator">=</span> scan_commit<span class="token punctuation">(</span>commit<span class="token punctuation">)</span>
    <span class="token keyword">if</span> findings<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"❌ 在提交中偵測到憑證！"</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> finding <span class="token keyword">in</span> findings<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  - </span><span class="token interpolation"><span class="token punctuation">{</span>finding<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>finding<span class="token punctuation">[</span><span class="token string">'count'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> 個符合"</span></span><span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✅ 未偵測到憑證"</span><span class="token punctuation">)</span></code></pre>
<p>CI/CD 掃描在開發者繞過本機鉤子時提供安全網。</p>
<h2 id="第-5-層：密鑰管理系統">第 5 層：密鑰管理系統</h2>
<p>在生產環境中用集中式密鑰管理取代環境變數。</p>
<h3 id="AWS-Secrets-Manager">AWS Secrets Manager</h3>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># 在執行時取得密鑰</span>
<span class="token keyword">import</span> boto3
<span class="token keyword">import</span> json

<span class="token keyword">def</span> <span class="token function">get_secret</span><span class="token punctuation">(</span>secret_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    client <span class="token operator">=</span> boto3<span class="token punctuation">.</span>client<span class="token punctuation">(</span><span class="token string">'secretsmanager'</span><span class="token punctuation">,</span> region_name<span class="token operator">=</span><span class="token string">'us-east-1'</span><span class="token punctuation">)</span>
    response <span class="token operator">=</span> client<span class="token punctuation">.</span>get_secret_value<span class="token punctuation">(</span>SecretId<span class="token operator">=</span>secret_name<span class="token punctuation">)</span>
    <span class="token keyword">return</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">[</span><span class="token string">'SecretString'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 在應用程式中使用</span>
secrets <span class="token operator">=</span> get_secret<span class="token punctuation">(</span><span class="token string">'production/app/credentials'</span><span class="token punctuation">)</span>
DATABASE_URL <span class="token operator">=</span> secrets<span class="token punctuation">[</span><span class="token string">'database_url'</span><span class="token punctuation">]</span>
API_KEY <span class="token operator">=</span> secrets<span class="token punctuation">[</span><span class="token string">'api_key'</span><span class="token punctuation">]</span></code></pre>
<h3 id="HashiCorp-Vault">HashiCorp Vault</h3>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># 使用 hvac 函式庫</span>
<span class="token keyword">import</span> hvac

client <span class="token operator">=</span> hvac<span class="token punctuation">.</span>Client<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'https://vault.example.com'</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>approle<span class="token punctuation">.</span>login<span class="token punctuation">(</span>
    role_id<span class="token operator">=</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'VAULT_ROLE_ID'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    secret_id<span class="token operator">=</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'VAULT_SECRET_ID'</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span>

secrets <span class="token operator">=</span> client<span class="token punctuation">.</span>secrets<span class="token punctuation">.</span>kv<span class="token punctuation">.</span>v2<span class="token punctuation">.</span>read_secret_version<span class="token punctuation">(</span>
    path<span class="token operator">=</span><span class="token string">'production/app'</span>
<span class="token punctuation">)</span>
DATABASE_URL <span class="token operator">=</span> secrets<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'database_url'</span><span class="token punctuation">]</span></code></pre>
<h3 id="Kubernetes-Secrets">Kubernetes Secrets</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># secret.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> app<span class="token punctuation">-</span>secrets
<span class="token key atrule">type</span><span class="token punctuation">:</span> Opaque
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">database-url</span><span class="token punctuation">:</span> cG9zdGdyZXNxbDovL3VzZXI6cGFzc0BkYi9uYW1l
  <span class="token key atrule">api-key</span><span class="token punctuation">:</span> c2tfbGl2ZV9hYmMxMjN4eXo3ODk=</code></pre>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># deployment.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DATABASE_URL
          <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
            <span class="token key atrule">secretKeyRef</span><span class="token punctuation">:</span>
              <span class="token key atrule">name</span><span class="token punctuation">:</span> app<span class="token punctuation">-</span>secrets
              <span class="token key atrule">key</span><span class="token punctuation">:</span> database<span class="token punctuation">-</span>url</code></pre>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>🔐 密鑰管理的優勢</p><div class="admonition-content"><p><strong>優點</strong></p>
<ul>
<li>集中式憑證儲存</li>
<li>自動輪換功能</li>
<li>存取控制和稽核</li>
<li>靜態和傳輸中的加密</li>
<li>與雲端平台整合</li>
<li>短期憑證減少暴露視窗</li>
</ul>
<p><strong>何時使用</strong></p>
<ul>
<li>生產環境</li>
<li>多服務架構</li>
<li>合規要求</li>
<li>需要自動憑證輪換</li>
<li>團隊範圍的憑證共享</li>
</ul>
</div></div>
<h3 id="短期憑證">短期憑證</h3>
<p>密鑰管理系統啟用自動過期的短期憑證：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># AWS STS 臨時憑證</span>
<span class="token keyword">import</span> boto3

sts <span class="token operator">=</span> boto3<span class="token punctuation">.</span>client<span class="token punctuation">(</span><span class="token string">'sts'</span><span class="token punctuation">)</span>
response <span class="token operator">=</span> sts<span class="token punctuation">.</span>assume_role<span class="token punctuation">(</span>
    RoleArn<span class="token operator">=</span><span class="token string">'arn:aws:iam::123456789012:role/AppRole'</span><span class="token punctuation">,</span>
    RoleSessionName<span class="token operator">=</span><span class="token string">'app-session'</span><span class="token punctuation">,</span>
    DurationSeconds<span class="token operator">=</span><span class="token number">3600</span>  <span class="token comment"># 1 小時</span>
<span class="token punctuation">)</span>

credentials <span class="token operator">=</span> response<span class="token punctuation">[</span><span class="token string">'Credentials'</span><span class="token punctuation">]</span>
<span class="token comment"># 使用臨時憑證</span></code></pre>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># Vault 動態密鑰</span>
<span class="token keyword">import</span> hvac

client <span class="token operator">=</span> hvac<span class="token punctuation">.</span>Client<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'https://vault.example.com'</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>approle<span class="token punctuation">.</span>login<span class="token punctuation">(</span>
    role_id<span class="token operator">=</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'VAULT_ROLE_ID'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    secret_id<span class="token operator">=</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'VAULT_SECRET_ID'</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span>

<span class="token comment"># 產生短期資料庫憑證</span>
db_creds <span class="token operator">=</span> client<span class="token punctuation">.</span>secrets<span class="token punctuation">.</span>database<span class="token punctuation">.</span>generate_credentials<span class="token punctuation">(</span>
    name<span class="token operator">=</span><span class="token string">'my-role'</span><span class="token punctuation">,</span>
    ttl<span class="token operator">=</span><span class="token string">'1h'</span>
<span class="token punctuation">)</span>

username <span class="token operator">=</span> db_creds<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>
password <span class="token operator">=</span> db_creds<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>
<span class="token comment"># 憑證在 1 小時後自動過期</span></code></pre>
<div class="admonition success"><p class="admonition-title"><span class="mdi mdi-check-circle-outline admonition-icon"></span>✅ 短期憑證的優勢</p><div class="admonition-content"><p><strong>安全優勢</strong></p>
<ul>
<li>憑證自動過期</li>
<li>減少憑證洩露的視窗</li>
<li>無需手動輪換</li>
<li>洩露的憑證快速失效</li>
<li>限制憑證暴露的影響範圍</li>
</ul>
<p><strong>實施模式</strong></p>
<ul>
<li>AWS STS 用於臨時 AWS 憑證（15 分鐘 - 12 小時）</li>
<li>Vault 動態密鑰用於資料庫（幾分鐘到幾小時）</li>
<li>具有短過期時間的 OAuth 權杖（幾分鐘到幾小時）</li>
<li>具有 TTL 的服務帳戶權杖</li>
<li>具有短有效期的憑證式驗證</li>
</ul>
<p><strong>最佳實踐</strong></p>
<ul>
<li>為憑證設定最短實用 TTL</li>
<li>實施自動憑證更新</li>
<li>監控憑證使用模式</li>
<li>在應用程式關閉時撤銷憑證</li>
<li>使用憑證快取以最小化請求</li>
</ul>
</div></div>
<h2 id="第-6-層：使用-GitProxy-的推送保護">第 6 層：使用 GitProxy 的推送保護</h2>
<p>對於需要核准工作流程的組織,<a target="_blank" rel="noopener" href="https://git-proxy.finos.org/">GitProxy</a> 在 Git 之上提供自訂推送保護和政策。</p>
<h3 id="什麼是-GitProxy？">什麼是 GitProxy？</h3>
<p>GitProxy 是一個高度可設定的框架,在維持開發者體驗的同時強制執行推送保護：</p>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>🛡️ GitProxy 功能</p><div class="admonition-content"><p><strong>開發者優先設計</strong></p>
<ul>
<li>在到達遠端儲存庫之前攔截推送</li>
<li>在 CLI/終端機中呈現補救說明</li>
<li>最小化摩擦和採用障礙</li>
<li>讓開發者專注於提交程式碼</li>
</ul>
<p><strong>核准工作流程</strong></p>
<ul>
<li>將推送保持在暫停狀態</li>
<li>需要明確核准才能推送到上游</li>
<li>提供 Web UI、REST API 和 CLI 進行核准</li>
<li>產生可共享的推送審查連結</li>
</ul>
<p><strong>可設定的政策</strong></p>
<ul>
<li>自訂推送保護規則</li>
<li>組織特定的安全態勢</li>
<li>風險偏好對齊</li>
<li>與現有工作流程整合</li>
</ul>
</div></div>
<h3 id="快速設定">快速設定</h3>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安裝 GitProxy</span>
<span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> @finos/git-proxy

<span class="token comment"># 建立設定</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> proxy.config.json <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
{
  "authorisedList": [
    {
      "project": "your-org",
      "name": "your-repo",
      "url": "https://github.com/your-org/your-repo.git"
    }
  ]
}
EOF</span>

<span class="token comment"># 執行 GitProxy</span>
npx @finos/git-proxy <span class="token parameter variable">--config</span> ./proxy.config.json

<span class="token comment"># 設定儲存庫使用 GitProxy</span>
<span class="token function">git</span> remote set-url origin http://localhost:8000/your-org/your-repo.git</code></pre>
<h3 id="核准工作流程">核准工作流程</h3>
<p>當開發者推送程式碼時：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">git</span> push
remote:
remote: GitProxy has received your push ✅
remote:
remote: 🔗 Shareable Link
remote: http://localhost:8080/dashboard/push/000000__b12557</code></pre>
<p>透過 CLI 核准：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 登入</span>
npx @finos/git-proxy-cli login <span class="token parameter variable">--username</span> admin <span class="token parameter variable">--password</span> admin

<span class="token comment"># 核准推送</span>
npx @finos/git-proxy-cli authorise <span class="token parameter variable">--id</span> 000000__b12557

<span class="token comment"># 開發者重新推送</span>
<span class="token function">git</span> push  <span class="token comment"># 現在成功</span></code></pre>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>🎯 GitProxy 使用案例</p><div class="admonition-content"><p><strong>何時使用 GitProxy</strong></p>
<ul>
<li>需要核准工作流程的受監管產業</li>
<li>具有嚴格變更控制的組織</li>
<li>需要在生產前審查推送的團隊</li>
<li>程式碼變更的合規要求</li>
<li>預提交鉤子之外的額外層次</li>
</ul>
<p><strong>優勢</strong></p>
<ul>
<li>集中式推送控制</li>
<li>所有推送的稽核軌跡</li>
<li>組織層級的政策強制執行</li>
<li>開發者無法繞過</li>
<li>補充預提交鉤子</li>
</ul>
</div></div>
<h2 id="第-7-層：平台掃描和監控">第 7 層：平台掃描和監控</h2>
<p>利用平台提供的掃描進行持續監控。</p>
<h3 id="GitHub-密鑰掃描">GitHub 密鑰掃描</h3>
<p>GitHub 自動掃描公開儲存庫：</p>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>🔍 GitHub 密鑰掃描</p><div class="admonition-content"><p><strong>自動偵測</strong></p>
<ul>
<li>掃描公開儲存庫中的所有提交</li>
<li>偵測 100 多種憑證模式</li>
<li>通知儲存庫管理員</li>
<li>警告憑證提供者（AWS、Azure 等）</li>
</ul>
<p><strong>GitHub Advanced Security</strong></p>
<ul>
<li>適用於私有儲存庫</li>
<li>自訂模式支援</li>
<li>推送保護（阻止提交）</li>
<li>與安全公告整合</li>
</ul>
<p><strong>啟用推送保護</strong>
</p><pre class="language-none"><code class="language-none">Settings → Code security and analysis<p></p>
</code></pre></div></div><code class="language-none">

→ Push protection → Enable</code>
<h3 id="GitLab-密鑰偵測">GitLab 密鑰偵測</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># .gitlab-ci.yml</span>
<span class="token key atrule">include</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">template</span><span class="token punctuation">:</span> Security/Secret<span class="token punctuation">-</span>Detection.gitlab<span class="token punctuation">-</span>ci.yml

<span class="token key atrule">secret_detection</span><span class="token punctuation">:</span>
  <span class="token key atrule">variables</span><span class="token punctuation">:</span>
    <span class="token key atrule">SECRET_DETECTION_HISTORIC_SCAN</span><span class="token punctuation">:</span> <span class="token string">"true"</span></code></pre>
<h3 id="自訂監控">自訂監控</h3>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># 監控新提交</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> re

<span class="token keyword">def</span> <span class="token function">check_commit</span><span class="token punctuation">(</span>repo<span class="token punctuation">,</span> commit_sha<span class="token punctuation">)</span><span class="token punctuation">:</span>
    url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"https://api.github.com/repos/</span><span class="token interpolation"><span class="token punctuation">{</span>repo<span class="token punctuation">}</span></span><span class="token string">/commits/</span><span class="token interpolation"><span class="token punctuation">{</span>commit_sha<span class="token punctuation">}</span></span><span class="token string">"</span></span>
    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    commit_data <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    patterns <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">r'AKIA[0-9A-Z]{16}'</span><span class="token punctuation">,</span>
        <span class="token string">r'password\s*=\s*["\'][^"\']+["\']'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
    
    <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> commit_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'files'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        patch <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'patch'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> pattern <span class="token keyword">in</span> patterns<span class="token punctuation">:</span>
            <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> patch<span class="token punctuation">)</span><span class="token punctuation">:</span>
                alert_security_team<span class="token punctuation">(</span>repo<span class="token punctuation">,</span> commit_sha<span class="token punctuation">,</span> pattern<span class="token punctuation">)</span></code></pre>
<p>持續監控捕捉滑過其他層次的憑證。</p>
<h2 id="實施策略">實施策略</h2>
<p>遵循 OWASP DevSecOps 原則逐步推出憑證保護：</p>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>📋 實施路線圖</p><div class="admonition-content"><p><strong>階段 1：基礎（第 1 週）</strong></p>
<ul>
<li>新增全面的 <code>.gitignore</code> 模式</li>
<li>建立 <code>.env.example</code> 範本</li>
<li>記錄環境變數要求</li>
<li>稽核現有程式碼中的硬編碼憑證</li>
</ul>
<p><strong>階段 2：預提交保護（第 2 週）</strong></p>
<ul>
<li>安裝 git-secrets 或 detect-secrets</li>
<li>設定密鑰偵測的預提交鉤子</li>
<li>新增程式碼檢查鉤子（Black、ESLint 等）</li>
<li>訓練團隊預提交工作流程</li>
<li>建立程式碼審查指南</li>
</ul>
<p><strong>階段 3：CI/CD 整合（第 3 週）</strong></p>
<ul>
<li>將密鑰掃描新增到 CI/CD 管線</li>
<li>在建置流程中整合檢查檢查</li>
<li>設定自動警報</li>
<li>阻止包含偵測到憑證或檢查失敗的合併</li>
<li>設定監控儀表板</li>
</ul>
<p><strong>階段 4：推送保護（第 4 週）</strong></p>
<ul>
<li>評估 GitProxy 的核准工作流程</li>
<li>設定推送政策和授權儲存庫</li>
<li>設定核准流程（UI、CLI、API）</li>
<li>訓練團隊核准工作流程</li>
<li>記錄升級程序</li>
</ul>
<p><strong>階段 5：密鑰管理（第 5 週以上）</strong></p>
<ul>
<li>評估密鑰管理解決方案</li>
<li>遷移生產憑證</li>
<li>實施自動輪換</li>
<li>記錄操作程序</li>
</ul>
<p><strong>階段 6：持續改進</strong></p>
<ul>
<li>審查和更新偵測模式</li>
<li>分析誤報率</li>
<li>收集團隊回饋</li>
<li>根據團隊需求優化檢查規則</li>
<li>進行定期安全訓練</li>
</ul>
</div></div>
<h2 id="處理誤報">處理誤報</h2>
<p>所有掃描工具都會產生需要管理的誤報：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># git-secrets：允許特定模式</span>
<span class="token function">git</span> secrets <span class="token parameter variable">--add</span> <span class="token parameter variable">--allowed</span> <span class="token string">'example_password'</span>
<span class="token function">git</span> secrets <span class="token parameter variable">--add</span> <span class="token parameter variable">--allowed</span> <span class="token string">'test_api_key'</span>

<span class="token comment"># detect-secrets：稽核並標記誤報</span>
detect-secrets audit .secrets.baseline
<span class="token comment"># 互動式：將每個發現標記為真實或誤報</span>

<span class="token comment"># gitleaks：使用 .gitleaksignore</span>
<span class="token builtin class-name">echo</span> <span class="token string">"path/to/test/file.py"</span> <span class="token operator">&gt;&gt;</span> .gitleaksignore</code></pre>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># detect-secrets 的自訂設定</span>
<span class="token comment"># .secrets.baseline</span>
<span class="token punctuation">{</span>
  <span class="token key atrule">"exclude"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token key atrule">"files"</span><span class="token punctuation">:</span> <span class="token string">"test/.*|.*\\.example$"</span><span class="token punctuation">,</span>
    <span class="token key atrule">"lines"</span><span class="token punctuation">:</span> <span class="token string">"password.*=.*example"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<div class="admonition warning"><p class="admonition-title"><span class="mdi mdi-alert-outline admonition-icon"></span>⚠️ 誤報管理</p><div class="admonition-content"><p><strong>最佳實踐</strong></p>
<ul>
<li>仔細審查每個誤報</li>
<li>記錄為什麼允許模式</li>
<li>使用特定的允許清單,而非廣泛模式</li>
<li>定期稽核允許的模式</li>
<li>移除過時的允許清單項目</li>
</ul>
</div></div>
<h2 id="結論">結論</h2>
<p>防止憑證進入 Git 需要與 OWASP DevSecOps 原則一致的分層防禦策略。沒有單一工具能捕捉每個錯誤,但多個重疊的防禦建立了強大的保護系統。預提交階段特別關鍵——它是你的第一道也是最有效的防線,在問題到達中央儲存庫之前就予以捕捉。</p>
<p>從 <code>.gitignore</code> 設定和環境變數開始建立正確的模式。新增預提交鉤子以自動進行密鑰和程式碼品質的本機掃描。實施 CI/CD 管線檢查以捕捉繞過的鉤子。對於需要核准工作流程的組織,GitProxy 提供了無法繞過的額外推送保護層。為生產憑證部署密鑰管理系統,優先考慮自動過期的短期憑證以最小化暴露視窗。啟用平台掃描以進行持續監控。</p>
<p>在預防上的投資立即帶來回報。每個被防止的憑證洩露都避免了 <a href="/zh-TW/2022/02/Managing-Credentials-Committed-to-Git/">Git 歷史重寫、憑證輪換和事件回應</a>的複雜性。維護掃描工具的營運負擔與憑證洩露的成本相比微不足道。</p>
<p>從基礎開始——正確的 <code>.gitignore</code> 和環境變數——然後逐步新增層次。預提交鉤子應該是你的下一個優先事項,結合密鑰偵測與程式碼檢查以進行全面的品質強制執行。即使是基本的預提交鉤子也能捕捉大多數意外提交。對於受監管的環境,考慮使用 GitProxy 來強制執行核准工作流程。具有短期憑證的進階密鑰管理代表黃金標準,但可以等到你的團隊掌握基礎知識後再實施。</p>
<p>記住：每個提交到 Git 的憑證都應被視為已洩露。預防不僅僅是關於工具——它是關於建立一種文化,讓憑證保護和程式碼品質成為自動的,而非事後想法。短期憑證體現了深度防禦——即使洩露,它們也會快速過期,限制損害。預提交階段在開發者最需要的時候為他們提供即時回饋和教育。</p>

        </div>
        <footer class="article-footer">
            
    <a data-url="https://neo01.com/zh-TW/2022/03/Preventing-Credentials-in-Git/" data-id="3b1aace8" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url').replace("http://","https://"),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
    <!--script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": {
            "@type": "Person",
            "name": "Neo Alienson"
        },
        "headline": "在 Git 中防止憑證：分層防禦策略",
        "image": "https://neo01.com/assets/git/thumbnail.png",
        "keywords": "Credentials DevOps Git Security",
        "genre": "Development",
        "datePublished": "2022-03-21",
        "dateCreated": "2022-03-21",
        "dateModified": "2025-10-25",
        "url": "https://neo01.com//zh-TW/2022/03/Preventing-Credentials-in-Git/",
        "description": "預防勝於補救。遵循 OWASP DevSecOps 原則，透過預提交鉤子、密鑰掃描、程式碼檢查和自動偵測建構多層防禦。",
        "wordCount": 4589
    }
</script-->

</article>

                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>追蹤 :</p>
        <ul class="social-links">
                <li>
                    <a class="social-tooltip" title="stack-exchange" href="https://stackexchange.com/users/2122053/neo?tab=accounts" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-exchange"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="stack-overflow" href="https://stackoverflow.com/users/1885105/neo" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-overflow"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/neoalienson" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-github"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="linkedin" href="https://linkedin.com/in/neo01" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-linkedin"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="rss" href="/atom.xml" target="_blank" rel="noopener">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
        </ul>
    </div>
    <div class="widgets-container">
        
            
                <div class="widget-wrap widget-list">
    <h3 class="widget-title">連結</h3>
    <div class="widget">
        <ul><li><a href="/zh-TW/ai">AI 遊樂場</a></li><li><a href="/zh-TW/tools">工具</a></li><li><a href="/zh-TW/games">遊戲</a></li><li><a href="/zh-TW/pages/useful-information">實用資訊</a></li><li><a href="/zh-TW/pages/Hexo-Blogging-Cheatsheet">Hexo 部落格速查表</a></li></ul>
    </div>
</div>

            
                
            
                    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/10/How-I-Use-AI-to-Learn/" class="thumbnail">
        <span style="background-image:url(/assets/learning/thumbnail_80.png)" alt="我如何使用 AI 學習：透過迭代知識建構的個人旅程" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/AI/">人工智慧</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/10/How-I-Use-AI-to-Learn/" class="title">我如何使用 AI 學習：透過迭代知識建構的個人旅程</a></p>
                            <p class="item-date"><time datetime="2025-10-18T16:00:00.000Z" itemprop="datePublished">2025-10-19</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/10/Tools-Games-And-Browser-Built-In-AI/" class="thumbnail">
        <span style="background-image:url(/2025/10/Tools-Games-And-Browser-Built-In-AI/thumbnail.jpeg)" alt="工具、遊戲與瀏覽器內建 AI 遊樂場" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/AI/">人工智慧</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/10/Tools-Games-And-Browser-Built-In-AI/" class="title">工具、遊戲與瀏覽器內建 AI 遊樂場</a></p>
                            <p class="item-date"><time datetime="2025-10-01T16:00:00.000Z" itemprop="datePublished">2025-10-02</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/" class="thumbnail">
        <span style="background-image:url(/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/thumbnail.jpeg)" alt="代理式編碼的崛起：AI 驅動的軟體工程" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/AI/">人工智慧</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/" class="title">代理式編碼的崛起：AI 驅動的軟體工程</a></p>
                            <p class="item-date"><time datetime="2025-09-19T16:00:00.000Z" itemprop="datePublished">2025-09-20</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports_Part2/" class="thumbnail">
        <span style="background-image:url(/assets/ports/thumbnail.png)" alt="理解臨時埠 Part 2：為什麼伺服器應用程式應避免使用動態埠" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/Development/">開發</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports_Part2/" class="title">理解臨時埠 Part 2：為什麼伺服器應用程式應避免使用動態埠</a></p>
                            <p class="item-date"><time datetime="2025-08-30T16:00:00.000Z" itemprop="datePublished">2025-08-31</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports_Part1/" class="thumbnail">
        <span style="background-image:url(/assets/ports/thumbnail.png)" alt="理解臨時埠：網路通訊的隱形工作者" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/Development/">開發</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports_Part1/" class="title">理解臨時埠：網路通訊的隱形工作者</a></p>
                            <p class="item-date"><time datetime="2025-08-29T16:00:00.000Z" itemprop="datePublished">2025-08-30</time></p>
                        </div>
                    </li>
            </ul>
        </div>
    </div>

            
                
    
    
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">所有文章</h3>
        <div class="widget">
            <ul class="archive-list">
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2025/">2025</a>
                    <span class="archive-list-count">14</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2024/">2024</a>
                    <span class="archive-list-count">25</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2023/">2023</a>
                    <span class="archive-list-count">15</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2022/">2022</a>
                    <span class="archive-list-count">8</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2021/">2021</a>
                    <span class="archive-list-count">12</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2020/">2020</a>
                    <span class="archive-list-count">13</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2019/">2019</a>
                    <span class="archive-list-count">12</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2018/">2018</a>
                    <span class="archive-list-count">2</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2017/">2017</a>
                    <span class="archive-list-count">5</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2016/">2016</a>
                    <span class="archive-list-count">4</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2015/">2015</a>
                    <span class="archive-list-count">6</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2014/">2014</a>
                    <span class="archive-list-count">7</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2013/">2013</a>
                    <span class="archive-list-count">2</span>
                </li>
            
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <!-- disable caching cause each page has different footer from qrcode -->
        <!-- common/footer, null, {cache: !config.relative_link})  -->
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="qrcode-share-wrapper">
                <div class="qrcode-text">https://neo01.com/l#55e176b2</div>
                <img src="/qr/qr-c699992ffb637c2254d8457477477599.svg" width="200" height="200" alt="QR Code for https://neo01.com/l#55e176b2">
            </div>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" title="Homepage" class="logo"></a>
                </h1>
                
                <p>© 2025 Neo Alienson. 版權所有.
                  <a href="/zh-TW/terms-and-conditions">使用條款</a></p>
                
            </div>
            <div class="footer-plugins">
              


            </div>
        </div>
    </div>
</footer>

        
    
        


        


        


        


        


        


        


        


        


    



<!-- Custom Scripts -->




    </div>
<!-- hexo injector body_end start --><script type="text/javascript" src="/js/bundle_last.js"></script><!-- hexo injector body_end end -->

</body></html>