<!DOCTYPE html><html lang="zh-TW"><head><!-- hexo injector head_begin start --><!-- Google tag (gtag.js) begins-->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3DZR3TQYCY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-3DZR3TQYCY');
    </script>
    <!-- Google tag (gtag.js) ends-->
    <!-- hexo injector head_begin end -->
    <meta charset="utf-8">
    <!-- security headers starts -->
    <!-- meta http-equiv="content-security-policy" content="script-src 'sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=' 'sha256-lJjk3/dvd+wXqRFjV7T5L/nXJXr5NjUjmsKSPEe+ass=';" -->
    <!-- security headers ends -->
    <!-- favicon starts -->    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <!-- favicon ends -->
    

    
    <title>在家中建立單一登入系統 | Decoding Digital Anomalies</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="keywords" content="Cybersecurity,Homelab,Authentication,SSO">
    
    
    <meta name="description" content="厭倦了管理家庭實驗室服務的數十個密碼？學習如何建立單一登入系統，只需一次登入即可存取所有服務。">
<meta property="og:type" content="article">
<meta property="og:title" content="在家中建立單一登入系統">
<meta property="og:url" content="https://neo01.com/zh-TW/2025/01/Single-Sign-On-at-Home/index.html">
<meta property="og:site_name" content="Decoding Digital Anomalies">
<meta property="og:description" content="厭倦了管理家庭實驗室服務的數十個密碼？學習如何建立單一登入系統，只需一次登入即可存取所有服務。">
<meta property="og:locale" content="zh_TW">
<meta property="article:published_time" content="2025-01-14T16:00:00.000Z">
<meta property="article:modified_time" content="2025-10-12T09:00:06.701Z">
<meta property="article:author" content="Neo Alienson">
<meta property="article:tag" content="Cybersecurity">
<meta property="article:tag" content="Homelab">
<meta property="article:tag" content="Authentication">
<meta property="article:tag" content="SSO">
<meta name="twitter:card" content="summary">
    
            <link rel="alternate" href="/atom.xml" title="Decoding Digital Anomalies" type="application/atom+xml">
    

    

    

    

    

    

    

    
    
        


    
    
        


    

<!-- hexo injector head_end start --><link rel="stylesheet" type="text/css" href="/css/bundle.css"><script type="text/javascript" src="/js/bundle_first.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><style id="admonition-styles">.admonition {
  margin: 1em 0;
  padding: 0rem;
  border-left: 0.3rem solid;
  border-radius: 0.4rem;
  background-color: #f9f9f9;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
  overflow: hidden;
  page-break-inside: avoid;
}

.admonition-title {
  display: flex;
  align-items: center;
  font-weight: 600;
  padding: 0rem 1rem 0.1rem 0.75rem;
  font-size: 1.05em;
  background-color: rgba(0, 0, 0, 0.03);
  border-top-left-radius: 0.4rem;
  border-top-right-radius: 0.4rem;
  margin: 0 !important;
}

.admonition-icon {
  font-size: 1.2em;
  margin-right: 0.6rem;
  opacity: 0.85;
  margin-top: 0.1rem;
}

/* 内容区域 margin */
.admonition > *:not(.admonition-title) {
  margin: 0.6rem 1rem 0.6rem 1rem;
}

/* NOTE 类型 */
.admonition.anote {
  border-color: #448aff;
}
.admonition.anote > .admonition-title {
  background-color: #448aff1a;
  color: #2962ff;
}

/* INFO / TODO 类型 */
.admonition.info,
.admonition.todo {
  border-color: #00b8d4;
}
.admonition.info > .admonition-title,
.admonition.todo > .admonition-title {
  background-color: rgba(0, 184, 212, 0.1);
  color: #007c91;
}

/* 警告类 */
.admonition.warning,
.admonition.attention,
.admonition.caution {
  border-color: #ff9100;
}
.admonition.warning > .admonition-title,
.admonition.attention > .admonition-title,
.admonition.caution > .admonition-title {
  background-color: rgba(255, 145, 0, 0.1);
  color: #c66900;
}

/* 错误类 */
.admonition.failure,
.admonition.missing,
.admonition.fail,
.admonition.error,
.admonition.danger,
.admonition.bug {
  border-color: #ff5252;
}
.admonition.failure > .admonition-title,
.admonition.missing > .admonition-title,
.admonition.fail > .admonition-title,
.admonition.error > .admonition-title,
.admonition.danger > .admonition-title,
.admonition.bug > .admonition-title {
  background-color: rgba(255, 82, 82, 0.1);
  color: #b71c1c;
}

/* TIP 类型 */
.admonition.tip {
  border-color: #00bfa5;
}
.admonition.tip > .admonition-title {
  background-color: #00bfa51a;
  color: #00796b;
}

/* SUCCESS 类型 */
.admonition.success {
  border-color: #00c853;
}
.admonition.success > .admonition-title {
  background-color: #00c8531a;
  color: #2e7d32;
}

/* QUESTION 类型 */
.admonition.question {
  border-color: #64dd17;
}
.admonition.question > .admonition-title {
  background-color: #64dd171a;
  color: #558b2f;
}

/* EXAMPLE 类型 */
.admonition.example {
  border-color: #7c4dff;
}
.admonition.example > .admonition-title {
  background-color: #7c4dff1a;
  color: #512da8;
}

/* QUOTE 类型 */
.admonition.quote {
  border-color: #9e9e9e;
}
.admonition.quote > .admonition-title {
  background-color: #9e9e9e1a;
  color: #424242;
}

/*黑暗模式*/
/* 夜间模式基础样式 */
[data-theme="dark"] .admonition {
  background-color: #1e1e1e;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
}

[data-theme="dark"] .admonition-title {
  background-color: rgba(255, 255, 255, 0.05);
}

/* anote */
[data-theme="dark"] .admonition.anote {
  border-color: #82b1ff;
}
[data-theme="dark"] .admonition.anote > .admonition-title {
  background-color: #82b1ff1a;
  color: #bbdefb;
}

/* tip */
[data-theme="dark"] .admonition.tip {
  border-color: #64ffda;
}
[data-theme="dark"] .admonition.tip > .admonition-title {
  background-color: #64ffda1a;
  color: #1de9b6;
}

/* success */
[data-theme="dark"] .admonition.success {
  border-color: #69f0ae;
}
[data-theme="dark"] .admonition.success > .admonition-title {
  background-color: #69f0ae1a;
  color: #00e676;
}

/* question */
[data-theme="dark"] .admonition.question {
  border-color: #b2ff59;
}
[data-theme="dark"] .admonition.question > .admonition-title {
  background-color: #b2ff591a;
  color: #aeea00;
}

/* example */
[data-theme="dark"] .admonition.example {
  border-color: #b388ff;
}
[data-theme="dark"] .admonition.example > .admonition-title {
  background-color: #b388ff1a;
  color: #b39ddb;
}

/* quote */
[data-theme="dark"] .admonition.quote {
  border-color: #bdbdbd;
}
[data-theme="dark"] .admonition.quote > .admonition-title {
  background-color: #bdbdbd1a;
  color: #eeeeee;
}

/* warning / attention / caution */
[data-theme="dark"] .admonition.warning,
[data-theme="dark"] .admonition.attention,
[data-theme="dark"] .admonition.caution {
  border-color: #ffb300;
}
[data-theme="dark"] .admonition.warning > .admonition-title,
[data-theme="dark"] .admonition.attention > .admonition-title,
[data-theme="dark"] .admonition.caution > .admonition-title {
  background-color: #ffb3001a;
  color: #ffe082;
}

/* error / fail / failure / bug / danger / missing */
[data-theme="dark"] .admonition.error,
[data-theme="dark"] .admonition.fail,
[data-theme="dark"] .admonition.failure,
[data-theme="dark"] .admonition.bug,
[data-theme="dark"] .admonition.missing,
[data-theme="dark"] .admonition.danger {
  border-color: #ef5350;
}
[data-theme="dark"] .admonition.error > .admonition-title,
[data-theme="dark"] .admonition.fail > .admonition-title,
[data-theme="dark"] .admonition.failure > .admonition-title,
[data-theme="dark"] .admonition.bug > .admonition-title,
[data-theme="dark"] .admonition.missing > .admonition-title,
[data-theme="dark"] .admonition.danger > .admonition-title {
  background-color: #ef53501a;
  color: #ff8a80;
}</style><script id="mermaid-scripts" src="/cache/mermaid.min.local.js"></script>
<script>mermaid.initialize({theme: 'default'});</script></head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" title="Homepage" class="logo"></a>
                    </h1>
                        <h2 class="subtitle-wrap">
                            <p class="title">解碼數位異象</p>
                          <p class="subtitle">有時功能就是數位兔子洞中的錯誤，反之亦然</p>
                        </h2>
                    <div id="lang-selector">
                        <span class="lang-icon">🌐</span>
                        
                            <a href="/2025/01/Single-Sign-On-at-Home/" class="lang-link">English</a>
<span class="lang-sep">|</span>                            <a href="/zh-CN/2025/01/Single-Sign-On-at-Home/" class="lang-link">简体中文</a>
                    </div>
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/zh-TW/">首頁</a>
                                </li>
                                                                    <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/AI/">人工智慧</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/AI/Art-Gallery/">藝術畫廊</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Architecture/">架構</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Cybersecurity/">資訊安全</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Development/">開發</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Misc/">雜項</a></li></ul>
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/zh-TW/about-me">關於</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" id="search-form-input" placeholder="搜尋">
        <button type="submit" title="搜尋" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" id="ins-search-input" placeholder="輸入關鍵字...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script integrity="sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=">
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '頁面',
            CATEGORIES: '分類',
            TAGS: '標籤',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
        LANG: 'zh-TW',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>




</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Cybersecurity/">Cybersecurity</a>
    </h1>
</div>

                        <div class="main-body-content">
                            <article id="post-2025/01/Single-Sign-On-at-Home-zh-TW" class="article article-single article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner responsive-content">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        在家中建立單一登入系統
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
      <i class="fa fa-calendar"></i>
        
          Created <time datetime="2025-01-14T16:00:00.000Z" itemprop="datePublished">2025-01-15</time>
          &nbsp;<i class="fa fa-calendar"></i>
          Updated <time datetime="2025-10-12T09:00:06.701Z" itemprop="datePublished">2025-10-12</time>
        
    </div>


                

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/zh-TW/tags/Cybersecurity/">Cybersecurity</a> <a class="tag-link" href="/zh-TW/tags/Homelab/">Homelab</a> <a class="tag-link" href="/zh-TW/tags/Authentication/">Authentication</a> <a class="tag-link" href="/zh-TW/tags/SSO/">SSO</a>
    </div>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%82%BA%E4%BB%80%E9%BA%BC%E5%9C%A8%E5%AE%B6%E4%B8%AD%E9%9C%80%E8%A6%81-SSO%EF%BC%9F"><span class="toc-text">為什麼在家中需要 SSO？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%90%86%E8%A7%A3-SSO-%E5%9F%BA%E7%A4%8E"><span class="toc-text">理解 SSO 基礎</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E6%9E%B6-vs-%E5%A4%96%E9%83%A8%E8%BA%AB%E5%88%86%E6%8F%90%E4%BE%9B%E8%80%85"><span class="toc-text">自架 vs 外部身分提供者</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%B8%E6%93%87%E4%BD%A0%E7%9A%84-SSO-%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%A1%88"><span class="toc-text">選擇你的 SSO 解決方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A8%AD%E5%AE%9A-Authelia"><span class="toc-text">設定 Authelia</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%A4%9A%E5%9B%A0%E7%B4%A0%E9%A9%97%E8%AD%89"><span class="toc-text">新增多因素驗證</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%9F%E7%94%A8-SSO-%E5%BE%8C%E6%98%AF%E5%90%A6%E6%87%89%E4%BF%9D%E7%95%99%E6%9C%AC%E5%9C%B0%E5%B8%B3%E6%88%B6%EF%BC%9F"><span class="toc-text">啟用 SSO 後是否應保留本地帳戶？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B3%87%E6%BA%90"><span class="toc-text">資源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B5%90%E8%AB%96"><span class="toc-text">結論</span></a></li></ol>
            <p>你已經建立了一個令人印象深刻的家庭實驗室——Nextcloud、Jellyfin、Home Assistant、Portainer、Grafana，以及十幾個其他服務。每個都很棒。每個也都有自己的登入頁面。以及自己的密碼。以及自己的工作階段逾時。</p>
<p>聽起來很熟悉嗎？歡迎來到密碼疲勞的世界。</p>
<p>如果你可以登入一次就存取所有內容呢？這就是單一登入（SSO），它不再只是企業專用。</p>
<h2 id="為什麼在家中需要-SSO？">為什麼在家中需要 SSO？</h2>
<p><strong>問題所在：</strong></p>
<ul>
<li>15+ 個服務 = 15+ 個要記住的密碼（或重複使用 😱）</li>
<li>分別登入每個服務浪費時間</li>
<li>沒有集中式使用者管理</li>
<li>需要時難以撤銷存取權限</li>
<li>密碼重設是一場惡夢</li>
</ul>
<p><strong>解決方案：</strong></p>
<p>SSO 提供：</p>
<ul>
<li><strong>一次登入</strong>適用於所有服務</li>
<li><strong>集中式身分驗證</strong> - 在一個地方管理使用者</li>
<li><strong>更好的安全性</strong> - 一次強制執行 MFA，適用於所有地方</li>
<li><strong>更容易的入職</strong> - 一次將家人/朋友加入所有服務</li>
<li><strong>快速撤銷</strong> - 停用一個帳戶，鎖定所有地方</li>
</ul>
<h2 id="理解-SSO-基礎">理解 SSO 基礎</h2>
<h3 id="什麼是單一登入？">什麼是單一登入？</h3>
<p>SSO 是一種身分驗證方案，允許使用者登入一次並存取多個應用程式，無需重新驗證。</p>
<p><strong>簡單範例：</strong></p>
<ul>
<li>沒有 SSO：登入 Nextcloud → 登入 Grafana → 登入 Jellyfin（3 次登入）</li>
<li>有 SSO：登入一次 → 存取所有三個服務（1 次登入）</li>
</ul>
<h3 id="關鍵元件說明">關鍵元件說明</h3>
<p>將 SSO 想像成一個有多個 VIP 房間的夜店。讓我們分解每個元件：</p>
<h4 id="1-身分提供者（IdP）-保全">1. 身分提供者（IdP）- 保全</h4>
<p>**它的作用：**驗證你是誰的中央身分驗證機構。</p>
<p>**現實世界類比：**就像夜店入口的保全，檢查你的身分證並給你一個手環。</p>
<p><strong>在你的家庭實驗室中：</strong></p>
<ul>
<li><strong>Authelia、Authentik 或 Keycloak</strong> 充當保全</li>
<li>當你嘗試存取任何服務時，你會先被重新導向到這裡</li>
<li>它檢查你的使用者名稱/密碼和 MFA</li>
<li>一旦驗證，它會給你一個「令牌」（就像手環）</li>
</ul>
<p><strong>範例流程：</strong></p>
<pre class="language-none"><code class="language-none">你 → 嘗試存取 Nextcloud
Nextcloud → "我不認識你，去問保全"
你 → 重新導向到 Authelia 登入頁面
Authelia → "出示你的憑證"
你 → 輸入密碼 + MFA 代碼
Authelia → "已驗證！這是你的令牌"</code></pre>
<h4 id="2-服務提供者（SP）-VIP-房間">2. 服務提供者（SP）- VIP 房間</h4>
<p>**它的作用：**信任 IdP 驗證使用者的實際應用程式。</p>
<p>**現實世界類比：**就像夜店中的 VIP 房間。他們不檢查你的身分證——他們只看保全給的手環。</p>
<p><strong>在你的家庭實驗室中：</strong></p>
<ul>
<li>**你的應用程式：**Nextcloud、Grafana、Jellyfin、Home Assistant</li>
<li>它們不自己處理密碼</li>
<li>它們信任 IdP 的決定</li>
<li>它們只檢查：“你有來自 Authelia 的有效令牌嗎？”</li>
</ul>
<p><strong>範例：</strong></p>
<pre class="language-none"><code class="language-none">你 → 存取 Grafana（帶有來自 Authelia 的令牌）
Grafana → "我看到你有來自 Authelia 的有效令牌"
Grafana → "Authelia 說你是 'alice'，在 'admins' 群組中"
Grafana → "歡迎！"</code></pre>
<h4 id="3-使用者目錄-賓客名單">3. 使用者目錄 - 賓客名單</h4>
<p>**它的作用：**儲存使用者資訊（使用者名稱、密碼、群組）。</p>
<p>**現實世界類比：**保全檢查的賓客名單。</p>
<p><strong>在你的家庭實驗室中：</strong></p>
<ul>
<li>**簡單：**包含使用者名稱和雜湊密碼的 YAML 檔案</li>
<li>**進階：**LDAP 伺服器（就像使用者的資料庫）</li>
<li>包含：使用者名稱、密碼、電子郵件、群組成員資格</li>
</ul>
<p><strong>範例結構：</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">users</span><span class="token punctuation">:</span>
  <span class="token key atrule">alice</span><span class="token punctuation">:</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> (雜湊)
    <span class="token key atrule">email</span><span class="token punctuation">:</span> alice@home.local
    <span class="token key atrule">groups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>admins<span class="token punctuation">,</span> users<span class="token punctuation">]</span>
  <span class="token key atrule">bob</span><span class="token punctuation">:</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> (雜湊)
    <span class="token key atrule">email</span><span class="token punctuation">:</span> bob@home.local
    <span class="token key atrule">groups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>users<span class="token punctuation">]</span></code></pre>
<h4 id="4-身分驗證-vs-授權">4. 身分驗證 vs 授權</h4>
<p>**身分驗證：**證明你是誰（“你是 Alice 嗎？”）<br>
**授權：**決定你可以做什麼（“Alice 可以存取管理面板嗎？”）</p>
<p><strong>現實世界類比：</strong></p>
<ul>
<li><strong>身分驗證</strong> = 出示身分證證明你已滿 21 歲</li>
<li><strong>授權</strong> = 保全決定你是否可以進入 VIP 區</li>
</ul>
<p><strong>在 SSO 中：</strong></p>
<ul>
<li><strong>IdP 處理身分驗證：</strong>“是的，這是 Alice，密碼正確”</li>
<li><strong>應用程式處理授權：</strong>“Alice 在 ‘admins’ 群組中，授予管理員存取權限”</li>
</ul>
<h4 id="5-身分驗證協定-語言">5. 身分驗證協定 - 語言</h4>
<p>**它們的作用：**IdP 和應用程式通訊的標準化方式。</p>
<p>**現實世界類比：**就像保全和 VIP 房間用來溝通的不同語言。</p>
<p><strong>OIDC（OpenID Connect）- 現代且推薦：</strong></p>
<ul>
<li><strong>身分驗證：</strong>“你是誰？”</li>
<li><strong>授權：</strong>“你在哪些群組中？”</li>
<li>使用 JSON（易於閱讀）</li>
<li>建立在 OAuth2 之上</li>
<li>大多數現代應用程式支援</li>
<li><strong>盡可能使用此協定</strong></li>
</ul>
<p><strong>OIDC 令牌範例：</strong></p>
<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"sub"</span><span class="token operator">:</span> <span class="token string">"alice"</span><span class="token punctuation">,</span>
  <span class="token property">"email"</span><span class="token operator">:</span> <span class="token string">"alice@homelab.local"</span><span class="token punctuation">,</span>
  <span class="token property">"groups"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"admins"</span><span class="token punctuation">,</span> <span class="token string">"users"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"exp"</span><span class="token operator">:</span> <span class="token number">1705334400</span>
<span class="token punctuation">}</span></code></pre>
<p><strong>SAML - 企業標準：</strong></p>
<ul>
<li>就像說正式的法律語言</li>
<li>使用 XML（冗長）</li>
<li>較舊的企業應用程式使用它</li>
<li>更複雜但廣泛支援</li>
<li>在企業環境中常見</li>
</ul>
<p><strong>Windows 整合式身分驗證（WIA）- 僅限 Windows：</strong></p>
<ul>
<li>使用 Kerberos/NTLM</li>
<li>Windows 網域使用者自動登入</li>
<li>在網域上無需密碼提示</li>
<li>**僅適用於：**Active Directory + Windows 用戶端</li>
<li><strong>非聯合式</strong> - 無法與外部 SaaS 應用程式整合</li>
<li><strong>不適合家庭實驗室</strong>，除非你執行 Windows Server 網域</li>
</ul>
<h4 id="6-聯合式-vs-非聯合式身分驗證">6. 聯合式 vs 非聯合式身分驗證</h4>
<p><strong>什麼是聯合？</strong></p>
<p>聯合允許不同組織/系統相互信任彼此的身分驗證。</p>
<p><strong>現實世界類比：</strong></p>
<ul>
<li>**非聯合式：**你的健身房會員資格只在你的健身房有效</li>
<li>**聯合式：**你的護照在多個國家有效（它們相互信任）</li>
</ul>
<p><strong>非聯合式身分驗證（WIA、基本驗證）：</strong></p>
<pre class="language-none"><code class="language-none">你的家庭實驗室 IdP → 僅適用於你的家庭實驗室服務
❌ 無法向外部 SaaS（GitHub、AWS 等）進行身分驗證</code></pre>
<p><strong>聯合式身分驗證（OIDC、SAML）：</strong></p>
<pre class="language-none"><code class="language-none">你的家庭實驗室 IdP ↔ 外部 SaaS（如果它們支援）
✅ 可以向信任你的 IdP 的服務進行身分驗證</code></pre>
<p><strong>範例場景：</strong></p>
<p><strong>非聯合式（WIA）：</strong></p>
<pre class="language-none"><code class="language-none">你 → Windows 網域控制器 → 家庭實驗室應用程式 ✅
你 → Windows 網域控制器 → GitHub ❌（GitHub 不信任你的 DC）</code></pre>
<p><strong>聯合式（OIDC/SAML）：</strong></p>
<pre class="language-none"><code class="language-none">你 → Authentik → 家庭實驗室應用程式 ✅
你 → Authentik → GitHub Enterprise ✅（如果已設定）
你 → Authentik → AWS ✅（如果已設定）</code></pre>
<p><strong>家庭實驗室的陷阱：</strong></p>
<p>大多數 SaaS 提供者僅支援<strong>企業訂閱</strong>的聯合：</p>
<table>
<thead>
<tr>
<th>服務</th>
<th>免費/個人</th>
<th>企業</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>GitHub</strong></td>
<td>無 SSO</td>
<td>使用 SAML 的 SSO</td>
</tr>
<tr>
<td><strong>AWS</strong></td>
<td>無 SSO</td>
<td>使用 SAML 的 SSO</td>
</tr>
<tr>
<td><strong>Google Workspace</strong></td>
<td>無 SSO</td>
<td>使用 SAML 的 SSO</td>
</tr>
<tr>
<td><strong>Microsoft 365</strong></td>
<td>無 SSO</td>
<td>使用 SAML 的 SSO</td>
</tr>
<tr>
<td><strong>Slack</strong></td>
<td>無 SSO</td>
<td>使用 SAML 的 SSO</td>
</tr>
</tbody>
</table>
<p><strong>成本現實：</strong></p>
<ul>
<li>GitHub Enterprise：$21/使用者/月</li>
<li>AWS SSO：需要 AWS Organizations</li>
<li>Google Workspace：$12-18/使用者/月（SSO）</li>
<li>Microsoft 365：$22/使用者/月（SSO）</li>
</ul>
<div class="admonition warning"><p class="admonition-title"><span class="mdi mdi-alert-outline admonition-icon"></span>⚠️ 家庭實驗室 SSO 限制</p><div class="admonition-content"><p><strong>你的家庭實驗室 SSO 將適用於：</strong></p>
<ul>
<li>✅ 自架服務（Nextcloud、Grafana、Jellyfin）</li>
<li>✅ 你控制的服務</li>
<li>✅ 支援 OIDC/SAML 且無限制的應用程式</li>
</ul>
<p><strong>你的家庭實驗室 SSO 將不適用於：</strong></p>
<ul>
<li>❌ 免費層 SaaS（GitHub、Gmail、Slack）</li>
<li>❌ 需要企業訂閱的服務</li>
<li>❌ 不支援自訂 IdP 的服務</li>
</ul>
<p><strong>這將家庭實驗室 SSO 限制為僅內部服務</strong>，但對於管理 10-20 個自架應用程式仍然很有價值！</p>
</div></div>
<p><strong>比較：</strong></p>
<table>
<thead>
<tr>
<th>協定</th>
<th>最適合</th>
<th>複雜度</th>
<th>聯合式</th>
<th>家庭實驗室友善</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>OIDC</strong></td>
<td>現代應用程式</td>
<td>低</td>
<td>✅ 是</td>
<td>✅ 是</td>
</tr>
<tr>
<td><strong>SAML</strong></td>
<td>企業應用程式</td>
<td>高</td>
<td>✅ 是</td>
<td>⚠️ 如果需要</td>
</tr>
<tr>
<td><strong>WIA</strong></td>
<td>Windows 網域</td>
<td>中</td>
<td>❌ 否</td>
<td>❌ 過度</td>
</tr>
</tbody>
</table>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>💡 協定選擇</p><div class="admonition-content"><p>對於家庭實驗室：</p>
<ul>
<li><strong>使用 OIDC</strong> 適用於支援它的應用程式（Grafana、Nextcloud、Portainer）</li>
<li><strong>使用轉發驗證</strong>（Authelia）適用於不支援 OIDC 的應用程式</li>
<li><strong>跳過 WIA</strong>，除非你已經執行 Active Directory（而且它無法與 SaaS 一起使用）</li>
<li><strong>僅在特定應用程式需要時使用 SAML</strong></li>
<li>**接受限制：**你的 SSO 無法與免費層 SaaS（GitHub、Gmail 等）一起使用</li>
</ul>
</div></div>
<p><strong>視覺化比較：</strong></p>
<div class="mermaid">flowchart LR
    A["👤 使用者"] --&gt;|"1. 登入請求"| B["🔐 IdP<br>(Authelia)"]
    B --&gt;|"2. 檢查憑證"| C["📚 使用者目錄<br>(YAML/LDAP)"]
    C --&gt;|"3. 有效使用者"| B
    B --&gt;|"4. 發行令牌<br>(OIDC/SAML)"| A
    A --&gt;|"5. 出示令牌"| D["📦 服務提供者<br>(Nextcloud)"]
    D --&gt;|"6. 驗證令牌"| B
    B --&gt;|"7. 令牌有效"| D
    D --&gt;|"8. 授予存取權限"| A
    
    style B fill:#e3f2fd
    style C fill:#f3e5f5
    style D fill:#e8f5e9</div>
<h4 id="整合在一起">整合在一起</h4>
<p><strong>沒有 SSO（目前狀態）：</strong></p>
<pre class="language-none"><code class="language-none">你 → Nextcloud → 輸入 Nextcloud 的密碼
你 → Grafana → 輸入 Grafana 的密碼
你 → Jellyfin → 輸入 Jellyfin 的密碼
（15 個服務 = 15 個密碼！）</code></pre>
<p><strong>有 SSO（設定後）：</strong></p>
<pre class="language-none"><code class="language-none">你 → Nextcloud → 重新導向到 Authelia → 登入一次
你 → Grafana → 已登入（令牌存在）
你 → Jellyfin → 已登入（令牌存在）
（1 次登入 = 存取所有內容！）</code></pre>
<p>**魔法：**一旦你登入 Authelia，它會建立一個工作階段。你的所有應用程式都會向 Authelia 檢查：“這個使用者已登入嗎？” Authelia 說"是的！"然後它們讓你進入。</p>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>🎯 關鍵要點</p><div class="admonition-content"><ul>
<li><strong>IdP（Authelia）</strong> = 你登入的唯一地方</li>
<li><strong>服務提供者（你的應用程式）</strong> = 信任 IdP 的決定</li>
<li><strong>使用者目錄</strong> = 儲存使用者名稱/密碼的地方</li>
<li><strong>協定（OIDC/SAML）</strong> = 它們如何相互通訊</li>
</ul>
<p>你在 IdP 登入一次，你的所有應用程式都信任該登入。</p>
</div></div>
<h2 id="自架-vs-外部身分提供者">自架 vs 外部身分提供者</h2>
<p>在深入研究自架解決方案之前，你可能會想：“為什麼不直接使用 Google、Microsoft 或 GitHub 作為我的 IdP？”</p>
<h3 id="外部-IdP（Google、Microsoft、GitHub、Auth0）">外部 IdP（Google、Microsoft、GitHub、Auth0）</h3>
<p><strong>優點：</strong></p>
<ul>
<li>零維護</li>
<li>已經有帳戶</li>
<li>企業級安全性</li>
<li>個人使用免費</li>
<li>內建 MFA</li>
<li><strong>可以與 SaaS 聯合</strong>（如果你有企業訂閱）</li>
</ul>
<p><strong>缺點：</strong></p>
<ul>
<li><strong>隱私問題</strong> - 外部提供者看到你對家庭實驗室的每次登入</li>
<li><strong>網際網路依賴</strong> - 如果網際網路中斷，無法進行身分驗證</li>
<li><strong>服務中斷</strong> - 當他們的服務中斷時，你的家庭實驗室會中斷</li>
<li><strong>帳戶連結</strong> - 沒有外部帳戶就無法新增使用者</li>
<li><strong>服務條款</strong> - 受其規則和變更約束</li>
<li><strong>資料主權</strong> - 身分驗證資料離開你的網路</li>
<li><strong>限於其生態系統</strong> - 無法將 Google SSO 用於 Microsoft 服務</li>
</ul>
<h3 id="自架-IdP（Authelia、Authentik、Keycloak）">自架 IdP（Authelia、Authentik、Keycloak）</h3>
<p><strong>優點：</strong></p>
<ul>
<li><strong>完全隱私</strong> - 無外部追蹤</li>
<li><strong>離線工作</strong> - 網際網路中斷不影響本地服務</li>
<li><strong>完全控制</strong> - 你的規則，你的使用者</li>
<li><strong>自訂使用者</strong> - 新增家人/朋友而無需 Google 帳戶</li>
<li><strong>無供應商鎖定</strong> - 擁有你的身分驗證基礎設施</li>
<li><strong>學習機會</strong> - 了解 SSO 的運作方式</li>
<li><strong>聯合協定</strong> - 使用 OIDC/SAML（標準協定）</li>
</ul>
<p><strong>缺點：</strong></p>
<ul>
<li>需要設定和維護</li>
<li>你負責安全性</li>
<li>需要管理備份</li>
<li>比"使用 Google 登入"按鈕更複雜</li>
<li><strong>有限的 SaaS 整合</strong> - 大多數 SaaS 需要昂貴的企業計劃才能接受你的 IdP</li>
</ul>
<h3 id="混合方法">混合方法</h3>
<p>兩全其美：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Authentik 可以使用外部 IdP 作為來源</span>
<span class="token comment"># 使用者可以選擇：本地帳戶或 Google 或 GitHub</span></code></pre>
<p><strong>使用案例：</strong></p>
<ul>
<li><strong>自架主要</strong> + 外部作為備份</li>
<li><strong>家人的本地帳戶</strong> + 訪客的外部帳戶</li>
<li><strong>敏感服務的自架</strong> + 低風險應用程式的外部</li>
</ul>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>💡 何時使用外部 IdP</p><div class="admonition-content"><p>使用外部 IdP 如果：</p>
<ul>
<li>你可以接受 Google/Microsoft 看到你的登入活動</li>
<li>你的家庭實驗室始終連接網際網路</li>
<li>你只需要為自己進行身分驗證</li>
<li>你想要零維護</li>
<li>你有企業訂閱並想與 SaaS 整合</li>
</ul>
<p>使用自架如果：</p>
<ul>
<li>隱私很重要（無外部追蹤）</li>
<li>你想要離線功能</li>
<li>你需要管理多個使用者（家人/朋友）</li>
<li>你想學習和控制你的基礎設施</li>
<li>你有不應暴露給外部提供者的服務</li>
<li><strong>你只需要自架服務的 SSO</strong>（常見的家庭實驗室情況）</li>
</ul>
</div></div>
<p><strong>現實世界範例：</strong></p>
<p><strong>場景 1 - ISP 中斷：</strong><br>
使用外部 IdP，你無法登入本地 Home Assistant 檢查安全攝影機。使用自架 SSO，本地網路上的一切仍然正常運作。</p>
<p><strong>場景 2 - SaaS 整合：</strong><br>
你想為 GitHub 使用家庭實驗室 SSO。GitHub 需要 Enterprise（$21/使用者/月）才能接受自訂 SAML IdP。對於家庭實驗室來說，這太貴了，所以你將使用 GitHub 自己的身分驗證。</p>
<h2 id="選擇你的-SSO-解決方案">選擇你的 SSO 解決方案</h2>
<h3 id="選項-1：Authelia（輕量級，基於代理）">選項 1：Authelia（輕量級，基於代理）</h3>
<p>**最適合：**簡單設定，反向代理使用者</p>
<p><strong>優點：</strong></p>
<ul>
<li>輕量級（單一二進位檔）</li>
<li>適用於任何反向代理（Traefik、nginx）</li>
<li>簡單的 YAML 設定</li>
<li>內建 LDAP/檔案式驗證</li>
<li>優秀的文件</li>
</ul>
<p><strong>缺點：</strong></p>
<ul>
<li>有限的 OIDC 支援（基本）</li>
<li>無管理 UI（僅設定檔）</li>
<li>比 Authentik 更少的整合</li>
</ul>
<h3 id="選項-2：Authentik（功能齊全，現代）">選項 2：Authentik（功能齊全，現代）</h3>
<p>**最適合：**複雜設定，需要多種協定</p>
<p><strong>優點：</strong></p>
<ul>
<li>美觀的管理 UI</li>
<li>完整的 OIDC 和 SAML 支援</li>
<li>內建使用者管理</li>
<li>可自訂的登入流程</li>
<li>積極開發</li>
</ul>
<p><strong>缺點：</strong></p>
<ul>
<li>較重的資源使用</li>
<li>更複雜的設定</li>
<li>需要 PostgreSQL/Redis</li>
</ul>
<h3 id="選項-3：Keycloak（企業級）">選項 3：Keycloak（企業級）</h3>
<p>**最適合：**大型家庭實驗室，企業功能</p>
<p><strong>優點：</strong></p>
<ul>
<li>業界標準</li>
<li>全面的功能</li>
<li>優秀的 SAML/OIDC 支援</li>
<li>使用者聯合</li>
</ul>
<p><strong>缺點：</strong></p>
<ul>
<li>重度資源使用（基於 Java）</li>
<li>複雜的設定</li>
<li>對小型家庭實驗室來說過度</li>
</ul>
<h3 id="比較表">比較表</h3>
<table>
<thead>
<tr>
<th>功能</th>
<th>Authelia</th>
<th>Authentik</th>
<th>Keycloak</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>資源使用</strong></td>
<td>低</td>
<td>中</td>
<td>高</td>
</tr>
<tr>
<td><strong>設定複雜度</strong></td>
<td>低</td>
<td>中</td>
<td>高</td>
</tr>
<tr>
<td><strong>OIDC 支援</strong></td>
<td>基本</td>
<td>完整</td>
<td>完整</td>
</tr>
<tr>
<td><strong>SAML 支援</strong></td>
<td>❌ 否</td>
<td>✅ 是</td>
<td>✅ 是</td>
</tr>
<tr>
<td><strong>管理 UI</strong></td>
<td>❌ 否</td>
<td>✅ 是</td>
<td>✅ 是</td>
</tr>
<tr>
<td><strong>MFA</strong></td>
<td>✅ TOTP、WebAuthn</td>
<td>✅ TOTP、WebAuthn、Passkey</td>
<td>✅ 所有類型</td>
</tr>
<tr>
<td><strong>最適合</strong></td>
<td>小型實驗室</td>
<td>中型實驗室</td>
<td>企業</td>
</tr>
</tbody>
</table>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>💡 建議</p><div class="admonition-content"><ul>
<li><strong>從 Authelia 開始</strong>，如果你使用 Traefik/nginx 並想要簡單性</li>
<li><strong>選擇 Authentik</strong>，如果你需要 OIDC/SAML 並想要 UI</li>
<li><strong>僅在需要企業功能或已經了解時使用 Keycloak</strong></li>
</ul>
</div></div>
<p>由於文章很長，我將繼續翻譯剩餘部分。讓我知道是否需要繼續，或者你想要我現在創建簡體中文版本。</p>
<h2 id="設定-Authelia">設定 Authelia</h2>
<h3 id="架構">架構</h3>
<div class="mermaid">flowchart TD
  User["👤 使用者"]
  Proxy["🚪 反向代理 (Traefik/nginx)"]
  Authelia["🔐 Authelia"]
  LDAP["📚 使用者目錄 (YAML/LDAP)"]
  
  subgraph Services[" "]
    App1["📦 Nextcloud"]
    App2["🎬 Jellyfin"]
    App3["📊 Grafana"]
  end
  
  User --&gt; Proxy
  Proxy --&gt; Authelia
  Proxy --&gt; Services
  Authelia -.-&gt; LDAP
  
  style Authelia fill:#e3f2fd
  style Proxy fill:#fff3e0
  style LDAP fill:#f3e5f5
  style Services fill:#e8f5e9</div>
<h3 id="先決條件">先決條件</h3>
<ul>
<li>Docker 和 Docker Compose</li>
<li>反向代理（Traefik 或 nginx）</li>
<li>網域名稱（或本地 DNS）</li>
</ul>
<h3 id="步驟-1：建立目錄結構">步驟 1：建立目錄結構</h3>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> authelia/<span class="token punctuation">{</span>config,secrets<span class="token punctuation">}</span>
<span class="token builtin class-name">cd</span> authelia</code></pre>
<h3 id="步驟-2：產生密鑰">步驟 2：產生密鑰</h3>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># JWT 密鑰</span>
<span class="token function">tr</span> <span class="token parameter variable">-cd</span> <span class="token string">'[:alnum:]'</span> <span class="token operator">&lt;</span> /dev/urandom <span class="token operator">|</span> <span class="token function">fold</span> <span class="token parameter variable">-w</span> <span class="token string">"64"</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token operator">&gt;</span> secrets/jwt_secret

<span class="token comment"># 工作階段密鑰</span>
<span class="token function">tr</span> <span class="token parameter variable">-cd</span> <span class="token string">'[:alnum:]'</span> <span class="token operator">&lt;</span> /dev/urandom <span class="token operator">|</span> <span class="token function">fold</span> <span class="token parameter variable">-w</span> <span class="token string">"64"</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token operator">&gt;</span> secrets/session_secret

<span class="token comment"># 儲存加密金鑰</span>
<span class="token function">tr</span> <span class="token parameter variable">-cd</span> <span class="token string">'[:alnum:]'</span> <span class="token operator">&lt;</span> /dev/urandom <span class="token operator">|</span> <span class="token function">fold</span> <span class="token parameter variable">-w</span> <span class="token string">"64"</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token operator">&gt;</span> secrets/storage_encryption_key</code></pre>
<h3 id="步驟-3：建立設定">步驟 3：建立設定</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># config/configuration.yml</span>
<span class="token punctuation">---</span>
<span class="token key atrule">theme</span><span class="token punctuation">:</span> dark
<span class="token key atrule">default_2fa_method</span><span class="token punctuation">:</span> <span class="token string">"totp"</span>

<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">host</span><span class="token punctuation">:</span> 0.0.0.0
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9091</span>

<span class="token key atrule">log</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span> info

<span class="token key atrule">totp</span><span class="token punctuation">:</span>
  <span class="token key atrule">issuer</span><span class="token punctuation">:</span> homelab.local
  <span class="token key atrule">period</span><span class="token punctuation">:</span> <span class="token number">30</span>
  <span class="token key atrule">skew</span><span class="token punctuation">:</span> <span class="token number">1</span>

<span class="token key atrule">authentication_backend</span><span class="token punctuation">:</span>
  <span class="token key atrule">file</span><span class="token punctuation">:</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /config/users_database.yml
    <span class="token key atrule">password</span><span class="token punctuation">:</span>
      <span class="token key atrule">algorithm</span><span class="token punctuation">:</span> argon2id
      <span class="token key atrule">iterations</span><span class="token punctuation">:</span> <span class="token number">1</span>
      <span class="token key atrule">salt_length</span><span class="token punctuation">:</span> <span class="token number">16</span>
      <span class="token key atrule">parallelism</span><span class="token punctuation">:</span> <span class="token number">8</span>
      <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token number">64</span>

<span class="token key atrule">access_control</span><span class="token punctuation">:</span>
  <span class="token key atrule">default_policy</span><span class="token punctuation">:</span> deny
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">domain</span><span class="token punctuation">:</span> <span class="token string">"*.homelab.local"</span>
      <span class="token key atrule">policy</span><span class="token punctuation">:</span> two_factor

<span class="token key atrule">session</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> authelia_session
  <span class="token key atrule">domain</span><span class="token punctuation">:</span> homelab.local
  <span class="token key atrule">expiration</span><span class="token punctuation">:</span> 1h
  <span class="token key atrule">inactivity</span><span class="token punctuation">:</span> 5m
  <span class="token key atrule">remember_me_duration</span><span class="token punctuation">:</span> 1M

<span class="token key atrule">regulation</span><span class="token punctuation">:</span>
  <span class="token key atrule">max_retries</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">find_time</span><span class="token punctuation">:</span> 2m
  <span class="token key atrule">ban_time</span><span class="token punctuation">:</span> 5m

<span class="token key atrule">storage</span><span class="token punctuation">:</span>
  <span class="token key atrule">encryption_key_secret_file</span><span class="token punctuation">:</span> /secrets/storage_encryption_key
  <span class="token key atrule">local</span><span class="token punctuation">:</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /config/db.sqlite3

<span class="token key atrule">notifier</span><span class="token punctuation">:</span>
  <span class="token key atrule">filesystem</span><span class="token punctuation">:</span>
    <span class="token key atrule">filename</span><span class="token punctuation">:</span> /config/notification.txt</code></pre>
<h3 id="步驟-4：建立使用者">步驟 4：建立使用者</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># config/users_database.yml</span>
<span class="token key atrule">users</span><span class="token punctuation">:</span>
  <span class="token key atrule">alice</span><span class="token punctuation">:</span>
    <span class="token key atrule">displayname</span><span class="token punctuation">:</span> <span class="token string">"Alice Smith"</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"$argon2id$v=19$m=65536,t=3,p=4$..."</span>
    <span class="token key atrule">email</span><span class="token punctuation">:</span> alice@homelab.local
    <span class="token key atrule">groups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> admins
      <span class="token punctuation">-</span> users
  
  <span class="token key atrule">bob</span><span class="token punctuation">:</span>
    <span class="token key atrule">displayname</span><span class="token punctuation">:</span> <span class="token string">"Bob Jones"</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"$argon2id$v=19$m=65536,t=3,p=4$..."</span>
    <span class="token key atrule">email</span><span class="token punctuation">:</span> bob@homelab.local
    <span class="token key atrule">groups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> users</code></pre>
<p><strong>產生密碼雜湊：</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">--rm</span> authelia/authelia:latest authelia crypto <span class="token builtin class-name">hash</span> generate argon2 <span class="token parameter variable">--password</span> <span class="token string">'yourpassword'</span></code></pre>
<h3 id="步驟-5：Docker-Compose">步驟 5：Docker Compose</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># docker-compose.yml</span>
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.8'</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">authelia</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> authelia/authelia<span class="token punctuation">:</span>latest
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> authelia
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./config<span class="token punctuation">:</span>/config
      <span class="token punctuation">-</span> ./secrets<span class="token punctuation">:</span>/secrets
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 9091<span class="token punctuation">:</span><span class="token number">9091</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> TZ=America/New_York
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</code></pre>
<h3 id="步驟-6：與-Traefik-整合">步驟 6：與 Traefik 整合</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># docker-compose.yml（加入現有的 Traefik 設定）</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">authelia</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> authelia/authelia<span class="token punctuation">:</span>latest
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> authelia
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./authelia/config<span class="token punctuation">:</span>/config
      <span class="token punctuation">-</span> ./authelia/secrets<span class="token punctuation">:</span>/secrets
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.enable=true"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.authelia.rule=Host(`auth.homelab.local`)"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.authelia.entrypoints=websecure"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.authelia.tls=true"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.services.authelia.loadbalancer.server.port=9091"</span>
      
      <span class="token comment"># Authelia 中介軟體</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.middlewares.authelia.forwardauth.address=http://authelia:9091/api/verify?rd=https://auth.homelab.local"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.middlewares.authelia.forwardauth.trustForwardHeader=true"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.middlewares.authelia.forwardauth.authResponseHeaders=Remote-User,Remote-Groups,Remote-Name,Remote-Email"</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped

  <span class="token comment"># 受保護服務範例</span>
  <span class="token key atrule">nextcloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nextcloud<span class="token punctuation">:</span>latest
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.enable=true"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.nextcloud.rule=Host(`nextcloud.homelab.local`)"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.nextcloud.entrypoints=websecure"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.nextcloud.tls=true"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.nextcloud.middlewares=authelia@docker"</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</code></pre>
<h3 id="步驟-7：啟動服務">步驟 7：啟動服務</h3>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span></code></pre>
<p>造訪 <code>https://auth.homelab.local</code> 查看登入頁面。</p>
<h3 id="理解身分驗證流程">理解身分驗證流程</h3>
<p>現在你已經設定好 Authelia，讓我們看看當你存取受保護的服務時到底發生了什麼：</p>
<div class="mermaid">sequenceDiagram
    participant User
    participant App as 應用程式 (Nextcloud)
    participant SSO as SSO 提供者 (Authelia)
    participant LDAP as 使用者目錄 (YAML/LDAP)
    
    User-&gt;&gt;App: 1. 存取應用程式
    App-&gt;&gt;User: 2. 重新導向到 SSO 登入
    User-&gt;&gt;SSO: 3. 輸入憑證 + MFA
    SSO-&gt;&gt;LDAP: 4. 驗證憑證
    LDAP-&gt;&gt;SSO: 5. 使用者已驗證
    SSO-&gt;&gt;App: 6. 回傳驗證令牌
    App-&gt;&gt;User: 7. 授予存取權限
    
    Note over User,App: 使用者現在已登入！
    
    User-&gt;&gt;App: 8. 存取另一個應用程式 (Jellyfin)
    App-&gt;&gt;SSO: 9. 檢查現有工作階段
    SSO-&gt;&gt;App: 10. 有效工作階段存在
    App-&gt;&gt;User: 11. 授予存取權限（無需登入）</div>
<p><strong>幕後發生的事情：</strong></p>
<ol>
<li>**首次存取：**你造訪 <code>nextcloud.homelab.local</code></li>
<li>**Traefik 攔截：**向 Authelia 檢查 - “這個使用者已驗證嗎？”</li>
<li>**未驗證：**Authelia 將你重新導向到 <code>auth.homelab.local</code></li>
<li>**你登入：**輸入使用者名稱、密碼和 MFA 代碼</li>
<li>**Authelia 驗證：**對照使用者資料庫檢查憑證</li>
<li>**建立工作階段：**Authelia 建立工作階段 cookie</li>
<li>**重新導向回來：**你被送回 Nextcloud</li>
<li>**授予存取權限：**Traefik 看到有效工作階段，允許存取</li>
</ol>
<p><strong>第二個服務存取：</strong></p>
<ol>
<li>你造訪 <code>grafana.homelab.local</code></li>
<li>Traefik 向 Authelia 檢查 - “這個使用者已驗證嗎？”</li>
<li>Authelia 看到現有工作階段 cookie - “是的，是 Alice！”</li>
<li>立即授予存取權限 - <strong>無需登入</strong></li>
</ol>
<p>這就是 SSO 的魔法 - 一次登入，到處存取！</p>
<h2 id="新增多因素驗證">新增多因素驗證</h2>
<h3 id="MFA-選項概覽">MFA 選項概覽</h3>
<table>
<thead>
<tr>
<th>方法</th>
<th>安全性</th>
<th>便利性</th>
<th>成本</th>
<th>防釣魚</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Passkey (WebAuthn)</strong></td>
<td>最高</td>
<td>高</td>
<td>免費</td>
<td>✅ 是</td>
</tr>
<tr>
<td><strong>硬體金鑰</strong></td>
<td>最高</td>
<td>中</td>
<td>$25-50</td>
<td>✅ 是</td>
</tr>
<tr>
<td><strong>TOTP（驗證器應用程式）</strong></td>
<td>高</td>
<td>中</td>
<td>免費</td>
<td>❌ 否</td>
</tr>
<tr>
<td><strong>SMS</strong></td>
<td>低</td>
<td>高</td>
<td>需要 SMS 閘道</td>
<td>❌ 否</td>
</tr>
</tbody>
</table>
<h3 id="1-Passkey（WebAuthn）-推薦">1. Passkey（WebAuthn）- 推薦</h3>
<p><strong>什麼是 Passkey？</strong></p>
<p>Passkey 是使用生物辨識驗證（指紋、臉部、PIN）的密碼現代替代品。</p>
<p>**現實世界類比：**就像使用指紋解鎖手機，而不是輸入密碼。</p>
<p><strong>運作方式：</strong></p>
<ul>
<li>你的裝置儲存加密金鑰</li>
<li>你使用生物辨識（指紋/臉部）或裝置 PIN 進行驗證</li>
<li>沒有密碼可以被竊取或釣魚</li>
<li>透過雲端同步跨裝置運作（iCloud 鑰匙圈、Google 密碼管理員）</li>
</ul>
<p><strong>Authentik 設定：</strong></p>
<ol>
<li>使用者選單 → 設定</li>
<li>MFA 裝置 → 註冊</li>
<li>選擇 <strong>WebAuthn</strong> 或 <strong>Passkey</strong></li>
<li>按照瀏覽器提示：
<ul>
<li>**行動裝置：**使用指紋/Face ID</li>
<li>**筆記型電腦：**使用 Touch ID/Windows Hello</li>
<li>**桌上型電腦：**使用手機作為 passkey 或硬體金鑰</li>
</ul>
</li>
</ol>
<p><strong>Authelia 設定：</strong></p>
<ol>
<li>登入任何受保護的服務</li>
<li>點擊「註冊安全金鑰」</li>
<li>選擇 passkey 選項</li>
<li>使用生物辨識進行驗證</li>
</ol>
<p><strong>支援的平台：</strong></p>
<ul>
<li>✅ iPhone/iPad（iOS 16+）- Face ID/Touch ID</li>
<li>✅ Android（9+）- 指紋/臉部解鎖</li>
<li>✅ macOS（Ventura+）- Touch ID</li>
<li>✅ Windows（10+）- Windows Hello</li>
<li>✅ Chrome/Edge/Safari - 內建支援</li>
</ul>
<h3 id="2-硬體安全金鑰">2. 硬體安全金鑰</h3>
<p><strong>用於驗證的實體裝置：</strong></p>
<p><strong>Authentik：</strong></p>
<ol>
<li>使用者選單 → 設定</li>
<li>MFA 裝置 → 註冊</li>
<li>選擇 WebAuthn</li>
<li>插入安全金鑰（YubiKey 等）</li>
<li>提示時觸碰金鑰</li>
</ol>
<p><strong>熱門硬體金鑰：</strong></p>
<ul>
<li><strong>YubiKey 5</strong>（$45-50）- USB-A/C、NFC</li>
<li><strong>YubiKey 5C Nano</strong>（$55）- 留在 USB-C 埠</li>
<li><strong>Google Titan</strong>（$30）- USB-A/C、藍牙</li>
<li><strong>Feitian</strong>（$20-30）- 預算選項</li>
</ul>
<h3 id="3-TOTP（驗證器應用程式）">3. TOTP（驗證器應用程式）</h3>
<p><strong>來自應用程式的基於時間的代碼：</strong></p>
<p><strong>Authelia（內建）：</strong></p>
<ol>
<li>登入任何受保護的服務</li>
<li>點擊「註冊裝置」</li>
<li>使用驗證器應用程式掃描 QR 碼</li>
<li>輸入 6 位數代碼進行驗證</li>
</ol>
<p><strong>Authentik：</strong></p>
<ol>
<li>使用者選單 → 設定</li>
<li>MFA 裝置 → 註冊</li>
<li>選擇 TOTP</li>
<li>掃描 QR 碼</li>
</ol>
<p><strong>推薦的驗證器應用程式：</strong></p>
<ul>
<li><strong>Aegis</strong>（Android）- 開源、加密備份</li>
<li><strong>Raivo OTP</strong>（iOS）- 開源、iCloud 同步</li>
<li><strong>2FAS</strong>（iOS/Android）- 免費、雲端備份</li>
<li><strong>Authy</strong>（iOS/Android）- 多裝置同步</li>
<li><strong>Google Authenticator</strong>（iOS/Android）- 簡單、雲端備份</li>
</ul>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>💡 MFA 最佳實踐</p><div class="admonition-content"><p><strong>優先順序：</strong></p>
<ol>
<li><strong>Passkeys</strong> - 最安全且方便（使用生物辨識）</li>
<li><strong>硬體金鑰</strong> - 非常安全，需要實體裝置</li>
<li><strong>TOTP 應用程式</strong> - 安全，但可能被釣魚</li>
<li><strong>避免 SMS</strong> - 容易受到 SIM 卡交換攻擊</li>
</ol>
<p><strong>建議：</strong></p>
<ul>
<li><strong>管理員始終需要 MFA</strong>（使用 passkeys 或硬體金鑰）</li>
<li><strong>家人可選</strong>（減少摩擦，passkeys 很容易）</li>
<li><strong>備份代碼</strong> - 產生並安全儲存</li>
<li><strong>多種方法</strong> - 註冊 passkey + TOTP 作為備份</li>
<li><strong>Passkeys 同步</strong> - 使用 iCloud/Google 從所有裝置存取</li>
</ul>
</div></div>
<h2 id="啟用-SSO-後是否應保留本地帳戶？">啟用 SSO 後是否應保留本地帳戶？</h2>
<p><strong>簡短答案：是的，始終保留本地帳戶作為備份。</strong></p>
<h3 id="為什麼保留本地帳戶？">為什麼保留本地帳戶？</h3>
<p>**SSO 是單點故障。**如果你的 SSO 系統故障，你將被鎖定在所有內容之外。</p>
<p><strong>SSO 故障的現實世界場景：</strong></p>
<ol>
<li><strong>SSO 容器崩潰</strong> - Docker/Kubernetes 問題</li>
<li><strong>資料庫損壞</strong> - Authelia/Authentik 資料庫問題</li>
<li><strong>設定錯誤</strong> - 設定中的錯字破壞驗證</li>
<li><strong>憑證過期</strong> - HTTPS 憑證過期，SSO 無法存取</li>
<li><strong>網路問題</strong> - DNS 問題、反向代理故障</li>
<li><strong>意外刪除</strong> - 哎呀，刪除了錯誤的容器</li>
</ol>
<p><strong>沒有本地帳戶會發生什麼：</strong></p>
<pre class="language-none"><code class="language-none">SSO 故障 → 無法登入任何內容 → 甚至無法存取 SSO 進行修復 → 被鎖定</code></pre>
<p><strong>有本地帳戶作為備份：</strong></p>
<pre class="language-none"><code class="language-none">SSO 故障 → 使用本地管理員帳戶 → 修復 SSO → 恢復正常</code></pre>
<h3 id="本地帳戶的最佳實踐">本地帳戶的最佳實踐</h3>
<div class="admonition danger"><p class="admonition-title"><span class="mdi mdi-alert-circle-outline admonition-icon"></span>🔒 關鍵：保護你的本地帳戶</p><div class="admonition-content"><p>本地帳戶繞過 SSO，因此必須受到保護：</p>
<ul>
<li><strong>強密碼</strong> - 使用密碼管理員，20+ 個字元</li>
<li><strong>在本地帳戶上啟用 MFA</strong> - 許多服務支援此功能</li>
<li><strong>限制本地帳戶</strong> - 僅為管理員/緊急存取建立</li>
<li><strong>不同的密碼</strong> - 不要重複使用 SSO 密碼</li>
<li><strong>記錄憑證</strong> - 安全儲存（密碼管理員、加密檔案）</li>
</ul>
</div></div>
<h3 id="支援本地帳戶-MFA-的服務">支援本地帳戶 MFA 的服務</h3>
<p><strong>Proxmox：</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 為本地 root 帳戶啟用 TOTP</span>
<span class="token comment"># 資料中心 → 權限 → 雙因素</span>
<span class="token comment"># 為使用者 root@pam 新增 TOTP</span></code></pre>
<p><strong>Nextcloud：</strong></p>
<ul>
<li>設定 → 安全性 → 雙因素驗證</li>
<li>即使對本地管理員帳戶也啟用 TOTP</li>
</ul>
<p><strong>Grafana：</strong></p>
<pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># grafana.ini</span>
<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">auth</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">login_maximum_inactive_lifetime_duration</span> <span class="token punctuation">=</span> <span class="token value attr-value">7d</span>
<span class="token key attr-name">login_maximum_lifetime_duration</span> <span class="token punctuation">=</span> <span class="token value attr-value">30d</span>

<span class="token comment"># 本地管理員仍可透過驗證器應用程式使用 MFA</span></code></pre>
<p><strong>Home Assistant：</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># configuration.yaml</span>
<span class="token key atrule">auth_providers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> homeassistant  <span class="token comment"># 本地帳戶</span>
  <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> command_line   <span class="token comment"># SSO 整合</span>

<span class="token comment"># 在 UI 中為本地帳戶啟用 MFA：</span>
<span class="token comment"># 個人資料 → 安全性 → 多因素驗證</span></code></pre>
<h3 id="設定策略">設定策略</h3>
<p><strong>選項 1：雙重驗證（推薦）</strong></p>
<p>允許 SSO 和本地登入：</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">// Nextcloud - 不隱藏密碼表單</span>
<span class="token string single-quoted-string">'oidc_login_hide_password_form'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// 保持本地登入可見</span>
<span class="token string single-quoted-string">'oidc_login_auto_redirect'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>       <span class="token comment">// 不強制 SSO</span></code></pre>
<p><strong>選項 2：隱藏本地登入</strong></p>
<p>隱藏本地登入但透過直接 URL 保持可存取：</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">// Nextcloud - 隱藏但保持功能</span>
<span class="token string single-quoted-string">'oidc_login_hide_password_form'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>   <span class="token comment">// 隱藏本地登入</span>
<span class="token comment">// 存取本地登入：https://nextcloud.local/login?direct=1</span></code></pre>
<p><strong>選項 3：僅 SSO 加緊急帳戶</strong></p>
<p>對所有人強制 SSO，除了一個緊急管理員：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Authelia - 緊急存取繞過 SSO</span>
<span class="token key atrule">access_control</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">domain</span><span class="token punctuation">:</span> <span class="token string">"*.homelab.local"</span>
      <span class="token key atrule">policy</span><span class="token punctuation">:</span> bypass
      <span class="token key atrule">subject</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">"user:emergency-admin"</span>
      <span class="token key atrule">resources</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">"^/admin/emergency.*$"</span></code></pre>
<h3 id="緊急存取檢查清單">緊急存取檢查清單</h3>
<ul>
<li>[ ] <strong>每個關鍵服務上都存在本地管理員帳戶</strong></li>
<li>[ ] <strong>所有本地帳戶都有強唯一密碼</strong></li>
<li>[ ] <strong>在支援的本地帳戶上啟用 MFA</strong></li>
<li>[ ] <strong>憑證記錄在安全位置</strong>（密碼管理員）</li>
<li>[ ] <strong>每月測試本地登入</strong>以確保其運作</li>
<li>[ ] <strong>記錄恢復程序</strong> - 如何修復 SSO</li>
<li>[ ] <strong>SSO 設定的備份</strong> - 可以快速恢復</li>
</ul>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>💡 黃金法則</p><div class="admonition-content"><p><strong>始終維護安全的後門：</strong></p>
<ul>
<li>SSO 是你的前門（方便、安全）</li>
<li>本地帳戶是你的緊急出口（很少使用，始終可用）</li>
<li>兩者都應使用 MFA 保護</li>
<li>定期測試兩者</li>
</ul>
<p>把它想像成在房子外面藏一把備用鑰匙 - 你很少需要它，但當你需要時，你會很高興它在那裡！</p>
</div></div>
<h2 id="資源">資源</h2>
<ul>
<li>**<a target="_blank" rel="noopener" href="https://www.authelia.com/">Authelia 文件</a>：**完整的 Authelia 指南</li>
<li>**<a target="_blank" rel="noopener" href="https://goauthentik.io/docs/">Authentik 文件</a>：**Authentik 設定和配置</li>
<li>**<a target="_blank" rel="noopener" href="https://www.keycloak.org/documentation">Keycloak 文件</a>：**企業 SSO 指南</li>
<li>**<a target="_blank" rel="noopener" href="https://openid.net/connect/">OIDC 說明</a>：**理解 OpenID Connect</li>
</ul>
<h2 id="結論">結論</h2>
<p>在家中設定 SSO 將你的家庭實驗室從一系列獨立服務轉變為統一平台。初始設定投資立即透過便利性和改進的安全性得到回報。</p>
<p><strong>關鍵要點：</strong></p>
<ul>
<li>SSO 消除了多個服務的密碼疲勞</li>
<li><strong>Authelia 最適合簡單設定</strong>，配合反向代理</li>
<li><strong>Authentik 提供完整功能</strong>，配有美觀的 UI</li>
<li>轉發驗證保護任何服務</li>
<li>MFA 新增關鍵安全層</li>
<li>LDAP 整合可擴展用於更大的部署</li>
<li>定期備份至關重要（SSO 是單點故障）</li>
<li><strong>家庭實驗室 SSO 限於自架服務</strong> - SaaS 整合需要昂貴的企業計劃</li>
<li>聯合（OIDC/SAML）實現跨系統 SSO，但 WIA 是非聯合的</li>
</ul>
<p><strong>快速入門建議：</strong></p>
<p>對於大多數家庭實驗室：</p>
<ol>
<li>從 <strong>Authelia</strong> + Traefik 開始（最簡單的路徑）</li>
<li>最初使用基於檔案的身分驗證</li>
<li>為管理員帳戶新增 MFA</li>
<li>逐步將服務遷移到 SSO</li>
<li>如果以後需要 OIDC/SAML，考慮 Authentik</li>
</ol>
<p>從 2-3 個服務開始，熟悉流程，然後擴展。當你不再需要處理數十個密碼時，未來的你會感謝你！🔐</p>

        </div>
        <footer class="article-footer">
            
    <a data-url="https://neo01.com/zh-TW/2025/01/Single-Sign-On-at-Home/" data-id="65b6ebc3" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url').replace("http://","https://"),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
    <!--script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": {
            "@type": "Person",
            "name": "Neo Alienson"
        },
        "headline": "在家中建立單一登入系統",
        "image": "https://neo01.com",
        "keywords": "Cybersecurity Homelab Authentication SSO",
        "genre": "Cybersecurity",
        "datePublished": "2025-01-15",
        "dateCreated": "2025-01-15",
        "dateModified": "2025-10-12",
        "url": "https://neo01.com//zh-TW/2025/01/Single-Sign-On-at-Home/",
        "description": "厭倦了管理家庭實驗室服務的數十個密碼？學習如何建立單一登入系統，只需一次登入即可存取所有服務。",
        "wordCount": 2778
    }
</script-->

</article>

                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>追蹤 :</p>
        <ul class="social-links">
                <li>
                    <a class="social-tooltip" title="stack-exchange" href="https://stackexchange.com/users/2122053/neo?tab=accounts" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-exchange"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="stack-overflow" href="https://stackoverflow.com/users/1885105/neo" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-overflow"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/neoalienson" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-github"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="linkedin" href="https://linkedin.com/in/neo01" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-linkedin"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="rss" href="/atom.xml" target="_blank" rel="noopener">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
        </ul>
    </div>
    <div class="widgets-container">
        
            
                <div class="widget-wrap widget-list">
    <h3 class="widget-title">連結</h3>
    <div class="widget">
        <ul><li><a href="/zh-TW/ai">AI 遊樂場</a></li><li><a href="/zh-TW/tools">工具</a></li><li><a href="/zh-TW/games">遊戲</a></li><li><a href="/zh-TW/pages/useful-information">實用資訊</a></li><li><a href="/zh-TW/pages/Hexo-Blogging-Cheatsheet">Hexo 部落格速查表</a></li></ul>
    </div>
</div>

            
                    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/10/Tools-Games-And-Browser-Built-In-AI/" class="thumbnail">
        <span style="background-image:url(/2025/10/Tools-Games-And-Browser-Built-In-AI/thumbnail.jpeg)" alt="工具、遊戲與瀏覽器內建 AI 遊樂場" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/AI/">人工智慧</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/10/Tools-Games-And-Browser-Built-In-AI/" class="title">工具、遊戲與瀏覽器內建 AI 遊樂場</a></p>
                            <p class="item-date"><time datetime="2025-10-01T16:00:00.000Z" itemprop="datePublished">2025-10-02</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/" class="thumbnail">
        <span style="background-image:url(/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/thumbnail.jpeg)" alt="代理式編碼的崛起：AI 驅動的軟體工程" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/AI/">人工智慧</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/" class="title">代理式編碼的崛起：AI 驅動的軟體工程</a></p>
                            <p class="item-date"><time datetime="2025-09-19T16:00:00.000Z" itemprop="datePublished">2025-09-20</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports_Part2/" class="thumbnail">
        <span style="background-image:url(/2025/08/Understanding_Ephemeral_Ports_Part1/thumbnail.png)" alt="理解臨時埠 Part 2：為什麼伺服器應用程式應避免使用動態埠" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/Development/">開發</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports_Part2/" class="title">理解臨時埠 Part 2：為什麼伺服器應用程式應避免使用動態埠</a></p>
                            <p class="item-date"><time datetime="2025-08-30T16:00:00.000Z" itemprop="datePublished">2025-08-31</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports_Part1/" class="thumbnail">
        <span style="background-image:url(/2025/08/Understanding_Ephemeral_Ports_Part1/thumbnail.png)" alt="理解臨時埠：網路通訊的隱形工作者" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/Development/">開發</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports_Part1/" class="title">理解臨時埠：網路通訊的隱形工作者</a></p>
                            <p class="item-date"><time datetime="2025-08-29T16:00:00.000Z" itemprop="datePublished">2025-08-30</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/07/Architecture_As_Code_Part_2_Building_the_Foundation/" class="thumbnail">
        <span style="background-image:url(/2025/07/Architecture_As_Code_Part_2_Building_the_Foundation/thumbnail.jpg)" alt="架構即程式碼：第二部分 - 建立基礎" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/Architecture/">架構</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/07/Architecture_As_Code_Part_2_Building_the_Foundation/" class="title">架構即程式碼：第二部分 - 建立基礎</a></p>
                            <p class="item-date"><time datetime="2025-07-19T16:00:00.000Z" itemprop="datePublished">2025-07-20</time></p>
                        </div>
                    </li>
            </ul>
        </div>
    </div>

            
                
    
    
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">所有文章</h3>
        <div class="widget">
            <ul class="archive-list">
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2025/">2025</a>
                    <span class="archive-list-count">11</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2024/">2024</a>
                    <span class="archive-list-count">24</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2023/">2023</a>
                    <span class="archive-list-count">12</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2022/">2022</a>
                    <span class="archive-list-count">2</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2020/">2020</a>
                    <span class="archive-list-count">5</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2019/">2019</a>
                    <span class="archive-list-count">12</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2018/">2018</a>
                    <span class="archive-list-count">2</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2017/">2017</a>
                    <span class="archive-list-count">5</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2016/">2016</a>
                    <span class="archive-list-count">4</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2015/">2015</a>
                    <span class="archive-list-count">6</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2014/">2014</a>
                    <span class="archive-list-count">7</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2013/">2013</a>
                    <span class="archive-list-count">2</span>
                </li>
            
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <!-- disable caching cause each page has different footer from qrcode -->
        <!-- common/footer, null, {cache: !config.relative_link})  -->
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="qrcode-share-wrapper">
                <div class="qrcode-text">https://neo01.com/l#57700f21</div>
                <img src="/qr/qr-4d0717da2333486e02afd618edacfd2a.svg" width="200" height="200" alt="QR Code for https://neo01.com/l#57700f21">
            </div>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" title="Homepage" class="logo"></a>
                </h1>
                
                <p>© 2025 Neo Alienson. 版權所有.
                  <a href="/zh-TW/terms-and-conditions">使用條款</a></p>
                
            </div>
            <div class="footer-plugins">
              


            </div>
        </div>
    </div>
</footer>

        
    
        


        


        


        


        


        


        


        


        


    



<!-- Custom Scripts -->




    </div>
<!-- hexo injector body_end start --><script type="text/javascript" src="/js/bundle_last.js"></script><!-- hexo injector body_end end -->

</body></html>