<!DOCTYPE html><html lang="zh-TW"><head><!-- hexo injector head_begin start --><!-- Google tag (gtag.js) begins-->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3DZR3TQYCY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-3DZR3TQYCY');
    </script>
    <!-- Google tag (gtag.js) ends-->
    <!-- hexo injector head_begin end -->
    <meta charset="utf-8">
    <!-- security headers starts -->
    <!-- meta http-equiv="content-security-policy" content="script-src 'sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=' 'sha256-lJjk3/dvd+wXqRFjV7T5L/nXJXr5NjUjmsKSPEe+ass=';" -->
    <!-- security headers ends -->
    <!-- favicon starts -->    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <!-- favicon ends -->
    

    
    <title>速率限制模式：高效管理受限服務 | Decoding Digital Anomalies</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="keywords" content="">
    
    
    <meta name="description" content="了解速率限制模式如何幫助你避免節流錯誤，並在使用有限制的服務時提升吞吐量。">
<meta property="og:type" content="article">
<meta property="og:title" content="速率限制模式：高效管理受限服務">
<meta property="og:url" content="https://neo01.com/zh-TW/2019/01/Rate-Limiting-Pattern/index.html">
<meta property="og:site_name" content="Decoding Digital Anomalies">
<meta property="og:description" content="了解速率限制模式如何幫助你避免節流錯誤，並在使用有限制的服務時提升吞吐量。">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://neo01.com/zh-TW/2019/01/Rate-Limiting-Pattern/thumbnail.png">
<meta property="article:published_time" content="2019-01-14T16:00:00.000Z">
<meta property="article:modified_time" content="2025-10-12T11:06:35.057Z">
<meta property="article:author" content="Neo Alienson">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://neo01.com/zh-TW/2019/01/Rate-Limiting-Pattern/thumbnail.png">
    
    

    
        <link rel="alternate" href="/atom.xml" title="Decoding Digital Anomalies" type="application/atom+xml">
    

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/libs/titillium-web/styles.css">


    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/css/prism-line-numbers.css">

    
<link rel="stylesheet" href="/css/prism.min.css">


    


    


    
    
        
<link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">

    
    
        
<link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">

    


<!-- hexo injector head_end start --><script type="text/javascript" src="/js/bundle_first.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="stylesheet" type="text/css" href="/cache/cookieconsent.css"><style id="admonition-styles">.admonition {
  margin: 1em 0;
  padding: 0rem;
  border-left: 0.3rem solid;
  border-radius: 0.4rem;
  background-color: #f9f9f9;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
  overflow: hidden;
  page-break-inside: avoid;
}

.admonition-title {
  display: flex;
  align-items: center;
  font-weight: 600;
  padding: 0rem 1rem 0.1rem 0.75rem;
  font-size: 1.05em;
  background-color: rgba(0, 0, 0, 0.03);
  border-top-left-radius: 0.4rem;
  border-top-right-radius: 0.4rem;
  margin: 0 !important;
}

.admonition-icon {
  font-size: 1.2em;
  margin-right: 0.6rem;
  opacity: 0.85;
  margin-top: 0.1rem;
}

/* 内容区域 margin */
.admonition > *:not(.admonition-title) {
  margin: 0.6rem 1rem 0.6rem 1rem;
}

/* NOTE 类型 */
.admonition.anote {
  border-color: #448aff;
}
.admonition.anote > .admonition-title {
  background-color: #448aff1a;
  color: #2962ff;
}

/* INFO / TODO 类型 */
.admonition.info,
.admonition.todo {
  border-color: #00b8d4;
}
.admonition.info > .admonition-title,
.admonition.todo > .admonition-title {
  background-color: rgba(0, 184, 212, 0.1);
  color: #007c91;
}

/* 警告类 */
.admonition.warning,
.admonition.attention,
.admonition.caution {
  border-color: #ff9100;
}
.admonition.warning > .admonition-title,
.admonition.attention > .admonition-title,
.admonition.caution > .admonition-title {
  background-color: rgba(255, 145, 0, 0.1);
  color: #c66900;
}

/* 错误类 */
.admonition.failure,
.admonition.missing,
.admonition.fail,
.admonition.error,
.admonition.danger,
.admonition.bug {
  border-color: #ff5252;
}
.admonition.failure > .admonition-title,
.admonition.missing > .admonition-title,
.admonition.fail > .admonition-title,
.admonition.error > .admonition-title,
.admonition.danger > .admonition-title,
.admonition.bug > .admonition-title {
  background-color: rgba(255, 82, 82, 0.1);
  color: #b71c1c;
}

/* TIP 类型 */
.admonition.tip {
  border-color: #00bfa5;
}
.admonition.tip > .admonition-title {
  background-color: #00bfa51a;
  color: #00796b;
}

/* SUCCESS 类型 */
.admonition.success {
  border-color: #00c853;
}
.admonition.success > .admonition-title {
  background-color: #00c8531a;
  color: #2e7d32;
}

/* QUESTION 类型 */
.admonition.question {
  border-color: #64dd17;
}
.admonition.question > .admonition-title {
  background-color: #64dd171a;
  color: #558b2f;
}

/* EXAMPLE 类型 */
.admonition.example {
  border-color: #7c4dff;
}
.admonition.example > .admonition-title {
  background-color: #7c4dff1a;
  color: #512da8;
}

/* QUOTE 类型 */
.admonition.quote {
  border-color: #9e9e9e;
}
.admonition.quote > .admonition-title {
  background-color: #9e9e9e1a;
  color: #424242;
}

/*黑暗模式*/
/* 夜间模式基础样式 */
[data-theme="dark"] .admonition {
  background-color: #1e1e1e;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
}

[data-theme="dark"] .admonition-title {
  background-color: rgba(255, 255, 255, 0.05);
}

/* anote */
[data-theme="dark"] .admonition.anote {
  border-color: #82b1ff;
}
[data-theme="dark"] .admonition.anote > .admonition-title {
  background-color: #82b1ff1a;
  color: #bbdefb;
}

/* tip */
[data-theme="dark"] .admonition.tip {
  border-color: #64ffda;
}
[data-theme="dark"] .admonition.tip > .admonition-title {
  background-color: #64ffda1a;
  color: #1de9b6;
}

/* success */
[data-theme="dark"] .admonition.success {
  border-color: #69f0ae;
}
[data-theme="dark"] .admonition.success > .admonition-title {
  background-color: #69f0ae1a;
  color: #00e676;
}

/* question */
[data-theme="dark"] .admonition.question {
  border-color: #b2ff59;
}
[data-theme="dark"] .admonition.question > .admonition-title {
  background-color: #b2ff591a;
  color: #aeea00;
}

/* example */
[data-theme="dark"] .admonition.example {
  border-color: #b388ff;
}
[data-theme="dark"] .admonition.example > .admonition-title {
  background-color: #b388ff1a;
  color: #b39ddb;
}

/* quote */
[data-theme="dark"] .admonition.quote {
  border-color: #bdbdbd;
}
[data-theme="dark"] .admonition.quote > .admonition-title {
  background-color: #bdbdbd1a;
  color: #eeeeee;
}

/* warning / attention / caution */
[data-theme="dark"] .admonition.warning,
[data-theme="dark"] .admonition.attention,
[data-theme="dark"] .admonition.caution {
  border-color: #ffb300;
}
[data-theme="dark"] .admonition.warning > .admonition-title,
[data-theme="dark"] .admonition.attention > .admonition-title,
[data-theme="dark"] .admonition.caution > .admonition-title {
  background-color: #ffb3001a;
  color: #ffe082;
}

/* error / fail / failure / bug / danger / missing */
[data-theme="dark"] .admonition.error,
[data-theme="dark"] .admonition.fail,
[data-theme="dark"] .admonition.failure,
[data-theme="dark"] .admonition.bug,
[data-theme="dark"] .admonition.missing,
[data-theme="dark"] .admonition.danger {
  border-color: #ef5350;
}
[data-theme="dark"] .admonition.error > .admonition-title,
[data-theme="dark"] .admonition.fail > .admonition-title,
[data-theme="dark"] .admonition.failure > .admonition-title,
[data-theme="dark"] .admonition.bug > .admonition-title,
[data-theme="dark"] .admonition.missing > .admonition-title,
[data-theme="dark"] .admonition.danger > .admonition-title {
  background-color: #ef53501a;
  color: #ff8a80;
}</style><script id="echarts-scripts" src="/cache/echarts.min.local.js"></script><script id="mermaid-scripts" src="/cache/mermaid.min.local.js"></script>
<script>mermaid.initialize({theme: 'default'});</script></head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" title="Homepage" class="logo"></a>
                    </h1>
                    
                        <h2 class="subtitle-wrap">
                          
                            <p class="title">解碼數位異象</p>
                          
                          <p class="subtitle">有時功能就是數位兔子洞中的錯誤，反之亦然</p>
                        </h2>
                    
                    <div id="lang-selector">
                        <span class="lang-icon">🌐</span>
                        
                        
                            
                            
                            <a href="/2019/01/Rate-Limiting-Pattern/" class="lang-link">English</a>
                        
                            
                            <span class="lang-sep">|</span>
                            <a href="/zh-CN/2019/01/Rate-Limiting-Pattern/" class="lang-link">简体中文</a>
                        
                    </div>
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/zh-TW/">首頁</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/AI/">人工智慧</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/AI/Art-Gallery/">藝術畫廊</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Architecture/">架構</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Cybersecurity/">資訊安全</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Development/">開發</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Misc/">雜項</a></li></ul>
                                    
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/zh-TW/about-me">關於</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" id="search-form-input" placeholder="搜尋">
        <button type="submit" title="搜尋" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" id="ins-search-input" placeholder="輸入關鍵字...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script integrity="sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=">
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '頁面',
            CATEGORIES: '分類',
            TAGS: '標籤',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
        LANG: 'zh-TW',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>




</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Architecture/">Architecture</a>
    </h1>
</div>

                        <div class="main-body-content">
                            <article id="post-2019/01/Rate-Limiting-Pattern-zh-TW" class="article article-single article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner responsive-content">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        速率限制模式：高效管理受限服務
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
      <i class="fa fa-calendar"></i>
        
          Created <time datetime="2019-01-14T16:00:00.000Z" itemprop="datePublished">2019-01-15</time>
          &nbsp;<i class="fa fa-calendar"></i>
          Updated <time datetime="2025-10-12T11:06:35.057Z" itemprop="datePublished">2025-10-12</time>
        
    </div>


                

                
            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%83%85%E5%A2%83%E8%88%87%E5%95%8F%E9%A1%8C"><span class="toc-text">情境與問題</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%A1%88"><span class="toc-text">解決方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%8F%E9%A1%8C%E8%88%87%E8%80%83%E9%87%8F"><span class="toc-text">問題與考量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%95%E6%99%82%E4%BD%BF%E7%94%A8%E6%AD%A4%E6%A8%A1%E5%BC%8F"><span class="toc-text">何時使用此模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B%E6%9E%B6%E6%A7%8B"><span class="toc-text">範例架構</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E9%97%9C%E6%A8%A1%E5%BC%8F"><span class="toc-text">相關模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99"><span class="toc-text">參考資料</span></a></li></ol>
            <p><img src="/2019/01/Rate-Limiting-Pattern/banner.png" alt=""></p>
<p>許多服務使用節流來控制資源消耗，對應用程式存取它們的速率施加限制。速率限制模式幫助你避免節流錯誤並準確預測吞吐量，特別是對於大規模重複性自動化任務（如批次處理）。</p>
<h2 id="情境與問題">情境與問題</h2>
<p>對受節流服務執行大量操作可能導致流量增加和效率降低。你需要追蹤被拒絕的請求並重試操作，可能需要多次傳遞才能完成工作。</p>
<p>考慮這個將資料匯入資料庫的範例：</p>
<ul>
<li>你的應用程式需要匯入 10,000 筆記錄。每筆記錄需要 10 個請求單位（RUs），總共需要 100,000 RUs。</li>
<li>你的資料庫實例有 20,000 RUs 的佈建容量。</li>
<li>你傳送所有 10,000 筆記錄。2,000 筆成功，8,000 筆被拒絕。</li>
<li>你重試 8,000 筆記錄。2,000 筆成功，6,000 筆被拒絕。</li>
<li>你重試 6,000 筆記錄。2,000 筆成功，4,000 筆被拒絕。</li>
<li>你重試 4,000 筆記錄。2,000 筆成功，2,000 筆被拒絕。</li>
<li>你重試 2,000 筆記錄。全部成功。</li>
</ul>
<p>工作完成了，但只是在傳送了 30,000 筆記錄之後——是實際資料集大小的三倍。</p>
<p>這種天真方法的額外問題：</p>
<ul>
<li><strong>錯誤處理開銷</strong>：20,000 個錯誤需要記錄和處理，消耗記憶體和儲存空間。</li>
<li><strong>無法預測的完成時間</strong>：不知道節流限制，你無法估計處理需要多長時間。</li>
</ul>
<h2 id="解決方案">解決方案</h2>
<p>速率限制透過控制在一段時間內傳送到服務的記錄數量來減少流量並提升吞吐量。</p>
<p>服務基於不同指標進行節流：</p>
<ul>
<li><strong>操作數量</strong>（例如，每秒 20 個請求）</li>
<li><strong>資料量</strong>（例如，每分鐘 2 GiB）</li>
<li><strong>操作的相對成本</strong>（例如，每秒 20,000 RUs）</li>
</ul>
<p>你的速率限制實作必須控制傳送到服務的操作，在不超過容量的情況下優化使用。</p>
<h3 id="使用持久化訊息系統">使用持久化訊息系統</h3>
<p>當你的 API 可以比受節流服務允許的速度更快地處理請求時，你需要管理匯入速度。簡單地緩衝請求是有風險的——如果你的應用程式崩潰，你會失去緩衝的資料。</p>
<p>相反，將記錄傳送到可以處理你完整匯入速率的持久化訊息系統。使用作業處理器以受節流服務限制內的受控速率讀取記錄。</p>
<p>持久化訊息選項包括：</p>
<ul>
<li>訊息佇列（例如，RabbitMQ、ActiveMQ）</li>
<li>事件串流平台（例如，Apache Kafka）</li>
<li>雲端佇列服務</li>
</ul>
<div class="mermaid">graph LR
    A["API<br>(高速率)"] --&gt; B["持久化<br>訊息佇列"]
    B --&gt; C["作業處理器 1"]
    B --&gt; D["作業處理器 2"]
    B --&gt; E["作業處理器 3"]
    C --&gt; F["受節流服務<br>(有限速率)"]
    D --&gt; F
    E --&gt; F
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style F fill:#ffe1e1</div>
<h3 id="細粒度時間間隔">細粒度時間間隔</h3>
<p>服務通常基於可理解的時間跨度（每秒或每分鐘）進行節流，但電腦處理速度要快得多。與其每秒批次釋放一次，不如更頻繁地傳送較小的數量以：</p>
<ul>
<li>保持資源消耗（記憶體、CPU、網路）均勻流動</li>
<li>防止突發請求造成的瓶頸</li>
</ul>
<p>例如，如果服務允許每秒 100 個操作，每 200 毫秒釋放 20 個操作：</p>
<div id="chart_ox014e1ac" class="echarts" style="width: 800px; height: 600px;"></div>
<script>
(function() {
    if (typeof echarts !== 'undefined') {
        var chart = echarts.init(document.getElementById('chart_ox014e1ac'));
        var option = {
  "title": {
    "text": "速率限制：平滑 vs 突發流量"
  },
  "tooltip": {
    "trigger": "axis"
  },
  "legend": {
    "data": ["突發 (100/秒)", "平滑 (20/200毫秒)"]
  },
  "xAxis": {
    "type": "category",
    "data": ["0毫秒", "200毫秒", "400毫秒", "600毫秒", "800毫秒", "1000毫秒"]
  },
  "yAxis": {
    "type": "value",
    "name": "操作數"
  },
  "series": [
    {
      "name": "突發 (100/秒)",
      "type": "bar",
      "data": [100, 0, 0, 0, 0, 100],
      "itemStyle": {
        "color": "#ff6b6b"
      }
    },
    {
      "name": "平滑 (20/200毫秒)",
      "type": "bar",
      "data": [20, 20, 20, 20, 20, 20],
      "itemStyle": {
        "color": "#51cf66"
      }
    }
  ]
};
        chart.setOption(option);
    }
})();
</script>
<h3 id="管理多個不協調的處理程序">管理多個不協調的處理程序</h3>
<p>當多個處理程序共享受節流服務時，邏輯分割服務的容量並使用分散式互斥系統來管理這些分割區的鎖定。</p>
<p><strong>範例：</strong></p>
<p>如果受節流系統允許每秒 500 個請求：</p>
<ol>
<li>建立 20 個分割區，每個價值每秒 25 個請求</li>
<li>需要 100 個請求的處理程序請求四個分割區</li>
<li>系統授予兩個分割區 10 秒</li>
<li>處理程序速率限制為每秒 50 個請求，在 2 秒內完成，然後釋放鎖定</li>
</ol>
<p><strong>實作方法：</strong></p>
<p>使用 blob 儲存為每個邏輯分割區建立一個小檔案。應用程式在短時間內（例如，15 秒）獲得這些檔案的獨佔租約。對於授予的每個租約，應用程式可以使用該分割區的容量。</p>
<div class="mermaid">block-beta
columns 3
  block:processes:3
    columns 3
    P1["處理程序 1"]
    P2["處理程序 2"]
    P3["處理程序 3"]
  end
  space:3
  block:leases:3
    columns 3
    L1["租約 1<br>25 請求/秒"]
    L2["租約 2<br>25 請求/秒"]
    L3["租約 3<br>25 請求/秒"]
  end
  space:3
  block:service:3
    S["受節流服務<br>總共 500 請求/秒"]
  end
  
  P1 --&gt; L1
  P2 --&gt; L2
  P3 --&gt; L3
  L1 --&gt; S
  L2 --&gt; S
  L3 --&gt; S
  
  style processes fill:#e1f5ff
  style leases fill:#fff4e1
  style service fill:#ffe1e1</div>
<p>為了減少延遲，為每個處理程序分配少量獨佔容量。處理程序只在超過其保留容量時才尋求共享容量租約。</p>
<p>租約管理的替代技術包括 Zookeeper、Consul、etcd 和 Redis/Redsync。</p>
<h2 id="問題與考量">問題與考量</h2>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>💡 關鍵考量</p><div class="admonition-content"><p><strong>處理節流錯誤</strong>：速率限制減少錯誤但不會消除它們。你的應用程式仍必須處理任何發生的節流錯誤。</p>
<p><strong>多個工作流</strong>：如果你的應用程式有多個工作流存取相同的受節流服務（例如，批次載入和查詢），將所有工作流整合到你的速率限制策略中，或為每個工作流保留單獨的容量池。</p>
<p><strong>多應用程式使用</strong>：當多個應用程式使用相同的受節流服務時，增加的節流錯誤可能表示競爭。考慮暫時降低吞吐量，直到其他應用程式的使用量降低。</p>
</div></div>
<p>!!!</p>
<h2 id="何時使用此模式">何時使用此模式</h2>
<p>使用此模式以：</p>
<ul>
<li>減少來自受節流限制服務的節流錯誤</li>
<li>與天真的錯誤重試方法相比減少流量</li>
<li>僅在有容量處理記錄時才將記錄出列，從而減少記憶體消耗</li>
<li>提高批次處理完成時間的可預測性</li>
</ul>
<h2 id="範例架構">範例架構</h2>
<p>考慮一個應用程式，使用者向 API 提交各種類型的記錄。每種記錄類型都有一個獨特的作業處理器，執行驗證、豐富化和資料庫插入。</p>
<p>所有元件（API、作業處理器）都是獨立擴展的獨立處理程序，不直接通訊。</p>
<div class="mermaid">graph TB
    U1["使用者"] --&gt; API["API"]
    U2["使用者"] --&gt; API
    
    API --&gt; QA["佇列 A<br>(類型 A 記錄)"]
    API --&gt; QB["佇列 B<br>(類型 B 記錄)"]
    
    QA --&gt; JPA["作業處理器 A"]
    QB --&gt; JPB["作業處理器 B"]
    
    JPA --&gt; LS["租約儲存<br>(Blob 0-9)"]
    JPB --&gt; LS
    
    JPA --&gt; DB["資料庫<br>(1000 請求/秒限制)"]
    JPB --&gt; DB
    
    style API fill:#e1f5ff
    style QA fill:#fff4e1
    style QB fill:#fff4e1
    style LS fill:#f0e1ff
    style DB fill:#ffe1e1</div>
<p><strong>工作流程：</strong></p>
<ol>
<li>使用者向 API 提交 10,000 筆類型 A 記錄</li>
<li>API 將記錄加入佇列 A</li>
<li>使用者向 API 提交 5,000 筆類型 B 記錄</li>
<li>API 將記錄加入佇列 B</li>
<li>作業處理器 A 嘗試租用 blob 2</li>
<li>作業處理器 B 嘗試租用 blob 2</li>
<li>作業處理器 A 失敗；作業處理器 B 獲得 15 秒的租約（100 請求/秒容量）</li>
<li>作業處理器 B 將 100 筆記錄出列並寫入</li>
<li>1 秒後，兩個處理器都嘗試額外的租約</li>
<li>作業處理器 A 獲得 blob 6（100 請求/秒）；作業處理器 B 獲得 blob 3（現在總共 200 請求/秒）</li>
<li>處理器繼續競爭租約並以其授予的速率處理記錄</li>
<li>當租約到期時（15 秒後），處理器相應地降低其請求速率</li>
</ol>
<h2 id="相關模式">相關模式</h2>
<p><strong>節流</strong>：速率限制通常是為了回應受節流服務而實作的。</p>
<p><strong>重試</strong>：當請求導致節流錯誤時，在適當的間隔後重試。</p>
<p><strong>基於佇列的負載平衡</strong>：與速率限制類似但更廣泛。主要差異：</p>
<ul>
<li>速率限制不一定需要佇列，但需要持久化訊息</li>
<li>速率限制引入分散式互斥在分割區上，允許管理與相同受節流服務通訊的多個不協調處理程序的容量</li>
<li>基於佇列的負載平衡適用於服務之間的任何效能不匹配；速率限制專門針對受節流服務</li>
</ul>
<h2 id="參考資料">參考資料</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/architecture/patterns/rate-limiting-pattern">Rate Limiting Pattern - Microsoft Learn</a></li>
</ul>

        </div>
        <footer class="article-footer">
            
    <a data-url="https://neo01.com/zh-TW/2019/01/Rate-Limiting-Pattern/" data-id="68768a99" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url').replace("http://","https://"),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
    <!--script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": {
            "@type": "Person",
            "name": "Neo Alienson"
        },
        "headline": "速率限制模式：高效管理受限服務",
        "image": "https://neo01.comthumbnail.png",
        "keywords": "",
        "genre": "Architecture",
        "datePublished": "2019-01-15",
        "dateCreated": "2019-01-15",
        "dateModified": "2025-10-12",
        "url": "https://neo01.com//zh-TW/2019/01/Rate-Limiting-Pattern/",
        "description": "了解速率限制模式如何幫助你避免節流錯誤，並在使用有限制的服務時提升吞吐量。",
        "wordCount": 680
    }
</script-->

</article>

                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>追蹤 :</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="stack-exchange" href="https://stackexchange.com/users/2122053/neo?tab=accounts" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-exchange"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="stack-overflow" href="https://stackoverflow.com/users/1885105/neo" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-overflow"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/neoalienson" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="linkedin" href="https://linkedin.com/in/neo01" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-linkedin"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="rss" href="/atom.xml" target="_blank" rel="noopener">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    <!-- 
        
<nav id="article-nav">
    
        <a href="/2019/01/Rate-Limiting-Pattern/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">下一篇</strong>
        <p class="article-nav-title">
        
            Rate Limiting Pattern: Efficiently Managing Throttled Services
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/zh-TW/2018/03/How-To-Setup-Root-Certificate-For-MITM-Proxy-On-iOS/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">上一篇</strong>
        <p class="article-nav-title">如何在 iOS 上為 MITM 代理設定根憑證</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

     -->
    <div class="widgets-container">
        
            
                <div class="widget-wrap widget-list">
    <h3 class="widget-title">連結</h3>
    <div class="widget">
        <ul><li><a href="/zh-TW/ai">AI 遊樂場</a></li><li><a href="/zh-TW/tools">工具</a></li><li><a href="/zh-TW/games">遊戲</a></li><li><a href="/zh-TW/pages/useful-information">實用資訊</a></li><li><a href="/zh-TW/pages/Hexo-Blogging-Cheatsheet">Hexo 部落格速查表</a></li></ul>
    </div>
</div>

            
                
    
    
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/10/Tools-Games-And-Browser-Built-In-AI/" class="thumbnail">
    
    
        
        <span style="background-image:url(/2025/10/Tools-Games-And-Browser-Built-In-AI/thumbnail.jpeg)" alt="工具、遊戲與瀏覽器內建 AI 遊樂場" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/AI/">人工智慧</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/10/Tools-Games-And-Browser-Built-In-AI/" class="title">工具、遊戲與瀏覽器內建 AI 遊樂場</a></p>
                            <p class="item-date"><time datetime="2025-10-01T16:00:00.000Z" itemprop="datePublished">2025-10-02</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/" class="thumbnail">
    
    
        
        <span style="background-image:url(/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/thumbnail.jpeg)" alt="代理式編碼的崛起：AI 驅動的軟體工程" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/AI/">人工智慧</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/" class="title">代理式編碼的崛起：AI 驅動的軟體工程</a></p>
                            <p class="item-date"><time datetime="2025-09-19T16:00:00.000Z" itemprop="datePublished">2025-09-20</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports/" class="thumbnail">
    
    
        
        <span style="background-image:url(/2025/08/Understanding_Ephemeral_Ports/thumbnail.png)" alt="理解臨時埠" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/Development/">開發</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports/" class="title">理解臨時埠</a></p>
                            <p class="item-date"><time datetime="2025-08-29T16:00:00.000Z" itemprop="datePublished">2025-08-30</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/07/Architecture_As_Code_Part_2_Building_the_Foundation/" class="thumbnail">
    
    
        
        <span style="background-image:url(/2025/07/Architecture_As_Code_Part_2_Building_the_Foundation/thumbnail.jpg)" alt="架構即程式碼：第二部分 - 建立基礎" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/Architecture/">架構</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/07/Architecture_As_Code_Part_2_Building_the_Foundation/" class="title">架構即程式碼：第二部分 - 建立基礎</a></p>
                            <p class="item-date"><time datetime="2025-07-19T16:00:00.000Z" itemprop="datePublished">2025-07-20</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/07/Architecture_As_Code_Part_1_The_Revolution_Begins/" class="thumbnail">
    
    
        
        <span style="background-image:url(/2025/07/Architecture_As_Code_Part_1_The_Revolution_Begins/thumbnail.jpg)" alt="架構即程式碼：第一部分 - 革命的開端" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/Architecture/">架構</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/07/Architecture_As_Code_Part_1_The_Revolution_Begins/" class="title">架構即程式碼：第一部分 - 革命的開端</a></p>
                            <p class="item-date"><time datetime="2025-07-14T16:00:00.000Z" itemprop="datePublished">2025-07-15</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    
    
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">所有文章</h3>
        <div class="widget">
            <ul class="archive-list">
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2025/">2025</a>
                    <span class="archive-list-count">10</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2024/">2024</a>
                    <span class="archive-list-count">24</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2023/">2023</a>
                    <span class="archive-list-count">12</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2022/">2022</a>
                    <span class="archive-list-count">2</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2020/">2020</a>
                    <span class="archive-list-count">3</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2019/">2019</a>
                    <span class="archive-list-count">12</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2018/">2018</a>
                    <span class="archive-list-count">2</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2017/">2017</a>
                    <span class="archive-list-count">5</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2016/">2016</a>
                    <span class="archive-list-count">4</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2015/">2015</a>
                    <span class="archive-list-count">6</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2014/">2014</a>
                    <span class="archive-list-count">7</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2013/">2013</a>
                    <span class="archive-list-count">2</span>
                </li>
            
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <!-- disable caching cause each page has different footer from qrcode -->
        <!-- common/footer, null, {cache: !config.relative_link})  -->
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="qrcode-share-wrapper">
                <div class="qrcode-text">https://neo01.com/l#240e46d4</div>
                <img src="/qr/qr-66c2ed5de9e894c5bb576970abecfcfc.svg" width="200" height="200" alt="QR Code for https://neo01.com/l#240e46d4">
            </div>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" title="Homepage" class="logo"></a>
                </h1>
                
                <p>© 2025 Neo Alienson. 版權所有.
                  <a href="/zh-TW/terms-and-conditions">使用條款</a></p>
                
            </div>
            <div class="footer-plugins">
              


            </div>
        </div>
    </div>
</footer>

        
    
        


        


        


        


        


        


        


        


        


    



<!-- Custom Scripts -->




    </div>
<!-- hexo injector body_end start --><script type="text/javascript" src="/js/bundle_last.js"></script><!-- hexo injector body_end end -->

<script>CookieConsent.run({"palette":{"popup":{"background":"#000"},"button":{"background":"#f1d600"}},"guiOptions":{"consentModal":{"layout":"box","position":"bottom right","equalWeightButtons":true,"flipButtons":false},"preferencesModal":{"layout":"box","position":"right","equalWeightButtons":false,"flipButtons":false}},"categories":{"necessary":{"readOnly":true},"functionality":{},"analytics":{}},"language":{"default":"en","autoDetect":"browser","translations":{"en":{"consentModal":{"title":"Hello traveler, it's cookie time!","description":"🍪 This site uses cookies to serve you the best experience—no crumbs left behind! Want to know what cookies really are? Check out this easy-to-understand cookie explanation. And for the legal nitty-gritty, here’s our website cookie policy to keep you in the loop! 🚀\n","acceptAllBtn":"Accept all","acceptNecessaryBtn":"Reject all","showPreferencesBtn":"Manage preferences","footer":"<a href=\"#link\">Privacy Policy</a>\n<a href=\"/terms-and-conditions/\">Terms and conditions</a>\n"},"preferencesModal":{"title":"Consent Preferences Center","acceptAllBtn":"Accept all","acceptNecessaryBtn":"Reject all","savePreferencesBtn":"Save preferences","closeIconLabel":"Close modal","serviceCounterLabel":"Service|Services","sections":[{"title":"Cookie Usage","description":"We use cookies to make your visit smoother, faster, and tailored just for you. Cookies help us remember your preferences, improve site performance, and deliver personalized content while keeping things secure and user-friendly.\n"},{"title":"Strictly Necessary Cookies <span class=\"pm__badge\">Always Enabled</span>","description":"These cookies are essential for the website to function properly. They enable core features like security, page navigation, and access to secure areas. Without these, the site cannot operate correctly.\n","linkedCategory":"necessary"},{"title":"Functionality Cookies","description":"Functionality cookies remember your choices to provide a more personalized experience. For example, they save your language preference or login details so you don’t have to keep entering them each time.\n","linkedCategory":"functionality"},{"title":"Analytics Cookies","description":"Analytics cookies help us understand how visitors interact with our site by collecting information anonymously. This insight allows us to improve functionality, fix issues, and make the website better for you.\n","linkedCategory":"analytics"},{"title":"More information","description":"Please refer to our <a href='/pages/cookie-policy'>cookie policy</a> for full details on how we use cookies and your options to manage them.\n"}]}}}}})</script></body></html>