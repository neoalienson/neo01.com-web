<!DOCTYPE html><html lang="zh-TW"><head>
  <meta http-equiv="refresh" content="0;url=/zh-TW/2021/03/Certificate-Pinning-Security-Trade-offs/"><!-- hexo injector head_begin start --><!-- Google tag (gtag.js) begins-->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3DZR3TQYCY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-3DZR3TQYCY');
    </script>
    <!-- Google tag (gtag.js) ends-->
    <!-- hexo injector head_begin end -->
    <meta charset="utf-8">
    <!-- security headers starts -->
    <!-- meta http-equiv="content-security-policy" content="script-src 'sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=' 'sha256-lJjk3/dvd+wXqRFjV7T5L/nXJXr5NjUjmsKSPEe+ass=';" -->
    <!-- security headers ends -->
    <!-- favicon starts -->    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <!-- favicon ends -->
    

    
    <title>憑證固定：TLS 安全的雙刃劍 | Decoding Digital Anomalies</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="keywords" content="Certificate,Security,TLS">
    
    
    <meta name="description" content="憑證固定承諾增強安全性，但也帶來了營運風險。了解固定什麼、如何實作，以及為什麼它可能會破壞你的應用程式。">
<meta property="og:type" content="article">
<meta property="og:title" content="憑證固定：TLS 安全的雙刃劍">
<meta property="og:url" content="https://neo01.com/zh-TW/2021/03/Certificate-Pinning-Security-Trade-offs/index.html">
<meta property="og:site_name" content="Decoding Digital Anomalies">
<meta property="og:description" content="憑證固定承諾增強安全性，但也帶來了營運風險。了解固定什麼、如何實作，以及為什麼它可能會破壞你的應用程式。">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://neo01.com/assets/cert/pinning_thumbnail.png">
<meta property="article:published_time" content="2021-03-03T16:00:00.000Z">
<meta property="article:modified_time" content="2025-10-26T12:13:27.610Z">
<meta property="article:author" content="Neo Alienson">
<meta property="article:tag" content="Certificate">
<meta property="article:tag" content="Security">
<meta property="article:tag" content="TLS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://neo01.com/assets/cert/pinning_thumbnail.png">
    
            <link rel="alternate" href="/atom.xml" title="Decoding Digital Anomalies" type="application/atom+xml">
    

    

    

    

    

    

    

    
    
        


    
    
        


    

<!-- hexo injector head_end start --><link rel="stylesheet" type="text/css" href="/css/bundle.css"><script type="text/javascript" src="/js/bundle_first.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0">    <link rel="canonical" href="https://neo01.com/zh-TW/2021/03/Certificate-Pinning-Security-Trade-offs/">
    <link rel="alternate" hreflang="en" href="https://neo01.com/zh-TW/2021/03/Certificate-Pinning-Security-Trade-offs/">
    <link rel="alternate" hreflang="zh-TW" href="https://neo01.com/zh-TW//zh-TW/2021/03/Certificate-Pinning-Security-Trade-offs/">
    <link rel="alternate" hreflang="zh-CN" href="https://neo01.com/zh-CN//zh-TW/2021/03/Certificate-Pinning-Security-Trade-offs/">
    <link rel="alternate" hreflang="ja" href="https://neo01.com/ja//zh-TW/2021/03/Certificate-Pinning-Security-Trade-offs/">
    <link rel="alternate" hreflang="x-default" href="https://neo01.com/zh-TW/2021/03/Certificate-Pinning-Security-Trade-offs/">
<style id="admonition-styles">.admonition {
  margin: 1em 0;
  padding: 0rem;
  border-left: 0.3rem solid;
  border-radius: 0.4rem;
  background-color: #f9f9f9;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
  overflow: hidden;
  page-break-inside: avoid;
}

.admonition-title {
  display: flex;
  align-items: center;
  font-weight: 600;
  padding: 0rem 1rem 0.1rem 0.75rem;
  font-size: 1.05em;
  background-color: rgba(0, 0, 0, 0.03);
  border-top-left-radius: 0.4rem;
  border-top-right-radius: 0.4rem;
  margin: 0 !important;
}

.admonition-icon {
  font-size: 1.2em;
  margin-right: 0.6rem;
  opacity: 0.85;
  margin-top: 0.1rem;
}

/* 内容区域 margin */
.admonition > *:not(.admonition-title) {
  margin: 0.6rem 1rem 0.6rem 1rem;
}

/* NOTE 类型 */
.admonition.anote {
  border-color: #448aff;
}
.admonition.anote > .admonition-title {
  background-color: #448aff1a;
  color: #2962ff;
}

/* INFO / TODO 类型 */
.admonition.info,
.admonition.todo {
  border-color: #00b8d4;
}
.admonition.info > .admonition-title,
.admonition.todo > .admonition-title {
  background-color: rgba(0, 184, 212, 0.1);
  color: #007c91;
}

/* 警告类 */
.admonition.warning,
.admonition.attention,
.admonition.caution {
  border-color: #ff9100;
}
.admonition.warning > .admonition-title,
.admonition.attention > .admonition-title,
.admonition.caution > .admonition-title {
  background-color: rgba(255, 145, 0, 0.1);
  color: #c66900;
}

/* 错误类 */
.admonition.failure,
.admonition.missing,
.admonition.fail,
.admonition.error,
.admonition.danger,
.admonition.bug {
  border-color: #ff5252;
}
.admonition.failure > .admonition-title,
.admonition.missing > .admonition-title,
.admonition.fail > .admonition-title,
.admonition.error > .admonition-title,
.admonition.danger > .admonition-title,
.admonition.bug > .admonition-title {
  background-color: rgba(255, 82, 82, 0.1);
  color: #b71c1c;
}

/* TIP 类型 */
.admonition.tip {
  border-color: #00bfa5;
}
.admonition.tip > .admonition-title {
  background-color: #00bfa51a;
  color: #00796b;
}

/* SUCCESS 类型 */
.admonition.success {
  border-color: #00c853;
}
.admonition.success > .admonition-title {
  background-color: #00c8531a;
  color: #2e7d32;
}

/* QUESTION 类型 */
.admonition.question {
  border-color: #64dd17;
}
.admonition.question > .admonition-title {
  background-color: #64dd171a;
  color: #558b2f;
}

/* EXAMPLE 类型 */
.admonition.example {
  border-color: #7c4dff;
}
.admonition.example > .admonition-title {
  background-color: #7c4dff1a;
  color: #512da8;
}

/* QUOTE 类型 */
.admonition.quote {
  border-color: #9e9e9e;
}
.admonition.quote > .admonition-title {
  background-color: #9e9e9e1a;
  color: #424242;
}

/*黑暗模式*/
/* 夜间模式基础样式 */
[data-theme="dark"] .admonition {
  background-color: #1e1e1e;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
}

[data-theme="dark"] .admonition-title {
  background-color: rgba(255, 255, 255, 0.05);
}

/* anote */
[data-theme="dark"] .admonition.anote {
  border-color: #82b1ff;
}
[data-theme="dark"] .admonition.anote > .admonition-title {
  background-color: #82b1ff1a;
  color: #bbdefb;
}

/* tip */
[data-theme="dark"] .admonition.tip {
  border-color: #64ffda;
}
[data-theme="dark"] .admonition.tip > .admonition-title {
  background-color: #64ffda1a;
  color: #1de9b6;
}

/* success */
[data-theme="dark"] .admonition.success {
  border-color: #69f0ae;
}
[data-theme="dark"] .admonition.success > .admonition-title {
  background-color: #69f0ae1a;
  color: #00e676;
}

/* question */
[data-theme="dark"] .admonition.question {
  border-color: #b2ff59;
}
[data-theme="dark"] .admonition.question > .admonition-title {
  background-color: #b2ff591a;
  color: #aeea00;
}

/* example */
[data-theme="dark"] .admonition.example {
  border-color: #b388ff;
}
[data-theme="dark"] .admonition.example > .admonition-title {
  background-color: #b388ff1a;
  color: #b39ddb;
}

/* quote */
[data-theme="dark"] .admonition.quote {
  border-color: #bdbdbd;
}
[data-theme="dark"] .admonition.quote > .admonition-title {
  background-color: #bdbdbd1a;
  color: #eeeeee;
}

/* warning / attention / caution */
[data-theme="dark"] .admonition.warning,
[data-theme="dark"] .admonition.attention,
[data-theme="dark"] .admonition.caution {
  border-color: #ffb300;
}
[data-theme="dark"] .admonition.warning > .admonition-title,
[data-theme="dark"] .admonition.attention > .admonition-title,
[data-theme="dark"] .admonition.caution > .admonition-title {
  background-color: #ffb3001a;
  color: #ffe082;
}

/* error / fail / failure / bug / danger / missing */
[data-theme="dark"] .admonition.error,
[data-theme="dark"] .admonition.fail,
[data-theme="dark"] .admonition.failure,
[data-theme="dark"] .admonition.bug,
[data-theme="dark"] .admonition.missing,
[data-theme="dark"] .admonition.danger {
  border-color: #ef5350;
}
[data-theme="dark"] .admonition.error > .admonition-title,
[data-theme="dark"] .admonition.fail > .admonition-title,
[data-theme="dark"] .admonition.failure > .admonition-title,
[data-theme="dark"] .admonition.bug > .admonition-title,
[data-theme="dark"] .admonition.missing > .admonition-title,
[data-theme="dark"] .admonition.danger > .admonition-title {
  background-color: #ef53501a;
  color: #ff8a80;
}</style></head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" title="Homepage" class="logo"></a>
                    </h1>
                        <h2 class="subtitle-wrap">
                            <p class="title">解碼數位異象</p>
                          <p class="subtitle">有時功能就是數位兔子洞中的錯誤，反之亦然</p>
                        </h2>
                    <div id="lang-selector">
                        <span class="lang-icon">🌐</span>
                        
                                <a href="/2021/03/Certificate-Pinning-Security-Trade-offs/" class="lang-link">English</a>
<span class="lang-sep">|</span>                                <a href="/zh-CN/2021/03/Certificate-Pinning-Security-Trade-offs/" class="lang-link">简体中文</a>
<span class="lang-sep">|</span>                                <a href="/ja/2021/03/Certificate-Pinning-Security-Trade-offs/" class="lang-link">日本語</a>
                    </div>
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/zh-TW/">首頁</a>
                                </li>
                                                                    <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/AI/">人工智慧</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/AI/Art-Gallery/">藝術畫廊</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Architecture/">架構</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Cybersecurity/">資訊安全</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Development/">開發</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Misc/">雜項</a></li></ul>
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/zh-TW/about-me">關於</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" id="search-form-input" placeholder="搜尋">
        <button type="submit" title="搜尋" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" id="ins-search-input" placeholder="輸入關鍵字...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script integrity="sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=">
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '頁面',
            CATEGORIES: '分類',
            TAGS: '標籤',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
        LANG: 'zh-TW',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>




</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Development/">Development</a>
    </h1>
</div>

                        <div class="main-body-content">
                            <article id="post-2021/03/Certificate-Pinning-Security-Trade-offs-zh-TW" class="article article-single article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner responsive-content">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        憑證固定：TLS 安全的雙刃劍
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
      <i class="fa fa-calendar"></i>
        
          Created <time datetime="2021-03-03T16:00:00.000Z" itemprop="datePublished">2021-03-04</time>
          &nbsp;<i class="fa fa-calendar"></i>
          Updated <time datetime="2025-10-26T12:13:27.610Z" itemprop="datePublished">2025-10-26</time>
        
    </div>


                

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/zh-TW/tags/Security/">Security</a> <a class="tag-link" href="/zh-TW/tags/Certificate/">Certificate</a> <a class="tag-link" href="/zh-TW/tags/TLS/">TLS</a>
    </div>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%90%86%E8%A7%A3%E6%86%91%E8%AD%89%E9%8F%88"><span class="toc-text">理解憑證鏈</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%A8%E5%B9%B3%E5%8F%B0%E7%9A%84%E6%86%91%E8%AD%89%E5%9B%BA%E5%AE%9A"><span class="toc-text">跨平台的憑證固定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BA%E5%AE%9A%E5%9B%B0%E5%A2%83%EF%BC%9A%E5%9B%BA%E5%AE%9A%E4%BB%80%E9%BA%BC"><span class="toc-text">固定困境：固定什麼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AC%E9%91%B0%E5%9B%BA%E5%AE%9A%EF%BC%9A%E6%8E%A8%E8%96%A6%E6%96%B9%E6%B3%95"><span class="toc-text">公鑰固定：推薦方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E5%90%8D%E7%A8%B1%E9%99%B7%E9%98%B1%EF%BC%9A%E4%B8%8D%E8%A6%81%E9%80%8F%E9%81%8E-CN-%E5%9B%BA%E5%AE%9A"><span class="toc-text">通用名稱陷阱：不要透過 CN 固定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9C%9F%E5%AF%A6%E4%B8%96%E7%95%8C%E7%9A%84%E5%9B%BA%E5%AE%9A%E5%A4%B1%E6%95%97"><span class="toc-text">真實世界的固定失敗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9A%AA%E4%BA%9B%E5%A4%B1%E8%AA%A4%EF%BC%9A%E6%B8%AC%E8%A9%A6%E6%8B%AF%E6%95%91%E4%BA%86%E4%B8%80%E5%88%87"><span class="toc-text">險些失誤：測試拯救了一切</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%AC%E8%A9%A6%E6%86%91%E8%AD%89%E5%9B%BA%E5%AE%9A%EF%BC%9A%E4%B8%8D%E8%A6%81%E8%B5%B0%E6%8D%B7%E5%BE%91"><span class="toc-text">測試憑證固定：不要走捷徑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%95%E6%99%82%E4%BD%BF%E7%94%A8%E6%86%91%E8%AD%89%E5%9B%BA%E5%AE%9A"><span class="toc-text">何時使用憑證固定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%86%91%E8%AD%89%E5%9B%BA%E5%AE%9A%E7%9A%84%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%A1%88"><span class="toc-text">憑證固定的替代方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B5%90%E8%AB%96"><span class="toc-text">結論</span></a></li></ol>
            <p>憑證固定作為一種安全技術應運而生，用於對抗中間人攻擊和流氓憑證頒發機構。透過將預期的憑證資訊硬編碼到應用程式中，開發人員可以確保只有在與合法伺服器通訊時連線才會成功。然而，這種增強的安全性伴隨著顯著的營運複雜性和風險。配置錯誤的固定或過期的憑證可能會導致應用程式無法使用，需要緊急更新並讓使用者感到沮喪。</p>
<p>本文探討了跨瀏覽器、行動應用程式和後端服務的憑證固定。我們將剖析憑證鏈層次結構，評估要固定的元素，並理解安全性與營運靈活性之間的權衡。透過真實事件和產業實務，我們揭示了為什麼憑證固定既強大又危險。</p>
<h2 id="理解憑證鏈">理解憑證鏈</h2>
<p>在深入研究固定策略之前，理解憑證鏈結構至關重要。TLS 憑證不是孤立存在的——它們形成了從伺服器憑證到受信任根憑證頒發機構的分層信任鏈。</p>
<h3 id="三層層次結構">三層層次結構</h3>
<p>TLS 憑證鏈通常由三個級別組成，每個級別都有不同的用途：</p>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>🔗 憑證鏈結構</p><div class="admonition-content"><p><strong>葉憑證（終端實體憑證）</strong></p>
<ul>
<li>安裝在 Web 伺服器或應用程式上的憑證</li>
<li>包含你的網域名稱（例如 example.com）</li>
<li>有效期最短（目前最長 398 天，到 2029 年將縮短至 47 天）</li>
<li>由中繼憑證簽署</li>
<li>鏈中最頻繁更換的憑證</li>
</ul>
<p><strong>中繼憑證</strong></p>
<ul>
<li>由根 CA 頒發用於簽署葉憑證</li>
<li>充當根憑證和葉憑證之間的緩衝</li>
<li>典型有效期：3-10 年</li>
<li>可以在不影響根憑證信任的情況下被撤銷</li>
<li>鏈中可能存在多個中繼憑證</li>
</ul>
<p><strong>根憑證</strong></p>
<ul>
<li>位於鏈頂部的自簽憑證</li>
<li>嵌入在作業系統和瀏覽器中</li>
<li>有效期極長：15-25 年</li>
<li>由於分發挑戰很少更改</li>
<li>被攻破需要作業系統/瀏覽器更新才能移除</li>
</ul>
</div></div>
<p>憑證鏈透過加密簽章工作。根 CA 簽署中繼憑證，中繼憑證簽署你的葉憑證，客戶端驗證鏈上的每個簽章，直到到達其憑證儲存中的受信任根憑證。</p>
<h3 id="為什麼存在這種層次結構">為什麼存在這種層次結構</h3>
<p>三層結構不是任意的——它提供了關鍵的營運和安全優勢：</p>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>🛡️ 層次結構優勢</p><div class="admonition-content"><p><strong>根憑證保護</strong></p>
<ul>
<li>根私鑰保存在安全設施的離線環境中</li>
<li>最大限度地減少被攻破的風險</li>
<li>減少頻繁簽署操作帶來的營運風險</li>
</ul>
<p><strong>營運靈活性</strong></p>
<ul>
<li>中繼憑證可以在不更換根憑證的情況下被撤銷</li>
<li>可以在不需要作業系統/瀏覽器更新的情況下頒發新的中繼憑證</li>
<li>允許 CA 分段營運（地理位置、產品線）</li>
</ul>
<p><strong>風險隔離</strong></p>
<ul>
<li>中繼憑證被攻破限制了損害範圍</li>
<li>葉憑證被攻破只影響特定網域</li>
<li>分層安全減少了單點故障</li>
</ul>
</div></div>
<p>在決定固定什麼時，這種層次結構變得至關重要。每個級別在安全性和營運靈活性之間提供不同的權衡。</p>
<h2 id="跨平台的憑證固定">跨平台的憑證固定</h2>
<p>憑證固定的實作在瀏覽器、行動應用程式和後端服務之間存在顯著差異。每個平台都有不同的能力、約束和用例，影響固定策略。</p>
<h3 id="瀏覽器固定：有限且衰落">瀏覽器固定：有限且衰落</h3>
<p>現代瀏覽器在很大程度上已經放棄了對 Web 應用程式自訂憑證固定的支援：</p>
<div class="admonition warning"><p class="admonition-title"><span class="mdi mdi-alert-outline admonition-icon"></span>⚠️ 瀏覽器固定現實</p><div class="admonition-content"><p><strong>HTTP 公鑰固定（HPKP）- 已棄用</strong></p>
<ul>
<li>2015 年引入，允許網站指定固定的憑證</li>
<li>Chrome 在 2017 年棄用，2018 年移除</li>
<li>Firefox 和其他瀏覽器也紛紛效仿</li>
<li>原因：太危險——配置錯誤可能永久破壞網站</li>
</ul>
<p><strong>當前瀏覽器方法</strong></p>
<ul>
<li>瀏覽器為高價值網域維護自己的固定清單</li>
<li>Google 固定自己的網域（google.com、gmail.com 等）</li>
<li>預載入的固定編譯到瀏覽器程式碼中</li>
<li>不適用於第三方網站</li>
</ul>
<p><strong>HPKP 失敗的原因</strong></p>
<ul>
<li>配置錯誤的固定將使用者鎖定在網站之外</li>
<li>攻擊者可以使用 HPKP 進行勒索攻擊</li>
<li>沒有損壞固定的恢復機制</li>
<li>營運負擔超過了安全優勢</li>
</ul>
</div></div>
<p>對於 Web 應用程式，憑證固定實際上不可用。瀏覽器依賴標準的 CA 信任模型以及憑證透明度等額外保護。</p>
<h3 id="行動應用程式固定：常見但有風險">行動應用程式固定：常見但有風險</h3>
<p>行動應用程式代表了當今憑證固定的主要用例：</p>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>📱 行動固定特徵</p><div class="admonition-content"><p><strong>iOS 實作</strong></p>
<ul>
<li>透過 NSURLSession 和應用程式傳輸安全提供原生支援</li>
<li>可以固定憑證或公鑰</li>
<li>在應用程式程式碼中實作</li>
<li>需要應用程式更新才能更改固定</li>
</ul>
<p><strong>Android 實作</strong></p>
<ul>
<li>網路安全配置（Android 7.0+）</li>
<li>宣告式 XML 配置</li>
<li>可以固定憑證或公鑰</li>
<li>也需要應用程式更新才能更改固定</li>
</ul>
<p><strong>常見用例</strong></p>
<ul>
<li>銀行和金融應用程式</li>
<li>處理敏感資料的醫療保健應用</li>
<li>具有高安全要求的企業應用程式</li>
<li>與已知受控伺服器通訊的應用</li>
</ul>
</div></div>
<p>當你控制客戶端和伺服器、可以協調更新並且安全優勢證明營運複雜性合理時，行動固定是有意義的。</p>
<h3 id="後端服務固定：受控環境">後端服務固定：受控環境</h3>
<p>後端服務與其他後端服務通訊代表了另一種固定場景：</p>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>🔧 後端固定優勢</p><div class="admonition-content"><p><strong>受控環境</strong></p>
<ul>
<li>客戶端和伺服器都在你的控制之下</li>
<li>可以協調憑證更新</li>
<li>自動化部署減少更新摩擦</li>
</ul>
<p><strong>微服務通訊</strong></p>
<ul>
<li>服務到服務的身份驗證</li>
<li>帶固定的雙向 TLS（mTLS）</li>
<li>零信任架構實作</li>
</ul>
<p><strong>API 客戶端函式庫</strong></p>
<ul>
<li>與特定 API 通訊的 SDK</li>
<li>已知的憑證基礎設施</li>
<li>可以將固定與函式庫更新捆綁在一起</li>
</ul>
</div></div>
<p>後端固定的風險低於行動固定，因為更新可以快速部署而無需使用者參與。</p>
<h2 id="固定困境：固定什麼">固定困境：固定什麼</h2>
<p>選擇固定什麼涉及在安全性和營運靈活性之間取得平衡。每個選項——根憑證、中繼憑證或葉憑證——都呈現出不同的權衡。</p>
<h3 id="固定葉憑證：最大安全性，最大風險">固定葉憑證：最大安全性，最大風險</h3>
<p>固定伺服器的葉憑證提供最強的安全性，但會帶來重大的營運挑戰：</p>
<div class="admonition error"><p class="admonition-title"><span class="mdi mdi-alert-circle-outline admonition-icon"></span>🚫 葉憑證固定風險</p><div class="admonition-content"><p><strong>需要頻繁輪換</strong></p>
<ul>
<li>葉憑證在 398 天後過期（很快將縮短至 47 天）</li>
<li>每次憑證續訂都需要應用程式更新</li>
<li>使用 47 天憑證：每年至少需要 7-8 次更新</li>
</ul>
<p><strong>緊急情況</strong></p>
<ul>
<li>私鑰被攻破需要立即更換憑證</li>
<li>在部署新憑證之前需要應用程式更新</li>
<li>使用舊應用版本的使用者無法連線</li>
<li>沒有優雅的遷移路徑</li>
</ul>
<p><strong>營運負擔</strong></p>
<ul>
<li>協調憑證更新與應用發布</li>
<li>在部署前測試固定更新</li>
<li>管理具有不同固定的多個應用版本</li>
<li>破壞連線的高風險</li>
</ul>
</div></div>
<p>除非在可以管理營運複雜性的極高安全場景中，否則很少推薦葉憑證固定。</p>
<h3 id="固定中繼憑證：平衡方法">固定中繼憑證：平衡方法</h3>
<p>固定中繼憑證提供了一個中間地帶：</p>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>⚖️ 中繼憑證權衡</p><div class="admonition-content"><p><strong>優勢</strong></p>
<ul>
<li>中繼憑證持續 3-10 年</li>
<li>需要更少的應用程式更新</li>
<li>葉憑證輪換不影響固定</li>
<li>相比不固定有合理的安全改進</li>
</ul>
<p><strong>劣勢</strong></p>
<ul>
<li>CA 可以使用相同的中繼憑證為你的網域頒發憑證</li>
<li>不能防止 CA 被攻破</li>
<li>中繼憑證輪換時仍需要更新</li>
<li>可能存在多個中繼憑證（需要固定所有）</li>
</ul>
<p><strong>最佳實務</strong></p>
<ul>
<li>固定當前中繼憑證加備份中繼憑證</li>
<li>監控 CA 關於中繼憑證更改的公告</li>
<li>在中繼憑證過期之前做好更新計畫</li>
<li>首先使用暫存中繼憑證進行測試</li>
</ul>
</div></div>
<p>中繼憑證固定是行動應用程式最常見的方法，在安全性和營運可行性之間取得平衡。</p>
<h3 id="固定根憑證：最小安全優勢">固定根憑證：最小安全優勢</h3>
<p>固定根憑證提供的安全改進最少：</p>
<div class="admonition warning"><p class="admonition-title"><span class="mdi mdi-alert-outline admonition-icon"></span>⚠️ 根憑證固定限制</p><div class="admonition-content"><p><strong>有限的安全價值</strong></p>
<ul>
<li>根 CA 可以為任何網域頒發憑證</li>
<li>不能防止 CA 被攻破攻擊</li>
<li>相比標準信任模型提供最小保護</li>
<li>只能防止使用不同根 CA 的攻擊</li>
</ul>
<p><strong>營運優勢</strong></p>
<ul>
<li>根憑證持續 15-25 年</li>
<li>需要非常不頻繁的更新</li>
<li>葉憑證和中繼憑證輪換不影響固定</li>
</ul>
<p><strong>何時有意義</strong></p>
<ul>
<li>限制到特定 CA（例如，只信任 DigiCert 根憑證）</li>
<li>減少被攻破的 CA 的攻擊面</li>
<li>符合 CA 限制的合規要求</li>
</ul>
</div></div>
<p>考慮到最小的安全改進，根憑證固定很少值得實作。</p>
<h2 id="公鑰固定：推薦方法">公鑰固定：推薦方法</h2>
<p>與其固定整個憑證，固定公鑰提供了更好的靈活性：</p>
<div class="admonition success"><p class="admonition-title"><span class="mdi mdi-check-circle-outline admonition-icon"></span>✅ 公鑰固定優勢</p><div class="admonition-content"><p><strong>憑證輪換無需更改固定</strong></p>
<ul>
<li>新憑證可以使用相同的金鑰對</li>
<li>固定在憑證續訂期間保持有效</li>
<li>減少更新頻率</li>
</ul>
<p><strong>備份金鑰支援</strong></p>
<ul>
<li>提前產生備份金鑰對</li>
<li>固定當前和備份公鑰</li>
<li>如果主金鑰被攻破，切換到備份金鑰</li>
<li>提供緊急恢復路徑</li>
</ul>
<p><strong>實作</strong></p>
<ul>
<li>從憑證中提取公鑰</li>
<li>對公鑰進行雜湊（通常是 SHA-256）</li>
<li>將雜湊儲存在應用程式中</li>
<li>在 TLS 交握期間進行比較</li>
</ul>
</div></div>
<p>公鑰固定是產業推薦的方法，在保持營運靈活性的同時提供安全優勢。</p>
<h3 id="實作公鑰固定">實作公鑰固定</h3>
<p>技術實作涉及提取和雜湊公鑰：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 從憑證中提取公鑰</span>
openssl x509 <span class="token parameter variable">-in</span> certificate.pem <span class="token parameter variable">-pubkey</span> <span class="token parameter variable">-noout</span> <span class="token operator">&gt;</span> pubkey.pem

<span class="token comment"># 產生公鑰的 SHA-256 雜湊（SPKI 格式）</span>
openssl x509 <span class="token parameter variable">-in</span> certificate.pem <span class="token parameter variable">-pubkey</span> <span class="token parameter variable">-noout</span> <span class="token operator">|</span> <span class="token punctuation">\</span>
  openssl pkey <span class="token parameter variable">-pubin</span> <span class="token parameter variable">-outform</span> der <span class="token operator">|</span> <span class="token punctuation">\</span>
  openssl dgst <span class="token parameter variable">-sha256</span> <span class="token parameter variable">-binary</span> <span class="token operator">|</span> <span class="token punctuation">\</span>
  base64</code></pre>
<p>產生的 base64 編碼雜湊就是你在應用程式中固定的內容。在 TLS 交握期間，提取伺服器的公鑰，對其進行雜湊，並與你固定的雜湊進行比較。</p>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>🔑 金鑰管理最佳實務</p><div class="admonition-content"><p><strong>始終固定多個金鑰</strong></p>
<ul>
<li>當前生產金鑰</li>
<li>備份金鑰（預先產生，安全儲存）</li>
<li>可選：中繼 CA 公鑰</li>
</ul>
<p><strong>金鑰輪換策略</strong></p>
<ul>
<li>部署新固定時產生備份金鑰</li>
<li>將備份金鑰安全地離線儲存</li>
<li>輪換時，備份變為主金鑰，產生新備份</li>
<li>在輪換前更新固定以包含新備份</li>
</ul>
<p><strong>緊急程序</strong></p>
<ul>
<li>記錄金鑰被攻破回應程序</li>
<li>保持快速部署應用更新的能力</li>
<li>考慮終止開關或遠端固定更新機制</li>
<li>定期測試緊急程序</li>
</ul>
</div></div>
<h2 id="通用名稱陷阱：不要透過-CN-固定">通用名稱陷阱：不要透過 CN 固定</h2>
<p>一些開發人員試圖透過驗證憑證的通用名稱（CN）或主體別名（SAN）來實作固定。這種方法從根本上是有缺陷的：</p>
<div class="admonition error"><p class="admonition-title"><span class="mdi mdi-alert-circle-outline admonition-icon"></span>🚫 為什麼 CN 固定失敗</p><div class="admonition-content"><p><strong>沒有加密綁定</strong></p>
<ul>
<li>CN 只是憑證中的一個文字欄位</li>
<li>任何 CA 都可以使用你的網域名稱頒發憑證</li>
<li>不驗證憑證實際上是你的</li>
<li>不提供任何安全優勢</li>
</ul>
<p><strong>攻擊場景</strong></p>
<ul>
<li>攻擊者攻破任何受信任的 CA</li>
<li>為你的網域（victim.com）請求憑證</li>
<li>憑證具有正確的 CN 但錯誤的公鑰</li>
<li>你的 CN 驗證通過，攻擊者攔截流量</li>
</ul>
<p><strong>你實際上在驗證什麼</strong></p>
<ul>
<li>標準 TLS 函式庫已經驗證 CN/SAN</li>
<li>你在重複現有驗證</li>
<li>沒有新增任何安全層</li>
<li>為沒有好處建立維護負擔</li>
</ul>
</div></div>
<p>CN 驗證不是憑證固定——它是不提供安全改進的冗餘驗證。</p>
<h3 id="什麼真正提供安全性">什麼真正提供安全性</h3>
<p>真正的憑證固定驗證加密屬性：</p>
<div class="admonition success"><p class="admonition-title"><span class="mdi mdi-check-circle-outline admonition-icon"></span>✅ 加密驗證</p><div class="admonition-content"><p><strong>公鑰固定</strong></p>
<ul>
<li>驗證實際的加密金鑰</li>
<li>沒有私鑰存取權限無法偽造</li>
<li>提供針對 CA 被攻破的真正安全性</li>
</ul>
<p><strong>憑證固定</strong></p>
<ul>
<li>驗證包括簽章在內的整個憑證</li>
<li>確保精確的憑證匹配</li>
<li>比公鑰固定更強但靈活性較差</li>
</ul>
<p><strong>憑證鏈固定</strong></p>
<ul>
<li>驗證中繼憑證或根憑證</li>
<li>限制哪些 CA 可以頒發有效憑證</li>
<li>平衡安全性和營運靈活性</li>
</ul>
</div></div>
<p>關鍵見解：固定加密材料（金鑰、憑證），而不是中繼資料（CN、組織名稱）。</p>
<h2 id="真實世界的固定失敗">真實世界的固定失敗</h2>
<p>憑證固定失敗導致了高調的中斷，說明了營運風險：</p>
<div class="admonition warning"><p class="admonition-title"><span class="mdi mdi-alert-outline admonition-icon"></span>⚠️ 著名的固定事件</p><div class="admonition-content"><p><strong>行動銀行應用</strong></p>
<ul>
<li>憑證續訂被遺忘，固定未更新</li>
<li>在部署新憑證之前需要應用更新</li>
<li>數千使用者無法存取銀行服務</li>
<li>緊急應用更新匆忙通過審批流程</li>
</ul>
<p><strong>企業應用程式</strong></p>
<ul>
<li>CA 輪換了中繼憑證</li>
<li>已部署應用程式中的固定未更新</li>
<li>整個行動勞動力無法連線</li>
<li>需要緊急憑證回滾</li>
</ul>
<p><strong>API 客戶端函式庫</strong></p>
<ul>
<li>固定的葉憑證過期</li>
<li>使用該函式庫的所有應用程式都損壞</li>
<li>開發人員被迫更新和重新部署</li>
<li>整個客戶群的服務中斷</li>
</ul>
</div></div>
<p>這些事件有共同的主題：憑證輪換計畫不足、缺乏備份固定，以及低估了憑證和應用程式更新之間所需的協調。</p>
<h2 id="險些失誤：測試拯救了一切">險些失誤：測試拯救了一切</h2>
<p>我曾經透過嚴格的輪換前測試——以及在被駁回時的堅持——險些避免了一次災難性的中斷。我們的行動應用程式使用了混合固定方法：它將通用名稱對應到特定的公鑰固定。雖然從純安全角度來看並不理想，但這種設計提供了營運靈活性——只要公鑰保持固定，我們就可以在不更新應用的情況下使用相同的 CN 輪換憑證。</p>
<p>在一次例行憑證輪換期間，我的團隊遵循了我們的標準程序：在部署到生產環境之前，在暫存環境中測試新憑證。測試失敗了。連線被拒絕，應用無法與我們的伺服器通訊。</p>
<h3 id="當測試團隊說「太難了」">當測試團隊說「太難了」</h3>
<p>測試團隊報告了失敗，但很快就駁回了它。「憑證固定很難測試，」他們說。「我們在 UAT 中停用了固定——這就是我們看到失敗的原因。這可能只是一個配置問題。我們已經測試了其他所有內容，它運作正常。」</p>
<p>這個回應讓我深感不安。他們因為「固定失敗太常見」而在 UAT 中停用了憑證固定，這意味著他們的測試沒有驗證實際的生產行為。距離計畫的生產發布只剩下兩個小時，我決定親自調查，而不是接受駁回。</p>
<h3 id="UAT-固定缺口">UAT 固定缺口</h3>
<p>測試團隊的輕視態度揭示了一個危險的做法：他們在 UAT（使用者驗收測試）環境中停用了憑證固定。他們的理由是務實的但有缺陷的——固定使測試更難，所以他們移除了它。</p>
<div class="admonition error"><p class="admonition-title"><span class="mdi mdi-alert-circle-outline admonition-icon"></span>🚫 停用固定陷阱</p><div class="admonition-content"><p><strong>他們為什麼在 UAT 中停用固定</strong></p>
<ul>
<li>「憑證固定太難測試」</li>
<li>UAT 憑證經常更改或過期</li>
<li>用於測試的自簽憑證</li>
<li>測試團隊缺乏更新固定的權限</li>
<li>「它減慢了我們的測試週期」</li>
<li>「我們會在生產監控中捕獲真正的問題」</li>
</ul>
<p><strong>危險的後果</strong></p>
<ul>
<li>UAT 測試沒有驗證任何關於憑證固定的內容</li>
<li>所有與固定相關的問題只會出現在生產環境中</li>
<li>「成功」的 UAT 測試帶來的虛假信心</li>
<li>生產環境成為真正的測試環境</li>
<li>使用者會遇到測試從未捕獲的失敗</li>
</ul>
<p><strong>實際發生的情況</strong></p>
<ul>
<li>測試團隊在 UAT 中執行完整的測試套件</li>
<li>所有測試都通過了（因為固定被停用）</li>
<li>他們報告「準備好生產發布」</li>
<li>憑證輪換會破壞生產環境</li>
<li>只有我啟用固定的暫存測試捕獲了問題</li>
</ul>
</div></div>
<p>我堅持維護一個啟用憑證固定的單獨暫存環境，正是為了捕獲這些問題。測試團隊認為這是多餘的和過度謹慎的。這次事件證明了相反的情況。</p>
<p>我打開程式碼並開始逐行檢查。固定邏輯、CN 對應、公鑰驗證——每個元件都需要仔細審查。時間在流逝，但在不理解失敗的情況下匆忙發布將是魯莽的。</p>
<p>經過一個小時的調查，我發現了問題：新憑證的通用名稱結構與預期不同。</p>
<div class="admonition error"><p class="admonition-title"><span class="mdi mdi-alert-circle-outline admonition-icon"></span>🔍 發現（發布前 2 小時）</p><div class="admonition-content"><p><strong>我在程式碼中發現的內容</strong></p>
<ul>
<li>憑證提供商在續訂期間更改了 CN 格式</li>
<li>舊憑證：<code>CN=api.example.com</code></li>
<li>新憑證：<code>CN=*.example.com</code>（萬用字元）</li>
<li>應用的 CN 到固定對應邏輯期望精確匹配</li>
<li>萬用字元 CN 與硬編碼對應不匹配</li>
<li>所有連線都會被拒絕</li>
</ul>
<p><strong>如果部署的影響</strong></p>
<ul>
<li>整個行動使用者群無法連線</li>
<li>沒有應用更新就沒有立即修復</li>
<li>應用程式商店審批流程：最少 1-3 天</li>
<li>潛在的收入損失和聲譽損害</li>
<li>緊急回滾將是唯一選擇</li>
</ul>
<p><strong>時間線</strong></p>
<ul>
<li>測試團隊報告失敗但駁回了它</li>
<li>距離計畫發布還有 2 小時</li>
<li>逐行程式碼調查揭示了根本原因</li>
<li>發布在剩餘 1 小時時被取消</li>
<li>透過堅持和調查避免了災難</li>
</ul>
</div></div>
<p>我立即取消了憑證輪換，距離計畫的發布視窗只剩一個小時。我們與憑證提供商合作，頒發了一個具有原始 CN 格式的新憑證，保持與已部署應用程式的一致性。輪換被重新安排，並在徹底測試確認 CN 符合我們的期望後成功完成。</p>
<h3 id="險些失誤的教訓">險些失誤的教訓</h3>
<p>這次經歷強化了幾個關鍵原則，特別是關於組織文化以及調查失敗而不是駁回失敗的重要性：</p>
<div class="admonition success"><p class="admonition-title"><span class="mdi mdi-check-circle-outline admonition-icon"></span>✅ 測試最佳實務</p><div class="admonition-content"><p><strong>永遠不要在 UAT 中停用固定</strong></p>
<ul>
<li>如果生產環境中啟用了固定，則必須在 UAT 中啟用</li>
<li>「太難測試」意味著你會在生產環境中發現問題</li>
<li>UAT 必須完全鏡像生產行為</li>
<li>在 UAT 中使用類似生產的憑證</li>
<li>跨環境維護固定同步</li>
<li>接受營運負擔作為必要的驗證</li>
<li>如果你不能測試它，你就不能安全地部署它</li>
</ul>
<p><strong>永遠不要駁回測試失敗</strong></p>
<ul>
<li>憑證固定失敗是訊號，不是雜訊</li>
<li>「太難測試」不是可接受的回應</li>
<li>調查每個失敗到根本原因</li>
<li>不要假設「它會在生產環境中運作」</li>
<li>堅持理解為什麼測試失敗</li>
</ul>
<p><strong>在輪換前始終測試</strong></p>
<ul>
<li>在暫存環境中測試新憑證</li>
<li>使用實際的應用程式建置，而不是模擬器</li>
<li>驗證所有憑證屬性：CN、SAN、公鑰、鏈</li>
<li>如果可能，使用多個應用版本進行測試</li>
<li>記錄預期的憑證屬性</li>
<li>如有必要，逐行調查</li>
</ul>
<p><strong>為營運靈活性而設計</strong></p>
<ul>
<li>CN 到固定對應為金鑰輪換提供了靈活性</li>
<li>可以在不更新應用的情況下更新公鑰（在相同 CN 內）</li>
<li>減少所需應用更新的頻率</li>
<li>平衡安全性與營運現實</li>
</ul>
<p><strong>保持協調</strong></p>
<ul>
<li>清楚地記錄憑證要求</li>
<li>向憑證提供商傳達要求</li>
<li>在接受交付之前驗證憑證屬性</li>
<li>準備好回滾程序</li>
<li>安排有足夠測試時間的輪換</li>
</ul>
</div></div>
<p>混合方法——使用 CN 對應到公鑰固定——代表了一種務實的妥協。純公鑰固定會更安全，但每次金鑰輪換都需要應用更新。純 CN 驗證不會提供任何安全性。我們的方法允許我們在 CN 保持一致的情況下輪換金鑰而無需應用更新，同時仍然透過固定的公鑰驗證加密屬性。</p>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>🎯 設計考量</p><div class="admonition-content"><p><strong>適當的設計降低風險</strong></p>
<ul>
<li>將憑證身份（CN）與加密驗證（公鑰）分開</li>
<li>允許每個 CN 有多個固定以實現優雅輪換</li>
<li>在初始部署中包含備份固定</li>
<li>為憑證提供商更改而設計</li>
<li>為緊急情況做計畫</li>
</ul>
<p><strong>環境配置</strong></p>
<ul>
<li>在包括 UAT 在內的所有環境中啟用固定</li>
<li>如果測試團隊停用固定，維護啟用它的單獨暫存環境</li>
<li>如有必要，使用特定於環境的固定</li>
<li>將固定配置與憑證基礎設施一起維護</li>
<li>不要為了方便而犧牲測試覆蓋率</li>
<li>接受適當的測試需要努力</li>
<li>如果你不能在啟用固定的情況下測試，你就不能安全地部署</li>
</ul>
<p><strong>文件至關重要</strong></p>
<ul>
<li>記錄固定架構和理由</li>
<li>維護固定的 CN 和公鑰清單</li>
<li>記錄憑證提供商要求</li>
<li>為輪換程序建立執行手冊</li>
<li>在團隊成員之間共享知識</li>
</ul>
<p><strong>文化考量</strong></p>
<ul>
<li>培養調查而不是駁回測試失敗的文化</li>
<li>授權工程師在發現問題時取消發布</li>
<li>在發布前分配適當調查的時間</li>
<li>不要接受「太難測試」作為有效理由</li>
<li>將憑證輪換視為高風險變更</li>
</ul>
</div></div>
<p>這次事件表明，適當的設計和嚴格的測試不是可選的奢侈品——它們是防止自我造成的中斷的基本保障。更重要的是，它暴露了測試團隊方法中的關鍵缺陷：他們因為「太難測試」而在 UAT 中停用了憑證固定，這意味著他們的測試沒有驗證任何關於生產行為的內容。</p>
<p>測試團隊執行了他們的完整測試套件並報告「準備好生產」。所有測試都通過了——因為固定被停用了。他們透過不反映現實的測試建立了虛假的安全感。只有我堅持維護啟用固定的單獨暫存環境才捕獲了問題。沒有它，憑證固定的第一次測試將在生產環境中進行，數千使用者無法連線。</p>
<p>這次事件驗證了一個有爭議的決定：維護啟用固定測試的營運負擔。許多組織因為「失敗太常見」而在測試環境中停用固定，但這會建立一個危險的缺口，生產環境成為真正的測試環境。啟用固定測試的困難不是一個錯誤——它是一個功能，強制執行適當的憑證管理實務並在問題到達使用者之前捕獲它們。</p>
<p>花費兩個小時調查節省了數天的危機管理、緊急應用更新和潛在的業務影響。每次憑證輪換都應被視為高風險操作，需要與主要程式碼部署相同的謹慎和驗證。每次測試失敗都值得調查，而不是駁回——特別是在處理憑證固定時，失敗的後果是立即和嚴重的。</p>
<h2 id="測試憑證固定：不要走捷徑">測試憑證固定：不要走捷徑</h2>
<p>在非生產環境中停用憑證固定的誘惑很強，但它破壞了測試的整個目的：</p>
<div class="admonition error"><p class="admonition-title"><span class="mdi mdi-alert-circle-outline admonition-icon"></span>🚫 適得其反的捷徑</p><div class="admonition-content"><p><strong>在 UAT 中停用固定的常見理由</strong></p>
<ul>
<li>「憑證固定太難測試」</li>
<li>「我們在 UAT 中使用自簽憑證」</li>
<li>「固定失敗在測試中太常見」</li>
<li>「它減慢了我們的測試週期」</li>
<li>「生產憑證無論如何都是不同的」</li>
</ul>
<p><strong>為什麼這些理由失敗</strong></p>
<ul>
<li>測試應該驗證生產行為</li>
<li>如果難以測試，就難以操作</li>
<li>常見的失敗表明真正的問題</li>
<li>緩慢的測試優於生產中斷</li>
<li>不同的憑證仍應遵循相同的固定規則</li>
</ul>
</div></div>
<div class="admonition success"><p class="admonition-title"><span class="mdi mdi-check-circle-outline admonition-icon"></span>✅ 適當的測試方法</p><div class="admonition-content"><p><strong>在所有環境中維護固定</strong></p>
<ul>
<li>在 UAT 中使用類似生產的憑證</li>
<li>跨環境保持固定同步</li>
<li>首先在 UAT 中測試憑證輪換程序</li>
<li>驗證固定邏輯正常運作</li>
<li>在生產之前捕獲配置問題</li>
</ul>
<p><strong>接受營運負擔</strong></p>
<ul>
<li>是的，在 UAT 中管理憑證更難</li>
<li>是的，它需要團隊之間的協調</li>
<li>是的，它減慢了一些測試場景</li>
<li>但它防止了生產災難</li>
<li>困難就是重點——它強制執行適當的實務</li>
</ul>
</div></div>
<p>在 UAT 中停用固定的組織通常只在生產環境中發現問題，在那裡影響是嚴重的，恢復選項是有限的。在測試環境中維護固定的營運負擔遠小於影響數千或數百萬使用者的生產中斷的成本。</p>
<h2 id="何時使用憑證固定">何時使用憑證固定</h2>
<p>考慮到風險，憑證固定何時有意義？</p>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>✅ 良好的固定用例</p><div class="admonition-content"><p><strong>高價值行動應用程式</strong></p>
<ul>
<li>銀行和金融服務</li>
<li>具有 PHI 的醫療保健應用程式</li>
<li>政府和國防應用程式</li>
<li>當安全性證明營運複雜性合理時</li>
</ul>
<p><strong>受控環境</strong></p>
<ul>
<li>後端服務到服務通訊</li>
<li>具有託管部署的企業應用程式</li>
<li>具有更新機制的物聯網裝置</li>
<li>當客戶端和伺服器都在你的控制之下時</li>
</ul>
<p><strong>威脅模型要求</strong></p>
<ul>
<li>防止 CA 被攻破至關重要</li>
<li>監管合規要求固定</li>
<li>針對性攻擊風險很高</li>
<li>標準 TLS 信任模型不足</li>
</ul>
</div></div>
<div class="admonition error"><p class="admonition-title"><span class="mdi mdi-alert-circle-outline admonition-icon"></span>❌ 不良固定用例</p><div class="admonition-content"><p><strong>公共網站</strong></p>
<ul>
<li>瀏覽器不支援自訂固定</li>
<li>HPKP 因風險而被棄用</li>
<li>憑證透明度提供替代保護</li>
</ul>
<p><strong>沒有更新機制的應用程式</strong></p>
<ul>
<li>無法從固定失敗中恢復</li>
<li>永久損壞的風險</li>
<li>沒有優雅的遷移路徑</li>
</ul>
<p><strong>快速變化的基礎設施</strong></p>
<ul>
<li>頻繁的憑證輪換</li>
<li>多個憑證提供商</li>
<li>動態基礎設施（CDN、負載平衡器）</li>
<li>營運負擔太高</li>
</ul>
</div></div>
<p>實作固定的決定應基於仔細的威脅建模和對營運能力的誠實評估。</p>
<h2 id="憑證固定的替代方案">憑證固定的替代方案</h2>
<p>在實作固定之前，考慮替代安全措施：</p>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>🔒 替代安全措施</p><div class="admonition-content"><p><strong>憑證透明度</strong></p>
<ul>
<li>所有頒發憑證的公共日誌</li>
<li>偵測你網域的未授權憑證</li>
<li>監控 CT 日誌以尋找意外頒發</li>
<li>應用程式沒有營運負擔</li>
</ul>
<p><strong>CAA DNS 記錄</strong></p>
<ul>
<li>指定哪些 CA 可以為你的網域頒發憑證</li>
<li>防止未授權的 CA 頒發憑證</li>
<li>簡單的 DNS 記錄，無需應用程式變更</li>
<li>所有主要 CA 都支援</li>
</ul>
<p><strong>雙向 TLS（mTLS）</strong></p>
<ul>
<li>用於身份驗證的客戶端憑證</li>
<li>比固定更強的服務到服務通訊</li>
<li>雙方相互認證</li>
<li>在零信任架構中很常見</li>
</ul>
<p><strong>增強監控</strong></p>
<ul>
<li>透過 CT 日誌監控憑證頒發</li>
<li>對意外的憑證變更發出警報</li>
<li>在沒有固定風險的情況下偵測攻擊</li>
<li>提供可見性而沒有營運負擔</li>
</ul>
</div></div>
<p>這些替代方案通常提供比憑證固定更好的安全性與複雜性比率。</p>
<h2 id="結論">結論</h2>
<p>憑證固定代表了一種強大的安全技術，但伴隨著重大的營運風險。透過將預期的憑證或公鑰硬編碼到應用程式中，你可以防止 CA 被攻破和中間人攻擊。然而，這種保護是以營運靈活性和自我造成的中斷風險為代價的。</p>
<p>憑證固定中的關鍵決策圍繞固定什麼以及如何管理生命週期。固定葉憑證提供最大的安全性，但隨著憑證輪換需要頻繁更新。固定中繼憑證平衡了安全性和營運可行性，使其成為行動應用程式最常見的方法。固定根憑證提供最小的安全優勢，很少有理由。公鑰固定提供了最佳平衡，允許憑證輪換而無需固定更新，同時保持加密驗證。</p>
<p>通用名稱陷阱說明了對憑證安全性的根本誤解。驗證 CN 或 SAN 欄位不提供安全優勢——這些是任何 CA 都可以在憑證中包含的中繼資料。真正的安全來自驗證加密屬性：公鑰、憑證簽章和鏈驗證。CN 驗證與標準 TLS 驗證是冗餘的，並建立了虛假的安全感。</p>
<p>真實世界的固定失敗展示了營運風險。被遺忘的憑證續訂破壞的行動銀行應用、被 CA 中繼憑證輪換中斷的企業應用程式，以及被過期固定使無用的 API 函式庫都有共同的主題：計畫不足、缺乏備份固定，以及低估協調複雜性。這些事件通常造成的損害比固定旨在防止的攻擊更大。</p>
<p>實作固定的決定應基於仔細的威脅建模。受控環境中的高價值行動應用程式和託管部署代表良好的用例。公共網站、沒有更新機制的應用程式和快速變化的基礎設施是不良候選者。替代安全措施——憑證透明度、CAA 記錄、雙向 TLS 和增強監控——通常提供更好的安全性與複雜性比率。</p>
<p>憑證固定是一把雙刃劍。在具有強大營運流程的受控環境中適當使用時，它可以增強針對複雜攻擊的安全性。在不適當的場景中粗心使用時，它會建立營運脆弱性和自我造成的中斷。產業向更短憑證有效期的趨勢使固定越來越具有挑戰性，強化了公鑰固定優於憑證固定的重要性以及替代安全措施的價值。</p>
<p>在實作憑證固定之前，問問自己：我的威脅模型是否證明營運複雜性合理？我是否有可靠管理固定更新的流程和工具？你能在包括 UAT 在內的所有環境中保持啟用固定嗎？是否有提供類似保護但風險較小的替代安全措施？這些問題的答案應該指導你的固定策略——或者你完全避免固定的決定。</p>
<p>如果你確實實作了固定：永遠不要僅僅因為「太難」而在測試環境中停用它。這種困難是你的早期預警系統，在問題到達生產環境之前捕獲它們。接受營運負擔作為適當安全驗證的代價。</p>

        </div>
        <footer class="article-footer">
            
    <a data-url="https://neo01.com/zh-TW/2021/03/Certificate-Pinning-Security-Trade-offs/" data-id="651ba05b" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url').replace("http://","https://"),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
    <!--script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": {
            "@type": "Person",
            "name": "Neo Alienson"
        },
        "headline": "憑證固定：TLS 安全的雙刃劍",
        "image": "https://neo01.com/assets/cert/pinning_thumbnail.png",
        "keywords": "Certificate Security TLS",
        "genre": "Development",
        "datePublished": "2021-03-04",
        "dateCreated": "2021-03-04",
        "dateModified": "2025-10-26",
        "url": "https://neo01.com//zh-TW/2021/03/Certificate-Pinning-Security-Trade-offs/",
        "description": "憑證固定承諾增強安全性，但也帶來了營運風險。了解固定什麼、如何實作，以及為什麼它可能會破壞你的應用程式。",
        "wordCount": 512
    }
</script-->

</article>

                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>追蹤 :</p>
        <ul class="social-links">
                <li>
                    <a class="social-tooltip" title="stack-exchange" href="https://stackexchange.com/users/2122053/neo?tab=accounts" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-exchange"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="stack-overflow" href="https://stackoverflow.com/users/1885105/neo" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-overflow"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/neoalienson" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-github"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="linkedin" href="https://linkedin.com/in/neo01" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-linkedin"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="rss" href="/atom.xml" target="_blank" rel="noopener">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
        </ul>
    </div>
    <div class="widgets-container">
        
            
                <div class="widget-wrap widget-list">
    <h3 class="widget-title">連結</h3>
    <div class="widget">
        <ul><li><a href="/zh-TW/ai">AI 遊樂場</a></li><li><a href="/zh-TW/tools">工具</a></li><li><a href="/zh-TW/games">遊戲</a></li><li><a href="/zh-TW/pages/useful-information">實用資訊</a></li><li><a href="/zh-TW/pages/Hexo-Blogging-Cheatsheet">Hexo 部落格速查表</a></li></ul>
    </div>
</div>

            
                
            
                    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/10/How-I-Use-AI-to-Learn/" class="thumbnail">
        <span style="background-image:url(/assets/learning/thumbnail_80.png)" alt="我如何使用 AI 學習：透過迭代知識建構的個人旅程" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/AI/">人工智慧</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/10/How-I-Use-AI-to-Learn/" class="title">我如何使用 AI 學習：透過迭代知識建構的個人旅程</a></p>
                            <p class="item-date"><time datetime="2025-10-18T16:00:00.000Z" itemprop="datePublished">2025-10-19</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/10/Tools-Games-And-Browser-Built-In-AI/" class="thumbnail">
        <span style="background-image:url(/2025/10/Tools-Games-And-Browser-Built-In-AI/thumbnail.jpeg)" alt="工具、遊戲與瀏覽器內建 AI 遊樂場" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/AI/">人工智慧</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/10/Tools-Games-And-Browser-Built-In-AI/" class="title">工具、遊戲與瀏覽器內建 AI 遊樂場</a></p>
                            <p class="item-date"><time datetime="2025-10-01T16:00:00.000Z" itemprop="datePublished">2025-10-02</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/" class="thumbnail">
        <span style="background-image:url(/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/thumbnail.jpeg)" alt="代理式編碼的崛起：AI 驅動的軟體工程" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/AI/">人工智慧</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/" class="title">代理式編碼的崛起：AI 驅動的軟體工程</a></p>
                            <p class="item-date"><time datetime="2025-09-19T16:00:00.000Z" itemprop="datePublished">2025-09-20</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports_Part2/" class="thumbnail">
        <span style="background-image:url(/assets/ports/thumbnail.png)" alt="理解臨時埠 Part 2：為什麼伺服器應用程式應避免使用動態埠" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/Development/">開發</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports_Part2/" class="title">理解臨時埠 Part 2：為什麼伺服器應用程式應避免使用動態埠</a></p>
                            <p class="item-date"><time datetime="2025-08-30T16:00:00.000Z" itemprop="datePublished">2025-08-31</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports_Part1/" class="thumbnail">
        <span style="background-image:url(/assets/ports/thumbnail.png)" alt="理解臨時埠：網路通訊的隱形工作者" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/Development/">開發</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports_Part1/" class="title">理解臨時埠：網路通訊的隱形工作者</a></p>
                            <p class="item-date"><time datetime="2025-08-29T16:00:00.000Z" itemprop="datePublished">2025-08-30</time></p>
                        </div>
                    </li>
            </ul>
        </div>
    </div>

            
                
    
    
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">所有文章</h3>
        <div class="widget">
            <ul class="archive-list">
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2025/">2025</a>
                    <span class="archive-list-count">14</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2024/">2024</a>
                    <span class="archive-list-count">25</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2023/">2023</a>
                    <span class="archive-list-count">15</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2022/">2022</a>
                    <span class="archive-list-count">10</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2021/">2021</a>
                    <span class="archive-list-count">12</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2020/">2020</a>
                    <span class="archive-list-count">13</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2019/">2019</a>
                    <span class="archive-list-count">12</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2018/">2018</a>
                    <span class="archive-list-count">2</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2017/">2017</a>
                    <span class="archive-list-count">5</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2016/">2016</a>
                    <span class="archive-list-count">4</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2015/">2015</a>
                    <span class="archive-list-count">6</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2014/">2014</a>
                    <span class="archive-list-count">7</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2013/">2013</a>
                    <span class="archive-list-count">2</span>
                </li>
            
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <!-- disable caching cause each page has different footer from qrcode -->
        <!-- common/footer, null, {cache: !config.relative_link})  -->
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="qrcode-share-wrapper">
                <div class="qrcode-text">https://neo01.com/l#a1ffbd2d</div>
                <img src="/qr/qr-abc0917b0deae6bdca3c4e85483dffaa.svg" width="200" height="200" alt="QR Code for https://neo01.com/l#a1ffbd2d">
            </div>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" title="Homepage" class="logo"></a>
                </h1>
                
                <p>© 2025 Neo Alienson. 版權所有.
                  <a href="/zh-TW/terms-and-conditions">使用條款</a></p>
                
            </div>
            <div class="footer-plugins">
              


            </div>
        </div>
    </div>
</footer>

        
    
        


        


        


        


        


        


        


        


        


    



<!-- Custom Scripts -->




    </div>
<!-- hexo injector body_end start --><script type="text/javascript" src="/js/bundle_last.js"></script><!-- hexo injector body_end end -->

</body></html>