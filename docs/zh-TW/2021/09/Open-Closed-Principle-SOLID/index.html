<!DOCTYPE html><html lang="zh-TW"><head><!-- hexo injector head_begin start --><!-- Google tag (gtag.js) begins-->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3DZR3TQYCY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-3DZR3TQYCY');
    </script>
    <!-- Google tag (gtag.js) ends-->
    <!-- hexo injector head_begin end -->
    <meta charset="utf-8">
    <!-- security headers starts -->
    <!-- meta http-equiv="content-security-policy" content="script-src 'sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=' 'sha256-lJjk3/dvd+wXqRFjV7T5L/nXJXr5NjUjmsKSPEe+ass=';" -->
    <!-- security headers ends -->
    <!-- favicon starts -->    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <!-- favicon ends -->
    

    <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="alternate" href="/atom.xml" title="Decoding Digital Anomalies" type="application/atom+xml">
    

    

    

    

    

    

    

    
    
        


    
    
        


    



    
    <title>開閉原則：在不破壞的情況下擴展 | Decoding Digital Anomalies</title>
    
    <meta name="keywords" content="Architecture,Best Practices,Software Design">
    
    
    <meta name="description" content="軟體實體應該對擴展開放，對修改關閉。這個原則承諾在不破壞的情況下提供靈活性，但開發者在何時應用抽象以及何時會變成過度工程方面掙扎。">
<meta property="og:type" content="article">
<meta property="og:title" content="開閉原則：在不破壞的情況下擴展">
<meta property="og:url" content="https://neo01.com/zh-TW/2021/09/Open-Closed-Principle-SOLID/index.html">
<meta property="og:site_name" content="Decoding Digital Anomalies">
<meta property="og:description" content="軟體實體應該對擴展開放，對修改關閉。這個原則承諾在不破壞的情況下提供靈活性，但開發者在何時應用抽象以及何時會變成過度工程方面掙扎。">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://neo01.com/assets/solid/thumbnail.png">
<meta property="article:published_time" content="2021-09-11T16:00:00.000Z">
<meta property="article:modified_time" content="2025-10-24T18:11:52.626Z">
<meta property="article:author" content="Neo Alienson">
<meta property="article:tag" content="Architecture">
<meta property="article:tag" content="Best Practices">
<meta property="article:tag" content="Software Design">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://neo01.com/assets/solid/thumbnail.png">
    
    <!-- hexo injector head_end start --><link rel="stylesheet" type="text/css" href="/css/bundle.css"><script type="text/javascript" src="/js/bundle_first.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 8.1.0">  <link rel="canonical" href="https://neo01.com/zh-TW/2021/09/Open-Closed-Principle-SOLID/">
  <link rel="alternate" hreflang="en" data-canonical="true" href="https://neo01.com/2021/09/Open-Closed-Principle-SOLID/">
  <link rel="alternate" hreflang="zh-TW" href="https://neo01.com/zh-TW/2021/09/Open-Closed-Principle-SOLID/">
  <link rel="alternate" hreflang="zh-CN" href="https://neo01.com/zh-CN/2021/09/Open-Closed-Principle-SOLID/">
  <link rel="alternate" hreflang="ja" href="https://neo01.com/ja/2021/09/Open-Closed-Principle-SOLID/">
<style id="admonition-styles">.admonition {
  margin: 1em 0;
  padding: 0rem;
  border-left: 0.3rem solid;
  border-radius: 0.4rem;
  background-color: #f9f9f9;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
  overflow: hidden;
  page-break-inside: avoid;
}

.admonition-title {
  display: flex;
  align-items: center;
  font-weight: 600;
  padding: 0rem 1rem 0.1rem 0.75rem;
  font-size: 1.05em;
  background-color: rgba(0, 0, 0, 0.03);
  border-top-left-radius: 0.4rem;
  border-top-right-radius: 0.4rem;
  margin: 0 !important;
}

.admonition-icon {
  font-size: 1.2em;
  margin-right: 0.6rem;
  opacity: 0.85;
  margin-top: 0.1rem;
}

/* 内容区域 margin */
.admonition > *:not(.admonition-title) {
  margin: 0.6rem 1rem 0.6rem 1rem;
}

/* NOTE 类型 */
.admonition.anote {
  border-color: #448aff;
}
.admonition.anote > .admonition-title {
  background-color: #448aff1a;
  color: #2962ff;
}

/* INFO / TODO 类型 */
.admonition.info,
.admonition.todo {
  border-color: #00b8d4;
}
.admonition.info > .admonition-title,
.admonition.todo > .admonition-title {
  background-color: rgba(0, 184, 212, 0.1);
  color: #007c91;
}

/* 警告类 */
.admonition.warning,
.admonition.attention,
.admonition.caution {
  border-color: #ff9100;
}
.admonition.warning > .admonition-title,
.admonition.attention > .admonition-title,
.admonition.caution > .admonition-title {
  background-color: rgba(255, 145, 0, 0.1);
  color: #c66900;
}

/* 错误类 */
.admonition.failure,
.admonition.missing,
.admonition.fail,
.admonition.error,
.admonition.danger,
.admonition.bug {
  border-color: #ff5252;
}
.admonition.failure > .admonition-title,
.admonition.missing > .admonition-title,
.admonition.fail > .admonition-title,
.admonition.error > .admonition-title,
.admonition.danger > .admonition-title,
.admonition.bug > .admonition-title {
  background-color: rgba(255, 82, 82, 0.1);
  color: #b71c1c;
}

/* TIP 类型 */
.admonition.tip {
  border-color: #00bfa5;
}
.admonition.tip > .admonition-title {
  background-color: #00bfa51a;
  color: #00796b;
}

/* SUCCESS 类型 */
.admonition.success {
  border-color: #00c853;
}
.admonition.success > .admonition-title {
  background-color: #00c8531a;
  color: #2e7d32;
}

/* QUESTION 类型 */
.admonition.question {
  border-color: #64dd17;
}
.admonition.question > .admonition-title {
  background-color: #64dd171a;
  color: #558b2f;
}

/* EXAMPLE 类型 */
.admonition.example {
  border-color: #7c4dff;
}
.admonition.example > .admonition-title {
  background-color: #7c4dff1a;
  color: #512da8;
}

/* QUOTE 类型 */
.admonition.quote {
  border-color: #9e9e9e;
}
.admonition.quote > .admonition-title {
  background-color: #9e9e9e1a;
  color: #424242;
}

/*黑暗模式*/
/* 夜间模式基础样式 */
[data-theme="dark"] .admonition {
  background-color: #1e1e1e;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
}

[data-theme="dark"] .admonition-title {
  background-color: rgba(255, 255, 255, 0.05);
}

/* anote */
[data-theme="dark"] .admonition.anote {
  border-color: #82b1ff;
}
[data-theme="dark"] .admonition.anote > .admonition-title {
  background-color: #82b1ff1a;
  color: #bbdefb;
}

/* tip */
[data-theme="dark"] .admonition.tip {
  border-color: #64ffda;
}
[data-theme="dark"] .admonition.tip > .admonition-title {
  background-color: #64ffda1a;
  color: #1de9b6;
}

/* success */
[data-theme="dark"] .admonition.success {
  border-color: #69f0ae;
}
[data-theme="dark"] .admonition.success > .admonition-title {
  background-color: #69f0ae1a;
  color: #00e676;
}

/* question */
[data-theme="dark"] .admonition.question {
  border-color: #b2ff59;
}
[data-theme="dark"] .admonition.question > .admonition-title {
  background-color: #b2ff591a;
  color: #aeea00;
}

/* example */
[data-theme="dark"] .admonition.example {
  border-color: #b388ff;
}
[data-theme="dark"] .admonition.example > .admonition-title {
  background-color: #b388ff1a;
  color: #b39ddb;
}

/* quote */
[data-theme="dark"] .admonition.quote {
  border-color: #bdbdbd;
}
[data-theme="dark"] .admonition.quote > .admonition-title {
  background-color: #bdbdbd1a;
  color: #eeeeee;
}

/* warning / attention / caution */
[data-theme="dark"] .admonition.warning,
[data-theme="dark"] .admonition.attention,
[data-theme="dark"] .admonition.caution {
  border-color: #ffb300;
}
[data-theme="dark"] .admonition.warning > .admonition-title,
[data-theme="dark"] .admonition.attention > .admonition-title,
[data-theme="dark"] .admonition.caution > .admonition-title {
  background-color: #ffb3001a;
  color: #ffe082;
}

/* error / fail / failure / bug / danger / missing */
[data-theme="dark"] .admonition.error,
[data-theme="dark"] .admonition.fail,
[data-theme="dark"] .admonition.failure,
[data-theme="dark"] .admonition.bug,
[data-theme="dark"] .admonition.missing,
[data-theme="dark"] .admonition.danger {
  border-color: #ef5350;
}
[data-theme="dark"] .admonition.error > .admonition-title,
[data-theme="dark"] .admonition.fail > .admonition-title,
[data-theme="dark"] .admonition.failure > .admonition-title,
[data-theme="dark"] .admonition.bug > .admonition-title,
[data-theme="dark"] .admonition.missing > .admonition-title,
[data-theme="dark"] .admonition.danger > .admonition-title {
  background-color: #ef53501a;
  color: #ff8a80;
}</style></head>

<body>
    <div id="wrap">
        
        
<header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <div class="logo"></div>
                    </h1>

                        <h2 class="subtitle-wrap">
                            <p class="title">解碼數位異象</p>
                          <p class="subtitle">有時功能就是數位兔子洞中的錯誤，反之亦然</p>
                        </h2>




                    <div id="lang-selector">
                        <span class="lang-icon">🌐</span>
                        
                            <a href="#" class="lang-link" data-lang="en">English</a>
<span class="lang-sep">|</span>                            <a href="#" class="lang-link" data-lang="zh-CN">简体中文</a>
<span class="lang-sep">|</span>                            <a href="#" class="lang-link" data-lang="ja">日本語</a>
                        <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            var currentLang = 'zh-TW';
                            var currentPath = window.location.pathname;
                            var basePath;
                            
                            if (currentLang === 'en') {
                                basePath = currentPath;
                            } else {
                                basePath = currentPath.replace(new RegExp('^/' + currentLang + '/'), '/');
                            }
                            
                            document.querySelectorAll('.lang-link').forEach(function(link) {
                                var targetLang = link.getAttribute('data-lang');
                                var targetPath;
                                if (targetLang === 'en') {
                                    targetPath = basePath;
                                } else {
                                    targetPath = '/' + targetLang + basePath;
                                }
                                link.href = targetPath;
                            });
                        });
                        </script>
                    </div>


                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/zh-TW/">首頁</a>
                                </li>
                                                                    <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/AI/">人工智慧</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/AI/Art-Gallery/">藝術畫廊</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Architecture/">架構</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Cybersecurity/">資訊安全</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Development/">開發</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/zh-TW/categories/Misc/">雜項</a></li></ul>
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/zh-TW/about-me">關於</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" id="search-form-input" placeholder="搜尋">
        <button type="submit" title="搜尋" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" id="ins-search-input" placeholder="輸入關鍵字...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script integrity="sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=">
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '頁面',
            CATEGORIES: '分類',
            TAGS: '標籤',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
        LANG: 'zh-TW',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>




</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

        
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Development/">Development</a>
    </h1>
</div>

                        <div class="main-body-content">
                            <article id="post-2021/09/Open-Closed-Principle-SOLID-zh-TW" class="article article-single article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner responsive-content">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        開閉原則：在不破壞的情況下擴展
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
      <i class="fa fa-calendar"></i>
        
          Created <time datetime="2021-09-11T16:00:00.000Z" itemprop="datePublished">2021-09-12</time>
          &nbsp;<i class="fa fa-calendar"></i>
          Updated <time datetime="2025-10-24T18:11:52.626Z" itemprop="datePublished">2025-10-25</time>
        
    </div>


                

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/zh-TW/tags/Architecture/">Architecture</a> <a class="tag-link" href="/zh-TW/tags/Best-Practices/">Best Practices</a> <a class="tag-link" href="/zh-TW/tags/Software-Design/">Software Design</a>
    </div>

            </div>
        
        
        
        <div class="article-entry" itemprop="articleBody">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%90%86%E8%A7%A3%E9%96%8B%E9%96%89%E5%8E%9F%E5%89%87"><span class="toc-text">理解開閉原則</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%8E%E9%A1%AF%E7%9A%84%E9%81%95%E8%A6%8F%EF%BC%9ASwitch-%E9%99%B3%E8%BF%B0%E5%BC%8F"><span class="toc-text">明顯的違規：Switch 陳述式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E5%A6%99%E7%9A%84%E9%81%95%E8%A6%8F%EF%BC%9A%E7%A1%AC%E7%B7%A8%E7%A2%BC%E8%A1%8C%E7%82%BA"><span class="toc-text">微妙的違規：硬編碼行為</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%8E%E5%BA%A6%E5%B7%A5%E7%A8%8B%E9%99%B7%E9%98%B1%EF%BC%9A%E9%81%8E%E6%97%A9%E6%8A%BD%E8%B1%A1"><span class="toc-text">過度工程陷阱：過早抽象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%95%E6%99%82%E6%87%89%E7%94%A8-OCP%EF%BC%9A%E8%AE%8A%E5%8C%96%E9%BB%9E%E6%B8%AC%E8%A9%A6"><span class="toc-text">何時應用 OCP：變化點測試</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%A6%E9%9A%9B%E6%87%89%E7%94%A8%EF%BC%9A%E5%A4%96%E6%8E%9B%E6%9E%B6%E6%A7%8B"><span class="toc-text">實際應用：外掛架構</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B5%90%E8%AB%96"><span class="toc-text">結論</span></a></li></ol>
            <p>開閉原則（OCP）是 SOLID 設計中的第二個原則，但它可能是最容易被誤解的。由 Bertrand Meyer 提出並由 Robert C. Martin 推廣，它指出：「軟體實體應該對擴展開放，對修改關閉。」這個看似矛盾的陳述承諾能夠在不改變現有程式碼的情況下新增新功能。然而，開發者在以下問題上掙扎：我應該何時建立抽象？多少靈活性才算過度？遵循 OCP 實際上會讓程式碼更複雜嗎？</p>
<p>本文透過實際場景探討開閉原則，從僵化的 switch 陳述式到過度工程的外掛架構。我們將剖析「對擴展開放」的真正含義、何時抽象增加價值以及何時它創造不必要的複雜性。借鑑生產程式碼庫和重構經驗，我們揭示為什麼 OCP 既強大又容易被誤用。</p>
<h2 id="理解開閉原則">理解開閉原則</h2>
<p>在深入了解何時以及如何應用 OCP 之前，理解這個原則的真正含義至關重要。「對擴展開放，對修改關閉」這個術語乍一看似乎是矛盾的。</p>
<h3 id="開閉是什麼意思？">開閉是什麼意思？</h3>
<p>該原則有兩個相互配合的部分：</p>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>📚 開閉定義</p><div class="admonition-content"><p><strong>對擴展開放</strong></p>
<ul>
<li>可以新增新功能</li>
<li>可以引入新行為</li>
<li>可以支援新需求</li>
<li>無需觸及現有程式碼</li>
</ul>
<p><strong>對修改關閉</strong></p>
<ul>
<li>現有程式碼保持不變</li>
<li>已測試的程式碼保持已測試狀態</li>
<li>工作的程式碼保持工作狀態</li>
<li>減少破壞性改變的風險</li>
</ul>
<p><strong>機制</strong></p>
<ul>
<li>抽象使擴展成為可能</li>
<li>多型提供靈活性</li>
<li>繼承或組合新增行為</li>
<li>介面定義契約</li>
</ul>
</div></div>
<p>該原則強調保護穩定程式碼免受改變。當需求演進時，你擴展系統而不是修改現有的、工作的程式碼。這減少了向已測試功能引入錯誤的風險。</p>
<h3 id="為什麼-OCP-重要">為什麼 OCP 重要</h3>
<p>違反 OCP 會建立脆弱的程式碼，每次改變都會破壞：</p>
<div class="admonition warning"><p class="admonition-title"><span class="mdi mdi-alert-outline admonition-icon"></span>⚠️ 違反 OCP 的代價</p><div class="admonition-content"><p><strong>修改的漣漪效應</strong></p>
<ul>
<li>每個新功能都需要改變現有程式碼</li>
<li>改變在系統中傳播</li>
<li>破壞工作功能的風險</li>
<li>回歸測試負擔增加</li>
</ul>
<p><strong>耦合和僵化</strong></p>
<ul>
<li>新需求強制到處修改</li>
<li>程式碼變得抗拒改變</li>
<li>對破壞事物的恐懼抑制演進</li>
<li>技術債務累積</li>
</ul>
<p><strong>測試開銷</strong></p>
<ul>
<li>必須重新測試所有修改的程式碼</li>
<li>整合測試可能會破壞</li>
<li>對改變的信心下降</li>
<li>部署風險增加</li>
</ul>
</div></div>
<p>這些成本隨著時間推移而累積。每個新功能都需要修改的程式碼變得越來越難以改變且風險越來越大。</p>
<h2 id="明顯的違規：Switch-陳述式">明顯的違規：Switch 陳述式</h2>
<p>最明顯的 OCP 違規來自 switch 陳述式或 if-else 鏈，每個新情況都必須修改它們。</p>
<h3 id="經典的-Switch-陳述式違規">經典的 Switch 陳述式違規</h3>
<p>考慮這個計算運費的常見模式：</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShippingCalculator</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">calculateShipping</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">,</span> <span class="token class-name">String</span> shippingMethod<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">double</span> cost <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>shippingMethod<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">"STANDARD"</span><span class="token operator">:</span>
                cost <span class="token operator">=</span> order<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">"EXPRESS"</span><span class="token operator">:</span>
                cost <span class="token operator">=</span> order<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.5</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">"OVERNIGHT"</span><span class="token operator">:</span>
                cost <span class="token operator">=</span> order<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3.0</span> <span class="token operator">+</span> <span class="token number">25</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Unknown shipping method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">return</span> cost<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>這段程式碼違反了 OCP，因為：</p>
<div class="admonition error"><p class="admonition-title"><span class="mdi mdi-alert-circle-outline admonition-icon"></span>🚫 識別出的 OCP 違規</p><div class="admonition-content"><p><strong>擴展需要修改</strong></p>
<ul>
<li>新增新的運輸方式需要改變這個類別</li>
<li>必須修改 switch 陳述式</li>
<li>必須重新編譯和重新測試現有程式碼</li>
</ul>
<p><strong>分散的邏輯</strong></p>
<ul>
<li>運輸計算邏輯嵌入在 switch 中</li>
<li>無法獨立測試運輸方式</li>
<li>無法在其他地方重用運輸邏輯</li>
</ul>
<p><strong>脆弱性</strong></p>
<ul>
<li>容易忘記更新所有 switch 陳述式</li>
<li>破壞現有運輸方式的風險</li>
<li>新方法沒有編譯時安全性</li>
</ul>
</div></div>
<p>當你需要新增「INTERNATIONAL」運輸時會發生什麼？你修改這個類別。當你新增「SAME_DAY」運輸時？再次修改。每個新的運輸方式都需要改變已測試的、工作的程式碼。</p>
<h3 id="重構以遵循-OCP">重構以遵循 OCP</h3>
<p>應用抽象使程式碼對擴展開放：</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">// 抽象：定義契約</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ShippingStrategy</span> <span class="token punctuation">{</span>
    <span class="token keyword">double</span> <span class="token function">calculateCost</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 具體實作：每個運輸方式是一個單獨的類別</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StandardShipping</span> <span class="token keyword">implements</span> <span class="token class-name">ShippingStrategy</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">calculateCost</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> order<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"STANDARD"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExpressShipping</span> <span class="token keyword">implements</span> <span class="token class-name">ShippingStrategy</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">calculateCost</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> order<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.5</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"EXPRESS"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OvernightShipping</span> <span class="token keyword">implements</span> <span class="token class-name">ShippingStrategy</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">calculateCost</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> order<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3.0</span> <span class="token operator">+</span> <span class="token number">25</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"OVERNIGHT"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 計算器現在使用抽象</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShippingCalculator</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ShippingStrategy</span><span class="token punctuation">&gt;</span></span> strategies <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">ShippingCalculator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 註冊可用的策略</span>
        <span class="token function">registerStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StandardShipping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">registerStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ExpressShipping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">registerStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OvernightShipping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerStrategy</span><span class="token punctuation">(</span><span class="token class-name">ShippingStrategy</span> strategy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        strategies<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>strategy<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> strategy<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">calculateShipping</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">,</span> <span class="token class-name">String</span> shippingMethod<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ShippingStrategy</span> strategy <span class="token operator">=</span> strategies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>shippingMethod<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>strategy <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Unknown shipping method: "</span> <span class="token operator">+</span> shippingMethod<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> strategy<span class="token punctuation">.</span><span class="token function">calculateCost</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>現在程式碼遵循 OCP：</p>
<div class="admonition success"><p class="admonition-title"><span class="mdi mdi-check-circle-outline admonition-icon"></span>✅ OCP 的好處</p><div class="admonition-content"><p><strong>對擴展開放</strong></p>
<ul>
<li>透過建立新類別新增新的運輸方式</li>
<li>不修改現有的運輸方式</li>
<li>不修改計算器</li>
<li>註冊新策略就可以工作</li>
</ul>
<p><strong>對修改關閉</strong></p>
<ul>
<li>現有的運輸方式不變</li>
<li>計算器邏輯不變</li>
<li>已測試的程式碼保持已測試狀態</li>
<li>對工作功能沒有風險</li>
</ul>
<p><strong>額外的好處</strong></p>
<ul>
<li>每個運輸方式可獨立測試</li>
<li>運輸邏輯可重用</li>
<li>清晰的關注點分離</li>
<li>編譯時類型安全</li>
</ul>
</div></div>
<p>現在新增「INTERNATIONAL」運輸只需要建立一個新類別：</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InternationalShipping</span> <span class="token keyword">implements</span> <span class="token class-name">ShippingStrategy</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">calculateCost</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> order<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5.0</span> <span class="token operator">+</span> <span class="token number">50</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"INTERNATIONAL"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 註冊它就可以工作——不修改現有程式碼</span>
calculator<span class="token punctuation">.</span><span class="token function">registerStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InternationalShipping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>現有程式碼保持不變。不需要重新測試標準、快遞或隔夜運輸。</p>
<h2 id="微妙的違規：硬編碼行為">微妙的違規：硬編碼行為</h2>
<p>比 switch 陳述式更隱蔽的是具有硬編碼行為的類別，它們在不修改的情況下抗拒擴展。</p>
<h3 id="報告產生器問題">報告產生器問題</h3>
<p>考慮一個產生不同格式的報告產生器：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ReportGenerator</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">generate_report</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">,</span> format_type<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> format_type <span class="token operator">==</span> <span class="token string">"PDF"</span><span class="token punctuation">:</span>
            <span class="token comment"># PDF 產生邏輯</span>
            pdf_content <span class="token operator">=</span> <span class="token string">"&lt;PDF&gt;"</span>
            <span class="token keyword">for</span> item <span class="token keyword">in</span> data<span class="token punctuation">:</span>
                pdf_content <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"&lt;p&gt;</span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&lt;/p&gt;"</span></span>
            pdf_content <span class="token operator">+=</span> <span class="token string">"&lt;/PDF&gt;"</span>
            <span class="token keyword">return</span> pdf_content
            
        <span class="token keyword">elif</span> format_type <span class="token operator">==</span> <span class="token string">"HTML"</span><span class="token punctuation">:</span>
            <span class="token comment"># HTML 產生邏輯</span>
            html_content <span class="token operator">=</span> <span class="token string">"&lt;html&gt;&lt;body&gt;"</span>
            <span class="token keyword">for</span> item <span class="token keyword">in</span> data<span class="token punctuation">:</span>
                html_content <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"&lt;div&gt;</span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&lt;/div&gt;"</span></span>
            html_content <span class="token operator">+=</span> <span class="token string">"&lt;/body&gt;&lt;/html&gt;"</span>
            <span class="token keyword">return</span> html_content
            
        <span class="token keyword">elif</span> format_type <span class="token operator">==</span> <span class="token string">"CSV"</span><span class="token punctuation">:</span>
            <span class="token comment"># CSV 產生邏輯</span>
            csv_content <span class="token operator">=</span> <span class="token string">"Name,Value\n"</span>
            <span class="token keyword">for</span> item <span class="token keyword">in</span> data<span class="token punctuation">:</span>
                csv_content <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span>
            <span class="token keyword">return</span> csv_content
            
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Unsupported format: </span><span class="token interpolation"><span class="token punctuation">{</span>format_type<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></code></pre>
<p>這違反了 OCP，因為：</p>
<div class="admonition warning"><p class="admonition-title"><span class="mdi mdi-alert-outline admonition-icon"></span>⚠️ 隱藏的 OCP 違規</p><div class="admonition-content"><p><strong>格式邏輯嵌入</strong></p>
<ul>
<li>所有格式邏輯在一個方法中</li>
<li>無法在不修改類別的情況下新增格式</li>
<li>無法獨立測試格式</li>
</ul>
<p><strong>不斷增長的複雜性</strong></p>
<ul>
<li>每個新格式都會增長方法</li>
<li>變得更難理解</li>
<li>增加錯誤的風險</li>
</ul>
<p><strong>緊密耦合</strong></p>
<ul>
<li>報告產生器知道所有格式</li>
<li>無法重用格式邏輯</li>
<li>無法組合格式</li>
</ul>
</div></div>
<p>新增 Excel 格式需要修改這個方法，重新測試所有格式，並有破壞現有功能的風險。</p>
<h3 id="使用策略模式重構">使用策略模式重構</h3>
<p>應用策略模式以遵循 OCP：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># 抽象：定義契約</span>
<span class="token keyword">from</span> abc <span class="token keyword">import</span> ABC<span class="token punctuation">,</span> abstractmethod

<span class="token keyword">class</span> <span class="token class-name">ReportFormatter</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">format</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

<span class="token comment"># 具體實作</span>
<span class="token keyword">class</span> <span class="token class-name">PDFFormatter</span><span class="token punctuation">(</span>ReportFormatter<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">format</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        pdf_content <span class="token operator">=</span> <span class="token string">"&lt;PDF&gt;"</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> data<span class="token punctuation">:</span>
            pdf_content <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"&lt;p&gt;</span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&lt;/p&gt;"</span></span>
        pdf_content <span class="token operator">+=</span> <span class="token string">"&lt;/PDF&gt;"</span>
        <span class="token keyword">return</span> pdf_content
    
    <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"PDF"</span>

<span class="token keyword">class</span> <span class="token class-name">HTMLFormatter</span><span class="token punctuation">(</span>ReportFormatter<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">format</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        html_content <span class="token operator">=</span> <span class="token string">"&lt;html&gt;&lt;body&gt;"</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> data<span class="token punctuation">:</span>
            html_content <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"&lt;div&gt;</span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&lt;/div&gt;"</span></span>
        html_content <span class="token operator">+=</span> <span class="token string">"&lt;/body&gt;&lt;/html&gt;"</span>
        <span class="token keyword">return</span> html_content
    
    <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"HTML"</span>

<span class="token keyword">class</span> <span class="token class-name">CSVFormatter</span><span class="token punctuation">(</span>ReportFormatter<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">format</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        csv_content <span class="token operator">=</span> <span class="token string">"Name,Value\n"</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> data<span class="token punctuation">:</span>
            csv_content <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span>
        <span class="token keyword">return</span> csv_content
    
    <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"CSV"</span>

<span class="token comment"># 產生器使用抽象</span>
<span class="token keyword">class</span> <span class="token class-name">ReportGenerator</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>formatters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token keyword">def</span> <span class="token function">register_formatter</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> formatter<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>formatters<span class="token punctuation">[</span>formatter<span class="token punctuation">.</span>get_name<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> formatter
    
    <span class="token keyword">def</span> <span class="token function">generate_report</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">,</span> format_type<span class="token punctuation">)</span><span class="token punctuation">:</span>
        formatter <span class="token operator">=</span> self<span class="token punctuation">.</span>formatters<span class="token punctuation">.</span>get<span class="token punctuation">(</span>format_type<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> formatter<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Unsupported format: </span><span class="token interpolation"><span class="token punctuation">{</span>format_type<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> formatter<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

<span class="token comment"># 使用</span>
generator <span class="token operator">=</span> ReportGenerator<span class="token punctuation">(</span><span class="token punctuation">)</span>
generator<span class="token punctuation">.</span>register_formatter<span class="token punctuation">(</span>PDFFormatter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
generator<span class="token punctuation">.</span>register_formatter<span class="token punctuation">(</span>HTMLFormatter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
generator<span class="token punctuation">.</span>register_formatter<span class="token punctuation">(</span>CSVFormatter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 新增 Excel 格式——不修改現有程式碼</span>
<span class="token keyword">class</span> <span class="token class-name">ExcelFormatter</span><span class="token punctuation">(</span>ReportFormatter<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">format</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Excel 產生邏輯</span>
        <span class="token keyword">return</span> <span class="token string">"Excel content"</span>
    
    <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"EXCEL"</span>

generator<span class="token punctuation">.</span>register_formatter<span class="token punctuation">(</span>ExcelFormatter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<p>重構後的設計：</p>
<div class="admonition success"><p class="admonition-title"><span class="mdi mdi-check-circle-outline admonition-icon"></span>✅ 無需修改的擴展</p><div class="admonition-content"><p><strong>新格式作為新類別</strong></p>
<ul>
<li>每個格式都是獨立的</li>
<li>新增格式而不觸及現有程式碼</li>
<li>單獨測試新格式</li>
</ul>
<p><strong>產生器不變</strong></p>
<ul>
<li>與任何格式化器一起工作</li>
<li>不知道特定格式</li>
<li>委託給抽象</li>
</ul>
<p><strong>靈活性</strong></p>
<ul>
<li>可以組合格式化器</li>
<li>可以裝飾格式化器</li>
<li>可以在執行時設定</li>
</ul>
</div></div>
<h2 id="過度工程陷阱：過早抽象">過度工程陷阱：過早抽象</h2>
<p>雖然 OCP 防止僵化，但過度熱衷的應用透過過早抽象創造不必要的複雜性。</p>
<h3 id="過度抽象的範例">過度抽象的範例</h3>
<p>考慮這個簡單計算器的過度靈活設計：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 抽象操作</span>
<span class="token keyword">interface</span> <span class="token class-name">Operation</span> <span class="token punctuation">{</span>
    <span class="token function">execute</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 具體操作</span>
<span class="token keyword">class</span> <span class="token class-name">AddOperation</span> <span class="token keyword">implements</span> <span class="token class-name">Operation</span> <span class="token punctuation">{</span>
    <span class="token function">execute</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"add"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">SubtractOperation</span> <span class="token keyword">implements</span> <span class="token class-name">Operation</span> <span class="token punctuation">{</span>
    <span class="token function">execute</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"subtract"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MultiplyOperation</span> <span class="token keyword">implements</span> <span class="token class-name">Operation</span> <span class="token punctuation">{</span>
    <span class="token function">execute</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"multiply"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">DivideOperation</span> <span class="token keyword">implements</span> <span class="token class-name">Operation</span> <span class="token punctuation">{</span>
    <span class="token function">execute</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Division by zero"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> a <span class="token operator">/</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"divide"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 具有外掛架構的計算器</span>
<span class="token keyword">class</span> <span class="token class-name">Calculator</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> operations<span class="token operator">:</span> Map<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> Operation<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">registerOperation</span><span class="token punctuation">(</span>operation<span class="token operator">:</span> Operation<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>operations<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>operation<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> operation<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">calculate</span><span class="token punctuation">(</span>operationName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> operation <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>operations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>operationName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>operation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Unknown operation: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>operationName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> operation<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用需要儀式</span>
<span class="token keyword">const</span> calc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Calculator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
calc<span class="token punctuation">.</span><span class="token function">registerOperation</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AddOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
calc<span class="token punctuation">.</span><span class="token function">registerOperation</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SubtractOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
calc<span class="token punctuation">.</span><span class="token function">registerOperation</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MultiplyOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
calc<span class="token punctuation">.</span><span class="token function">registerOperation</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DivideOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> calc<span class="token punctuation">.</span><span class="token function">calculate</span><span class="token punctuation">(</span><span class="token string">"add"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>這個設計走得太遠了：</p>
<div class="admonition error"><p class="admonition-title"><span class="mdi mdi-alert-circle-outline admonition-icon"></span>🚫 過度工程問題</p><div class="admonition-content"><p><strong>不必要的複雜性</strong></p>
<ul>
<li>簡單操作被埋在抽象中</li>
<li>基本算術需要四個類別</li>
<li>標準操作的註冊儀式</li>
</ul>
<p><strong>不太可能的擴展</strong></p>
<ul>
<li>你多久新增一次新的算術操作？</li>
<li>基本數學操作是穩定的</li>
<li>抽象解決了不存在的問題</li>
</ul>
<p><strong>降低的清晰度</strong></p>
<ul>
<li>更難理解程式碼做什麼</li>
<li>更多檔案需要導覽</li>
<li>間接性模糊了簡單邏輯</li>
</ul>
</div></div>
<h3 id="找到正確的平衡">找到正確的平衡</h3>
<p>穩定需求的更簡單設計：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Calculator</span> <span class="token punctuation">{</span>
    <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">subtract</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">multiply</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">divide</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Division by zero"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> a <span class="token operator">/</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用很直接</span>
<span class="token keyword">const</span> calc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Calculator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> calc<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>這個更簡單的設計：</p>
<div class="admonition success"><p class="admonition-title"><span class="mdi mdi-check-circle-outline admonition-icon"></span>✅ 適當的簡單性</p><div class="admonition-content"><p><strong>清晰和直接</strong></p>
<ul>
<li>每個方法做什麼很明顯</li>
<li>沒有不必要的間接性</li>
<li>易於理解和使用</li>
</ul>
<p><strong>滿足需求</strong></p>
<ul>
<li>基本操作很少改變</li>
<li>沒有需要擴展的證據</li>
<li>YAGNI：你不會需要它</li>
</ul>
<p><strong>以後易於重構</strong></p>
<ul>
<li>如果擴展變得必要，那時再重構</li>
<li>不要預先支付複雜性成本</li>
<li>等待實際需求</li>
</ul>
</div></div>
<p>關鍵見解：當你有證據表明需要擴展時應用 OCP，而不是投機性地。</p>
<h2 id="何時應用-OCP：變化點測試">何時應用 OCP：變化點測試</h2>
<p>如何確定何時應用 OCP？尋找變化點——需求可能改變或擴展的地方。</p>
<h3 id="識別變化點">識別變化點</h3>
<p>考慮一個支付處理系統：</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentProcessor</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processPayment</span><span class="token punctuation">(</span><span class="token class-name">Payment</span> payment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 驗證支付</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Invalid amount"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// 根據類型處理</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"CREDIT_CARD"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">processCreditCard</span><span class="token punctuation">(</span>payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"PAYPAL"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">processPayPal</span><span class="token punctuation">(</span>payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"BANK_TRANSFER"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">processBankTransfer</span><span class="token punctuation">(</span>payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// 記錄交易</span>
        <span class="token function">logTransaction</span><span class="token punctuation">(</span>payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">processCreditCard</span><span class="token punctuation">(</span><span class="token class-name">Payment</span> payment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 信用卡處理邏輯</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">processPayPal</span><span class="token punctuation">(</span><span class="token class-name">Payment</span> payment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// PayPal 處理邏輯</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">processBankTransfer</span><span class="token punctuation">(</span><span class="token class-name">Payment</span> payment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 銀行轉帳處理邏輯</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">logTransaction</span><span class="token punctuation">(</span><span class="token class-name">Payment</span> payment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Processed: "</span> <span class="token operator">+</span> payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>應用變化點測試：</p>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>🔍 變化點分析</p><div class="admonition-content"><p><strong>支付方式（高變化）</strong></p>
<ul>
<li>經常新增新的支付方式</li>
<li>每種方式都有獨特的處理邏輯</li>
<li>業務希望支援更多提供商</li>
<li><strong>結論：在這裡應用 OCP</strong></li>
</ul>
<p><strong>驗證邏輯（低變化）</strong></p>
<ul>
<li>金額驗證是穩定的</li>
<li>很少改變</li>
<li>對所有支付類型相同</li>
<li><strong>結論：保持簡單</strong></li>
</ul>
<p><strong>日誌記錄（低變化）</strong></p>
<ul>
<li>日誌格式是穩定的</li>
<li>在支付類型之間一致</li>
<li>沒有需要變化的證據</li>
<li><strong>結論：保持簡單</strong></li>
</ul>
</div></div>
<h3 id="選擇性應用-OCP">選擇性應用 OCP</h3>
<p>只重構變化點：</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">// 對支付方式應用 OCP</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PaymentMethod</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">Payment</span> payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreditCardPayment</span> <span class="token keyword">implements</span> <span class="token class-name">PaymentMethod</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">Payment</span> payment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 信用卡處理邏輯</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"CREDIT_CARD"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayPalPayment</span> <span class="token keyword">implements</span> <span class="token class-name">PaymentMethod</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">Payment</span> payment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// PayPal 處理邏輯</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"PAYPAL"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 處理器僅對變化點使用抽象</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentProcessor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">PaymentMethod</span><span class="token punctuation">&gt;</span></span> paymentMethods <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerPaymentMethod</span><span class="token punctuation">(</span><span class="token class-name">PaymentMethod</span> method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        paymentMethods<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processPayment</span><span class="token punctuation">(</span><span class="token class-name">Payment</span> payment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 驗證保持簡單——沒有變化</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Invalid amount"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// 支付處理使用抽象——高變化</span>
        <span class="token class-name">PaymentMethod</span> method <span class="token operator">=</span> paymentMethods<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>payment<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Unsupported payment type"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        method<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 日誌記錄保持簡單——沒有變化</span>
        <span class="token function">logTransaction</span><span class="token punctuation">(</span>payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">logTransaction</span><span class="token punctuation">(</span><span class="token class-name">Payment</span> payment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Processed: "</span> <span class="token operator">+</span> payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>這種選擇性方法：</p>
<div class="admonition success"><p class="admonition-title"><span class="mdi mdi-check-circle-outline admonition-icon"></span>✅ 平衡的設計</p><div class="admonition-content"><p><strong>需要的地方抽象</strong></p>
<ul>
<li>支付方式是可擴展的</li>
<li>新方式不修改現有程式碼</li>
<li>每種方式可獨立測試</li>
</ul>
<p><strong>適當的地方簡單</strong></p>
<ul>
<li>驗證邏輯保持直接</li>
<li>日誌邏輯保持直接</li>
<li>沒有不必要的抽象</li>
</ul>
<p><strong>實用的權衡</strong></p>
<ul>
<li>只在增加價值的地方增加複雜性</li>
<li>易於理解整體流程</li>
<li>如果以後需要可以重構其他部分</li>
</ul>
</div></div>
<h2 id="實際應用：外掛架構">實際應用：外掛架構</h2>
<p>OCP 在外掛架構中大放異彩，其中可擴展性是核心需求。</p>
<h3 id="外掛系統">外掛系統</h3>
<p>考慮一個支援外掛的文字編輯器：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># 核心抽象</span>
<span class="token keyword">class</span> <span class="token class-name">EditorPlugin</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

<span class="token comment"># 核心編輯器——對修改關閉</span>
<span class="token keyword">class</span> <span class="token class-name">TextEditor</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>plugins <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">""</span>
    
    <span class="token keyword">def</span> <span class="token function">register_plugin</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> plugin<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span>plugin<span class="token punctuation">.</span>get_name<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> plugin
    
    <span class="token keyword">def</span> <span class="token function">execute_plugin</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> plugin_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        plugin <span class="token operator">=</span> self<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>get<span class="token punctuation">(</span>plugin_name<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> plugin<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Plugin not found: </span><span class="token interpolation"><span class="token punctuation">{</span>plugin_name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        context <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"text"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">"editor"</span><span class="token punctuation">:</span> self<span class="token punctuation">}</span>
        result <span class="token operator">=</span> plugin<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>context<span class="token punctuation">)</span>
        <span class="token keyword">if</span> result<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>text <span class="token operator">=</span> result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">get_text</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>text
    
    <span class="token keyword">def</span> <span class="token function">set_text</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>text <span class="token operator">=</span> text

<span class="token comment"># 外掛——對擴展開放</span>
<span class="token keyword">class</span> <span class="token class-name">UpperCasePlugin</span><span class="token punctuation">(</span>EditorPlugin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"uppercase"</span>
    
    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        text <span class="token operator">=</span> context<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"text"</span><span class="token punctuation">:</span> text<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">WordCountPlugin</span><span class="token punctuation">(</span>EditorPlugin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"wordcount"</span>
    
    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        text <span class="token operator">=</span> context<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span>
        count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Word count: </span><span class="token interpolation"><span class="token punctuation">{</span>count<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>

<span class="token keyword">class</span> <span class="token class-name">ReversePlugin</span><span class="token punctuation">(</span>EditorPlugin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"reverse"</span>
    
    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        text <span class="token operator">=</span> context<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"text"</span><span class="token punctuation">:</span> text<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

<span class="token comment"># 使用</span>
editor <span class="token operator">=</span> TextEditor<span class="token punctuation">(</span><span class="token punctuation">)</span>
editor<span class="token punctuation">.</span>register_plugin<span class="token punctuation">(</span>UpperCasePlugin<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
editor<span class="token punctuation">.</span>register_plugin<span class="token punctuation">(</span>WordCountPlugin<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
editor<span class="token punctuation">.</span>register_plugin<span class="token punctuation">(</span>ReversePlugin<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

editor<span class="token punctuation">.</span>set_text<span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span>
editor<span class="token punctuation">.</span>execute_plugin<span class="token punctuation">(</span><span class="token string">"uppercase"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>editor<span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># HELLO WORLD</span>

<span class="token comment"># 第三方外掛——不修改編輯器</span>
<span class="token keyword">class</span> <span class="token class-name">SpellCheckPlugin</span><span class="token punctuation">(</span>EditorPlugin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"spellcheck"</span>
    
    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 拼字檢查邏輯</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Spell check complete"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>

editor<span class="token punctuation">.</span>register_plugin<span class="token punctuation">(</span>SpellCheckPlugin<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
editor<span class="token punctuation">.</span>execute_plugin<span class="token punctuation">(</span><span class="token string">"spellcheck"</span><span class="token punctuation">)</span></code></pre>
<p>這個架構展示了 OCP 的最佳狀態：</p>
<div class="admonition success"><p class="admonition-title"><span class="mdi mdi-check-circle-outline admonition-icon"></span>✅ 真正的可擴展性</p><div class="admonition-content"><p><strong>核心穩定性</strong></p>
<ul>
<li>編輯器程式碼永不改變</li>
<li>已測試的功能保持已測試狀態</li>
<li>對現有功能沒有風險</li>
</ul>
<p><strong>無限擴展</strong></p>
<ul>
<li>任何人都可以建立外掛</li>
<li>外掛彼此不知道</li>
<li>可以在沒有原始碼存取的情況下新增功能</li>
</ul>
<p><strong>真正的業務價值</strong></p>
<ul>
<li>第三方外掛生態系統</li>
<li>使用者根據需要自訂</li>
<li>平台在沒有供應商努力的情況下成長</li>
</ul>
</div></div>
<h2 id="結論">結論</h2>
<p>開閉原則提供了一個強大的機制來建構可以在不破壞的情況下演進的靈活系統。透過使程式碼對擴展開放但對修改關閉，OCP 減少了向已測試功能引入錯誤的風險，同時啟用新功能。然而，應用 OCP 需要判斷力——它不是關於到處建立抽象，而是關於識別真正的變化點。</p>
<p>有效應用 OCP 的關鍵是識別何時可能需要擴展。處理不同情況的 switch 陳述式和 if-else 鏈代表明顯的違規——每個新情況都需要修改現有程式碼。這些是透過介面和多型進行抽象的主要候選者。策略模式提供了一種直接的方法來消除這些違規，使每個情況成為可以在不修改現有程式碼的情況下新增的單獨類別。</p>
<p>微妙的違規更隱蔽，表現為隨著每個新需求而增長的方法。嵌入格式邏輯的報告產生器、硬編碼支付方式的支付處理器以及知道所有傳遞管道的通知系統都違反了 OCP。這些類別隨著需求的演進變得越來越複雜和脆弱。重構為抽象允許將新格式、支付方式和管道作為新類別新增。</p>
<p>然而，過早的抽象會創造不必要的複雜性。具有基本算術操作外掛架構的計算器是過度工程的——操作是穩定的，不太可能改變。YAGNI 原則（你不會需要它）適用：不要為假設的未來需求建立抽象。在有證據表明需要擴展之前，等待，然後再支付抽象的複雜性成本。</p>
<p>變化點測試提供了一種實用的方法來識別 OCP 增加價值的地方。分析系統的每個部分：這可能會改變嗎？我們經常在這裡新增新情況嗎？這是需要靈活性的業務差異化因素嗎？高變化點受益於 OCP；穩定的、低變化的程式碼應該保持簡單。這種選擇性應用平衡了靈活性和清晰度。</p>
<p>外掛架構展示了 OCP 的最佳狀態。文字編輯器、IDE、Web 瀏覽器和內容管理系統都受益於允許無限擴展而不修改核心程式碼的外掛系統。這些系統提供真正的業務價值——第三方擴充的生態系統在沒有供應商努力的情況下成長平台。當可擴展性是核心需求時，OCP 是必不可少的。</p>
<p>開閉原則既強大又容易被誤用。「對擴展開放，對修改關閉」的陳述很簡單，但知道何時應用它需要判斷力。透過關注變化點、等待需求的證據以及避免過早抽象，你可以建立既靈活又可維護的設計——在不破壞現有功能的情況下優雅地擴展。</p>

        </div>
        
        <footer class="article-footer">
            
    <a data-url="https://neo01.com/zh-TW/2021/09/Open-Closed-Principle-SOLID/" data-id="549a6f63" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url').replace("http://","https://"),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
    <!--script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": {
            "@type": "Person",
            "name": "Neo Alienson"
        },
        "headline": "開閉原則：在不破壞的情況下擴展",
        "image": "https://neo01.com/assets/solid/thumbnail.png",
        "keywords": "Architecture Best Practices Software Design",
        "genre": "Development",
        "datePublished": "2021-09-12",
        "dateCreated": "2021-09-12",
        "dateModified": "2025-10-25",
        "url": "https://neo01.com//zh-TW/2021/09/Open-Closed-Principle-SOLID/",
        "description": "軟體實體應該對擴展開放，對修改關閉。這個原則承諾在不破壞的情況下提供靈活性，但開發者在何時應用抽象以及何時會變成過度工程方面掙扎。",
        "wordCount": 6730
    }
</script-->

</article>

                        </div>
                    </section>
                    
<aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>追蹤 :</p>
        <ul class="social-links">
                <li>
                    <a class="social-tooltip" title="stack-exchange" href="https://stackexchange.com/users/2122053/neo?tab=accounts" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-exchange"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="stack-overflow" href="https://stackoverflow.com/users/1885105/neo" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-overflow"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/neoalienson" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-github"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="linkedin" href="https://linkedin.com/in/neo01" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-linkedin"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="rss" href="/atom.xml" target="_blank" rel="noopener">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
        </ul>
    </div>
    <div class="widgets-container">

        
            
                
                <div class="widget-wrap widget-list">
    <h3 class="widget-title">連結</h3>
    <div class="widget">
        <ul><li><a href="/zh-TW/ai">AI 遊樂場</a></li><li><a href="/zh-TW/tools">工具</a></li><li><a href="/zh-TW/games">遊戲</a></li><li><a href="/zh-TW/pages/useful-information">實用資訊</a></li><li><a href="/zh-TW/pages/Hexo-Blogging-Cheatsheet">Hexo 部落格速查表</a></li></ul>
    </div>
</div>

                
            
                
                
                
            
                
                    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/10/How-I-Use-AI-to-Learn/" class="thumbnail">
        <span style="background-image:url(/assets/learning/thumbnail_80.png)" alt="我如何使用 AI 學習：透過迭代知識建構的個人旅程" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/AI/">人工智慧</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/10/How-I-Use-AI-to-Learn/" class="title">我如何使用 AI 學習：透過迭代知識建構的個人旅程</a></p>
                            <p class="item-date"><time datetime="2025-10-18T16:00:00.000Z" itemprop="datePublished">2025-10-19</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/10/Tools-Games-And-Browser-Built-In-AI/" class="thumbnail">
        <span style="background-image:url(/2025/10/Tools-Games-And-Browser-Built-In-AI/thumbnail.jpeg)" alt="工具、遊戲與瀏覽器內建 AI 遊樂場" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/AI/">人工智慧</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/10/Tools-Games-And-Browser-Built-In-AI/" class="title">工具、遊戲與瀏覽器內建 AI 遊樂場</a></p>
                            <p class="item-date"><time datetime="2025-10-01T16:00:00.000Z" itemprop="datePublished">2025-10-02</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/" class="thumbnail">
        <span style="background-image:url(/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/thumbnail.jpeg)" alt="代理式編碼的崛起：AI 驅動的軟體工程" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/AI/">人工智慧</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/" class="title">代理式編碼的崛起：AI 驅動的軟體工程</a></p>
                            <p class="item-date"><time datetime="2025-09-19T16:00:00.000Z" itemprop="datePublished">2025-09-20</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports_Part2/" class="thumbnail">
        <span style="background-image:url(/assets/ports/thumbnail.png)" alt="理解臨時埠 Part 2：為什麼伺服器應用程式應避免使用動態埠" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/Development/">開發</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports_Part2/" class="title">理解臨時埠 Part 2：為什麼伺服器應用程式應避免使用動態埠</a></p>
                            <p class="item-date"><time datetime="2025-08-30T16:00:00.000Z" itemprop="datePublished">2025-08-31</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports_Part1/" class="thumbnail">
        <span style="background-image:url(/assets/ports/thumbnail.png)" alt="理解臨時埠：網路通訊的隱形工作者" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/zh-TW/categories/Development/">開發</a></p>
                            <p class="item-title"><a href="/zh-TW/2025/08/Understanding_Ephemeral_Ports_Part1/" class="title">理解臨時埠：網路通訊的隱形工作者</a></p>
                            <p class="item-date"><time datetime="2025-08-29T16:00:00.000Z" itemprop="datePublished">2025-08-30</time></p>
                        </div>
                    </li>
            </ul>
        </div>
    </div>

                
            
                
                
    
    
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">所有文章</h3>
        <div class="widget">
            <ul class="archive-list">
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2025/">2025</a>
                    <span class="archive-list-count">72</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2024/">2024</a>
                    <span class="archive-list-count">25</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2023/">2023</a>
                    <span class="archive-list-count">15</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2022/">2022</a>
                    <span class="archive-list-count">18</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2021/">2021</a>
                    <span class="archive-list-count">14</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2020/">2020</a>
                    <span class="archive-list-count">13</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2019/">2019</a>
                    <span class="archive-list-count">12</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2018/">2018</a>
                    <span class="archive-list-count">2</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2017/">2017</a>
                    <span class="archive-list-count">5</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2016/">2016</a>
                    <span class="archive-list-count">4</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2015/">2015</a>
                    <span class="archive-list-count">6</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2014/">2014</a>
                    <span class="archive-list-count">7</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/zh-TW/archives/2013/">2013</a>
                    <span class="archive-list-count">2</span>
                </li>
            
            </ul>
        </div>
    </div>


                
            
        

    </div>
</aside>


                </div>
            </div>
        </div>
        
<footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>

            <div class="qrcode-share-wrapper">
                <div class="qrcode-text">https://neo01.com/l#039afc27</div>
                <img src="/qr/qr-30d9573f294f3f5ffcdc4b09eaee0133.svg" width="200" height="200" alt="QR Code for https://neo01.com/l#039afc27">
            </div>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" title="Homepage" class="logo"></a>
                </h1>
                
                <p>© 2025 Neo Alienson. 版權所有.
                  <a href="/zh-TW/terms-and-conditions">使用條款</a></p>
                
            </div>
            <div class="footer-plugins">
              


            </div>
        </div>
    </div>
</footer>

        
        
    
        


        


        


        


        


        


        


        


        


    



<!-- Custom Scripts -->




        
    </div>
<!-- hexo injector body_end start --><script type="text/javascript" src="/js/bundle_last.js"></script><!-- hexo injector body_end end -->

<script>CookieConsent.run({"palette":{"popup":{"background":"#000"},"button":{"background":"#f1d600"}},"guiOptions":{"consentModal":{"layout":"box","position":"bottom right","equalWeightButtons":true,"flipButtons":false},"preferencesModal":{"layout":"box","position":"right","equalWeightButtons":false,"flipButtons":false}},"categories":{"necessary":{"readOnly":true},"functionality":{},"analytics":{}},"language":{"default":"en","autoDetect":"browser","translations":{"en":{"consentModal":{"title":"Hello traveler, it's cookie time!","description":"🍪 This site uses cookies to serve you the best experience—no crumbs left behind! Want to know what cookies really are? Check out this easy-to-understand cookie explanation. And for the legal nitty-gritty, here’s our website cookie policy to keep you in the loop! 🚀\n","acceptAllBtn":"Accept all","acceptNecessaryBtn":"Reject all","showPreferencesBtn":"Manage preferences","footer":"<a href=\"#link\">Privacy Policy</a>\n<a href=\"/terms-and-conditions/\">Terms and conditions</a>\n"},"preferencesModal":{"title":"Consent Preferences Center","acceptAllBtn":"Accept all","acceptNecessaryBtn":"Reject all","savePreferencesBtn":"Save preferences","closeIconLabel":"Close modal","serviceCounterLabel":"Service|Services","sections":[{"title":"Cookie Usage","description":"We use cookies to make your visit smoother, faster, and tailored just for you. Cookies help us remember your preferences, improve site performance, and deliver personalized content while keeping things secure and user-friendly.\n"},{"title":"Strictly Necessary Cookies <span class=\"pm__badge\">Always Enabled</span>","description":"These cookies are essential for the website to function properly. They enable core features like security, page navigation, and access to secure areas. Without these, the site cannot operate correctly.\n","linkedCategory":"necessary"},{"title":"Functionality Cookies","description":"Functionality cookies remember your choices to provide a more personalized experience. For example, they save your language preference or login details so you don’t have to keep entering them each time.\n","linkedCategory":"functionality"},{"title":"Analytics Cookies","description":"Analytics cookies help us understand how visitors interact with our site by collecting information anonymously. This insight allows us to improve functionality, fix issues, and make the website better for you.\n","linkedCategory":"analytics"},{"title":"More information","description":"Please refer to our <a href='/pages/cookie-policy'>cookie policy</a> for full details on how we use cookies and your options to manage them.\n"}]}}}}})</script></body></html>