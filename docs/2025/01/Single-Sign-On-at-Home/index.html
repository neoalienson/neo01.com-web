<!DOCTYPE html><html lang="en"><head><!-- hexo injector head_begin start --><!-- Google tag (gtag.js) begins-->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3DZR3TQYCY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-3DZR3TQYCY');
    </script>
    <!-- Google tag (gtag.js) ends-->
    <!-- hexo injector head_begin end -->
    <meta charset="utf-8">
    <!-- security headers starts -->
    <!-- meta http-equiv="content-security-policy" content="script-src 'sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=' 'sha256-lJjk3/dvd+wXqRFjV7T5L/nXJXr5NjUjmsKSPEe+ass=';" -->
    <!-- security headers ends -->
    <!-- favicon starts -->    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <!-- favicon ends -->
    

    
    <title>Setting Up Single Sign-On at Home | Decoding Digital Anomalies</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="keywords" content="Authentication,Cybersecurity,Homelab,SSO">
    
    
    <meta name="description" content="Tired of managing dozens of passwords for your homelab services? Learn how to set up Single Sign-On to access all your services with one login.">
<meta property="og:type" content="article">
<meta property="og:title" content="Setting Up Single Sign-On at Home">
<meta property="og:url" content="https://neo01.com/2025/01/Single-Sign-On-at-Home/index.html">
<meta property="og:site_name" content="Decoding Digital Anomalies">
<meta property="og:description" content="Tired of managing dozens of passwords for your homelab services? Learn how to set up Single Sign-On to access all your services with one login.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-01-14T16:00:00.000Z">
<meta property="article:modified_time" content="2025-10-12T08:43:10.241Z">
<meta property="article:author" content="Neo Alienson">
<meta property="article:tag" content="Authentication">
<meta property="article:tag" content="Cybersecurity">
<meta property="article:tag" content="Homelab">
<meta property="article:tag" content="SSO">
<meta name="twitter:card" content="summary">
    
            <link rel="alternate" href="/atom.xml" title="Decoding Digital Anomalies" type="application/atom+xml">
    

    

    

    

    

    

    

    
    
        


    
    
        


    

<!-- hexo injector head_end start --><link rel="stylesheet" type="text/css" href="/css/bundle.css"><script type="text/javascript" src="/js/bundle_first.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><style id="admonition-styles">.admonition {
  margin: 1em 0;
  padding: 0rem;
  border-left: 0.3rem solid;
  border-radius: 0.4rem;
  background-color: #f9f9f9;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
  overflow: hidden;
  page-break-inside: avoid;
}

.admonition-title {
  display: flex;
  align-items: center;
  font-weight: 600;
  padding: 0rem 1rem 0.1rem 0.75rem;
  font-size: 1.05em;
  background-color: rgba(0, 0, 0, 0.03);
  border-top-left-radius: 0.4rem;
  border-top-right-radius: 0.4rem;
  margin: 0 !important;
}

.admonition-icon {
  font-size: 1.2em;
  margin-right: 0.6rem;
  opacity: 0.85;
  margin-top: 0.1rem;
}

/* ÂÜÖÂÆπÂå∫Âüü margin */
.admonition > *:not(.admonition-title) {
  margin: 0.6rem 1rem 0.6rem 1rem;
}

/* NOTE Á±ªÂûã */
.admonition.anote {
  border-color: #448aff;
}
.admonition.anote > .admonition-title {
  background-color: #448aff1a;
  color: #2962ff;
}

/* INFO / TODO Á±ªÂûã */
.admonition.info,
.admonition.todo {
  border-color: #00b8d4;
}
.admonition.info > .admonition-title,
.admonition.todo > .admonition-title {
  background-color: rgba(0, 184, 212, 0.1);
  color: #007c91;
}

/* Ë≠¶ÂëäÁ±ª */
.admonition.warning,
.admonition.attention,
.admonition.caution {
  border-color: #ff9100;
}
.admonition.warning > .admonition-title,
.admonition.attention > .admonition-title,
.admonition.caution > .admonition-title {
  background-color: rgba(255, 145, 0, 0.1);
  color: #c66900;
}

/* ÈîôËØØÁ±ª */
.admonition.failure,
.admonition.missing,
.admonition.fail,
.admonition.error,
.admonition.danger,
.admonition.bug {
  border-color: #ff5252;
}
.admonition.failure > .admonition-title,
.admonition.missing > .admonition-title,
.admonition.fail > .admonition-title,
.admonition.error > .admonition-title,
.admonition.danger > .admonition-title,
.admonition.bug > .admonition-title {
  background-color: rgba(255, 82, 82, 0.1);
  color: #b71c1c;
}

/* TIP Á±ªÂûã */
.admonition.tip {
  border-color: #00bfa5;
}
.admonition.tip > .admonition-title {
  background-color: #00bfa51a;
  color: #00796b;
}

/* SUCCESS Á±ªÂûã */
.admonition.success {
  border-color: #00c853;
}
.admonition.success > .admonition-title {
  background-color: #00c8531a;
  color: #2e7d32;
}

/* QUESTION Á±ªÂûã */
.admonition.question {
  border-color: #64dd17;
}
.admonition.question > .admonition-title {
  background-color: #64dd171a;
  color: #558b2f;
}

/* EXAMPLE Á±ªÂûã */
.admonition.example {
  border-color: #7c4dff;
}
.admonition.example > .admonition-title {
  background-color: #7c4dff1a;
  color: #512da8;
}

/* QUOTE Á±ªÂûã */
.admonition.quote {
  border-color: #9e9e9e;
}
.admonition.quote > .admonition-title {
  background-color: #9e9e9e1a;
  color: #424242;
}

/*ÈªëÊöóÊ®°Âºè*/
/* Â§úÈó¥Ê®°ÂºèÂü∫Á°ÄÊ†∑Âºè */
[data-theme="dark"] .admonition {
  background-color: #1e1e1e;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
}

[data-theme="dark"] .admonition-title {
  background-color: rgba(255, 255, 255, 0.05);
}

/* anote */
[data-theme="dark"] .admonition.anote {
  border-color: #82b1ff;
}
[data-theme="dark"] .admonition.anote > .admonition-title {
  background-color: #82b1ff1a;
  color: #bbdefb;
}

/* tip */
[data-theme="dark"] .admonition.tip {
  border-color: #64ffda;
}
[data-theme="dark"] .admonition.tip > .admonition-title {
  background-color: #64ffda1a;
  color: #1de9b6;
}

/* success */
[data-theme="dark"] .admonition.success {
  border-color: #69f0ae;
}
[data-theme="dark"] .admonition.success > .admonition-title {
  background-color: #69f0ae1a;
  color: #00e676;
}

/* question */
[data-theme="dark"] .admonition.question {
  border-color: #b2ff59;
}
[data-theme="dark"] .admonition.question > .admonition-title {
  background-color: #b2ff591a;
  color: #aeea00;
}

/* example */
[data-theme="dark"] .admonition.example {
  border-color: #b388ff;
}
[data-theme="dark"] .admonition.example > .admonition-title {
  background-color: #b388ff1a;
  color: #b39ddb;
}

/* quote */
[data-theme="dark"] .admonition.quote {
  border-color: #bdbdbd;
}
[data-theme="dark"] .admonition.quote > .admonition-title {
  background-color: #bdbdbd1a;
  color: #eeeeee;
}

/* warning / attention / caution */
[data-theme="dark"] .admonition.warning,
[data-theme="dark"] .admonition.attention,
[data-theme="dark"] .admonition.caution {
  border-color: #ffb300;
}
[data-theme="dark"] .admonition.warning > .admonition-title,
[data-theme="dark"] .admonition.attention > .admonition-title,
[data-theme="dark"] .admonition.caution > .admonition-title {
  background-color: #ffb3001a;
  color: #ffe082;
}

/* error / fail / failure / bug / danger / missing */
[data-theme="dark"] .admonition.error,
[data-theme="dark"] .admonition.fail,
[data-theme="dark"] .admonition.failure,
[data-theme="dark"] .admonition.bug,
[data-theme="dark"] .admonition.missing,
[data-theme="dark"] .admonition.danger {
  border-color: #ef5350;
}
[data-theme="dark"] .admonition.error > .admonition-title,
[data-theme="dark"] .admonition.fail > .admonition-title,
[data-theme="dark"] .admonition.failure > .admonition-title,
[data-theme="dark"] .admonition.bug > .admonition-title,
[data-theme="dark"] .admonition.missing > .admonition-title,
[data-theme="dark"] .admonition.danger > .admonition-title {
  background-color: #ef53501a;
  color: #ff8a80;
}</style><script id="mermaid-scripts" src="/cache/mermaid.min.local.js"></script>
<script>mermaid.initialize({theme: 'default'});</script></head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" title="Homepage" class="logo"></a>
                    </h1>
                        <h2 class="subtitle-wrap">
                            <p class="title">Decoding Digital Anomalies</p>
                          <p class="subtitle">Sometimes the feature is the bug in the digital rabbit hole, and vice versa</p>
                        </h2>
                    <div id="lang-selector">
                        <span class="lang-icon">üåê</span>
                        
                            <a href="/zh-TW/2025/01/Single-Sign-On-at-Home/" class="lang-link">ÁπÅÈ´î‰∏≠Êñá</a>
<span class="lang-sep">|</span>                            <a href="/zh-CN/2025/01/Single-Sign-On-at-Home/" class="lang-link">ÁÆÄ‰Ωì‰∏≠Êñá</a>
                    </div>
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/">Home</a>
                                </li>
                                                                    <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/AI/">AI</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/AI/Art-Gallery/">Art Gallery</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Architecture/">Architecture</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Cybersecurity/">Cybersecurity</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Development/">Development</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Misc/">Misc</a></li></ul>
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/about-me">About</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" id="search-form-input" placeholder="Search">
        <button type="submit" title="Search" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" id="ins-search-input" placeholder="Type something...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script integrity="sha256-B5nfCL2Dym3Ba4YJFI7wB3f4vtClbrYJZ32A5erBEdg=">
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
        LANG: 'en',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>




</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Cybersecurity/">Cybersecurity</a>
    </h1>
</div>

                        <div class="main-body-content">
                            <article id="post-2025/01/Single-Sign-On-at-Home" class="article article-single article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner responsive-content">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        Setting Up Single Sign-On at Home
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
      <i class="fa fa-calendar"></i>
        
          Created <time datetime="2025-01-14T16:00:00.000Z" itemprop="datePublished">2025-01-15</time>
          &nbsp;<i class="fa fa-calendar"></i>
          Updated <time datetime="2025-10-12T08:43:10.241Z" itemprop="datePublished">2025-10-12</time>
        
    </div>


                

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Cybersecurity/">Cybersecurity</a> <a class="tag-link" href="/tags/Homelab/">Homelab</a> <a class="tag-link" href="/tags/Authentication/">Authentication</a> <a class="tag-link" href="/tags/SSO/">SSO</a>
    </div>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Why-SSO-at-Home"><span class="toc-text">Why SSO at Home?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Understanding-SSO-Basics"><span class="toc-text">Understanding SSO Basics</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Self-Hosted-vs-External-Identity-Providers"><span class="toc-text">Self-Hosted vs External Identity Providers</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Choosing-Your-SSO-Solution"><span class="toc-text">Choosing Your SSO Solution</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Setting-Up-Authelia"><span class="toc-text">Setting Up Authelia</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Setting-Up-Authentik"><span class="toc-text">Setting Up Authentik</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Integrating-Applications"><span class="toc-text">Integrating Applications</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Adding-Multi-Factor-Authentication"><span class="toc-text">Adding Multi-Factor Authentication</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Should-You-Keep-Local-Accounts-After-Enabling-SSO"><span class="toc-text">Should You Keep Local Accounts After Enabling SSO?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#User-Management"><span class="toc-text">User Management</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Advanced-LDAP-Integration"><span class="toc-text">Advanced: LDAP Integration</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Security-Best-Practices"><span class="toc-text">Security Best Practices</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Troubleshooting"><span class="toc-text">Troubleshooting</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Monitoring-and-Maintenance"><span class="toc-text">Monitoring and Maintenance</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Comparison-SSO-Solutions"><span class="toc-text">Comparison: SSO Solutions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Real-World-Example-Complete-Homelab-SSO"><span class="toc-text">Real-World Example: Complete Homelab SSO</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Resources"><span class="toc-text">Resources</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Conclusion"><span class="toc-text">Conclusion</span></a></li></ol>
            <p>You‚Äôve built an impressive homelab‚ÄîNextcloud, Jellyfin, Home Assistant, Portainer, Grafana, and a dozen other services. Each one is amazing. Each one also has its own login page. And its own password. And its own session timeout.</p>
<p>Sound familiar? Welcome to password fatigue.</p>
<p>What if you could log in once and access everything? That‚Äôs Single Sign-On (SSO), and it‚Äôs not just for enterprises anymore.</p>
<h2 id="Why-SSO-at-Home">Why SSO at Home?</h2>
<p><strong>The Problem:</strong></p>
<ul>
<li>15+ services = 15+ passwords to remember (or reuse üò±)</li>
<li>Logging into each service separately wastes time</li>
<li>No centralized user management</li>
<li>Difficult to revoke access when needed</li>
<li>Password resets are a nightmare</li>
</ul>
<p><strong>The Solution:</strong></p>
<p>SSO provides:</p>
<ul>
<li><strong>One login</strong> for all services</li>
<li><strong>Centralized authentication</strong> - manage users in one place</li>
<li><strong>Better security</strong> - enforce MFA once, applies everywhere</li>
<li><strong>Easier onboarding</strong> - add family/friends to all services at once</li>
<li><strong>Quick revocation</strong> - disable one account, locks out everywhere</li>
</ul>
<h2 id="Understanding-SSO-Basics">Understanding SSO Basics</h2>
<h3 id="What-is-Single-Sign-On">What is Single Sign-On?</h3>
<p>SSO is an authentication scheme that allows users to log in once and access multiple applications without re-authenticating.</p>
<p><strong>Simple example:</strong></p>
<ul>
<li>Without SSO: Log into Nextcloud ‚Üí Log into Grafana ‚Üí Log into Jellyfin (3 logins)</li>
<li>With SSO: Log in once ‚Üí Access all three services (1 login)</li>
</ul>
<h3 id="Key-Components-Explained">Key Components Explained</h3>
<p>Think of SSO like a nightclub with multiple VIP rooms. Let‚Äôs break down each component:</p>
<h4 id="1-Identity-Provider-IdP-The-Bouncer">1. Identity Provider (IdP) - The Bouncer</h4>
<p><strong>What it does:</strong> The central authentication authority that verifies who you are.</p>
<p><strong>Real-world analogy:</strong> Like a bouncer at a nightclub entrance who checks your ID and gives you a wristband.</p>
<p><strong>In your homelab:</strong></p>
<ul>
<li><strong>Authelia, Authentik, or Keycloak</strong> act as the bouncer</li>
<li>When you try to access any service, you‚Äôre redirected here first</li>
<li>It checks your username/password and MFA</li>
<li>Once verified, it gives you a ‚Äútoken‚Äù (like a wristband)</li>
</ul>
<p><strong>Example flow:</strong></p>
<pre class="language-none"><code class="language-none">You ‚Üí Try to access Nextcloud
Nextcloud ‚Üí "I don't know you, go ask the bouncer"
You ‚Üí Redirected to Authelia login page
Authelia ‚Üí "Show me your credentials"
You ‚Üí Enter password + MFA code
Authelia ‚Üí "Verified! Here's your token"</code></pre>
<h4 id="2-Service-Provider-SP-The-VIP-Rooms">2. Service Provider (SP) - The VIP Rooms</h4>
<p><strong>What it does:</strong> Your actual applications that trust the IdP to authenticate users.</p>
<p><strong>Real-world analogy:</strong> Like VIP rooms in the nightclub. They don‚Äôt check your ID‚Äîthey just look at your wristband from the bouncer.</p>
<p><strong>In your homelab:</strong></p>
<ul>
<li><strong>Your apps:</strong> Nextcloud, Grafana, Jellyfin, Home Assistant</li>
<li>They don‚Äôt handle passwords themselves</li>
<li>They trust the IdP‚Äôs decision</li>
<li>They just check: ‚ÄúDo you have a valid token from Authelia?‚Äù</li>
</ul>
<p><strong>Example:</strong></p>
<pre class="language-none"><code class="language-none">You ‚Üí Access Grafana (with token from Authelia)
Grafana ‚Üí "I see you have a valid token from Authelia"
Grafana ‚Üí "Authelia says you're 'alice' in group 'admins'"
Grafana ‚Üí "Welcome in!"</code></pre>
<h4 id="3-User-Directory-The-Guest-List">3. User Directory - The Guest List</h4>
<p><strong>What it does:</strong> Stores user information (usernames, passwords, groups).</p>
<p><strong>Real-world analogy:</strong> The guest list that the bouncer checks against.</p>
<p><strong>In your homelab:</strong></p>
<ul>
<li><strong>Simple:</strong> YAML file with usernames and hashed passwords</li>
<li><strong>Advanced:</strong> LDAP server (like a database for users)</li>
<li>Contains: usernames, passwords, email, group memberships</li>
</ul>
<p><strong>Example structure:</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">users</span><span class="token punctuation">:</span>
  <span class="token key atrule">alice</span><span class="token punctuation">:</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> (hashed)
    <span class="token key atrule">email</span><span class="token punctuation">:</span> alice@home.local
    <span class="token key atrule">groups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>admins<span class="token punctuation">,</span> users<span class="token punctuation">]</span>
  <span class="token key atrule">bob</span><span class="token punctuation">:</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> (hashed)
    <span class="token key atrule">email</span><span class="token punctuation">:</span> bob@home.local
    <span class="token key atrule">groups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>users<span class="token punctuation">]</span></code></pre>
<h4 id="4-Authentication-vs-Authorization">4. Authentication vs Authorization</h4>
<p><strong>Authentication:</strong> Proving who you are (‚ÄúAre you Alice?‚Äù)<br>
<strong>Authorization:</strong> Determining what you can do (‚ÄúCan Alice access admin panel?‚Äù)</p>
<p><strong>Real-world analogy:</strong></p>
<ul>
<li><strong>Authentication</strong> = Showing your ID to prove you‚Äôre 21 years old</li>
<li><strong>Authorization</strong> = The bouncer deciding if you can enter the VIP section</li>
</ul>
<p><strong>In SSO:</strong></p>
<ul>
<li><strong>IdP handles authentication:</strong> ‚ÄúYes, this is Alice with correct password‚Äù</li>
<li><strong>Apps handle authorization:</strong> ‚ÄúAlice is in ‚Äòadmins‚Äô group, grant admin access‚Äù</li>
</ul>
<h4 id="5-Authentication-Protocols-The-Language">5. Authentication Protocols - The Language</h4>
<p><strong>What they do:</strong> Standardized ways for IdP and apps to communicate.</p>
<p><strong>Real-world analogy:</strong> Like different languages the bouncer and VIP rooms use to communicate.</p>
<p><strong>OIDC (OpenID Connect) - Modern &amp; Recommended:</strong></p>
<ul>
<li><strong>Authentication:</strong> ‚ÄúWho are you?‚Äù</li>
<li><strong>Authorization:</strong> ‚ÄúWhat groups are you in?‚Äù</li>
<li>Uses JSON (easy to read)</li>
<li>Built on OAuth2</li>
<li>Most modern apps support it</li>
<li><strong>Use this when possible</strong></li>
</ul>
<p><strong>Example OIDC token:</strong></p>
<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"sub"</span><span class="token operator">:</span> <span class="token string">"alice"</span><span class="token punctuation">,</span>
  <span class="token property">"email"</span><span class="token operator">:</span> <span class="token string">"alice@homelab.local"</span><span class="token punctuation">,</span>
  <span class="token property">"groups"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"admins"</span><span class="token punctuation">,</span> <span class="token string">"users"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"exp"</span><span class="token operator">:</span> <span class="token number">1705334400</span>
<span class="token punctuation">}</span></code></pre>
<p><strong>SAML - Enterprise Standard:</strong></p>
<ul>
<li>Like speaking formal legal language</li>
<li>Uses XML (verbose)</li>
<li>Older enterprise apps use it</li>
<li>More complex but widely supported</li>
<li>Common in corporate environments</li>
</ul>
<p><strong>Windows Integrated Authentication (WIA) - Windows-Only:</strong></p>
<ul>
<li>Uses Kerberos/NTLM</li>
<li>Automatic login for Windows domain users</li>
<li>No password prompt if on domain</li>
<li><strong>Only works with:</strong> Active Directory + Windows clients</li>
<li><strong>Not federated</strong> - cannot integrate with external SaaS apps</li>
<li><strong>Not suitable for homelabs</strong> unless you run Windows Server domain</li>
</ul>
<h4 id="6-Federated-vs-Non-Federated-Authentication">6. Federated vs Non-Federated Authentication</h4>
<p><strong>What is Federation?</strong></p>
<p>Federation allows different organizations/systems to trust each other‚Äôs authentication.</p>
<p><strong>Real-world analogy:</strong></p>
<ul>
<li><strong>Non-federated:</strong> Your gym membership only works at your gym</li>
<li><strong>Federated:</strong> Your passport works in multiple countries (they trust each other)</li>
</ul>
<p><strong>Non-Federated Authentication (WIA, Basic Auth):</strong></p>
<pre class="language-none"><code class="language-none">Your Homelab IdP ‚Üí Only works for your homelab services
‚ùå Cannot authenticate to external SaaS (GitHub, AWS, etc.)</code></pre>
<p><strong>Federated Authentication (OIDC, SAML):</strong></p>
<pre class="language-none"><code class="language-none">Your Homelab IdP ‚Üî External SaaS (if they support it)
‚úÖ Could authenticate to services that trust your IdP</code></pre>
<p><strong>Example scenarios:</strong></p>
<p><strong>Non-federated (WIA):</strong></p>
<pre class="language-none"><code class="language-none">You ‚Üí Windows Domain Controller ‚Üí Homelab apps ‚úÖ
You ‚Üí Windows Domain Controller ‚Üí GitHub ‚ùå (GitHub doesn't trust your DC)</code></pre>
<p><strong>Federated (OIDC/SAML):</strong></p>
<pre class="language-none"><code class="language-none">You ‚Üí Authentik ‚Üí Homelab apps ‚úÖ
You ‚Üí Authentik ‚Üí GitHub Enterprise ‚úÖ (if configured)
You ‚Üí Authentik ‚Üí AWS ‚úÖ (if configured)</code></pre>
<p><strong>The Catch for Homelabs:</strong></p>
<p>Most SaaS providers only support federation with <strong>enterprise subscriptions</strong>:</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Free/Personal</th>
<th>Enterprise</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>GitHub</strong></td>
<td>No SSO</td>
<td>SSO with SAML</td>
</tr>
<tr>
<td><strong>AWS</strong></td>
<td>No SSO</td>
<td>SSO with SAML</td>
</tr>
<tr>
<td><strong>Google Workspace</strong></td>
<td>No SSO</td>
<td>SSO with SAML</td>
</tr>
<tr>
<td><strong>Microsoft 365</strong></td>
<td>No SSO</td>
<td>SSO with SAML</td>
</tr>
<tr>
<td><strong>Slack</strong></td>
<td>No SSO</td>
<td>SSO with SAML</td>
</tr>
</tbody>
</table>
<p><strong>Cost reality:</strong></p>
<ul>
<li>GitHub Enterprise: $21/user/month</li>
<li>AWS SSO: Requires AWS Organizations</li>
<li>Google Workspace: $12-18/user/month for SSO</li>
<li>Microsoft 365: $22/user/month for SSO</li>
</ul>
<div class="admonition warning"><p class="admonition-title"><span class="mdi mdi-alert-outline admonition-icon"></span>‚ö†Ô∏è Homelab SSO Limitations</p><div class="admonition-content"><p><strong>Your homelab SSO will work for:</strong></p>
<ul>
<li>‚úÖ Self-hosted services (Nextcloud, Grafana, Jellyfin)</li>
<li>‚úÖ Services you control</li>
<li>‚úÖ Apps that support OIDC/SAML without restrictions</li>
</ul>
<p><strong>Your homelab SSO will NOT work for:</strong></p>
<ul>
<li>‚ùå Free tier SaaS (GitHub, Gmail, Slack)</li>
<li>‚ùå Services requiring enterprise subscriptions</li>
<li>‚ùå Services that don't support custom IdPs</li>
</ul>
<p><strong>This limits homelab SSO to internal services only</strong>, which is still valuable for managing 10-20 self-hosted apps!</p>
</div></div>
<p><strong>Comparison:</strong></p>
<table>
<thead>
<tr>
<th>Protocol</th>
<th>Best For</th>
<th>Complexity</th>
<th>Federated</th>
<th>Homelab Friendly</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>OIDC</strong></td>
<td>Modern apps</td>
<td>Low</td>
<td>‚úÖ Yes</td>
<td>‚úÖ Yes</td>
</tr>
<tr>
<td><strong>SAML</strong></td>
<td>Enterprise apps</td>
<td>High</td>
<td>‚úÖ Yes</td>
<td>‚ö†Ô∏è If needed</td>
</tr>
<tr>
<td><strong>WIA</strong></td>
<td>Windows domains</td>
<td>Medium</td>
<td>‚ùå No</td>
<td>‚ùå Overkill</td>
</tr>
</tbody>
</table>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>üí° Protocol Choice</p><div class="admonition-content"><p>For homelabs:</p>
<ul>
<li><strong>Use OIDC</strong> for apps that support it (Grafana, Nextcloud, Portainer)</li>
<li><strong>Use forward auth</strong> (Authelia) for apps without OIDC support</li>
<li><strong>Skip WIA</strong> unless you already run Active Directory (and it won't work with SaaS anyway)</li>
<li><strong>Use SAML</strong> only if specific app requires it</li>
<li><strong>Accept limitation:</strong> Your SSO won't work with free-tier SaaS (GitHub, Gmail, etc.)</li>
</ul>
</div></div>
<p><strong>Visual comparison:</strong></p>
<div class="mermaid">flowchart LR
    A["üë§ User"] --&gt;|"1. Login request"| B["üîê IdP<br>(Authelia)"]
    B --&gt;|"2. Check credentials"| C["üìö User Directory<br>(YAML/LDAP)"]
    C --&gt;|"3. Valid user"| B
    B --&gt;|"4. Issue token<br>(OIDC/SAML)"| A
    A --&gt;|"5. Present token"| D["üì¶ Service Provider<br>(Nextcloud)"]
    D --&gt;|"6. Verify token"| B
    B --&gt;|"7. Token valid"| D
    D --&gt;|"8. Grant access"| A
    
    style B fill:#e3f2fd
    style C fill:#f3e5f5
    style D fill:#e8f5e9</div>
<h4 id="Putting-It-All-Together">Putting It All Together</h4>
<p><strong>Without SSO (Current state):</strong></p>
<pre class="language-none"><code class="language-none">You ‚Üí Nextcloud ‚Üí Enter password for Nextcloud
You ‚Üí Grafana ‚Üí Enter password for Grafana
You ‚Üí Jellyfin ‚Üí Enter password for Jellyfin
(15 services = 15 passwords!)</code></pre>
<p><strong>With SSO (After setup):</strong></p>
<pre class="language-none"><code class="language-none">You ‚Üí Nextcloud ‚Üí Redirected to Authelia ‚Üí Login once
You ‚Üí Grafana ‚Üí Already logged in (token exists)
You ‚Üí Jellyfin ‚Üí Already logged in (token exists)
(1 login = access to everything!)</code></pre>
<p><strong>The magic:</strong> Once you log into Authelia, it creates a session. All your apps check with Authelia: ‚ÄúIs this user logged in?‚Äù Authelia says ‚ÄúYes!‚Äù and they let you in.</p>
<div class="admonition anote"><p class="admonition-title"><span class="mdi mdi-note-outline admonition-icon"></span>üéØ Key Takeaway</p><div class="admonition-content"><ul>
<li><strong>IdP (Authelia)</strong> = The one place you log in</li>
<li><strong>Service Providers (your apps)</strong> = Trust the IdP's decision</li>
<li><strong>User Directory</strong> = Where usernames/passwords are stored</li>
<li><strong>Protocols (OIDC/SAML)</strong> = How they talk to each other</li>
</ul>
<p>You log in once at the IdP, and all your apps trust that login.</p>
</div></div>
<h2 id="Self-Hosted-vs-External-Identity-Providers">Self-Hosted vs External Identity Providers</h2>
<p>Before diving into self-hosted solutions, you might wonder: ‚ÄúWhy not just use Google, Microsoft, or GitHub as my IdP?‚Äù</p>
<h3 id="External-IdPs-Google-Microsoft-GitHub-Auth0">External IdPs (Google, Microsoft, GitHub, Auth0)</h3>
<p><strong>Pros:</strong></p>
<ul>
<li>Zero maintenance</li>
<li>Already have accounts</li>
<li>Enterprise-grade security</li>
<li>Free for personal use</li>
<li>Built-in MFA</li>
<li><strong>Can federate with SaaS</strong> (if you have enterprise subscriptions)</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li><strong>Privacy concerns</strong> - External provider sees every login to your homelab</li>
<li><strong>Internet dependency</strong> - Can‚Äôt authenticate if internet is down</li>
<li><strong>Service outages</strong> - Your homelab breaks when their service is down</li>
<li><strong>Account linking</strong> - Can‚Äôt add users without external accounts</li>
<li><strong>Terms of Service</strong> - Subject to their rules and changes</li>
<li><strong>Data sovereignty</strong> - Authentication data leaves your network</li>
<li><strong>Limited to their ecosystem</strong> - Can‚Äôt use Google SSO for Microsoft services</li>
</ul>
<h3 id="Self-Hosted-IdP-Authelia-Authentik-Keycloak">Self-Hosted IdP (Authelia, Authentik, Keycloak)</h3>
<p><strong>Pros:</strong></p>
<ul>
<li><strong>Complete privacy</strong> - No external tracking</li>
<li><strong>Works offline</strong> - Internet outage doesn‚Äôt affect local services</li>
<li><strong>Full control</strong> - Your rules, your users</li>
<li><strong>Custom users</strong> - Add family/friends without requiring Google accounts</li>
<li><strong>No vendor lock-in</strong> - Own your authentication infrastructure</li>
<li><strong>Learning opportunity</strong> - Understand how SSO works</li>
<li><strong>Federated protocols</strong> - Uses OIDC/SAML (standard protocols)</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>Requires setup and maintenance</li>
<li>You‚Äôre responsible for security</li>
<li>Need to manage backups</li>
<li>More complex than ‚ÄúLogin with Google‚Äù button</li>
<li><strong>Limited SaaS integration</strong> - Most SaaS requires expensive enterprise plans to accept your IdP</li>
</ul>
<h3 id="Hybrid-Approach">Hybrid Approach</h3>
<p>Best of both worlds:</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Authentik can use external IdPs as sources</span>
<span class="token comment"># Users can choose: Local account OR Google OR GitHub</span></code></pre>
<p><strong>Use cases:</strong></p>
<ul>
<li><strong>Self-hosted primary</strong> + external as backup</li>
<li><strong>Local accounts for family</strong> + external for guests</li>
<li><strong>Self-hosted for sensitive services</strong> + external for low-risk apps</li>
</ul>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>üí° When to Use External IdPs</p><div class="admonition-content"><p>Use external IdPs if:</p>
<ul>
<li>You're okay with Google/Microsoft seeing your login activity</li>
<li>Your homelab is always internet-connected</li>
<li>You only need authentication for yourself</li>
<li>You want zero maintenance</li>
<li>You have enterprise subscriptions and want to integrate with SaaS</li>
</ul>
<p>Use self-hosted if:</p>
<ul>
<li>Privacy is important (no external tracking)</li>
<li>You want offline capability</li>
<li>You need to manage multiple users (family/friends)</li>
<li>You want to learn and control your infrastructure</li>
<li>You have services that shouldn't be exposed to external providers</li>
<li><strong>You only need SSO for self-hosted services</strong> (the common homelab case)</li>
</ul>
</div></div>
<p><strong>Real-world examples:</strong></p>
<p><strong>Scenario 1 - ISP Outage:</strong><br>
With external IdP, you can‚Äôt log into your local Home Assistant to check security cameras. With self-hosted SSO, everything still works on your local network.</p>
<p><strong>Scenario 2 - SaaS Integration:</strong><br>
You want to use your homelab SSO for GitHub. GitHub requires Enterprise ($21/user/month) to accept custom SAML IdP. For homelabs, this is too expensive, so you‚Äôll use GitHub‚Äôs own authentication instead.</p>
<h2 id="Choosing-Your-SSO-Solution">Choosing Your SSO Solution</h2>
<h3 id="Option-1-Authelia-Lightweight-Proxy-Based">Option 1: Authelia (Lightweight, Proxy-Based)</h3>
<p><strong>Best for:</strong> Simple setups, reverse proxy users</p>
<p><strong>Pros:</strong></p>
<ul>
<li>Lightweight (single binary)</li>
<li>Works with any reverse proxy (Traefik, nginx)</li>
<li>Simple YAML configuration</li>
<li>Built-in LDAP/file-based auth</li>
<li>Excellent documentation</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>Limited OIDC support (basic)</li>
<li>No admin UI (config file only)</li>
<li>Fewer integrations than Authentik</li>
</ul>
<h3 id="Option-2-Authentik-Full-Featured-Modern">Option 2: Authentik (Full-Featured, Modern)</h3>
<p><strong>Best for:</strong> Complex setups, multiple protocols needed</p>
<p><strong>Pros:</strong></p>
<ul>
<li>Beautiful admin UI</li>
<li>Full OIDC and SAML support</li>
<li>Built-in user management</li>
<li>Customizable login flows</li>
<li>Active development</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>Heavier resource usage</li>
<li>More complex setup</li>
<li>Requires PostgreSQL/Redis</li>
</ul>
<h3 id="Option-3-Keycloak-Enterprise-Grade">Option 3: Keycloak (Enterprise-Grade)</h3>
<p><strong>Best for:</strong> Large homelabs, enterprise features</p>
<p><strong>Pros:</strong></p>
<ul>
<li>Industry standard</li>
<li>Comprehensive features</li>
<li>Excellent SAML/OIDC support</li>
<li>User federation</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>Heavy resource usage (Java-based)</li>
<li>Complex configuration</li>
<li>Overkill for small homelabs</li>
</ul>
<h3 id="Comparison-Table">Comparison Table</h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Authelia</th>
<th>Authentik</th>
<th>Keycloak</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Resource Usage</strong></td>
<td>Low</td>
<td>Medium</td>
<td>High</td>
</tr>
<tr>
<td><strong>Setup Complexity</strong></td>
<td>Low</td>
<td>Medium</td>
<td>High</td>
</tr>
<tr>
<td><strong>OIDC Support</strong></td>
<td>Basic</td>
<td>Full</td>
<td>Full</td>
</tr>
<tr>
<td><strong>SAML Support</strong></td>
<td>‚ùå No</td>
<td>‚úÖ Yes</td>
<td>‚úÖ Yes</td>
</tr>
<tr>
<td><strong>Admin UI</strong></td>
<td>‚ùå No</td>
<td>‚úÖ Yes</td>
<td>‚úÖ Yes</td>
</tr>
<tr>
<td><strong>MFA</strong></td>
<td>‚úÖ TOTP, WebAuthn</td>
<td>‚úÖ TOTP, WebAuthn, Passkey</td>
<td>‚úÖ All types</td>
</tr>
<tr>
<td><strong>Best For</strong></td>
<td>Small labs</td>
<td>Medium labs</td>
<td>Enterprise</td>
</tr>
</tbody>
</table>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>üí° Recommendation</p><div class="admonition-content"><ul>
<li><strong>Start with Authelia</strong> if you use Traefik/nginx and want simplicity</li>
<li><strong>Choose Authentik</strong> if you need OIDC/SAML and want a UI</li>
<li><strong>Use Keycloak</strong> only if you need enterprise features or already know it</li>
</ul>
</div></div>
<h2 id="Setting-Up-Authelia">Setting Up Authelia</h2>
<h3 id="Architecture">Architecture</h3>
<div class="mermaid">flowchart TD
  User["üë§ User"]
  Proxy["üö™ Reverse Proxy (Traefik/nginx)"]
  Authelia["üîê Authelia"]
  LDAP["üìö User Directory (YAML/LDAP)"]
  
  subgraph Services[" "]
    App1["üì¶ Nextcloud"]
    App2["üé¨ Jellyfin"]
    App3["üìä Grafana"]
  end
  
  User --&gt; Proxy
  Proxy --&gt; Authelia
  Proxy --&gt; Services
  Authelia -.-&gt; LDAP
  
  style Authelia fill:#e3f2fd
  style Proxy fill:#fff3e0
  style LDAP fill:#f3e5f5
  style Services fill:#e8f5e9</div>
<h3 id="Prerequisites">Prerequisites</h3>
<ul>
<li>Docker and Docker Compose</li>
<li>Reverse proxy (Traefik or nginx)</li>
<li>Domain name (or local DNS)</li>
</ul>
<h3 id="Step-1-Create-Directory-Structure">Step 1: Create Directory Structure</h3>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> authelia/<span class="token punctuation">{</span>config,secrets<span class="token punctuation">}</span>
<span class="token builtin class-name">cd</span> authelia</code></pre>
<h3 id="Step-2-Generate-Secrets">Step 2: Generate Secrets</h3>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># JWT secret</span>
<span class="token function">tr</span> <span class="token parameter variable">-cd</span> <span class="token string">'[:alnum:]'</span> <span class="token operator">&lt;</span> /dev/urandom <span class="token operator">|</span> <span class="token function">fold</span> <span class="token parameter variable">-w</span> <span class="token string">"64"</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token operator">&gt;</span> secrets/jwt_secret

<span class="token comment"># Session secret</span>
<span class="token function">tr</span> <span class="token parameter variable">-cd</span> <span class="token string">'[:alnum:]'</span> <span class="token operator">&lt;</span> /dev/urandom <span class="token operator">|</span> <span class="token function">fold</span> <span class="token parameter variable">-w</span> <span class="token string">"64"</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token operator">&gt;</span> secrets/session_secret

<span class="token comment"># Storage encryption key</span>
<span class="token function">tr</span> <span class="token parameter variable">-cd</span> <span class="token string">'[:alnum:]'</span> <span class="token operator">&lt;</span> /dev/urandom <span class="token operator">|</span> <span class="token function">fold</span> <span class="token parameter variable">-w</span> <span class="token string">"64"</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token operator">&gt;</span> secrets/storage_encryption_key</code></pre>
<h3 id="Step-3-Create-Configuration">Step 3: Create Configuration</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># config/configuration.yml</span>
<span class="token punctuation">---</span>
<span class="token key atrule">theme</span><span class="token punctuation">:</span> dark
<span class="token key atrule">default_2fa_method</span><span class="token punctuation">:</span> <span class="token string">"totp"</span>

<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">host</span><span class="token punctuation">:</span> 0.0.0.0
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9091</span>

<span class="token key atrule">log</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span> info

<span class="token key atrule">totp</span><span class="token punctuation">:</span>
  <span class="token key atrule">issuer</span><span class="token punctuation">:</span> homelab.local
  <span class="token key atrule">period</span><span class="token punctuation">:</span> <span class="token number">30</span>
  <span class="token key atrule">skew</span><span class="token punctuation">:</span> <span class="token number">1</span>

<span class="token key atrule">authentication_backend</span><span class="token punctuation">:</span>
  <span class="token key atrule">file</span><span class="token punctuation">:</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /config/users_database.yml
    <span class="token key atrule">password</span><span class="token punctuation">:</span>
      <span class="token key atrule">algorithm</span><span class="token punctuation">:</span> argon2id
      <span class="token key atrule">iterations</span><span class="token punctuation">:</span> <span class="token number">1</span>
      <span class="token key atrule">salt_length</span><span class="token punctuation">:</span> <span class="token number">16</span>
      <span class="token key atrule">parallelism</span><span class="token punctuation">:</span> <span class="token number">8</span>
      <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token number">64</span>

<span class="token key atrule">access_control</span><span class="token punctuation">:</span>
  <span class="token key atrule">default_policy</span><span class="token punctuation">:</span> deny
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">domain</span><span class="token punctuation">:</span> <span class="token string">"*.homelab.local"</span>
      <span class="token key atrule">policy</span><span class="token punctuation">:</span> two_factor

<span class="token key atrule">session</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> authelia_session
  <span class="token key atrule">domain</span><span class="token punctuation">:</span> homelab.local
  <span class="token key atrule">expiration</span><span class="token punctuation">:</span> 1h
  <span class="token key atrule">inactivity</span><span class="token punctuation">:</span> 5m
  <span class="token key atrule">remember_me_duration</span><span class="token punctuation">:</span> 1M

<span class="token key atrule">regulation</span><span class="token punctuation">:</span>
  <span class="token key atrule">max_retries</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">find_time</span><span class="token punctuation">:</span> 2m
  <span class="token key atrule">ban_time</span><span class="token punctuation">:</span> 5m

<span class="token key atrule">storage</span><span class="token punctuation">:</span>
  <span class="token key atrule">encryption_key_secret_file</span><span class="token punctuation">:</span> /secrets/storage_encryption_key
  <span class="token key atrule">local</span><span class="token punctuation">:</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /config/db.sqlite3

<span class="token key atrule">notifier</span><span class="token punctuation">:</span>
  <span class="token key atrule">filesystem</span><span class="token punctuation">:</span>
    <span class="token key atrule">filename</span><span class="token punctuation">:</span> /config/notification.txt</code></pre>
<h3 id="Step-4-Create-Users">Step 4: Create Users</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># config/users_database.yml</span>
<span class="token key atrule">users</span><span class="token punctuation">:</span>
  <span class="token key atrule">alice</span><span class="token punctuation">:</span>
    <span class="token key atrule">displayname</span><span class="token punctuation">:</span> <span class="token string">"Alice Smith"</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"$argon2id$v=19$m=65536,t=3,p=4$..."</span> <span class="token comment"># Generate with: authelia crypto hash generate argon2 --password 'yourpassword'</span>
    <span class="token key atrule">email</span><span class="token punctuation">:</span> alice@homelab.local
    <span class="token key atrule">groups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> admins
      <span class="token punctuation">-</span> users
  
  <span class="token key atrule">bob</span><span class="token punctuation">:</span>
    <span class="token key atrule">displayname</span><span class="token punctuation">:</span> <span class="token string">"Bob Jones"</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"$argon2id$v=19$m=65536,t=3,p=4$..."</span>
    <span class="token key atrule">email</span><span class="token punctuation">:</span> bob@homelab.local
    <span class="token key atrule">groups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> users</code></pre>
<p><strong>Generate password hash:</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">--rm</span> authelia/authelia:latest authelia crypto <span class="token builtin class-name">hash</span> generate argon2 <span class="token parameter variable">--password</span> <span class="token string">'yourpassword'</span></code></pre>
<h3 id="Step-5-Docker-Compose">Step 5: Docker Compose</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># docker-compose.yml</span>
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.8'</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">authelia</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> authelia/authelia<span class="token punctuation">:</span>latest
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> authelia
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./config<span class="token punctuation">:</span>/config
      <span class="token punctuation">-</span> ./secrets<span class="token punctuation">:</span>/secrets
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 9091<span class="token punctuation">:</span><span class="token number">9091</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> TZ=America/New_York
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</code></pre>
<h3 id="Step-6-Integrate-with-Traefik">Step 6: Integrate with Traefik</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># docker-compose.yml (add to existing Traefik setup)</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">authelia</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> authelia/authelia<span class="token punctuation">:</span>latest
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> authelia
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./authelia/config<span class="token punctuation">:</span>/config
      <span class="token punctuation">-</span> ./authelia/secrets<span class="token punctuation">:</span>/secrets
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.enable=true"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.authelia.rule=Host(`auth.homelab.local`)"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.authelia.entrypoints=websecure"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.authelia.tls=true"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.services.authelia.loadbalancer.server.port=9091"</span>
      
      <span class="token comment"># Authelia middleware</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.middlewares.authelia.forwardauth.address=http://authelia:9091/api/verify?rd=https://auth.homelab.local"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.middlewares.authelia.forwardauth.trustForwardHeader=true"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.middlewares.authelia.forwardauth.authResponseHeaders=Remote-User,Remote-Groups,Remote-Name,Remote-Email"</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped

  <span class="token comment"># Example protected service</span>
  <span class="token key atrule">nextcloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nextcloud<span class="token punctuation">:</span>latest
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.enable=true"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.nextcloud.rule=Host(`nextcloud.homelab.local`)"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.nextcloud.entrypoints=websecure"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.nextcloud.tls=true"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.nextcloud.middlewares=authelia@docker"</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</code></pre>
<h3 id="Step-7-Start-Services">Step 7: Start Services</h3>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span></code></pre>
<p>Visit <code>https://auth.homelab.local</code> to see the login page.</p>
<h3 id="Understanding-the-Authentication-Flow">Understanding the Authentication Flow</h3>
<p>Now that you have Authelia set up, let‚Äôs see exactly what happens when you access a protected service:</p>
<div class="mermaid">sequenceDiagram
    participant User
    participant App as Application (Nextcloud)
    participant SSO as SSO Provider (Authelia)
    participant LDAP as User Directory (YAML/LDAP)
    
    User-&gt;&gt;App: 1. Access application
    App-&gt;&gt;User: 2. Redirect to SSO login
    User-&gt;&gt;SSO: 3. Enter credentials + MFA
    SSO-&gt;&gt;LDAP: 4. Verify credentials
    LDAP-&gt;&gt;SSO: 5. User authenticated
    SSO-&gt;&gt;App: 6. Return auth token
    App-&gt;&gt;User: 7. Grant access
    
    Note over User,App: User now logged in!
    
    User-&gt;&gt;App: 8. Access another app (Jellyfin)
    App-&gt;&gt;SSO: 9. Check existing session
    SSO-&gt;&gt;App: 10. Valid session exists
    App-&gt;&gt;User: 11. Grant access (no login needed)</div>
<p><strong>What happens behind the scenes:</strong></p>
<ol>
<li><strong>First access:</strong> You visit <code>nextcloud.homelab.local</code></li>
<li><strong>Traefik intercepts:</strong> Checks with Authelia - ‚ÄúIs this user authenticated?‚Äù</li>
<li><strong>Not authenticated:</strong> Authelia redirects you to <code>auth.homelab.local</code></li>
<li><strong>You log in:</strong> Enter username, password, and MFA code</li>
<li><strong>Authelia verifies:</strong> Checks credentials against user database</li>
<li><strong>Session created:</strong> Authelia creates a session cookie</li>
<li><strong>Redirect back:</strong> You‚Äôre sent back to Nextcloud</li>
<li><strong>Access granted:</strong> Traefik sees valid session, allows access</li>
</ol>
<p><strong>Second service access:</strong></p>
<ol>
<li>You visit <code>grafana.homelab.local</code></li>
<li>Traefik checks with Authelia - ‚ÄúIs this user authenticated?‚Äù</li>
<li>Authelia sees existing session cookie - ‚ÄúYes, it‚Äôs Alice!‚Äù</li>
<li>Access granted immediately - <strong>no login needed</strong></li>
</ol>
<p>This is the magic of SSO - one login, access everywhere!</p>
<h2 id="Setting-Up-Authentik">Setting Up Authentik</h2>
<h3 id="Step-1-Install-with-Docker-Compose">Step 1: Install with Docker Compose</h3>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Download official compose file</span>
<span class="token function">wget</span> https://goauthentik.io/docker-compose.yml
<span class="token function">wget</span> https://goauthentik.io/.env

<span class="token comment"># Generate secrets</span>
<span class="token builtin class-name">echo</span> <span class="token string">"PG_PASS=<span class="token variable"><span class="token variable">$(</span>openssl rand <span class="token parameter variable">-base64</span> <span class="token number">36</span><span class="token variable">)</span></span>"</span> <span class="token operator">&gt;&gt;</span> .env
<span class="token builtin class-name">echo</span> <span class="token string">"AUTHENTIK_SECRET_KEY=<span class="token variable"><span class="token variable">$(</span>openssl rand <span class="token parameter variable">-base64</span> <span class="token number">60</span><span class="token variable">)</span></span>"</span> <span class="token operator">&gt;&gt;</span> .env

<span class="token comment"># Start services</span>
<span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span></code></pre>
<h3 id="Step-2-Initial-Setup">Step 2: Initial Setup</h3>
<ol>
<li>Visit <code>http://localhost:9000/if/flow/initial-setup/</code></li>
<li>Create admin account</li>
<li>Complete setup wizard</li>
</ol>
<h3 id="Step-3-Create-Application">Step 3: Create Application</h3>
<ol>
<li>
<p><strong>Applications ‚Üí Create</strong></p>
<ul>
<li>Name: Nextcloud</li>
<li>Slug: nextcloud</li>
<li>Provider: Create new OIDC provider</li>
</ul>
</li>
<li>
<p><strong>Configure OIDC Provider</strong></p>
<ul>
<li>Client Type: Confidential</li>
<li>Redirect URIs: <code>https://nextcloud.homelab.local/apps/oidc_login/oidc</code></li>
<li>Signing Key: Auto-generate</li>
</ul>
</li>
<li>
<p><strong>Note credentials:</strong></p>
<ul>
<li>Client ID: (auto-generated)</li>
<li>Client Secret: (auto-generated)</li>
</ul>
</li>
</ol>
<h3 id="Step-4-Configure-Application-Nextcloud-Example">Step 4: Configure Application (Nextcloud Example)</h3>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">// nextcloud/config/config.php</span>
<span class="token string single-quoted-string">'oidc_login_provider_url'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'https://auth.homelab.local/application/o/nextcloud/'</span><span class="token punctuation">,</span>
<span class="token string single-quoted-string">'oidc_login_client_id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'your-client-id'</span><span class="token punctuation">,</span>
<span class="token string single-quoted-string">'oidc_login_client_secret'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'your-client-secret'</span><span class="token punctuation">,</span>
<span class="token string single-quoted-string">'oidc_login_auto_redirect'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
<span class="token string single-quoted-string">'oidc_login_button_text'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Log in with SSO'</span><span class="token punctuation">,</span>
<span class="token string single-quoted-string">'oidc_login_hide_password_form'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
<span class="token string single-quoted-string">'oidc_login_attributes'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'sub'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'mail'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'email'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'groups'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'groups'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span></code></pre>
<h2 id="Integrating-Applications">Integrating Applications</h2>
<h3 id="Applications-with-Native-OIDC-Support">Applications with Native OIDC Support</h3>
<p><strong>Grafana:</strong></p>
<pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># grafana.ini</span>
<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">auth.generic_oauth</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">name</span> <span class="token punctuation">=</span> <span class="token value attr-value">SSO</span>
<span class="token key attr-name">client_id</span> <span class="token punctuation">=</span> <span class="token value attr-value">grafana-client-id</span>
<span class="token key attr-name">client_secret</span> <span class="token punctuation">=</span> <span class="token value attr-value">grafana-client-secret</span>
<span class="token key attr-name">scopes</span> <span class="token punctuation">=</span> <span class="token value attr-value">openid profile email</span>
<span class="token key attr-name">auth_url</span> <span class="token punctuation">=</span> <span class="token value attr-value">https://auth.homelab.local/application/o/authorize/</span>
<span class="token key attr-name">token_url</span> <span class="token punctuation">=</span> <span class="token value attr-value">https://auth.homelab.local/application/o/token/</span>
<span class="token key attr-name">api_url</span> <span class="token punctuation">=</span> <span class="token value attr-value">https://auth.homelab.local/application/o/userinfo/</span></code></pre>
<p><strong>Portainer:</strong></p>
<ol>
<li>Settings ‚Üí Authentication</li>
<li>OAuth ‚Üí Enable</li>
<li>Configure endpoints from Authentik</li>
</ol>
<p><strong>Home Assistant:</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># configuration.yaml</span>
<span class="token key atrule">auth_providers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> homeassistant
  <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> command_line
    <span class="token key atrule">command</span><span class="token punctuation">:</span> /config/auth_script.sh
    <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"--username"</span><span class="token punctuation">]</span>
    <span class="token key atrule">meta</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code></pre>
<h3 id="Applications-Without-OIDC-Support">Applications Without OIDC Support</h3>
<p>Use <strong>forward authentication</strong> with Authelia/Traefik:</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Protect any service</span>
<span class="token key atrule">labels</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.myapp.middlewares=authelia@docker"</span></code></pre>
<h3 id="Application-Support-Matrix">Application Support Matrix</h3>
<table>
<thead>
<tr>
<th>Application</th>
<th>OIDC</th>
<th>SAML</th>
<th>Forward Auth</th>
<th>Difficulty</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Nextcloud</strong></td>
<td>‚úÖ Yes</td>
<td>‚úÖ Yes</td>
<td>‚úÖ Yes</td>
<td>Easy</td>
</tr>
<tr>
<td><strong>Grafana</strong></td>
<td>‚úÖ Yes</td>
<td>‚ùå No</td>
<td>‚úÖ Yes</td>
<td>Easy</td>
</tr>
<tr>
<td><strong>Portainer</strong></td>
<td>‚úÖ Yes</td>
<td>‚ùå No</td>
<td>‚úÖ Yes</td>
<td>Easy</td>
</tr>
<tr>
<td><strong>Jellyfin</strong></td>
<td>‚ö†Ô∏è Plugin</td>
<td>‚ùå No</td>
<td>‚úÖ Yes</td>
<td>Medium</td>
</tr>
<tr>
<td><strong>Home Assistant</strong></td>
<td>‚ö†Ô∏è Custom</td>
<td>‚ùå No</td>
<td>‚úÖ Yes</td>
<td>Medium</td>
</tr>
<tr>
<td><strong>Proxmox</strong></td>
<td>‚úÖ Yes</td>
<td>‚ùå No</td>
<td>‚ùå No</td>
<td>Medium</td>
</tr>
<tr>
<td><strong>TrueNAS</strong></td>
<td>‚ùå No</td>
<td>‚úÖ Yes</td>
<td>‚úÖ Yes</td>
<td>Hard</td>
</tr>
</tbody>
</table>
<h2 id="Adding-Multi-Factor-Authentication">Adding Multi-Factor Authentication</h2>
<h3 id="MFA-Options-Overview">MFA Options Overview</h3>
<table>
<thead>
<tr>
<th>Method</th>
<th>Security</th>
<th>Convenience</th>
<th>Cost</th>
<th>Phishing Resistant</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Passkey (WebAuthn)</strong></td>
<td>Highest</td>
<td>High</td>
<td>Free</td>
<td>‚úÖ Yes</td>
</tr>
<tr>
<td><strong>Hardware Key</strong></td>
<td>Highest</td>
<td>Medium</td>
<td>$25-50</td>
<td>‚úÖ Yes</td>
</tr>
<tr>
<td><strong>TOTP (Authenticator App)</strong></td>
<td>High</td>
<td>Medium</td>
<td>Free</td>
<td>‚ùå No</td>
</tr>
<tr>
<td><strong>SMS</strong></td>
<td>Low</td>
<td>High</td>
<td>Requires SMS gateway</td>
<td>‚ùå No</td>
</tr>
</tbody>
</table>
<h3 id="1-Passkey-WebAuthn-Recommended">1. Passkey (WebAuthn) - Recommended</h3>
<p><strong>What is a Passkey?</strong></p>
<p>Passkeys are the modern replacement for passwords using biometric authentication (fingerprint, face, PIN).</p>
<p><strong>Real-world analogy:</strong> Like using your fingerprint to unlock your phone instead of typing a password.</p>
<p><strong>How it works:</strong></p>
<ul>
<li>Your device stores a cryptographic key</li>
<li>You authenticate with biometrics (fingerprint/face) or device PIN</li>
<li>No password to steal or phish</li>
<li>Works across devices via cloud sync (iCloud Keychain, Google Password Manager)</li>
</ul>
<p><strong>Authentik Setup:</strong></p>
<ol>
<li>User menu ‚Üí Settings</li>
<li>MFA Devices ‚Üí Enroll</li>
<li>Choose <strong>WebAuthn</strong> or <strong>Passkey</strong></li>
<li>Follow browser prompts:
<ul>
<li><strong>Mobile:</strong> Use fingerprint/Face ID</li>
<li><strong>Laptop:</strong> Use Touch ID/Windows Hello</li>
<li><strong>Desktop:</strong> Use phone as passkey or hardware key</li>
</ul>
</li>
</ol>
<p><strong>Authelia Setup:</strong></p>
<ol>
<li>Log in to any protected service</li>
<li>Click ‚ÄúRegister security key‚Äù</li>
<li>Choose passkey option</li>
<li>Authenticate with biometrics</li>
</ol>
<p><strong>Supported platforms:</strong></p>
<ul>
<li>‚úÖ iPhone/iPad (iOS 16+) - Face ID/Touch ID</li>
<li>‚úÖ Android (9+) - Fingerprint/Face unlock</li>
<li>‚úÖ macOS (Ventura+) - Touch ID</li>
<li>‚úÖ Windows (10+) - Windows Hello</li>
<li>‚úÖ Chrome/Edge/Safari - Built-in support</li>
</ul>
<h3 id="2-Hardware-Security-Keys">2. Hardware Security Keys</h3>
<p><strong>Physical devices for authentication:</strong></p>
<p><strong>Authentik:</strong></p>
<ol>
<li>User menu ‚Üí Settings</li>
<li>MFA Devices ‚Üí Enroll</li>
<li>Choose WebAuthn</li>
<li>Insert security key (YubiKey, etc.)</li>
<li>Touch the key when prompted</li>
</ol>
<p><strong>Popular hardware keys:</strong></p>
<ul>
<li><strong>YubiKey 5</strong> ($45-50) - USB-A/C, NFC</li>
<li><strong>YubiKey 5C Nano</strong> ($55) - Stays in USB-C port</li>
<li><strong>Google Titan</strong> ($30) - USB-A/C, Bluetooth</li>
<li><strong>Feitian</strong> ($20-30) - Budget option</li>
</ul>
<h3 id="3-TOTP-Authenticator-Apps">3. TOTP (Authenticator Apps)</h3>
<p><strong>Time-based codes from apps:</strong></p>
<p><strong>Authelia (Built-in):</strong></p>
<ol>
<li>Log in to any protected service</li>
<li>Click ‚ÄúRegister device‚Äù</li>
<li>Scan QR code with authenticator app</li>
<li>Enter 6-digit code to verify</li>
</ol>
<p><strong>Authentik:</strong></p>
<ol>
<li>User menu ‚Üí Settings</li>
<li>MFA Devices ‚Üí Enroll</li>
<li>Choose TOTP</li>
<li>Scan QR code</li>
</ol>
<p><strong>Recommended authenticator apps:</strong></p>
<ul>
<li><strong>Aegis</strong> (Android) - Open source, encrypted backups</li>
<li><strong>Raivo OTP</strong> (iOS) - Open source, iCloud sync</li>
<li><strong>2FAS</strong> (iOS/Android) - Free, cloud backup</li>
<li><strong>Authy</strong> (iOS/Android) - Multi-device sync</li>
<li><strong>Google Authenticator</strong> (iOS/Android) - Simple, cloud backup</li>
</ul>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>üí° MFA Best Practices</p><div class="admonition-content"><p><strong>Priority order:</strong></p>
<ol>
<li><strong>Passkeys</strong> - Most secure and convenient (use biometrics)</li>
<li><strong>Hardware keys</strong> - Very secure, requires physical device</li>
<li><strong>TOTP apps</strong> - Secure, but can be phished</li>
<li><strong>Avoid SMS</strong> - Vulnerable to SIM swapping</li>
</ol>
<p><strong>Recommendations:</strong></p>
<ul>
<li><strong>Require MFA for admins</strong> always (use passkeys or hardware keys)</li>
<li><strong>Optional for family</strong> (reduces friction, passkeys are easy)</li>
<li><strong>Backup codes</strong> - generate and store securely</li>
<li><strong>Multiple methods</strong> - register passkey + TOTP as backup</li>
<li><strong>Passkeys sync</strong> - Use iCloud/Google to access from all devices</li>
</ul>
</div></div>
<h2 id="Should-You-Keep-Local-Accounts-After-Enabling-SSO">Should You Keep Local Accounts After Enabling SSO?</h2>
<p><strong>Short answer: YES, always keep local accounts as a backup.</strong></p>
<h3 id="Why-Keep-Local-Accounts">Why Keep Local Accounts?</h3>
<p><strong>SSO is a single point of failure.</strong> If your SSO system goes down, you‚Äôll be locked out of everything.</p>
<p><strong>Real-world scenarios where SSO fails:</strong></p>
<ol>
<li><strong>SSO container crashes</strong> - Docker/Kubernetes issues</li>
<li><strong>Database corruption</strong> - Authelia/Authentik database problems</li>
<li><strong>Configuration error</strong> - Typo in config breaks authentication</li>
<li><strong>Certificate expiration</strong> - HTTPS cert expires, SSO unreachable</li>
<li><strong>Network issues</strong> - DNS problems, reverse proxy down</li>
<li><strong>Accidental deletion</strong> - Oops, deleted the wrong container</li>
</ol>
<p><strong>What happens without local accounts:</strong></p>
<pre class="language-none"><code class="language-none">SSO down ‚Üí Can't log into anything ‚Üí Can't even access SSO to fix it ‚Üí Locked out</code></pre>
<p><strong>With local accounts as backup:</strong></p>
<pre class="language-none"><code class="language-none">SSO down ‚Üí Use local admin account ‚Üí Fix SSO ‚Üí Back to normal</code></pre>
<h3 id="Best-Practices-for-Local-Accounts">Best Practices for Local Accounts</h3>
<div class="admonition danger"><p class="admonition-title"><span class="mdi mdi-alert-circle-outline admonition-icon"></span>üîí Critical: Secure Your Local Accounts</p><div class="admonition-content"><p>Local accounts bypass SSO, so they MUST be secured:</p>
<ul>
<li><strong>Strong passwords</strong> - Use password manager, 20+ characters</li>
<li><strong>Enable MFA on local accounts</strong> - Many services support this</li>
<li><strong>Limit local accounts</strong> - Only create for admins/emergency access</li>
<li><strong>Different passwords</strong> - Don't reuse SSO passwords</li>
<li><strong>Document credentials</strong> - Store securely (password manager, encrypted file)</li>
</ul>
</div></div>
<h3 id="Services-That-Support-MFA-on-Local-Accounts">Services That Support MFA on Local Accounts</h3>
<p><strong>Proxmox:</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Enable TOTP for local root account</span>
<span class="token comment"># Datacenter ‚Üí Permissions ‚Üí Two Factor</span>
<span class="token comment"># Add TOTP for user root@pam</span></code></pre>
<p><strong>Nextcloud:</strong></p>
<ul>
<li>Settings ‚Üí Security ‚Üí Two-Factor Authentication</li>
<li>Enable TOTP even for local admin account</li>
</ul>
<p><strong>Grafana:</strong></p>
<pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># grafana.ini</span>
<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">auth</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">login_maximum_inactive_lifetime_duration</span> <span class="token punctuation">=</span> <span class="token value attr-value">7d</span>
<span class="token key attr-name">login_maximum_lifetime_duration</span> <span class="token punctuation">=</span> <span class="token value attr-value">30d</span>

<span class="token comment"># Local admin can still use MFA via authenticator app</span></code></pre>
<p><strong>Home Assistant:</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># configuration.yaml</span>
<span class="token key atrule">auth_providers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> homeassistant  <span class="token comment"># Local accounts</span>
  <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> command_line   <span class="token comment"># SSO integration</span>

<span class="token comment"># Enable MFA for local accounts in UI:</span>
<span class="token comment"># Profile ‚Üí Security ‚Üí Multi-factor Authentication</span></code></pre>
<h3 id="Configuration-Strategy">Configuration Strategy</h3>
<p><strong>Option 1: Dual Authentication (Recommended)</strong></p>
<p>Allow both SSO and local login:</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">// Nextcloud - Don't hide password form</span>
<span class="token string single-quoted-string">'oidc_login_hide_password_form'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// Keep local login visible</span>
<span class="token string single-quoted-string">'oidc_login_auto_redirect'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>       <span class="token comment">// Don't force SSO</span></code></pre>
<p><strong>Option 2: Hidden Local Login</strong></p>
<p>Hide local login but keep it accessible via direct URL:</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">// Nextcloud - Hide but keep functional</span>
<span class="token string single-quoted-string">'oidc_login_hide_password_form'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>   <span class="token comment">// Hide local login</span>
<span class="token comment">// Access local login: https://nextcloud.local/login?direct=1</span></code></pre>
<p><strong>Option 3: SSO-Only with Emergency Account</strong></p>
<p>Force SSO for everyone except one emergency admin:</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Authelia - Bypass SSO for emergency access</span>
<span class="token key atrule">access_control</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">domain</span><span class="token punctuation">:</span> <span class="token string">"*.homelab.local"</span>
      <span class="token key atrule">policy</span><span class="token punctuation">:</span> bypass
      <span class="token key atrule">subject</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">"user:emergency-admin"</span>
      <span class="token key atrule">resources</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">"^/admin/emergency.*$"</span></code></pre>
<h3 id="Emergency-Access-Checklist">Emergency Access Checklist</h3>
<ul>
<li>[ ] <strong>Local admin account exists</strong> on each critical service</li>
<li>[ ] <strong>Strong unique passwords</strong> for all local accounts</li>
<li>[ ] <strong>MFA enabled</strong> on local accounts where supported</li>
<li>[ ] <strong>Credentials documented</strong> in secure location (password manager)</li>
<li>[ ] <strong>Test local login</strong> monthly to ensure it works</li>
<li>[ ] <strong>Recovery procedures documented</strong> - how to fix SSO</li>
<li>[ ] <strong>Backup of SSO config</strong> - can restore quickly</li>
</ul>
<h3 id="Example-Proxmox-with-SSO-Local-Account">Example: Proxmox with SSO + Local Account</h3>
<p><strong>Setup:</strong></p>
<ol>
<li><strong>Configure SSO (OIDC):</strong></li>
</ol>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Datacenter ‚Üí Permissions ‚Üí Realms ‚Üí Add ‚Üí OpenID Connect</span>
Issuer URL: https://auth.homelab.local/application/o/proxmox/
Client ID: proxmox
Client Key: your-secret
Default: Yes</code></pre>
<ol start="2">
<li><strong>Keep local root@pam account:</strong></li>
</ol>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Root account still works with password</span>
<span class="token comment"># Enable TOTP for extra security:</span>
<span class="token comment"># Datacenter ‚Üí Permissions ‚Üí Two Factor ‚Üí Add ‚Üí TOTP</span>
<span class="token comment"># User: root@pam</span></code></pre>
<ol start="3">
<li><strong>Test both methods:</strong></li>
</ol>
<pre class="language-none"><code class="language-none">SSO login: https://proxmox.local ‚Üí Redirects to Authelia ‚Üí Success
Local login: https://proxmox.local ‚Üí Choose "PAM" realm ‚Üí root + password + TOTP ‚Üí Success</code></pre>
<h3 id="Recovery-Procedure-Example">Recovery Procedure Example</h3>
<p><strong>Scenario: Authelia container crashed</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. Can't access any services via SSO</span>
<span class="token comment"># 2. Use local account to access Proxmox</span>
<span class="token comment">#    Login: root@pam + password + TOTP</span>

<span class="token comment"># 3. Check Authelia container</span>
<span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> <span class="token operator">|</span> <span class="token function">grep</span> authelia

<span class="token comment"># 4. Check logs</span>
<span class="token function">docker</span> logs authelia

<span class="token comment"># 5. Restart container</span>
<span class="token function">docker</span> restart authelia

<span class="token comment"># 6. Verify SSO works again</span>
<span class="token function">curl</span> https://auth.homelab.local/api/health

<span class="token comment"># 7. Test SSO login on a service</span></code></pre>
<h3 id="What-NOT-To-Do">What NOT To Do</h3>
<p>‚ùå <strong>Don‚Äôt disable local accounts completely</strong></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">// BAD: Removes all local login options</span>
<span class="token string single-quoted-string">'oidc_login_disable_registration'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
<span class="token string single-quoted-string">'oidc_login_hide_password_form'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
<span class="token string single-quoted-string">'oidc_login_auto_redirect'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
<span class="token comment">// If SSO breaks, you're locked out!</span></code></pre>
<p>‚ùå <strong>Don‚Äôt use weak passwords for local accounts</strong></p>
<pre class="language-none"><code class="language-none">Local password: "admin123"  // BAD - bypasses all SSO security</code></pre>
<p>‚ùå <strong>Don‚Äôt forget to test local login</strong></p>
<pre class="language-none"><code class="language-none">// Set up local account ‚Üí Never test it ‚Üí SSO breaks ‚Üí Local account also broken</code></pre>
<div class="admonition tip"><p class="admonition-title"><span class="mdi mdi-lightbulb-on-outline admonition-icon"></span>üí° Golden Rule</p><div class="admonition-content"><p><strong>Always maintain a secure backdoor:</strong></p>
<ul>
<li>SSO is your front door (convenient, secure)</li>
<li>Local accounts are your emergency exit (rarely used, always available)</li>
<li>Both should be secured with MFA</li>
<li>Test both regularly</li>
</ul>
<p>Think of it like having a spare key hidden outside your house - you rarely need it, but when you do, you'll be glad it's there!</p>
</div></div>
<h2 id="User-Management">User Management</h2>
<h3 id="Adding-Users-Authelia">Adding Users (Authelia)</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># config/users_database.yml</span>
<span class="token key atrule">users</span><span class="token punctuation">:</span>
  <span class="token key atrule">newuser</span><span class="token punctuation">:</span>
    <span class="token key atrule">displayname</span><span class="token punctuation">:</span> <span class="token string">"New User"</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"$argon2id$v=19$m=65536,t=3,p=4$..."</span>
    <span class="token key atrule">email</span><span class="token punctuation">:</span> newuser@homelab.local
    <span class="token key atrule">groups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> users</code></pre>
<p>Restart Authelia after changes.</p>
<h3 id="Adding-Users-Authentik">Adding Users (Authentik)</h3>
<ol>
<li><strong>Directory ‚Üí Users ‚Üí Create</strong></li>
<li>Fill in details</li>
<li>Assign to groups</li>
<li>Set password (or send invite)</li>
</ol>
<h3 id="Group-Based-Access-Control">Group-Based Access Control</h3>
<p><strong>Authelia:</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># config/configuration.yml</span>
<span class="token key atrule">access_control</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">domain</span><span class="token punctuation">:</span> <span class="token string">"admin.homelab.local"</span>
      <span class="token key atrule">policy</span><span class="token punctuation">:</span> two_factor
      <span class="token key atrule">subject</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">"group:admins"</span>
    
    <span class="token punctuation">-</span> <span class="token key atrule">domain</span><span class="token punctuation">:</span> <span class="token string">"*.homelab.local"</span>
      <span class="token key atrule">policy</span><span class="token punctuation">:</span> two_factor
      <span class="token key atrule">subject</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">"group:users"</span></code></pre>
<p><strong>Authentik:</strong></p>
<ol>
<li>Create groups: admins, users, family</li>
<li>Assign users to groups</li>
<li>In application policies, check group membership</li>
</ol>
<h2 id="Advanced-LDAP-Integration">Advanced: LDAP Integration</h2>
<p>For larger setups, use LDAP as central user directory.</p>
<h3 id="Install-OpenLDAP">Install OpenLDAP</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># docker-compose.yml</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">openldap</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> osixia/openldap<span class="token punctuation">:</span>latest
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> LDAP_ORGANISATION=Homelab
      <span class="token punctuation">-</span> LDAP_DOMAIN=homelab.local
      <span class="token punctuation">-</span> LDAP_ADMIN_PASSWORD=admin_password
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ldap_data<span class="token punctuation">:</span>/var/lib/ldap
      <span class="token punctuation">-</span> ldap_config<span class="token punctuation">:</span>/etc/ldap/slapd.d
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"389:389"</span>
      <span class="token punctuation">-</span> <span class="token string">"636:636"</span>

  <span class="token key atrule">ldap-admin</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> osixia/phpldapadmin<span class="token punctuation">:</span>latest
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> PHPLDAPADMIN_LDAP_HOSTS=openldap
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"8080:80"</span>
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> openldap

<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token key atrule">ldap_data</span><span class="token punctuation">:</span>
  ldap_config<span class="token punctuation">:</span></code></pre>
<h3 id="Configure-Authelia-with-LDAP">Configure Authelia with LDAP</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># config/configuration.yml</span>
<span class="token key atrule">authentication_backend</span><span class="token punctuation">:</span>
  <span class="token key atrule">ldap</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> ldap<span class="token punctuation">:</span>//openldap<span class="token punctuation">:</span><span class="token number">389</span>
    <span class="token key atrule">base_dn</span><span class="token punctuation">:</span> dc=homelab<span class="token punctuation">,</span>dc=local
    <span class="token key atrule">username_attribute</span><span class="token punctuation">:</span> uid
    <span class="token key atrule">additional_users_dn</span><span class="token punctuation">:</span> ou=users
    <span class="token key atrule">users_filter</span><span class="token punctuation">:</span> (<span class="token important">&amp;(</span><span class="token punctuation">{</span>username_attribute<span class="token punctuation">}</span>=<span class="token punctuation">{</span>input<span class="token punctuation">}</span>)(objectClass=person))
    <span class="token key atrule">additional_groups_dn</span><span class="token punctuation">:</span> ou=groups
    <span class="token key atrule">groups_filter</span><span class="token punctuation">:</span> (<span class="token important">&amp;(member=</span><span class="token punctuation">{</span>dn<span class="token punctuation">}</span>)(objectClass=groupOfNames))
    <span class="token key atrule">user</span><span class="token punctuation">:</span> cn=admin<span class="token punctuation">,</span>dc=homelab<span class="token punctuation">,</span>dc=local
    <span class="token key atrule">password</span><span class="token punctuation">:</span> admin_password</code></pre>
<h3 id="Configure-Authentik-with-LDAP">Configure Authentik with LDAP</h3>
<ol>
<li><strong>Directory ‚Üí Federation &amp; Social ‚Üí LDAP Sources</strong></li>
<li>Create new LDAP source</li>
<li>Configure connection details</li>
<li>Map attributes</li>
</ol>
<h2 id="Security-Best-Practices">Security Best Practices</h2>
<div class="admonition danger"><p class="admonition-title"><span class="mdi mdi-alert-circle-outline admonition-icon"></span>‚ö†Ô∏è Critical Security Measures</p><div class="admonition-content"><p><strong>Protect Your SSO System:</strong></p>
<ul>
<li>SSO is single point of failure - secure it well</li>
<li>Use strong admin passwords</li>
<li>Enable MFA for all admin accounts</li>
<li>Keep software updated</li>
<li>Monitor authentication logs</li>
<li>Backup configuration regularly</li>
</ul>
</div></div>
<p><strong>Security Checklist:</strong></p>
<ul>
<li>[ ] Strong passwords for all accounts</li>
<li>[ ] MFA enabled for admins</li>
<li>[ ] HTTPS everywhere (use private CA)</li>
<li>[ ] Rate limiting enabled</li>
<li>[ ] Failed login notifications</li>
<li>[ ] Regular security audits</li>
<li>[ ] Backup authentication database</li>
<li>[ ] Document recovery procedures</li>
<li>[ ] Test account recovery flow</li>
<li>[ ] Monitor for suspicious activity</li>
</ul>
<p><strong>Network Security:</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Authelia rate limiting</span>
<span class="token key atrule">regulation</span><span class="token punctuation">:</span>
  <span class="token key atrule">max_retries</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">find_time</span><span class="token punctuation">:</span> 2m
  <span class="token key atrule">ban_time</span><span class="token punctuation">:</span> 5m</code></pre>
<p><strong>Session Security:</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Short session timeouts</span>
<span class="token key atrule">session</span><span class="token punctuation">:</span>
  <span class="token key atrule">expiration</span><span class="token punctuation">:</span> 1h
  <span class="token key atrule">inactivity</span><span class="token punctuation">:</span> 15m</code></pre>
<h2 id="Troubleshooting">Troubleshooting</h2>
<h3 id="Issue-Redirect-Loop">Issue: Redirect Loop</h3>
<p><strong>Cause:</strong> Misconfigured forward auth or session cookies</p>
<p><strong>Solution:</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Ensure session domain matches</span>
<span class="token key atrule">session</span><span class="token punctuation">:</span>
  <span class="token key atrule">domain</span><span class="token punctuation">:</span> homelab.local  <span class="token comment"># Must match your domain</span></code></pre>
<h3 id="Issue-‚ÄúInvalid-Redirect-URI‚Äù">Issue: ‚ÄúInvalid Redirect URI‚Äù</h3>
<p><strong>Cause:</strong> Application redirect URI doesn‚Äôt match OIDC config</p>
<p><strong>Solution:</strong><br>
Check application logs for actual redirect URI, update in IdP.</p>
<h3 id="Issue-Users-Can‚Äôt-Access-After-Login">Issue: Users Can‚Äôt Access After Login</h3>
<p><strong>Cause:</strong> Missing authorization headers</p>
<p><strong>Solution:</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Traefik - ensure headers are forwarded</span>
<span class="token punctuation">-</span> <span class="token string">"traefik.http.middlewares.authelia.forwardauth.authResponseHeaders=Remote-User,Remote-Groups"</span></code></pre>
<h3 id="Issue-Session-Expires-Too-Quickly">Issue: Session Expires Too Quickly</h3>
<p><strong>Solution:</strong></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Increase session duration</span>
<span class="token key atrule">session</span><span class="token punctuation">:</span>
  <span class="token key atrule">expiration</span><span class="token punctuation">:</span> 12h
  <span class="token key atrule">inactivity</span><span class="token punctuation">:</span> 2h
  <span class="token key atrule">remember_me_duration</span><span class="token punctuation">:</span> 1M</code></pre>
<h2 id="Monitoring-and-Maintenance">Monitoring and Maintenance</h2>
<h3 id="Log-Monitoring">Log Monitoring</h3>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Authelia logs</span>
<span class="token function">docker</span> logs <span class="token parameter variable">-f</span> authelia

<span class="token comment"># Watch for failed logins</span>
<span class="token function">docker</span> logs authelia <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"authentication failed"</span></code></pre>
<h3 id="Backup-Strategy">Backup Strategy</h3>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># backup-sso.sh</span>

<span class="token assign-left variable">BACKUP_DIR</span><span class="token operator">=</span><span class="token string">"/backups/sso/<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d<span class="token variable">)</span></span>"</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$BACKUP_DIR</span>

<span class="token comment"># Backup Authelia</span>
<span class="token function">cp</span> <span class="token parameter variable">-r</span> /path/to/authelia/config <span class="token variable">$BACKUP_DIR</span>/
<span class="token function">cp</span> <span class="token parameter variable">-r</span> /path/to/authelia/secrets <span class="token variable">$BACKUP_DIR</span>/

<span class="token comment"># Backup Authentik database</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> authentik-postgres pg_dump <span class="token parameter variable">-U</span> authentik <span class="token operator">&gt;</span> <span class="token variable">$BACKUP_DIR</span>/authentik.sql

<span class="token builtin class-name">echo</span> <span class="token string">"Backup completed: <span class="token variable">$BACKUP_DIR</span>"</span></code></pre>
<h3 id="Health-Checks">Health Checks</h3>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># docker-compose.yml</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">authelia</span><span class="token punctuation">:</span>
    <span class="token key atrule">healthcheck</span><span class="token punctuation">:</span>
      <span class="token key atrule">test</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"CMD"</span><span class="token punctuation">,</span> <span class="token string">"wget"</span><span class="token punctuation">,</span> <span class="token string">"--no-verbose"</span><span class="token punctuation">,</span> <span class="token string">"--tries=1"</span><span class="token punctuation">,</span> <span class="token string">"--spider"</span><span class="token punctuation">,</span> <span class="token string">"http://localhost:9091/api/health"</span><span class="token punctuation">]</span>
      <span class="token key atrule">interval</span><span class="token punctuation">:</span> 30s
      <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 3s
      <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">3</span></code></pre>
<h2 id="Comparison-SSO-Solutions">Comparison: SSO Solutions</h2>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Authelia</th>
<th>Authentik</th>
<th>Keycloak</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>RAM Usage</strong></td>
<td>~50MB</td>
<td>~500MB</td>
<td>~1GB</td>
</tr>
<tr>
<td><strong>Setup Time</strong></td>
<td>30 min</td>
<td>1 hour</td>
<td>2+ hours</td>
</tr>
<tr>
<td><strong>Config Method</strong></td>
<td>YAML</td>
<td>Web UI</td>
<td>Web UI</td>
</tr>
<tr>
<td><strong>User Storage</strong></td>
<td>File/LDAP</td>
<td>Database</td>
<td>Database/LDAP</td>
</tr>
<tr>
<td><strong>OIDC</strong></td>
<td>Basic</td>
<td>Full</td>
<td>Full</td>
</tr>
<tr>
<td><strong>SAML</strong></td>
<td>‚ùå</td>
<td>‚úÖ</td>
<td>‚úÖ</td>
</tr>
<tr>
<td><strong>Learning Curve</strong></td>
<td>Low</td>
<td>Medium</td>
<td>High</td>
</tr>
<tr>
<td><strong>Community</strong></td>
<td>Active</td>
<td>Very Active</td>
<td>Huge</td>
</tr>
</tbody>
</table>
<h2 id="Real-World-Example-Complete-Homelab-SSO">Real-World Example: Complete Homelab SSO</h2>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Complete docker-compose.yml</span>
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.8'</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token comment"># Traefik reverse proxy</span>
  <span class="token key atrule">traefik</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> traefik<span class="token punctuation">:</span>latest
    <span class="token key atrule">command</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"--providers.docker=true"</span>
      <span class="token punctuation">-</span> <span class="token string">"--entrypoints.websecure.address=:443"</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"443:443"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /var/run/docker.sock<span class="token punctuation">:</span>/var/run/docker.sock

  <span class="token comment"># Authelia SSO</span>
  <span class="token key atrule">authelia</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> authelia/authelia<span class="token punctuation">:</span>latest
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./authelia/config<span class="token punctuation">:</span>/config
      <span class="token punctuation">-</span> ./authelia/secrets<span class="token punctuation">:</span>/secrets
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.enable=true"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.authelia.rule=Host(`auth.homelab.local`)"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.middlewares.authelia.forwardauth.address=http://authelia:9091/api/verify?rd=https://auth.homelab.local"</span>

  <span class="token comment"># Nextcloud with SSO</span>
  <span class="token key atrule">nextcloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nextcloud<span class="token punctuation">:</span>latest
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> nextcloud_data<span class="token punctuation">:</span>/var/www/html
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.enable=true"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.nextcloud.rule=Host(`nextcloud.homelab.local`)"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.nextcloud.middlewares=authelia@docker"</span>

  <span class="token comment"># Grafana with SSO</span>
  <span class="token key atrule">grafana</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> grafana/grafana<span class="token punctuation">:</span>latest
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> GF_AUTH_GENERIC_OAUTH_ENABLED=true
      <span class="token punctuation">-</span> GF_AUTH_GENERIC_OAUTH_CLIENT_ID=grafana
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.enable=true"</span>
      <span class="token punctuation">-</span> <span class="token string">"traefik.http.routers.grafana.rule=Host(`grafana.homelab.local`)"</span>

<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  nextcloud_data<span class="token punctuation">:</span></code></pre>
<h2 id="Resources">Resources</h2>
<ul>
<li><strong><a target="_blank" rel="noopener" href="https://www.authelia.com/">Authelia Documentation</a>:</strong> Complete Authelia guide</li>
<li><strong><a target="_blank" rel="noopener" href="https://goauthentik.io/docs/">Authentik Documentation</a>:</strong> Authentik setup and config</li>
<li><strong><a target="_blank" rel="noopener" href="https://www.keycloak.org/documentation">Keycloak Documentation</a>:</strong> Enterprise SSO guide</li>
<li><strong><a target="_blank" rel="noopener" href="https://openid.net/connect/">OIDC Explained</a>:</strong> Understanding OpenID Connect</li>
</ul>
<h2 id="Conclusion">Conclusion</h2>
<p>Setting up SSO at home transforms your homelab from a collection of separate services into a unified platform. The initial setup investment pays off immediately with convenience and improved security.</p>
<p><strong>Key Takeaways:</strong></p>
<ul>
<li>SSO eliminates password fatigue across multiple services</li>
<li><strong>Authelia is best for simple setups</strong> with reverse proxy</li>
<li><strong>Authentik offers full features</strong> with beautiful UI</li>
<li>Forward authentication protects any service</li>
<li>MFA adds critical security layer</li>
<li>LDAP integration scales for larger deployments</li>
<li>Regular backups are essential (SSO is single point of failure)</li>
<li><strong>Homelab SSO is limited to self-hosted services</strong> - SaaS integration requires expensive enterprise plans</li>
<li>Federation (OIDC/SAML) enables SSO across systems, but WIA is non-federated</li>
</ul>
<p><strong>Quick Start Recommendation:</strong></p>
<p>For most homelabs:</p>
<ol>
<li>Start with <strong>Authelia</strong> + Traefik (simplest path)</li>
<li>Use file-based authentication initially</li>
<li>Add MFA for admin accounts</li>
<li>Gradually migrate services to SSO</li>
<li>Consider Authentik if you need OIDC/SAML later</li>
</ol>
<p>Start with 2-3 services, get comfortable with the flow, then expand. Your future self will thank you when you‚Äôre not juggling dozens of passwords anymore! üîê</p>

        </div>
        <footer class="article-footer">
            
    <a data-url="https://neo01.com/2025/01/Single-Sign-On-at-Home/" data-id="3cc1f399" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url').replace("http://","https://"),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
    <!--script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": {
            "@type": "Person",
            "name": "Neo Alienson"
        },
        "headline": "Setting Up Single Sign-On at Home",
        "image": "https://neo01.com",
        "keywords": "Authentication Cybersecurity Homelab SSO",
        "genre": "Cybersecurity",
        "datePublished": "2025-01-15",
        "dateCreated": "2025-01-15",
        "dateModified": "2025-10-12",
        "url": "https://neo01.com/2025/01/Single-Sign-On-at-Home/",
        "description": "Tired of managing dozens of passwords for your homelab services? Learn how to set up Single Sign-On to access all your services with one login.",
        "wordCount": 6992
    }
</script-->

</article>

                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>follow:</p>
        <ul class="social-links">
                <li>
                    <a class="social-tooltip" title="stack-exchange" href="https://stackexchange.com/users/2122053/neo?tab=accounts" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-exchange"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="stack-overflow" href="https://stackoverflow.com/users/1885105/neo" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-stack-overflow"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/neoalienson" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-github"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="linkedin" href="https://linkedin.com/in/neo01" target="_blank" rel="noopener">
                        <i class="icon fa-brands fa-linkedin"></i>
                    </a>
                </li>
                <li>
                    <a class="social-tooltip" title="rss" href="/atom.xml" target="_blank" rel="noopener">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
        </ul>
    </div>
    <div class="widgets-container">
        
            
                <div class="widget-wrap widget-list">
    <h3 class="widget-title">links</h3>
    <div class="widget">
        <ul><li><a href="/ai">AI Playground</a></li><li><a href="/tools">Tools</a></li><li><a href="/games">Games</a></li><li><a href="/pages/useful-information">Useful Information</a></li><li><a href="/pages/Hexo-Blogging-Cheatsheet">Hexo Blogging Cheatsheet</a></li></ul>
    </div>
</div>

            
                
            
                    <div class="widget-wrap">
        <h3 class="widget-title">recents</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                    <li>
                        <div class="item-thumbnail">
                            <a href="/2025/10/Tools-Games-And-Browser-Built-In-AI/" class="thumbnail">
        <span style="background-image:url(/2025/10/Tools-Games-And-Browser-Built-In-AI/thumbnail.jpeg)" alt="Tools, Games and Browser Built-in AI Playground" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/AI/">AI</a></p>
                            <p class="item-title"><a href="/2025/10/Tools-Games-And-Browser-Built-In-AI/" class="title">Tools, Games and Browser Built-in AI Playground</a></p>
                            <p class="item-date"><time datetime="2025-10-01T16:00:00.000Z" itemprop="datePublished">2025-10-02</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/" class="thumbnail">
        <span style="background-image:url(/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/thumbnail.jpeg)" alt="The Rise of Agentic Coding: AI-Powered Software Engineering" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/AI/">AI</a></p>
                            <p class="item-title"><a href="/2025/09/The_Rise_of_Agentic_Coding_AI_Powered_Software_Engineering/" class="title">The Rise of Agentic Coding: AI-Powered Software Engineering</a></p>
                            <p class="item-date"><time datetime="2025-09-19T16:00:00.000Z" itemprop="datePublished">2025-09-20</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/2025/08/Understanding_Ephemeral_Ports_Part2/" class="thumbnail">
        <span style="background-image:url(/2025/08/Understanding_Ephemeral_Ports_Part1/thumbnail.png)" alt="Understanding Ephemeral Ports Part 2: Why Server Applications Should Avoid Dynamic Ports" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Development/">Development</a></p>
                            <p class="item-title"><a href="/2025/08/Understanding_Ephemeral_Ports_Part2/" class="title">Understanding Ephemeral Ports Part 2: Why Server Applications Should Avoid Dynamic Ports</a></p>
                            <p class="item-date"><time datetime="2025-08-30T16:00:00.000Z" itemprop="datePublished">2025-08-31</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/2025/08/Understanding_Ephemeral_Ports_Part1/" class="thumbnail">
        <span style="background-image:url(/2025/08/Understanding_Ephemeral_Ports_Part1/thumbnail.png)" alt="Understanding Ephemeral Ports: The Invisible Workers of Network Communication" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Development/">Development</a></p>
                            <p class="item-title"><a href="/2025/08/Understanding_Ephemeral_Ports_Part1/" class="title">Understanding Ephemeral Ports: The Invisible Workers of Network Communication</a></p>
                            <p class="item-date"><time datetime="2025-08-29T16:00:00.000Z" itemprop="datePublished">2025-08-30</time></p>
                        </div>
                    </li>
                    <li>
                        <div class="item-thumbnail">
                            <a href="/2025/07/Architecture_As_Code_Part_2_Building_the_Foundation/" class="thumbnail">
        <span style="background-image:url(/2025/07/Architecture_As_Code_Part_2_Building_the_Foundation/thumbnail.jpg)" alt="Architecture as Code: Part 2 - Building the Foundation" class="thumbnail-image"></span>
</a>
                        </div>
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Architecture/">Architecture</a></p>
                            <p class="item-title"><a href="/2025/07/Architecture_As_Code_Part_2_Building_the_Foundation/" class="title">Architecture as Code: Part 2 - Building the Foundation</a></p>
                            <p class="item-date"><time datetime="2025-07-19T16:00:00.000Z" itemprop="datePublished">2025-07-20</time></p>
                        </div>
                    </li>
            </ul>
        </div>
    </div>

            
                
    
    
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list">
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2025/">2025</a>
                    <span class="archive-list-count">11</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2024/">2024</a>
                    <span class="archive-list-count">24</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2023/">2023</a>
                    <span class="archive-list-count">12</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2022/">2022</a>
                    <span class="archive-list-count">2</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2020/">2020</a>
                    <span class="archive-list-count">5</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2019/">2019</a>
                    <span class="archive-list-count">12</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2018/">2018</a>
                    <span class="archive-list-count">2</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2017/">2017</a>
                    <span class="archive-list-count">5</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2016/">2016</a>
                    <span class="archive-list-count">4</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2015/">2015</a>
                    <span class="archive-list-count">6</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2014/">2014</a>
                    <span class="archive-list-count">7</span>
                </li>
            
                <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2013/">2013</a>
                    <span class="archive-list-count">2</span>
                </li>
            
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <!-- disable caching cause each page has different footer from qrcode -->
        <!-- common/footer, null, {cache: !config.relative_link})  -->
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="qrcode-share-wrapper">
                <div class="qrcode-text">https://neo01.com/l#c834f972</div>
                <img src="/qr/qr-af113df18839e2194cd1c53758c451f7.svg" width="200" height="200" alt="QR Code for https://neo01.com/l#c834f972">
            </div>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" title="Homepage" class="logo"></a>
                </h1>
                
                <p>¬© 2025 Neo Alienson. All rights reserved.
                  <a href="/terms-and-conditions">Terms and Conditions</a></p>
                
            </div>
            <div class="footer-plugins">
              


            </div>
        </div>
    </div>
</footer>

        
    
        


        


        


        


        


        


        


        


        


    



<!-- Custom Scripts -->




    </div>
<!-- hexo injector body_end start --><script type="text/javascript" src="/js/bundle_last.js"></script><!-- hexo injector body_end end -->

</body></html>